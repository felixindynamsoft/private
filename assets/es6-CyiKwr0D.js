(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))f(g);new MutationObserver(g=>{for(const v of g)if(v.type==="childList")for(const y of v.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&f(y)}).observe(document,{childList:!0,subtree:!0});function a(g){const v={};return g.integrity&&(v.integrity=g.integrity),g.referrerPolicy&&(v.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?v.credentials="include":g.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function f(g){if(g.ep)return;g.ep=!0;const v=a(g);fetch(g.href,v)}})();/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.2.30
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */function Me(h,t,a,f){if(a==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?h!==t||!f:!t.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?f:a==="a"?f.call(h):f?f.value:t.get(h)}function si(h,t,a,f,g){if(typeof t=="function"?h!==t||!g:!t.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(h,a),a}var _i,At,Ee;typeof SuppressedError=="function"&&SuppressedError,function(h){h[h.BOPM_BLOCK=0]="BOPM_BLOCK",h[h.BOPM_UPDATE=1]="BOPM_UPDATE"}(_i||(_i={})),function(h){h[h.CCUT_AUTO=0]="CCUT_AUTO",h[h.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",h[h.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",h[h.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",h[h.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",h[h.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(At||(At={})),function(h){h[h.IPF_BINARY=0]="IPF_BINARY",h[h.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",h[h.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",h[h.IPF_NV21=3]="IPF_NV21",h[h.IPF_RGB_565=4]="IPF_RGB_565",h[h.IPF_RGB_555=5]="IPF_RGB_555",h[h.IPF_RGB_888=6]="IPF_RGB_888",h[h.IPF_ARGB_8888=7]="IPF_ARGB_8888",h[h.IPF_RGB_161616=8]="IPF_RGB_161616",h[h.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",h[h.IPF_ABGR_8888=10]="IPF_ABGR_8888",h[h.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",h[h.IPF_BGR_888=12]="IPF_BGR_888",h[h.IPF_BINARY_8=13]="IPF_BINARY_8",h[h.IPF_NV12=14]="IPF_NV12",h[h.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(Ee||(Ee={}));const to=h=>Object.prototype.toString.call(h),io=h=>Array.isArray?Array.isArray(h):to(h)==="[object Array]",ts=h=>to(h)==="[object Boolean]",rt=h=>typeof h=="number"&&!Number.isNaN(h),ii=h=>h!==null&&typeof h=="object"&&!Array.isArray(h),ro=h=>!!ii(h)&&h.bytes instanceof Uint8Array&&!!rt(h.width)&&!(h.width<=0)&&!!rt(h.height)&&!(h.height<=0)&&!!rt(h.stride)&&!(h.stride<=0)&&"format"in h&&!("tag"in h&&!Ho(h.tag)),Yo=h=>!!ii(h)&&!!rt(h.left)&&!(h.left<0)&&!!rt(h.top)&&!(h.top<0)&&!!rt(h.right)&&!(h.right<0)&&!!rt(h.bottom)&&!(h.bottom<0)&&!(h.left>=h.right)&&!(h.top>=h.bottom)&&!!ts(h.isMeasuredInPercentage),Ho=h=>!!ii(h)&&!!rt(h.imageId)&&"type"in h,is=h=>!!ii(h)&&!!rt(h.x)&&!!rt(h.y),Xo=h=>!!ii(h)&&!!io(h.points)&&h.points.length!=0&&!h.points.some(t=>!is(t)),zo=h=>!!ii(h)&&!!io(h.points)&&h.points.length!=0&&h.points.length==4&&!h.points.some(t=>!is(t)),Zo=h=>!!ii(h)&&!!rt(h.x)&&!!rt(h.y)&&!!rt(h.width)&&!(h.width<0)&&!!rt(h.height)&&!(h.height<0)&&!("isMeasuredInPercentage"in h&&!ts(h.isMeasuredInPercentage));async function Mn(h,t){return await new Promise((a,f)=>{let g=new XMLHttpRequest;g.open("GET",h,!0),g.responseType=t,g.send(),g.onloadend=async()=>{g.status<200||g.status>=300?f(h+" "+g.status):a(g.response)},g.onerror=()=>{f(new Error("Network Error: "+g.statusText))}})}function Ko(h){return/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(h)}const ri=(h,t)=>{let a=h.split("."),f=t.split(".");for(let g=0;g<a.length&&g<f.length;++g){let v=a[g],y=f[g];if(v===y)continue;let w=parseInt(a[g]),I=parseInt(f[g]);return w===I||Number.isNaN(w)&&Number.isNaN(I)?v<y?-1:1:w<I||Number.isNaN(w)&&Number.isInteger(I)?-1:1}return a.length===f.length?0:a.length<f.length?-1:1},qo=typeof BigInt=="function";var Ar,Je,ai,Ji,Qi,_t,hi,Fn;let Pn=class Lt{get _isFetchingStarted(){return Me(this,Qi,"f")}constructor(){Ar.add(this),Je.set(this,[]),ai.set(this,1),Ji.set(this,_i.BOPM_BLOCK),Qi.set(this,!1),_t.set(this,void 0),hi.set(this,At.CCUT_AUTO)}setErrorListener(t){}addImageToBuffer(t){var a;if(!ro(t))throw new TypeError("Invalid 'image'.");if(!((a=t.tag)===null||a===void 0)&&a.hasOwnProperty("imageId")&&typeof t.tag.imageId=="number"&&this.hasImage(t.tag.imageId))throw new Error("Existed imageId.");if(Me(this,Je,"f").length>=Me(this,ai,"f"))switch(Me(this,Ji,"f")){case _i.BOPM_BLOCK:break;case _i.BOPM_UPDATE:if(Me(this,Je,"f").push(t),ii(Me(this,_t,"f"))&&rt(Me(this,_t,"f").imageId)&&Me(this,_t,"f").keepInBuffer==1)for(;Me(this,Je,"f").length>Me(this,ai,"f");){const f=Me(this,Je,"f").findIndex(g=>{var v;return((v=g.tag)===null||v===void 0?void 0:v.imageId)!==Me(this,_t,"f").imageId});Me(this,Je,"f").splice(f,1)}else Me(this,Je,"f").splice(0,Me(this,Je,"f").length-Me(this,ai,"f"))}else Me(this,Je,"f").push(t)}getImage(){if(Me(this,Je,"f").length===0)return null;let t;if(Me(this,_t,"f")&&rt(Me(this,_t,"f").imageId)){const a=Me(this,Ar,"m",Fn).call(this,Me(this,_t,"f").imageId);if(a<0)throw new Error(`Image with id ${Me(this,_t,"f").imageId} doesn't exist.`);t=Me(this,Je,"f").slice(a,a+1)[0]}else t=Me(this,Je,"f").pop();if([Ee.IPF_RGB_565,Ee.IPF_RGB_555,Ee.IPF_RGB_888,Ee.IPF_ARGB_8888,Ee.IPF_RGB_161616,Ee.IPF_ARGB_16161616,Ee.IPF_ABGR_8888,Ee.IPF_ABGR_16161616,Ee.IPF_BGR_888].includes(t.format)){if(Me(this,hi,"f")===At.CCUT_RGB_R_CHANNEL_ONLY){Lt._onLog&&Lt._onLog("only get R channel data.");const a=new Uint8Array(t.width*t.height);for(let f=0;f<a.length;f++)switch(t.format){case Ee.IPF_RGB_565:case Ee.IPF_RGB_555:case Ee.IPF_RGB_888:case Ee.IPF_RGB_161616:a[f]=t.bytes[3*f+2];break;case Ee.IPF_ARGB_8888:case Ee.IPF_ARGB_16161616:a[f]=t.bytes[4*f+2];break;case Ee.IPF_BGR_888:a[f]=t.bytes[3*f];break;case Ee.IPF_ABGR_8888:case Ee.IPF_ABGR_16161616:a[f]=t.bytes[4*f]}t.bytes=a,t.stride=t.width,t.format=Ee.IPF_GRAYSCALED}else if(Me(this,hi,"f")===At.CCUT_RGB_G_CHANNEL_ONLY){Lt._onLog&&Lt._onLog("only get G channel data.");const a=new Uint8Array(t.width*t.height);for(let f=0;f<a.length;f++)switch(t.format){case Ee.IPF_RGB_565:case Ee.IPF_RGB_555:case Ee.IPF_RGB_888:case Ee.IPF_RGB_161616:case Ee.IPF_BGR_888:a[f]=t.bytes[3*f+1];break;case Ee.IPF_ARGB_8888:case Ee.IPF_ARGB_16161616:case Ee.IPF_ABGR_8888:case Ee.IPF_ABGR_16161616:a[f]=t.bytes[4*f+1]}t.bytes=a,t.stride=t.width,t.format=Ee.IPF_GRAYSCALED}else if(Me(this,hi,"f")===At.CCUT_RGB_B_CHANNEL_ONLY){Lt._onLog&&Lt._onLog("only get B channel data.");const a=new Uint8Array(t.width*t.height);for(let f=0;f<a.length;f++)switch(t.format){case Ee.IPF_RGB_565:case Ee.IPF_RGB_555:case Ee.IPF_RGB_888:case Ee.IPF_RGB_161616:a[f]=t.bytes[3*f];break;case Ee.IPF_ARGB_8888:case Ee.IPF_ARGB_16161616:a[f]=t.bytes[4*f];break;case Ee.IPF_BGR_888:a[f]=t.bytes[3*f+2];break;case Ee.IPF_ABGR_8888:case Ee.IPF_ABGR_16161616:a[f]=t.bytes[4*f+2]}t.bytes=a,t.stride=t.width,t.format=Ee.IPF_GRAYSCALED}}else[Ee.IPF_NV21,Ee.IPF_NV12].includes(t.format)&&Lt._onLog&&Lt._onLog("NV21 or NV12 is not supported.");return t}setNextImageToReturn(t,a){if(!((...f)=>f.length!==0&&f.every(g=>rt(g)))(t))throw new TypeError("Invalid 'imageId'.");if(a!==void 0&&!ts(a))throw new TypeError("Invalid 'keepInBuffer'.");si(this,_t,{imageId:t,keepInBuffer:a})}_resetNextReturnedImage(){si(this,_t,null)}hasImage(t){return Me(this,Ar,"m",Fn).call(this,t)>=0}startFetching(){si(this,Qi,!0)}stopFetching(){si(this,Qi,!1)}setMaxImageCount(t){if(typeof t!="number")throw new TypeError("Invalid 'count'.");if(t<1||Math.round(t)!==t)throw new Error("Invalid 'count'.");for(si(this,ai,t);Me(this,Je,"f")&&Me(this,Je,"f").length>t;)Me(this,Je,"f").shift()}getMaxImageCount(){return Me(this,ai,"f")}getImageCount(){return Me(this,Je,"f").length}clearBuffer(){Me(this,Je,"f").length=0}isBufferEmpty(){return Me(this,Je,"f").length===0}setBufferOverflowProtectionMode(t){si(this,Ji,t)}getBufferOverflowProtectionMode(){return Me(this,Ji,"f")}setColourChannelUsageType(t){si(this,hi,t)}getColourChannelUsageType(){return Me(this,hi,"f")}};Je=new WeakMap,ai=new WeakMap,Ji=new WeakMap,Qi=new WeakMap,_t=new WeakMap,hi=new WeakMap,Ar=new WeakSet,Fn=function(h){if(typeof h!="number")throw new TypeError("Invalid 'imageId'.");return Me(this,Je,"f").findIndex(t=>{var a;return((a=t.tag)===null||a===void 0?void 0:a.imageId)===h})};const Jr=typeof self>"u",ds=(()=>{if(!Jr&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})(),no=h=>{if(h==null&&(h="./"),!Jr){let t=document.createElement("a");t.href=h,h=t.href}return h.endsWith("/")||(h+="/"),h};let Xi,Gt,wr,Qr,at;typeof navigator<"u"&&(Xi=navigator,Gt=Xi.userAgent,wr=Xi.platform,Qr=Xi.mediaDevices),function(){if(!Jr){const h={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Xi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:wr,search:"Win"},Mac:{str:wr},Linux:{str:wr}};let a="unknownBrowser",f=0,g="unknownOS";for(let v in h){const y=h[v]||{};let w=y.str||Gt,I=y.search||v,x=y.verStr||Gt,A=y.verSearch||v;if(A instanceof Array||(A=[A]),w.indexOf(I)!=-1){a=v;for(let L of A){let k=x.indexOf(L);if(k!=-1){f=parseFloat(x.substring(k+L.length+1));break}}break}}for(let v in t){const y=t[v]||{};let w=y.str||Gt,I=y.search||v;if(w.indexOf(I)!=-1){g=v;break}}g=="Linux"&&Gt.indexOf("Windows NT")!=-1&&(g="HarmonyOS"),at={browser:a,version:f,OS:g}}Jr&&(at={browser:"ssr",version:0,OS:"ssr"})}();const $o=typeof WebAssembly<"u"&&Gt&&!(/Safari/.test(Gt)&&!/Chrome/.test(Gt)&&/\(.+\s11_2_([2-6]).*\)/.test(Gt)),Jo=!(typeof Worker>"u"),so=!(!Qr||!Qr.getUserMedia),Qo=async()=>{let h=!1;if(so)try{(await Qr.getUserMedia({video:!0})).getTracks().forEach(t=>{t.stop()}),h=!0}catch{}return h};at.browser==="Chrome"&&at.version>66||at.browser==="Safari"&&at.version>13||at.browser==="OPR"&&at.version>43||at.browser==="Edge"&&at.version;const fs=h=>h&&typeof h=="object"&&typeof h.then=="function";let rs=class extends Promise{constructor(t){let a,f;super((g,v)=>{a=g,f=v}),this._s="pending",this.resolve=g=>{this.isPending&&(fs(g)?this.task=g:(this._s="fulfilled",a(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let a;this._task=t,fs(t)?a=t:typeof t=="function"&&(a=new Promise(t)),a&&(async()=>{try{const f=await a;t===this._task&&this.resolve(f)}catch(f){t===this._task&&this.reject(f)}})()}get isEmpty(){return this._task==null}};const Ot={},oo=async h=>{let t=[h],a=[];for(let f of t)a.push(Ot[f]=Ot[f]||new rs);await Promise.all(a)},en=async(h,t)=>{let a,f=typeof h=="string"?[h]:h,g=[];for(let v of f){let y;g.push(y=Ot[v]=Ot[v]||new rs(a=a||t())),y.isEmpty&&(y.task=a=a||t())}await Promise.all(g)};let xe,ao=0;const je=()=>ao++,Le={};let ei;const ea=h=>{ei=h,xe&&xe.postMessage({type:"setBLog",body:{value:!!h}})};let ns=!1;const ta=h=>{ns=h,xe&&xe.postMessage({type:"setBDebug",body:{value:!!h}})},Tt={},Ke={},Ie={std:{version:"1.2.10",path:no(ds+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:ds}},er=new Proxy(Ie,{get(h,t,a){let f=Reflect.get(h,t,a);return f&&f.path&&(f=f.path),f}}),Ht={dip:{wasm:!0}},yt=async h=>{let t;h instanceof Array||(h=h?[h]:[]);{let g=Ot.core;t=!g||g.isEmpty}let a=new Map;for(let g of h){if(g=g.toLowerCase(),g=="std"||g=="core")continue;if(!Ht[g])throw Error("The '"+g+"' module cannot be found.");let v=Ht[g].deps;if(v?.length)for(let w of v){let I=Ot[w];a.has(w)||a.set(w,!I||I.isEmpty)}let y=Ot[g];a.has(g)||a.set(g,!y||y.isEmpty)}let f=[];t&&f.push("core"),f.push(...a.keys()),await en(f,async()=>{const g=[...a.entries()].filter(A=>A[1]).map(A=>A[0]),v={};for(let A in er){if(A=="rootDirectory")continue;let L=er[A];er.rootDirectory&&(L.startsWith("http://")||L.startsWith("https://")||(L=er.rootDirectory+"/"+L)),v[A]=no(L)}const y={};for(let A of g)y[A]=Ht[A];const w={engineResourcePaths:v,autoResources:y,names:g};let I=new rs;if(t){w.needLoadCore=!0;let A=v.core+Ze._workerName;v.rootDirectory&&(A=v.rootDirectory+A),A.startsWith(location.origin)||(A=await fetch(A).then(L=>L.blob()).then(L=>URL.createObjectURL(L))),xe=new Worker(A),xe.onerror=L=>{let k=new Error(L.message);I.reject(k)},xe.addEventListener("message",L=>{let k=L.data?L.data:L,N=k.type,P=k.id,V=k.body;switch(N){case"log":ei&&ei(k.message);break;case"task":try{Le[P](V),delete Le[P]}catch(W){throw delete Le[P],W}break;case"event":try{Le[P](V)}catch(W){throw W}break;default:console.log(L)}}),w.bLog=!!ei,w.bd=ns,w.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await oo("worker");let x=ao++;Le[x]=A=>{if(A.success)Object.assign(Tt,A.versions),JSON.stringify(A.versions)!=="{}"&&(Ze._versions=A.versions),I.resolve(void 0);else{const L=Error(A.message);A.stack&&(L.stack=A.stack),I.reject(L)}},xe.postMessage({type:"loadWasm",body:w,id:x}),t&&en("worker",()=>Promise.resolve()),await I})};class Ze{static get engineResourcePaths(){return er}static set engineResourcePaths(t){Object.assign(Ie,t)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ei}static set _onLog(t){ea(t)}static get _bDebug(){return ns}static set _bDebug(t){ta(t)}static isModuleLoaded(t){return t=(t=t||"core").toLowerCase(),!!Ot[t]&&Ot[t].isFulfilled}static async loadWasm(t){return await yt(t)}static async detectEnvironment(){return await(async()=>({wasm:$o,worker:Jo,getUserMedia:so,camera:await Qo(),browser:at.browser,version:at.version,OS:at.OS}))()}static async getModuleVersion(){return await new Promise((t,a)=>{let f=je();Le[f]=async g=>{if(g.success)return t(g.versions);{let v=new Error(g.message);return v.stack=g.stack+`
`+v.stack,a(v)}},xe.postMessage({type:"getModuleVersion",id:f})})}static getVersion(){const t=Tt.core&&Tt.core.worker,a=Tt.core&&Tt.core.wasm;return`3.2.30(Worker: ${t||"Not Loaded"}, Wasm: ${a||"Not Loaded"})`}static enableLogging(){Pn._onLog=console.log,Ze._onLog=console.log}static disableLogging(){Pn._onLog=null,Ze._onLog=null}static async cfd(t){return await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a();{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cfd",id:g,body:{count:t}})})}}var Ce,gs,kn,ms,ps,tn,_s,vs,Bi,ys,Es;Ze._bSupportDce4Module=-1,Ze._bSupportIRTModule=-1,Ze._versions=null,Ze._workerName="core.worker.js",Ze.browserInfo=at,function(h){h[h.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",h[h.CRIT_BARCODE=2]="CRIT_BARCODE",h[h.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",h[h.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",h[h.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",h[h.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Ce||(Ce={})),function(h){h[h.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",h[h.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",h[h.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",h[h.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(gs||(gs={})),function(h){h[h.EC_OK=0]="EC_OK",h[h.EC_UNKNOWN=-1e4]="EC_UNKNOWN",h[h.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",h[h.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",h[h.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",h[h.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",h[h.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",h[h.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",h[h.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",h[h.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",h[h.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",h[h.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",h[h.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",h[h.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",h[h.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",h[h.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",h[h.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",h[h.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",h[h.EC_TIMEOUT=-10026]="EC_TIMEOUT",h[h.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",h[h.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",h[h.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",h[h.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",h[h.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",h[h.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",h[h.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",h[h.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",h[h.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",h[h.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",h[h.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",h[h.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",h[h.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",h[h.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",h[h.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",h[h.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",h[h.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",h[h.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",h[h.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",h[h.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",h[h.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",h[h.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",h[h.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",h[h.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",h[h.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",h[h.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",h[h.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",h[h.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",h[h.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",h[h.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",h[h.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",h[h.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",h[h.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",h[h.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",h[h.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",h[h.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",h[h.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",h[h.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",h[h.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",h[h.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",h[h.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",h[h.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",h[h.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",h[h.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",h[h.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",h[h.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",h[h.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",h[h.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",h[h.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",h[h.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",h[h.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",h[h.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",h[h.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",h[h.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",h[h.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",h[h.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",h[h.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",h[h.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",h[h.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",h[h.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",h[h.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",h[h.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",h[h.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",h[h.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",h[h.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",h[h.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",h[h.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",h[h.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",h[h.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",h[h.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",h[h.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",h[h.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",h[h.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",h[h.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",h[h.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",h[h.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",h[h.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",h[h.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",h[h.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",h[h.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",h[h.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",h[h.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(kn||(kn={})),function(h){h[h.GEM_SKIP=0]="GEM_SKIP",h[h.GEM_AUTO=1]="GEM_AUTO",h[h.GEM_GENERAL=2]="GEM_GENERAL",h[h.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",h[h.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",h[h.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",h[h.GEM_REV=-2147483648]="GEM_REV"}(ms||(ms={})),function(h){h[h.GTM_SKIP=0]="GTM_SKIP",h[h.GTM_INVERTED=1]="GTM_INVERTED",h[h.GTM_ORIGINAL=2]="GTM_ORIGINAL",h[h.GTM_AUTO=4]="GTM_AUTO",h[h.GTM_REV=-2147483648]="GTM_REV"}(ps||(ps={})),function(h){h[h.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",h[h.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(tn||(tn={})),function(h){h[h.PDFRM_VECTOR=1]="PDFRM_VECTOR",h[h.PDFRM_RASTER=2]="PDFRM_RASTER",h[h.PDFRM_REV=-2147483648]="PDFRM_REV"}(_s||(_s={})),function(h){h[h.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",h[h.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(vs||(vs={})),function(h){h[h.IRUT_NULL=0]="IRUT_NULL",h[h.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",h[h.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",h[h.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",h[h.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",h[h.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",h[h.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",h[h.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",h[h.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",h[h.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",h[h.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",h[h.IRUT_CONTOURS=1024]="IRUT_CONTOURS",h[h.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",h[h.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",h[h.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",h[h.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",h[h.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",h[h.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",h[h.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",h[h.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",h[h.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",h[h.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",h[h.IRUT_CORNERS=2097152]="IRUT_CORNERS",h[h.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",h[h.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",h[h.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",h[h.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",h[h.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",h[h.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",h[h.IRUT_ALL=268435455]="IRUT_ALL"}(Bi||(Bi={})),function(h){h[h.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",h[h.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",h[h.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",h[h.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",h[h.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",h[h.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",h[h.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",h[h.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",h[h.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(ys||(ys={})),function(h){h[h.ST_NULL=0]="ST_NULL",h[h.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",h[h.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",h[h.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",h[h.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",h[h.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",h[h.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",h[h.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(Es||(Es={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.2.21
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const ti=typeof self>"u",Cs=ti?{}:self,ho=(()=>{if(!ti&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})(),lo=h=>{if(h==null&&(h="./"),!ti){let t=document.createElement("a");t.href=h,h=t.href}return h.endsWith("/")||(h+="/"),h},ws=h=>h&&typeof h=="object"&&typeof h.then=="function";let ss=class extends Promise{constructor(t){let a,f;super((g,v)=>{a=g,f=v}),this._s="pending",this.resolve=g=>{this.isPending&&(ws(g)?this.task=g:(this._s="fulfilled",a(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let a;this._task=t,ws(t)?a=t:typeof t=="function"&&(a=new Promise(t)),a&&(async()=>{try{const f=await a;t===this._task&&this.resolve(f)}catch(f){t===this._task&&this.reject(f)}})()}get isEmpty(){return this._task==null}};const dn=" is not allowed to change after `createInstance` or `loadWasm` is called.",ia=!ti&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Ss=(h,t)=>{const a=h;if(!a._pLoad.isEmpty)throw new Error("`license`"+dn);a._license=t};!ti&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const co=h=>{if(h==null)h=[];else{h=h instanceof Array?[...h]:[h];for(let t=0;t<h.length;++t){if(!ti){let a=document.createElement("a");a.href=h[t],h[t]=a.href}h[t].endsWith("/")||(h[t]+="/")}}return h},Ts=(h,t)=>{const a=h;if(!a._pLoad.isEmpty)throw new Error("`licenseServer`"+dn);a._licenseServer=co(t)},Is=(h,t)=>{const a=h;if(!a._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+dn);a._deviceFriendlyName=t||""};let zi,Zi,Sr,gn,wt;typeof navigator<"u"&&(zi=navigator,Zi=zi.userAgent,Sr=zi.platform,gn=zi.mediaDevices),function(){if(!ti){const h={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:zi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Sr,search:"Win"},Mac:{str:Sr},Linux:{str:Sr}};let a="unknownBrowser",f=0,g="unknownOS";for(let v in h){const y=h[v]||{};let w=y.str||Zi,I=y.search||v,x=y.verStr||Zi,A=y.verSearch||v;if(A instanceof Array||(A=[A]),w.indexOf(I)!=-1){a=v;for(let L of A){let k=x.indexOf(L);if(k!=-1){f=parseFloat(x.substring(k+L.length+1));break}}break}}for(let v in t){const y=t[v]||{};let w=y.str||Zi,I=y.search||v;if(w.indexOf(I)!=-1){g=v;break}}g=="Linux"&&Zi.indexOf("Windows NT")!=-1&&(g="HarmonyOS"),wt={browser:a,version:f,OS:g}}ti&&(wt={browser:"ssr",version:0,OS:"ssr"})}(),gn&&gn.getUserMedia,wt.browser==="Chrome"&&wt.version>66||wt.browser==="Safari"&&wt.version>13||wt.browser==="OPR"&&wt.version>43||wt.browser==="Edge"&&wt.version;const uo=async()=>(yt("license"),en("dynamsoft_inited",async()=>{let{lt:h,l:t,ls:a,sp:f,rmk:g,cv:v}=((I,x=!1)=>{const A=I;if(A._pLoad.isEmpty){let L,k,N,P=A._license||"",V=JSON.parse(JSON.stringify(A._licenseServer)),W=A._sessionPassword,X=0;if(P.startsWith("t")||P.startsWith("f"))X=0;else if(P.length===0||P.startsWith("P")||P.startsWith("L")||P.startsWith("Y")||P.startsWith("A"))X=1;else{X=2;const K=P.indexOf(":");K!=-1&&(P=P.substring(K+1));const ee=P.indexOf("?");if(ee!=-1&&(k=P.substring(ee+1),P=P.substring(0,ee)),P.startsWith("DLC2"))X=0;else{if(P.startsWith("DLS2")){let ge;try{let ce=P.substring(4);ce=atob(ce),ge=JSON.parse(ce)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(P=ge.handshakeCode?ge.handshakeCode:ge.organizationID?ge.organizationID:"",typeof P=="number"&&(P=JSON.stringify(P)),V.length===0){let ce=[];ge.mainServerURL&&(ce[0]=ge.mainServerURL),ge.standbyServerURL&&(ce[1]=ge.standbyServerURL),V=co(ce)}!W&&ge.sessionPassword&&(W=ge.sessionPassword),L=ge.remark}P&&P!=="200001"&&!P.startsWith("200001-")||(X=1)}}if(X&&(x||(Cs.crypto||(N="Please upgrade your browser to support online key."),Cs.crypto.subtle||(N="Require https to use online key in this browser."))),N){if(X!==1)throw new Error(N);X=0,console.warn(N),A._lastErrorCode=-1,A._lastErrorString=N}return X===1&&(P="",console.warn("Applying for a public trial license ...")),{lt:X,l:P,ls:V,sp:W,rmk:L,cv:k}}throw new Error("Can't preprocess license again"+dn)})(et),y=new ss;et._pLoad.task=y,(async()=>{try{await et._pLoad}catch{}})();let w=je();Le[w]=I=>{if(I.message&&et._onAuthMessage){let L=et._onAuthMessage(I.message);L!=null&&(I.message=L)}let x,A=!1;if(h===1&&(A=!0),I.success?(ei&&ei("init license success"),I.message&&console.warn(I.message),Ze._bSupportIRTModule=I.bSupportIRTModule,Ze._bSupportDce4Module=I.bSupportDce4Module,et.bPassValidation=!0):(x=Error(I.message),I.stack&&(x.stack=I.stack),I.ltsErrorCode&&(x.ltsErrorCode=I.ltsErrorCode),A||I.ltsErrorCode==111&&I.message.toLowerCase().indexOf("trial license")!=-1&&(A=!0)),A){let L=Ie.license;Ie.rootDirectory&&(L=Ie.rootDirectory+"/"+L),L=lo(L),(async(k,N,P)=>{if(!k._bNeverShowDialog)try{let V=await fetch(k.engineResourcePath+"dls.license.dialog.html");if(!V.ok)throw Error("Get license dialog fail. Network Error: "+V.statusText);let W=await V.text();if(!W.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let X=document.createElement("div");X.innerHTML=W;let K=[];for(let ue=0;ue<X.childElementCount;++ue){let s=X.children[ue];s instanceof HTMLStyleElement&&(K.push(s),document.head.append(s))}let ee=X.childElementCount==1?X.children[0]:X;ee.remove();let ge,ce,Se,De,p,me=[ee],Te=ee.children;for(let ue of Te)me.push(ue);for(let ue=0;ue<me.length;++ue)for(let s of me[ue].children)me.push(s);for(let ue of me)if(!ge&&ue.classList.contains("dls-license-mask"))ge=ue,ue.addEventListener("click",s=>{if(ue==s.target){ee.remove();for(let r of K)r.remove()}});else if(!ce&&ue.classList.contains("dls-license-icon-close"))ce=ue,ue.addEventListener("click",()=>{ee.remove();for(let s of K)s.remove()});else if(!Se&&ue.classList.contains("dls-license-icon-error"))Se=ue,N!="error"&&ue.remove();else if(!De&&ue.classList.contains("dls-license-icon-warn"))De=ue,N!="warn"&&ue.remove();else if(!p&&ue.classList.contains("dls-license-msg-content")){p=ue;let s=P;for(;s;){let r=s.indexOf("["),n=s.indexOf("]",r),l=s.indexOf("(",n),e=s.indexOf(")",l);if(r==-1||n==-1||l==-1||e==-1){ue.appendChild(new Text(s));break}r>0&&ue.appendChild(new Text(s.substring(0,r)));let i=document.createElement("a"),o=s.substring(r+1,n);i.innerText=o;let d=s.substring(l+1,e);i.setAttribute("href",d),i.setAttribute("target","_blank"),ue.appendChild(i),s=s.substring(e+1)}}document.body.appendChild(ee)}catch(V){k._onLog&&k._onLog(V.message||V)}})({_bNeverShowDialog:et._bNeverShowDialog,engineResourcePath:L,_onLog:ei},I.success?"warn":"error",I.message)}I.success?y.resolve(void 0):y.reject(x)},await oo("worker"),xe.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!h,bptk:h===1,l:t,os:wt,fn:et.deviceFriendlyName,ls:a,sp:f,rmk:g,cv:v},id:w}),et.bCallInitLicense=!0,await y}));let bs;Ke.license={},Ke.license.dynamsoft=uo,Ke.license.getAR=async()=>{{let h=Ot.dynamsoft_inited;h&&h.isRejected&&await h}return xe?new Promise((h,t)=>{let a=je();Le[a]=async f=>{if(f.success){delete f.success;{let g=et.license;g&&(g.startsWith("t")||g.startsWith("f"))&&(f.pk=g)}if(Object.keys(f).length){if(f.lem){let g=Error(f.lem);g.ltsErrorCode=f.lec,delete f.lem,delete f.lec,f.ae=g}h(f)}else h(null)}else{let g=Error(f.message);f.stack&&(g.stack=f.stack),t(g)}},xe.postMessage({type:"getAR",id:a})}):null};let et=class Mt{static setLicenseServer(t){Ts(Mt,t)}static get license(){return this._license}static set license(t){Ss(Mt,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){Ts(Mt,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){Is(Mt,t)}static initLicense(t,a){if(Ss(Mt,t),Mt.bCallInitLicense=!0,a)return uo()}static setDeviceFriendlyName(t){Is(Mt,t)}static getDeviceFriendlyName(){return Mt._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await en("dynamsoft_uuid",async()=>{await yt();let t=new ss,a=je();Le[a]=f=>{if(f.success)t.resolve(f.uuid);else{const g=Error(f.message);f.stack&&(g.stack=f.stack),t.reject(g)}},xe.postMessage({type:"getDeviceUUID",id:a}),bs=await t}),bs))()}};et._pLoad=new ss,et.bPassValidation=!1,et.bCallInitLicense=!1,et._license=ia,et._licenseServer=[],et._deviceFriendlyName="",Ie.license==null&&(Ie.license=ho),Ht.license={wasm:!0},Ke.license.LicenseManager=et;const mn="1.2.10";typeof Ie.std!="string"&&ri(Ie.std.version,mn)<0&&(Ie.std={version:mn,path:lo(ho+`../../dynamsoft-capture-vision-std@${mn}/dist/`)});/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.2.30"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */const xs=h=>h&&typeof h=="object"&&typeof h.then=="function";let wi=class extends Promise{constructor(t){let a,f;super((g,v)=>{a=g,f=v}),this._s="pending",this.resolve=g=>{this.isPending&&(xs(g)?this.task=g:(this._s="fulfilled",a(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let a;this._task=t,xs(t)?a=t:typeof t=="function"&&(a=new Promise(t)),a&&(async()=>{try{const f=await a;t===this._task&&this.resolve(f)}catch(f){t===this._task&&this.reject(f)}})()}get isEmpty(){return this._task==null}};class ra{constructor(t){this._cvr=t}async getMaxBufferedItems(){return await new Promise((t,a)=>{let f=je();Le[f]=async g=>{if(g.success)return t(g.count);{let v=new Error(g.message);return v.stack=g.stack+`
`+v.stack,a(v)}},xe.postMessage({type:"cvr_getMaxBufferedItems",id:f,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(t){return await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a();{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_setMaxBufferedItems",id:g,instanceID:this._cvr._instanceID,body:{count:t}})})}async getBufferedCharacterItemSet(){return await new Promise((t,a)=>{let f=je();Le[f]=async g=>{if(g.success)return t(g.itemSet);{let v=new Error(g.message);return v.stack=g.stack+`
`+v.stack,a(v)}},xe.postMessage({type:"cvr_getBufferedCharacterItemSet",id:f,instanceID:this._cvr._instanceID})})}}var na={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const As=(h,t)=>{for(let a in t._irrRegistryState)t._irrRegistryState[a]=!1;for(let a of h._intermediateResultReceiverSet)if(a.isDce)t._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let f in a)t._irrRegistryState[f]||(t._irrRegistryState[f]=!!a[f])};let sa=class{constructor(t){this._irrRegistryState=na,this._cvr=t}async addResultReceiver(t){if(typeof t!="object")throw new Error("Invalid receiver.");this._cvr._intermediateResultReceiverSet.add(t),As(this._cvr,this);let a=-1,f={};if(!t.isDce){if(!t._observedResultUnitTypes||!t._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");a=t._observedResultUnitTypes,t._observedTaskMap.forEach((g,v)=>{f[v]=g}),t._observedTaskMap.clear()}return await new Promise((g,v)=>{let y=je();Le[y]=async w=>{if(w.success)return g();{let I=new Error(w.message);return I.stack=w.stack+`
`+I.stack,v(I)}},xe.postMessage({type:"cvr_setIrrRegistry",id:y,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:String(a),observedTaskMap:f}})})}async removeResultReceiver(t){return this._cvr._intermediateResultReceiverSet.delete(t),As(this._cvr,this),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a();{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_setIrrRegistry",id:g,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr._dsImage}};const fo=typeof self>"u",os=(()=>{if(!fo&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})(),go=h=>{if(h==null&&(h="./"),!fo){let t=document.createElement("a");t.href=h,h=t.href}return h.endsWith("/")||(h+="/"),h};var pn;Ie.cvr==null&&(Ie.cvr=os),Ht.cvr={js:!0,wasm:!0,deps:["license","dip"]},Ke.cvr={};const _n="1.2.10";typeof Ie.std!="string"&&ri(Ie.std.version,_n)<0&&(Ie.std={version:_n,path:go(os+`../../dynamsoft-capture-vision-std@${_n}/dist/`)});const vn="2.2.30";(!Ie.dip||typeof Ie.dip!="string"&&ri(Ie.dip.version,vn)<0)&&(Ie.dip={version:vn,path:go(os+`../../dynamsoft-image-processing@${vn}/dist/`)});var rn,Os;function mo(h,t){if(h&&h.location){const a=h.location.points;for(let f of a)f.x=f.x/t,f.y=f.y/t;mo(h.referencedItem,t)}}`${(pn=Tt.cvr)===null||pn===void 0?void 0:pn.worker}`,function(h){h[h.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",h[h.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(rn||(rn={})),function(h){h[h.IRUT_NULL=0]="IRUT_NULL",h[h.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",h[h.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",h[h.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",h[h.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",h[h.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",h[h.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",h[h.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",h[h.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",h[h.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",h[h.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",h[h.IRUT_CONTOURS=1024]="IRUT_CONTOURS",h[h.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",h[h.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",h[h.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",h[h.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",h[h.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",h[h.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",h[h.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",h[h.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",h[h.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",h[h.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",h[h.IRUT_CORNERS=2097152]="IRUT_CORNERS",h[h.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",h[h.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",h[h.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",h[h.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",h[h.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",h[h.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",h[h.IRUT_ALL=134217727]="IRUT_ALL"}(Os||(Os={}));let oa=class Ge{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Ze.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static async createInstance(){if(!Ke.license)throw Error("Module `license` is not existed.");await Ke.license.dynamsoft(),await yt(["cvr"]);const t=new Ge,a=new wi;let f=je();return Le[f]=async g=>{var v;if(g.success)t._instanceID=g.instanceID,t._currentSettings=JSON.parse(g.outputSettings),`${(v=Tt.cvr)===null||v===void 0?void 0:v.worker}${g.version}`,Ze.bSupportDce4Module===0&&(t._intermediateResultManager=t.getIntermediateResultManager(!0)),a.resolve(t);else{const y=Error(g.message);g.stack&&(y.stack=g.stack),a.reject(y)}},xe.postMessage({type:"cvr_createInstance",id:f}),a}async _singleFrameModeCallback(t){this._isa.getCameraView().setScanLaserVisible(!0);for(let v of this._resultReceiverSet)this._bNeedOutputOriginalImage&&v.onOriginalImageResultReceived&&v.onOriginalImageResultReceived({imageData:t});const a={bytes:new Uint8Array(t.bytes),width:t.width,height:t.height,stride:t.stride,format:t.format,tag:t.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const f=await this.capture(a,this._templateName);f.originalImageTag=t.tag;for(let v of this._resultReceiverSet)v.isDce&&v.onCapturedResultReceived(f,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const g={originalImageHashId:f.originalImageHashId,originalImageTag:f.originalImageTag,errorCode:f.errorCode,errorString:f.errorString};for(let v of this._resultReceiverSet)if(v.onDecodedBarcodesReceived&&f.barcodeResultItems&&v.onDecodedBarcodesReceived(Object.assign(Object.assign({},g),{barcodeResultItems:f.barcodeResultItems})),v.onRecognizedTextLinesReceived&&f.textLineResultItems&&v.onRecognizedTextLinesReceived(Object.assign(Object.assign({},g),{textLineResultItems:f.textLineResultItems})),v.onDetectedQuadsReceived&&f.detectedQuadResultItems&&v.onDetectedQuadsReceived(Object.assign(Object.assign({},g),{detectedQuadResultItems:f.detectedQuadResultItems})),v.onNormalizedImagesReceived&&f.normalizedImageResultItems&&v.onNormalizedImagesReceived(Object.assign(Object.assign({},g),{normalizedImageResultItems:f.normalizedImageResultItems})),v.onParsedResultsReceived&&f.parsedResultItems&&v.onParsedResultsReceived(Object.assign(Object.assign({},g),{parsedResultItems:f.parsedResultItems})),v.onCapturedResultReceived&&!v.isDce){if(this._bNeedOutputOriginalImage){const y=f.items.findIndex(w=>w.type===1);y!==-1&&(f.items[y].imageData=t)}v.onCapturedResultReceived(f)}}setInput(t){if(this._checkIsDisposed(),t){if(this._isa=t,t.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const a=this._isa.getCameraView();if(a){const f=a._capturedResultReceiver;f.isDce=!0,this._resultReceiverSet.add(f)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(t){if(this._checkIsDisposed(),typeof t!="object")return console.warn("Invalid ISA state listener.");t&&Object.keys(t)&&this._isaStateListenerSet.add(t)}removeImageSourceStateListener(t){return this._checkIsDisposed(),this._isaStateListenerSet.delete(t)}addResultReceiver(t){if(this._checkIsDisposed(),typeof t!="object")throw new Error("Invalid receiver.");t&&Object.keys(t).length&&(this._resultReceiverSet.add(t),this._setCrrRegistry())}removeResultReceiver(t){this._checkIsDisposed(),this._resultReceiverSet.delete(t),this._setCrrRegistry()}async _setCrrRegistry(){const t={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let g of this._resultReceiverSet)g.isDce||(t.onCapturedResultReceived=!!g.onCapturedResultReceived,t.onDecodedBarcodesReceived=!!g.onDecodedBarcodesReceived,t.onRecognizedTextLinesReceived=!!g.onRecognizedTextLinesReceived,t.onDetectedQuadsReceived=!!g.onDetectedQuadsReceived,t.onNormalizedImagesReceived=!!g.onNormalizedImagesReceived,t.onParsedResultsReceived=!!g.onParsedResultsReceived);const a=new wi;let f=je();return Le[f]=async g=>{if(g.success)a.resolve();else{let v=new Error(g.message);v.stack=g.stack+`
`+v.stack,a.reject()}},xe.postMessage({type:"cvr_setCrrRegistry",id:f,instanceID:this._instanceID,body:{receiver:JSON.stringify(t)}}),a}async addResultFilter(t){if(this._checkIsDisposed(),typeof t!="object")return console.warn("Invalid filter.");if(t&&Object.keys(t)){this._resultFilterSet.add(t),this._handleFilterSwitch();for(let a of this._resultFilterSet)await this._enableResultCrossVerification(a.verificationEnabled),await this._enableResultDeduplication(a.duplicateFilterEnabled),await this._setDuplicateForgetTime(a.duplicateForgetTime)}}async removeResultFilter(t){this._checkIsDisposed(),this._resultFilterSet.delete(t),this._handleFilterSwitch();for(let a of this._resultFilterSet)await this._enableResultCrossVerification(a.verificationEnabled),await this._enableResultDeduplication(a.duplicateFilterEnabled),await this._setDuplicateForgetTime(a.duplicateForgetTime)}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let t of this._resultFilterSet)t.isResultCrossVerificationEnabled(Ce.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),t.isResultCrossVerificationEnabled(Ce.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),t.isResultCrossVerificationEnabled(Ce.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),t.isResultCrossVerificationEnabled(Ce.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}async startCapturing(t){var a,f;if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");t||(t=this._currentSettings.CaptureVisionTemplates[0].Name);const g=await this.containsTask(t);return await yt(g),g.includes("dlr")&&!(!((a=Ke.dlr)===null||a===void 0)&&a.bLoadConfusableCharsData)&&await((f=Ke.dlr)===null||f===void 0?void 0:f.loadRecognitionData("ConfusableChars",Ie.dlr)),this._isa.isCameraEnhancer&&(g.includes("ddn")?this._isa.setPixelFormat(Ee.IPF_ABGR_8888):this._isa.setPixelFormat(Ee.IPF_GRAYSCALED)),this._isa.singleFrameMode!==void 0&&this._isa.singleFrameMode!=="disabled"?(this._templateName=t,void this._isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind)):(this._isa.getColourChannelUsageType()===At.CCUT_AUTO&&this._isa.setColourChannelUsageType(g.includes("ddn")?At.CCUT_FULL_CHANNEL:At.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new wi((v,y)=>{if(this.disposed)return;let w=je();Le[w]=async I=>{if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!I.success){let x=new Error(I.message);return x.stack=I.stack+`
`+x.stack,y(x)}for(let x of this._resultFilterSet)await this.addResultFilter(x);this._bPauseScan=!1,this._bNeedOutputOriginalImage=I.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&this._isa.startFetching(),this._loopReadVideo(t),v()},0),this._isa.isCameraEnhancer&&this._isa.getCameraView().setScanLaserVisible(!0)}},xe.postMessage({type:"cvr_startCapturing",id:w,instanceID:this._instanceID,body:{templateName:t}})}),await this._promiseStartScan))}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),this._isa.singleFrameMode!==void 0&&this._isa.singleFrameMode!=="disabled")?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(At.CCUT_AUTO)))}async _clearVerifyList(){let t=je();const a=new wi;return Le[t]=async f=>{if(f.success)return a.resolve();{let g=new Error(f.message);return g.stack=f.stack+`
`+g.stack,a.reject(g)}},xe.postMessage({type:"cvr_clearVerifyList",id:t,instanceID:this._instanceID}),a}async _getIntermediateResult(){this._checkIsDisposed();let t=je();const a=new wi;return Le[t]=async f=>{if(f.success)a.resolve(f.result);else{let g=new Error(f.message);g.stack=f.stack+`
`+g.stack,a.reject(g)}},xe.postMessage({type:"cvr_getIntermediateResult",id:t,instanceID:this._instanceID}),a}async containsTask(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a(JSON.parse(v.tasks));{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_containsTask",id:g,instanceID:this._instanceID,body:{templateName:t}})})}async _loopReadVideo(t){if(this._dynamsoft=!0,this.disposed||this._bPauseScan)return;if(this._isa.isBufferEmpty()){if(this._isa.hasNextImageToFetch())for(let f of this._isaStateListenerSet)f.onImageSourceStateReceived&&f.onImageSourceStateReceived(rn.ISS_BUFFER_EMPTY);else if(!this._isa.hasNextImageToFetch())for(let f of this._isaStateListenerSet)f.onImageSourceStateReceived&&f.onImageSourceStateReceived(rn.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||this._isa.isBufferEmpty())try{this._isa.isBufferEmpty()&&Ge._onLog&&Ge._onLog("buffer is empty so fetch image"),Ge._onLog&&Ge._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=this._isa.fetchImage(),Ge._onLog&&Ge._onLog(`DCE: finish fetching a frame: ${Date.now()}`),this._isa.setImageFetchInterval(this._averageTime)}catch{return void this._reRunCurrnetFunc(t)}else if(this._isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this._isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(t);if(!this._dsImage)return void this._reRunCurrnetFunc(t);for(let f of this._resultReceiverSet)this._bNeedOutputOriginalImage&&f.onOriginalImageResultReceived&&f.onOriginalImageResultReceived({imageData:this._dsImage});const a=Date.now();this._captureDsimage(this._dsImage,t).then(async f=>{if(Ge._onLog&&Ge._onLog("no js handle time: "+(Date.now()-a)),this._bPauseScan)return void this._reRunCurrnetFunc(t);f.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let y of this._resultReceiverSet)if(y.isDce){const w=Date.now();if(y.onCapturedResultReceived(f,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),Ge._onLog){const I=Date.now()-w;I>10&&Ge._onLog(`draw result time: ${I}`)}}const g={originalImageHashId:f.originalImageHashId,originalImageTag:f.originalImageTag,errorCode:f.errorCode,errorString:f.errorString};for(let y of this._resultReceiverSet)y.onDecodedBarcodesReceived&&f.barcodeResultItems&&y.onDecodedBarcodesReceived(Object.assign(Object.assign({},g),{barcodeResultItems:f.barcodeResultItems.filter(w=>!w.isFilter)})),y.onRecognizedTextLinesReceived&&f.textLineResultItems&&y.onRecognizedTextLinesReceived(Object.assign(Object.assign({},g),{textLineResultItems:f.textLineResultItems.filter(w=>!w.isFilter)})),y.onDetectedQuadsReceived&&f.detectedQuadResultItems&&y.onDetectedQuadsReceived(Object.assign(Object.assign({},g),{detectedQuadResultItems:f.detectedQuadResultItems.filter(w=>!w.isFilter)})),y.onNormalizedImagesReceived&&f.normalizedImageResultItems&&y.onNormalizedImagesReceived(Object.assign(Object.assign({},g),{normalizedImageResultItems:f.normalizedImageResultItems.filter(w=>!w.isFilter)})),y.onParsedResultsReceived&&f.parsedResultItems&&y.onParsedResultsReceived(Object.assign(Object.assign({},g),{parsedResultItems:f.parsedResultItems.filter(w=>!w.isFilter)})),y.onCapturedResultReceived&&!y.isDce&&(f.items=f.items.filter(w=>!w.isFilter),f.barcodeResultItems&&(f.barcodeResultItems=f.barcodeResultItems.filter(w=>!w.isFilter)),f.textLineResultItems&&(f.textLineResultItems=f.textLineResultItems.filter(w=>!w.isFilter)),f.detectedQuadResultItems&&(f.detectedQuadResultItems=f.detectedQuadResultItems.filter(w=>!w.isFilter)),f.normalizedImageResultItems&&(f.normalizedImageResultItems=f.normalizedImageResultItems.filter(w=>!w.isFilter)),f.parsedResultItems&&(f.parsedResultItems=f.parsedResultItems.filter(w=>!w.isFilter)),y.onCapturedResultReceived(f));const v=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-a),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Ge._onLog&&(Ge._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Ge._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Ge._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Ge._onLog(`averageTime: ${this._averageTime}`))),Ge._onLog){const y=Date.now()-v;y>10&&Ge._onLog(`fetch image calculate time: ${y}`)}Ge._onLog&&Ge._onLog(`time finish decode: ${Date.now()}`),Ge._onLog&&Ge._onLog("main time: "+(Date.now()-a)),Ge._onLog&&Ge._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,0))}).catch(f=>{this._isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._isa.startFetching(),this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,1e3)),f.message!=="platform error"&&setTimeout(()=>{throw f},0)})}_reRunCurrnetFunc(t){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},0)}async capture(t,a){var f,g;this._checkIsDisposed(),a||(a=this._currentSettings.CaptureVisionTemplates[0].Name);const v=await this.containsTask(a);let y;if(await yt(v),v.includes("dlr")&&!(!((f=Ke.dlr)===null||f===void 0)&&f.bLoadConfusableCharsData)&&await((g=Ke.dlr)===null||g===void 0?void 0:g.loadRecognitionData("ConfusableChars",Ie.dlr)),this._dynamsoft=!1,ro(t))y=await this._captureDsimage(t,a);else if(typeof t=="string")y=t.substring(0,11)=="data:image/"?await this._captureBase64(t,a):await this._captureUrl(t,a);else if(t instanceof Blob)y=await this._captureBlob(t,a);else if(t instanceof HTMLImageElement)y=await this._captureImage(t,a);else if(t instanceof HTMLCanvasElement)y=await this._captureCanvas(t,a);else{if(!(t instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");y=await this._captureVideo(t,a)}return y}async _captureDsimage(t,a){return await this._captureInWorker(t,a)}async _captureUrl(t,a){let f=await Mn(t,"blob");return await this._captureBlob(f,a)}async _captureBase64(t,a){t=t.substring(t.indexOf(",")+1);let f=atob(t),g=f.length,v=new Uint8Array(g);for(;g--;)v[g]=f.charCodeAt(g);return await this._captureBlob(new Blob([v]),a)}async _captureBlob(t,a){let f=null,g=null;if(typeof createImageBitmap<"u")try{f=await createImageBitmap(t)}catch{}f||(g=await async function(y){return await new Promise((w,I)=>{let x=URL.createObjectURL(y),A=new Image;A.src=x,A.onload=()=>{URL.revokeObjectURL(A.dbrObjUrl),w(A)},A.onerror=L=>{I(new Error("Can't convert blob to image : "+(L instanceof Event?L.type:L)))}})}(t));let v=await this._captureImage(f||g,a);return f&&f.close(),v}async _captureImage(t,a){let f,g,v=t instanceof HTMLImageElement?t.naturalWidth:t.width,y=t instanceof HTMLImageElement?t.naturalHeight:t.height,w=Math.max(v,y);w>this.maxCvsSideLength?(this._compressRate=this.maxCvsSideLength/w,f=Math.round(v*this._compressRate),g=Math.round(y*this._compressRate)):(f=v,g=y),this._canvas||(this._canvas=document.createElement("canvas"));const I=this._canvas;return I.width===f&&I.height===g||(I.width=f,I.height=g),I.ctx2d||(I.ctx2d=I.getContext("2d",{willReadFrequently:!0})),I.ctx2d.drawImage(t,0,0,v,y,0,0,f,g),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),await this._captureCanvas(I,a)}async _captureCanvas(t,a){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";if([t.width,t.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const f=t.ctx2d||t.getContext("2d",{willReadFrequently:!0}),g={bytes:Uint8Array.from(f.getImageData(0,0,t.width,t.height).data),width:t.width,height:t.height,stride:4*t.width,format:10};return await this._captureInWorker(g,a)}async _captureVideo(t,a){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";let f,g,v=t.videoWidth,y=t.videoHeight,w=Math.max(v,y);w>this.maxCvsSideLength?(this._compressRate=this.maxCvsSideLength/w,f=Math.round(v*this._compressRate),g=Math.round(y*this._compressRate)):(f=v,g=y),this._canvas||(this._canvas=document.createElement("canvas"));const I=this._canvas;return I.width===f&&I.height===g||(I.width=f,I.height=g),I.ctx2d||(I.ctx2d=I.getContext("2d",{willReadFrequently:!0})),I.ctx2d.drawImage(t,0,0,v,y,0,0,f,g),await this._captureCanvas(I,a)}async _captureInWorker(t,a){const{bytes:f,width:g,height:v,stride:y,format:w}=t;let I=je();const x=new wi;return Le[I]=async A=>{var L,k;if(!A.success){let N=new Error(A.message);return N.stack=A.stack+`
`+N.stack,x.reject(N)}{const N=Date.now();Ge._onLog&&(Ge._onLog(`get result time from worker: ${N}`),Ge._onLog("worker to main time consume: "+(N-A.workerReturnMsgTime)));try{const P=A.captureResult;t.bytes=A.bytes;for(let W of P.items)this._compressRate!==0&&mo(W,this._compressRate),W.type===Ce.CRIT_ORIGINAL_IMAGE?W.imageData=t:W.type===Ce.CRIT_NORMALIZED_IMAGE?(L=Ke.ddn)===null||L===void 0||L.handleNormalizedImageResultItem(W):W.type===Ce.CRIT_PARSED_RESULT&&((k=Ke.dcp)===null||k===void 0||k.handleParsedResultItem(W));if(this._dynamsoft)for(let W of this._resultFilterSet)W.onDecodedBarcodesReceived(P.items),W.onRecognizedTextLinesReceived(P.items),W.onDetectedQuadsReceived(P.items),W.onNormalizedImagesReceived(P.items);const V=function(W){const X={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return W.items.forEach(K=>{K.type===Ce.CRIT_BARCODE?X.barcodeResultItems.push(K):K.type===Ce.CRIT_TEXT_LINE?X.textLineResultItems.push(K):K.type===Ce.CRIT_DETECTED_QUAD?X.detectedQuadResultItems.push(K):K.type===Ce.CRIT_NORMALIZED_IMAGE?X.normalizedImageResultItems.push(K):K.type===Ce.CRIT_PARSED_RESULT&&X.parsedResultItems.push(K)}),X}(P);if(V.barcodeResultItems.length&&(P.barcodeResultItems=V.barcodeResultItems),V.textLineResultItems.length&&(P.textLineResultItems=V.textLineResultItems),V.detectedQuadResultItems.length&&(P.detectedQuadResultItems=V.detectedQuadResultItems),V.normalizedImageResultItems.length&&(P.normalizedImageResultItems=V.normalizedImageResultItems),V.parsedResultItems.length&&(P.parsedResultItems=V.parsedResultItems),!this._bPauseScan||!this._dynamsoft){const W=P.intermediateResult;if(W){let X=0;for(let K of this._intermediateResultReceiverSet){X++;for(let ee of W){if(ee.info.callbackName==="onTaskResultsReceived"){for(let ge of ee.intermediateResultUnits)ge.originalImageTag=t.tag?t.tag:null;K[ee.info.callbackName]&&K[ee.info.callbackName]({intermediateResultUnits:ee.intermediateResultUnits},ee.info)}else K[ee.info.callbackName]&&K[ee.info.callbackName](ee.result,ee.info);X===this._intermediateResultReceiverSet.size&&delete ee.info.callbackName}}}P&&P.intermediateResult&&delete P.intermediateResult}return this._compressRate=0,x.resolve(P)}catch(P){return x.reject(P)}}},Ge._onLog&&Ge._onLog(`send buffer to worker: ${Date.now()}`),xe.postMessage({type:"cvr_capture",id:I,instanceID:this._instanceID,body:{bytes:f,width:g,height:v,stride:y,format:w,templateName:a||"",dynamsoft:this._dynamsoft}},[f.buffer]),x}async initSettings(t){return this._checkIsDisposed(),t&&["string","object"].includes(typeof t)?(typeof t=="string"?t.startsWith("{")?this._currentSettings=JSON.parse(t):t=await Mn(t,"text"):typeof t=="object"&&(this._currentSettings=t,t=JSON.stringify(t)),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success){const y=JSON.parse(v.response);if(y.exception!==0){let x=new Error(y.description?y.description:"Init Settings Failed.");return x.errorCode=y.exception,f(x)}let w=[],I=JSON.parse(t).CaptureVisionTemplates;for(let x=0;x<I.length;x++){let A=await this.containsTask(I[x].Name);w=w.concat(A)}return await yt([...new Set(w)]),this._bNeedOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,a(y)}{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_initSettings",id:g,instanceID:this._instanceID,body:{settings:t}})})):console.error("Invalid template.")}async outputSettings(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success){const y=JSON.parse(v.settings);if(y.errorCode!==0){let w=new Error(y.errorString);return w.errorCode=y.errorCode,f(w)}return delete y.errorCode,delete y.errorString,a(y)}{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_outputSettings",id:g,instanceID:this._instanceID,body:{templateName:t||"*"}})})}async outputSettingsToFile(t,a,f){const g=await this.outputSettings(t),v=new Blob([JSON.stringify(g,null,2,function(y,w){return w instanceof Array?JSON.stringify(w):w},2)],{type:"application/json"});if(f){const y=document.createElement("a");y.href=URL.createObjectURL(v),a.endsWith(".json")&&(a=a.replace(".json","")),y.download=`${a}.json`,y.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(y.href)},500)},y.click()}return v}async getSimplifiedSettings(t){this._checkIsDisposed(),t||(t=this._currentSettings.CaptureVisionTemplates[0].Name);const a=await this.containsTask(t);return await yt(a),await new Promise((f,g)=>{let v=je();Le[v]=async y=>{if(y.success){const w=JSON.parse(y.settings,(I,x)=>qo&&I==="barcodeFormatIds"?BigInt(x):x);if(w.minImageCaptureInterval=this._minImageCaptureInterval,w.code!==0){let I=new Error(w.codeString);return I.errorCode=w.errorCode,g(I)}return delete w.code,delete w.codeString,f(w)}{let w=new Error(y.message);return w.stack=y.stack+`
`+w.stack,g(w)}},xe.postMessage({type:"cvr_getSimplifiedSettings",id:v,instanceID:this._instanceID,body:{templateName:t}})})}async updateSettings(t,a){this._checkIsDisposed();const f=await this.containsTask(t);return await yt(f),await new Promise((g,v)=>{let y=je();Le[y]=async w=>{if(w.success){const I=JSON.parse(w.response);if(a.minImageCaptureInterval&&a.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=a.minImageCaptureInterval),this._bNeedOutputOriginalImage=w.bNeedOutputOriginalImage,I.exception!==0){let x=new Error(I.description?I.description:"Update Settings Failed.");return x.errorCode=I.exception,v(x)}return this._currentSettings=await this.outputSettings("*"),g(I)}{let I=new Error(w.message);return I.stack=w.stack+`
`+I.stack,v(I)}},xe.postMessage({type:"cvr_updateSettings",id:y,instanceID:this._instanceID,body:{settings:a,templateName:t}})})}async resetSettings(){return this._checkIsDisposed(),await new Promise((t,a)=>{let f=je();Le[f]=async g=>{if(g.success){const v=JSON.parse(g.response);if(v.exception!==0){let y=new Error(v.description?v.description:"Reset Settings Failed.");return y.errorCode=v.exception,a(y)}return this._currentSettings=await this.outputSettings("*"),t(v)}{let v=new Error(g.message);return v.stack=g.stack+`
`+v.stack,a(v)}},xe.postMessage({type:"cvr_resetSettings",id:f,instanceID:this._instanceID})})}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new ra(this)),this._bufferdItemsManager}getIntermediateResultManager(t){if(this._checkIsDisposed(),!t&&Ze.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new sa(this)),this._intermediateResultManager}contains(t,a){return function(f,g){let v=g.x,y=g.y,w=f[0].x,I=f[0].y,x=f[1].x,A=f[1].y,L=f[2].x,k=f[2].y,N=f[3].x,P=f[3].y,V=ee(v,y,w,I,x,A),W=ee(v,y,x,A,L,k),X=ee(v,y,L,k,N,P),K=ee(v,y,N,P,w,I);function ee(ge,ce,Se,De,p,me){return(ge-Se)*(me-De)-(ce-De)*(p-Se)}return V>=0&&W>=0&&X>=0&&K>=0||V<=0&&W<=0&&X<=0&&K<=0}(t,a)}async parseRequiredResources(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a(JSON.parse(v.resources));{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_parseRequiredResources",id:g,instanceID:this._instanceID,body:{templateName:t}})})}async dispose(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this._isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let t=je();Le[t]=a=>{if(!a.success){let f=new Error(a.message);throw f.stack=a.stack+`
`+f.stack,f}},xe.postMessage({type:"cvr_dispose",id:t,instanceID:this._instanceID})}async _enableResultCrossVerification(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a(v.result);{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_enableResultCrossVerification",id:g,instanceID:this._instanceID,body:{verificationEnabled:t}})})}async _enableResultDeduplication(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a(v.result);{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_enableResultDeduplication",id:g,instanceID:this._instanceID,body:{duplicateFilterEnabled:t}})})}async _setDuplicateForgetTime(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a(v.result);{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_setDuplicateForgetTime",id:g,instanceID:this._instanceID,body:{duplicateForgetTime:t}})})}async _getDuplicateForgetTime(t){return this._checkIsDisposed(),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success)return a(v.time);{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"cvr_getDuplicateForgetTime",id:g,instanceID:this._instanceID,body:{type:t}})})}async _setThresholdValue(t,a,f){return await yt("ddn"),await new Promise((g,v)=>{let y=je();Le[y]=async w=>{if(w.success)return g();{let I=new Error(w.message);return I.stack=w.stack+`
`+I.stack,v(I)}},xe.postMessage({type:"ddn_setThresholdValue",id:y,instanceID:this._instanceID,body:{threshold:t,leftLimit:a,rightLimit:f}})})}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}};/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 4.0.3
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const Nn=typeof self>"u",aa=(()=>{if(!Nn&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})();Ie.dce==null&&(Ie.dce=aa),Ht.dce={wasm:!1,js:!1},Ke.dce={};function S(h,t,a,f){if(a==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?h!==t||!f:!t.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?f:a==="a"?f.call(h):f?f.value:t.get(h)}function ye(h,t,a,f,g){if(typeof t=="function"?h!==t||!g:!t.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return g?g.value=a:t.set(h,a),a}let Ki,Vt,Tr,nn,tt;typeof SuppressedError=="function"&&SuppressedError,typeof navigator<"u"&&(Ki=navigator,Vt=Ki.userAgent,Tr=Ki.platform,nn=Ki.mediaDevices),function(){if(!Nn){const h={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ki.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Tr,search:"Win"},Mac:{str:Tr},Linux:{str:Tr}};let a="unknownBrowser",f=0,g="unknownOS";for(let v in h){const y=h[v]||{};let w=y.str||Vt,I=y.search||v,x=y.verStr||Vt,A=y.verSearch||v;if(A instanceof Array||(A=[A]),w.indexOf(I)!=-1){a=v;for(let L of A){let k=x.indexOf(L);if(k!=-1){f=parseFloat(x.substring(k+L.length+1));break}}break}}for(let v in t){const y=t[v]||{};let w=y.str||Vt,I=y.search||v;if(w.indexOf(I)!=-1){g=v;break}}g=="Linux"&&Vt.indexOf("Windows NT")!=-1&&(g="HarmonyOS"),tt={browser:a,version:f,OS:g}}Nn&&(tt={browser:"ssr",version:0,OS:"ssr"})}();const ha=typeof WebAssembly<"u"&&Vt&&!(/Safari/.test(Vt)&&!/Chrome/.test(Vt)&&/\(.+\s11_2_([2-6]).*\)/.test(Vt)),la=!(typeof Worker>"u"),po=!(!nn||!nn.getUserMedia),ca=async()=>{let h=!1;if(po)try{(await nn.getUserMedia({video:!0})).getTracks().forEach(t=>{t.stop()}),h=!0}catch{}return h};tt.browser==="Chrome"&&tt.version>66||tt.browser==="Safari"&&tt.version>13||tt.browser==="OPR"&&tt.version>43||tt.browser==="Edge"&&tt.version;var ua={653:(h,t,a)=>{var f,g,v,y,w,I,x,A,L,k,N,P,V,W,X,K,ee,ge,ce,Se,De,p=p||{version:"5.2.1"};if(t.fabric=p,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?p.document=document:p.document=document.implementation.createHTMLDocument(""),p.window=window;else{var me=new(a(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;p.document=me.document,p.jsdomImplForWrapper=a(898).implForWrapper,p.nodeCanvas=a(245).Canvas,p.window=me,DOMParser=p.window.DOMParser}function Te(s,r){var n=s.canvas,l=r.targetCanvas,e=l.getContext("2d");e.translate(0,l.height),e.scale(1,-1);var i=n.height-l.height;e.drawImage(n,0,i,l.width,l.height,0,0,l.width,l.height)}function ue(s,r){var n=r.targetCanvas.getContext("2d"),l=r.destinationWidth,e=r.destinationHeight,i=l*e*4,o=new Uint8Array(this.imageBuffer,0,i),d=new Uint8ClampedArray(this.imageBuffer,0,i);s.readPixels(0,0,l,e,s.RGBA,s.UNSIGNED_BYTE,o);var c=new ImageData(d,l,e);n.putImageData(c,0,0)}p.isTouchSupported="ontouchstart"in p.window||"ontouchstart"in p.document||p.window&&p.window.navigator&&p.window.navigator.maxTouchPoints>0,p.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",p.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],p.DPI=96,p.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",p.commaWsp="(?:\\s+,?\\s*|,\\s*)",p.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,p.reNonWord=/[ \n\.,;!\?\-]/,p.fontPaths={},p.iMatrix=[1,0,0,1,0,0],p.svgNS="http://www.w3.org/2000/svg",p.perfLimitSizeTotal=2097152,p.maxCacheSideLimit=4096,p.minCacheSideLimit=256,p.charWidthsCache={},p.textureSize=2048,p.disableStyleCopyPaste=!1,p.enableGLFiltering=!0,p.devicePixelRatio=p.window.devicePixelRatio||p.window.webkitDevicePixelRatio||p.window.mozDevicePixelRatio||1,p.browserShadowBlurConstant=1,p.arcToSegmentsCache={},p.boundsOfCurveCache={},p.cachesBoundsOfCurve=!0,p.forceGLPutImageData=!1,p.initFilterBackend=function(){return p.enableGLFiltering&&p.isWebglSupported&&p.isWebglSupported(p.textureSize)?(console.log("max texture size: "+p.maxTextureSize),new p.WebglFilterBackend({tileSize:p.textureSize})):p.Canvas2dFilterBackend?new p.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=p),function(){function s(n,l){if(this.__eventListeners[n]){var e=this.__eventListeners[n];l?e[e.indexOf(l)]=!1:p.util.array.fill(e,!1)}}function r(n,l){var e=function(){l.apply(this,arguments),this.off(n,e)}.bind(this);this.on(n,e)}p.Observable={fire:function(n,l){if(!this.__eventListeners)return this;var e=this.__eventListeners[n];if(!e)return this;for(var i=0,o=e.length;i<o;i++)e[i]&&e[i].call(this,l||{});return this.__eventListeners[n]=e.filter(function(d){return d!==!1}),this},on:function(n,l){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var e in n)this.on(e,n[e]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(l);return this},once:function(n,l){if(arguments.length===1)for(var e in n)r.call(this,e,n[e]);else r.call(this,n,l);return this},off:function(n,l){if(!this.__eventListeners)return this;if(arguments.length===0)for(n in this.__eventListeners)s.call(this,n);else if(arguments.length===1&&typeof arguments[0]=="object")for(var e in n)s.call(this,e,n[e]);else s.call(this,n,l);return this}}}(),p.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var s=0,r=arguments.length;s<r;s++)this._onObjectAdded(arguments[s]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(s,r,n){var l=this._objects;return n?l[r]=s:l.splice(r,0,s),this._onObjectAdded&&this._onObjectAdded(s),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var s,r=this._objects,n=!1,l=0,e=arguments.length;l<e;l++)(s=r.indexOf(arguments[l]))!==-1&&(n=!0,r.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[l]));return this.renderOnAddRemove&&n&&this.requestRenderAll(),this},forEachObject:function(s,r){for(var n=this.getObjects(),l=0,e=n.length;l<e;l++)s.call(r,n[l],l,n);return this},getObjects:function(s){return s===void 0?this._objects.concat():this._objects.filter(function(r){return r.type===s})},item:function(s){return this._objects[s]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(s,r){return this._objects.indexOf(s)>-1||!!r&&this._objects.some(function(n){return typeof n.contains=="function"&&n.contains(s,!0)})},complexity:function(){return this._objects.reduce(function(s,r){return s+(r.complexity?r.complexity():0)},0)}},p.CommonMethods={_setOptions:function(s){for(var r in s)this.set(r,s[r])},_initGradient:function(s,r){!s||!s.colorStops||s instanceof p.Gradient||this.set(r,new p.Gradient(s))},_initPattern:function(s,r,n){!s||!s.source||s instanceof p.Pattern?n&&n():this.set(r,new p.Pattern(s,n))},_setObject:function(s){for(var r in s)this._set(r,s[r])},set:function(s,r){return typeof s=="object"?this._setObject(s):this._set(s,r),this},_set:function(s,r){this[s]=r},toggle:function(s){var r=this.get(s);return typeof r=="boolean"&&this.set(s,!r),this},get:function(s){return this[s]}},f=t,g=Math.sqrt,v=Math.atan2,y=Math.pow,w=Math.PI/180,I=Math.PI/2,p.util={cos:function(s){if(s===0)return 1;switch(s<0&&(s=-s),s/I){case 1:case 3:return 0;case 2:return-1}return Math.cos(s)},sin:function(s){if(s===0)return 0;var r=1;switch(s<0&&(r=-1),s/I){case 1:return r;case 2:return 0;case 3:return-r}return Math.sin(s)},removeFromArray:function(s,r){var n=s.indexOf(r);return n!==-1&&s.splice(n,1),s},getRandomInt:function(s,r){return Math.floor(Math.random()*(r-s+1))+s},degreesToRadians:function(s){return s*w},radiansToDegrees:function(s){return s/w},rotatePoint:function(s,r,n){var l=new p.Point(s.x-r.x,s.y-r.y),e=p.util.rotateVector(l,n);return new p.Point(e.x,e.y).addEquals(r)},rotateVector:function(s,r){var n=p.util.sin(r),l=p.util.cos(r);return{x:s.x*l-s.y*n,y:s.x*n+s.y*l}},createVector:function(s,r){return new p.Point(r.x-s.x,r.y-s.y)},calcAngleBetweenVectors:function(s,r){return Math.acos((s.x*r.x+s.y*r.y)/(Math.hypot(s.x,s.y)*Math.hypot(r.x,r.y)))},getHatVector:function(s){return new p.Point(s.x,s.y).multiply(1/Math.hypot(s.x,s.y))},getBisector:function(s,r,n){var l=p.util.createVector(s,r),e=p.util.createVector(s,n),i=p.util.calcAngleBetweenVectors(l,e),o=i*(p.util.calcAngleBetweenVectors(p.util.rotateVector(l,i),e)===0?1:-1)/2;return{vector:p.util.getHatVector(p.util.rotateVector(l,o)),angle:i}},projectStrokeOnPoints:function(s,r,n){var l=[],e=r.strokeWidth/2,i=r.strokeUniform?new p.Point(1/r.scaleX,1/r.scaleY):new p.Point(1,1),o=function(d){var c=e/Math.hypot(d.x,d.y);return new p.Point(d.x*c*i.x,d.y*c*i.y)};return s.length<=1||s.forEach(function(d,c){var u,m,_=new p.Point(d.x,d.y);c===0?(m=s[c+1],u=n?o(p.util.createVector(m,_)).addEquals(_):s[s.length-1]):c===s.length-1?(u=s[c-1],m=n?o(p.util.createVector(u,_)).addEquals(_):s[0]):(u=s[c-1],m=s[c+1]);var E,T,C=p.util.getBisector(_,u,m),b=C.vector,O=C.angle;if(r.strokeLineJoin==="miter"&&(E=-e/Math.sin(O/2),T=new p.Point(b.x*E*i.x,b.y*E*i.y),Math.hypot(T.x,T.y)/e<=r.strokeMiterLimit))return l.push(_.add(T)),void l.push(_.subtract(T));E=-e*Math.SQRT2,T=new p.Point(b.x*E*i.x,b.y*E*i.y),l.push(_.add(T)),l.push(_.subtract(T))}),l},transformPoint:function(s,r,n){return n?new p.Point(r[0]*s.x+r[2]*s.y,r[1]*s.x+r[3]*s.y):new p.Point(r[0]*s.x+r[2]*s.y+r[4],r[1]*s.x+r[3]*s.y+r[5])},makeBoundingBoxFromPoints:function(s,r){if(r)for(var n=0;n<s.length;n++)s[n]=p.util.transformPoint(s[n],r);var l=[s[0].x,s[1].x,s[2].x,s[3].x],e=p.util.array.min(l),i=p.util.array.max(l)-e,o=[s[0].y,s[1].y,s[2].y,s[3].y],d=p.util.array.min(o);return{left:e,top:d,width:i,height:p.util.array.max(o)-d}},invertTransform:function(s){var r=1/(s[0]*s[3]-s[1]*s[2]),n=[r*s[3],-r*s[1],-r*s[2],r*s[0]],l=p.util.transformPoint({x:s[4],y:s[5]},n,!0);return n[4]=-l.x,n[5]=-l.y,n},toFixed:function(s,r){return parseFloat(Number(s).toFixed(r))},parseUnit:function(s,r){var n=/\D{0,2}$/.exec(s),l=parseFloat(s);switch(r||(r=p.Text.DEFAULT_SVG_FONT_SIZE),n[0]){case"mm":return l*p.DPI/25.4;case"cm":return l*p.DPI/2.54;case"in":return l*p.DPI;case"pt":return l*p.DPI/72;case"pc":return l*p.DPI/72*12;case"em":return l*r;default:return l}},falseFunction:function(){return!1},getKlass:function(s,r){return s=p.util.string.camelize(s.charAt(0).toUpperCase()+s.slice(1)),p.util.resolveNamespace(r)[s]},getSvgAttributes:function(s){var r=["instantiated_by_use","style","id","class"];switch(s){case"linearGradient":r=r.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":r=r.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":r=r.concat(["offset","stop-color","stop-opacity"])}return r},resolveNamespace:function(s){if(!s)return p;var r,n=s.split("."),l=n.length,e=f||p.window;for(r=0;r<l;++r)e=e[n[r]];return e},loadImage:function(s,r,n,l){if(s){var e=p.util.createImage(),i=function(){r&&r.call(n,e,!1),e=e.onload=e.onerror=null};e.onload=i,e.onerror=function(){p.log("Error loading "+e.src),r&&r.call(n,null,!0),e=e.onload=e.onerror=null},s.indexOf("data")!==0&&l!=null&&(e.crossOrigin=l),s.substring(0,14)==="data:image/svg"&&(e.onload=null,p.util.loadImageInDom(e,i)),e.src=s}else r&&r.call(n,s)},loadImageInDom:function(s,r){var n=p.document.createElement("div");n.style.width=n.style.height="1px",n.style.left=n.style.top="-100%",n.style.position="absolute",n.appendChild(s),p.document.querySelector("body").appendChild(n),s.onload=function(){r(),n.parentNode.removeChild(n),n=null}},enlivenObjects:function(s,r,n,l){var e=[],i=0,o=(s=s||[]).length;function d(){++i===o&&r&&r(e.filter(function(c){return c}))}o?s.forEach(function(c,u){c&&c.type?p.util.getKlass(c.type,n).fromObject(c,function(m,_){_||(e[u]=m),l&&l(c,m,_),d()}):d()}):r&&r(e)},enlivenObjectEnlivables:function(s,r,n){var l=p.Object.ENLIVEN_PROPS.filter(function(e){return!!s[e]});p.util.enlivenObjects(l.map(function(e){return s[e]}),function(e){var i={};l.forEach(function(o,d){i[o]=e[d],r&&(r[o]=e[d])}),n&&n(i)})},enlivenPatterns:function(s,r){function n(){++e===i&&r&&r(l)}var l=[],e=0,i=(s=s||[]).length;i?s.forEach(function(o,d){o&&o.source?new p.Pattern(o,function(c){l[d]=c,n()}):(l[d]=o,n())}):r&&r(l)},groupSVGElements:function(s,r,n){var l;return s&&s.length===1?s[0]:(r&&(r.width&&r.height?r.centerPoint={x:r.width/2,y:r.height/2}:(delete r.width,delete r.height)),l=new p.Group(s,r),n!==void 0&&(l.sourcePath=n),l)},populateWithProperties:function(s,r,n){if(n&&Array.isArray(n))for(var l=0,e=n.length;l<e;l++)n[l]in s&&(r[n[l]]=s[n[l]])},createCanvasElement:function(){return p.document.createElement("canvas")},copyCanvasElement:function(s){var r=p.util.createCanvasElement();return r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0),r},toDataURL:function(s,r,n){return s.toDataURL("image/"+r,n)},createImage:function(){return p.document.createElement("img")},multiplyTransformMatrices:function(s,r,n){return[s[0]*r[0]+s[2]*r[1],s[1]*r[0]+s[3]*r[1],s[0]*r[2]+s[2]*r[3],s[1]*r[2]+s[3]*r[3],n?0:s[0]*r[4]+s[2]*r[5]+s[4],n?0:s[1]*r[4]+s[3]*r[5]+s[5]]},qrDecompose:function(s){var r=v(s[1],s[0]),n=y(s[0],2)+y(s[1],2),l=g(n),e=(s[0]*s[3]-s[2]*s[1])/l,i=v(s[0]*s[2]+s[1]*s[3],n);return{angle:r/w,scaleX:l,scaleY:e,skewX:i/w,skewY:0,translateX:s[4],translateY:s[5]}},calcRotateMatrix:function(s){if(!s.angle)return p.iMatrix.concat();var r=p.util.degreesToRadians(s.angle),n=p.util.cos(r),l=p.util.sin(r);return[n,l,-l,n,0,0]},calcDimensionsMatrix:function(s){var r=s.scaleX===void 0?1:s.scaleX,n=s.scaleY===void 0?1:s.scaleY,l=[s.flipX?-r:r,0,0,s.flipY?-n:n,0,0],e=p.util.multiplyTransformMatrices,i=p.util.degreesToRadians;return s.skewX&&(l=e(l,[1,0,Math.tan(i(s.skewX)),1],!0)),s.skewY&&(l=e(l,[1,Math.tan(i(s.skewY)),0,1],!0)),l},composeMatrix:function(s){var r=[1,0,0,1,s.translateX||0,s.translateY||0],n=p.util.multiplyTransformMatrices;return s.angle&&(r=n(r,p.util.calcRotateMatrix(s))),(s.scaleX!==1||s.scaleY!==1||s.skewX||s.skewY||s.flipX||s.flipY)&&(r=n(r,p.util.calcDimensionsMatrix(s))),r},resetObjectTransform:function(s){s.scaleX=1,s.scaleY=1,s.skewX=0,s.skewY=0,s.flipX=!1,s.flipY=!1,s.rotate(0)},saveObjectTransform:function(s){return{scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,angle:s.angle,left:s.left,flipX:s.flipX,flipY:s.flipY,top:s.top}},isTransparent:function(s,r,n,l){l>0&&(r>l?r-=l:r=0,n>l?n-=l:n=0);var e,i=!0,o=s.getImageData(r,n,2*l||1,2*l||1),d=o.data.length;for(e=3;e<d&&(i=o.data[e]<=0)!=0;e+=4);return o=null,i},parsePreserveAspectRatioAttribute:function(s){var r,n="meet",l=s.split(" ");return l&&l.length&&((n=l.pop())!=="meet"&&n!=="slice"?(r=n,n="meet"):l.length&&(r=l.pop())),{meetOrSlice:n,alignX:r!=="none"?r.slice(1,4):"none",alignY:r!=="none"?r.slice(5,8):"none"}},clearFabricFontCache:function(s){(s=(s||"").toLowerCase())?p.charWidthsCache[s]&&delete p.charWidthsCache[s]:p.charWidthsCache={}},limitDimsByArea:function(s,r){var n=Math.sqrt(r*s),l=Math.floor(r/n);return{x:Math.floor(n),y:l}},capValue:function(s,r,n){return Math.max(s,Math.min(r,n))},findScaleToFit:function(s,r){return Math.min(r.width/s.width,r.height/s.height)},findScaleToCover:function(s,r){return Math.max(r.width/s.width,r.height/s.height)},matrixToSVG:function(s){return"matrix("+s.map(function(r){return p.util.toFixed(r,p.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(s,r){var n=p.util.invertTransform(r),l=p.util.multiplyTransformMatrices(n,s.calcOwnMatrix());p.util.applyTransformToObject(s,l)},addTransformToObject:function(s,r){p.util.applyTransformToObject(s,p.util.multiplyTransformMatrices(r,s.calcOwnMatrix()))},applyTransformToObject:function(s,r){var n=p.util.qrDecompose(r),l=new p.Point(n.translateX,n.translateY);s.flipX=!1,s.flipY=!1,s.set("scaleX",n.scaleX),s.set("scaleY",n.scaleY),s.skewX=n.skewX,s.skewY=n.skewY,s.angle=n.angle,s.setPositionByOrigin(l,"center","center")},sizeAfterTransform:function(s,r,n){var l=s/2,e=r/2,i=[{x:-l,y:-e},{x:l,y:-e},{x:-l,y:e},{x:l,y:e}],o=p.util.calcDimensionsMatrix(n),d=p.util.makeBoundingBoxFromPoints(i,o);return{x:d.width,y:d.height}},mergeClipPaths:function(s,r){var n=s,l=r;n.inverted&&!l.inverted&&(n=r,l=s),p.util.applyTransformToObject(l,p.util.multiplyTransformMatrices(p.util.invertTransform(n.calcTransformMatrix()),l.calcTransformMatrix()));var e=n.inverted&&l.inverted;return e&&(n.inverted=l.inverted=!1),new p.Group([n],{clipPath:l,inverted:e})}},function(){var s=Array.prototype.join,r={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},n={m:"l",M:"L"};function l(T,C,b,O,j,U,$,z,H,M,D){var G=p.util.cos(T),q=p.util.sin(T),J=p.util.cos(C),B=p.util.sin(C),F=b*j*J-O*U*B+$,Y=O*j*J+b*U*B+z;return["C",M+H*(-b*j*q-O*U*G),D+H*(-O*j*q+b*U*G),F+H*(b*j*B+O*U*J),Y+H*(O*j*B-b*U*J),F,Y]}function e(T,C,b,O){var j=Math.atan2(C,T),U=Math.atan2(O,b);return U>=j?U-j:2*Math.PI-(j-U)}function i(T,C,b){for(var O=b[1],j=b[2],U=b[3],$=b[4],z=b[5],H=function(G,q,J,B,F,Y,Q){var Z=Math.PI,te=Q*Z/180,ae=p.util.sin(te),ne=p.util.cos(te),ie=0,oe=0,se=-ne*G*.5-ae*q*.5,he=-ne*q*.5+ae*G*.5,_e=(J=Math.abs(J))*J,le=(B=Math.abs(B))*B,Oe=he*he,Ue=se*se,mt=_e*le-_e*Oe-le*Ue,Rt=0;if(mt<0){var yi=Math.sqrt(1-mt/(_e*le));J*=yi,B*=yi}else Rt=(F===Y?-1:1)*Math.sqrt(mt/(_e*Oe+le*Ue));var Xe=Rt*J*he/B,pt=-Rt*B*se/J,Wi=ne*Xe-ae*pt+.5*G,Ei=ae*Xe+ne*pt+.5*q,ni=e(1,0,(se-Xe)/J,(he-pt)/B),Ci=e((se-Xe)/J,(he-pt)/B,(-se-Xe)/J,(-he-pt)/B);Y===0&&Ci>0?Ci-=2*Z:Y===1&&Ci<0&&(Ci+=2*Z);for(var us=Math.ceil(Math.abs(Ci/Z*2)),Cr=[],Yi=Ci/us,Wo=8/3*Math.sin(Yi/4)*Math.sin(Yi/4)/Math.sin(Yi/2),fn=ni+Yi,Hi=0;Hi<us;Hi++)Cr[Hi]=l(ni,fn,ne,ae,J,B,Wi,Ei,Wo,ie,oe),ie=Cr[Hi][5],oe=Cr[Hi][6],ni=fn,fn+=Yi;return Cr}(b[6]-T,b[7]-C,O,j,$,z,U),M=0,D=H.length;M<D;M++)H[M][1]+=T,H[M][2]+=C,H[M][3]+=T,H[M][4]+=C,H[M][5]+=T,H[M][6]+=C;return H}function o(T,C,b,O){return Math.sqrt((b-T)*(b-T)+(O-C)*(O-C))}function d(T,C,b,O,j,U,$,z){return function(H){var M,D=(M=H)*M*M,G=function(B){return 3*B*B*(1-B)}(H),q=function(B){return 3*B*(1-B)*(1-B)}(H),J=function(B){return(1-B)*(1-B)*(1-B)}(H);return{x:$*D+j*G+b*q+T*J,y:z*D+U*G+O*q+C*J}}}function c(T,C,b,O,j,U,$,z){return function(H){var M=1-H,D=3*M*M*(b-T)+6*M*H*(j-b)+3*H*H*($-j),G=3*M*M*(O-C)+6*M*H*(U-O)+3*H*H*(z-U);return Math.atan2(G,D)}}function u(T,C,b,O,j,U){return function($){var z,H=(z=$)*z,M=function(G){return 2*G*(1-G)}($),D=function(G){return(1-G)*(1-G)}($);return{x:j*H+b*M+T*D,y:U*H+O*M+C*D}}}function m(T,C,b,O,j,U){return function($){var z=1-$,H=2*z*(b-T)+2*$*(j-b),M=2*z*(O-C)+2*$*(U-O);return Math.atan2(M,H)}}function _(T,C,b){var O,j,U={x:C,y:b},$=0;for(j=1;j<=100;j+=1)O=T(j/100),$+=o(U.x,U.y,O.x,O.y),U=O;return $}function E(T){for(var C,b,O,j,U=0,$=T.length,z=0,H=0,M=0,D=0,G=[],q=0;q<$;q++){switch(O={x:z,y:H,command:(C=T[q])[0]},C[0]){case"M":O.length=0,M=z=C[1],D=H=C[2];break;case"L":O.length=o(z,H,C[1],C[2]),z=C[1],H=C[2];break;case"C":b=d(z,H,C[1],C[2],C[3],C[4],C[5],C[6]),j=c(z,H,C[1],C[2],C[3],C[4],C[5],C[6]),O.iterator=b,O.angleFinder=j,O.length=_(b,z,H),z=C[5],H=C[6];break;case"Q":b=u(z,H,C[1],C[2],C[3],C[4]),j=m(z,H,C[1],C[2],C[3],C[4]),O.iterator=b,O.angleFinder=j,O.length=_(b,z,H),z=C[3],H=C[4];break;case"Z":case"z":O.destX=M,O.destY=D,O.length=o(z,H,M,D),z=M,H=D}U+=O.length,G.push(O)}return G.push({length:U,x:z,y:H}),G}p.util.joinPath=function(T){return T.map(function(C){return C.join(" ")}).join(" ")},p.util.parsePath=function(T){var C,b,O,j,U,$=[],z=[],H=p.rePathCommand,M="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",D="("+M+")"+p.commaWsp,G="([01])"+p.commaWsp+"?",q=new RegExp(D+"?"+D+"?"+D+G+G+D+"?("+M+")","g");if(!T||!T.match)return $;for(var J,B=0,F=(U=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;B<F;B++){j=(C=U[B]).slice(1).trim(),z.length=0;var Y=C.charAt(0);if(J=[Y],Y.toLowerCase()==="a")for(var Q;Q=q.exec(j);)for(var Z=1;Z<Q.length;Z++)z.push(Q[Z]);else for(;O=H.exec(j);)z.push(O[0]);Z=0;for(var te=z.length;Z<te;Z++)b=parseFloat(z[Z]),isNaN(b)||J.push(b);var ae=r[Y.toLowerCase()],ne=n[Y]||Y;if(J.length-1>ae)for(var ie=1,oe=J.length;ie<oe;ie+=ae)$.push([Y].concat(J.slice(ie,ie+ae))),Y=ne;else $.push(J)}return $},p.util.makePathSimpler=function(T){var C,b,O,j,U,$,z=0,H=0,M=T.length,D=0,G=0,q=[];for(b=0;b<M;++b){switch(O=!1,(C=T[b].slice(0))[0]){case"l":C[0]="L",C[1]+=z,C[2]+=H;case"L":z=C[1],H=C[2];break;case"h":C[1]+=z;case"H":C[0]="L",C[2]=H,z=C[1];break;case"v":C[1]+=H;case"V":C[0]="L",H=C[1],C[1]=z,C[2]=H;break;case"m":C[0]="M",C[1]+=z,C[2]+=H;case"M":z=C[1],H=C[2],D=C[1],G=C[2];break;case"c":C[0]="C",C[1]+=z,C[2]+=H,C[3]+=z,C[4]+=H,C[5]+=z,C[6]+=H;case"C":U=C[3],$=C[4],z=C[5],H=C[6];break;case"s":C[0]="S",C[1]+=z,C[2]+=H,C[3]+=z,C[4]+=H;case"S":j==="C"?(U=2*z-U,$=2*H-$):(U=z,$=H),z=C[3],H=C[4],C[0]="C",C[5]=C[3],C[6]=C[4],C[3]=C[1],C[4]=C[2],C[1]=U,C[2]=$,U=C[3],$=C[4];break;case"q":C[0]="Q",C[1]+=z,C[2]+=H,C[3]+=z,C[4]+=H;case"Q":U=C[1],$=C[2],z=C[3],H=C[4];break;case"t":C[0]="T",C[1]+=z,C[2]+=H;case"T":j==="Q"?(U=2*z-U,$=2*H-$):(U=z,$=H),C[0]="Q",z=C[1],H=C[2],C[1]=U,C[2]=$,C[3]=z,C[4]=H;break;case"a":C[0]="A",C[6]+=z,C[7]+=H;case"A":O=!0,q=q.concat(i(z,H,C)),z=C[6],H=C[7];break;case"z":case"Z":z=D,H=G}O||q.push(C),j=C[0]}return q},p.util.getSmoothPathFromPoints=function(T,C){var b,O=[],j=new p.Point(T[0].x,T[0].y),U=new p.Point(T[1].x,T[1].y),$=T.length,z=1,H=0,M=$>2;for(C=C||0,M&&(z=T[2].x<U.x?-1:T[2].x===U.x?0:1,H=T[2].y<U.y?-1:T[2].y===U.y?0:1),O.push(["M",j.x-z*C,j.y-H*C]),b=1;b<$;b++){if(!j.eq(U)){var D=j.midPointFrom(U);O.push(["Q",j.x,j.y,D.x,D.y])}j=T[b],b+1<T.length&&(U=T[b+1])}return M&&(z=j.x>T[b-2].x?1:j.x===T[b-2].x?0:-1,H=j.y>T[b-2].y?1:j.y===T[b-2].y?0:-1),O.push(["L",j.x+z*C,j.y+H*C]),O},p.util.getPathSegmentsInfo=E,p.util.getBoundsOfCurve=function(T,C,b,O,j,U,$,z){var H;if(p.cachesBoundsOfCurve&&(H=s.call(arguments),p.boundsOfCurveCache[H]))return p.boundsOfCurveCache[H];var M,D,G,q,J,B,F,Y,Q=Math.sqrt,Z=Math.min,te=Math.max,ae=Math.abs,ne=[],ie=[[],[]];D=6*T-12*b+6*j,M=-3*T+9*b-9*j+3*$,G=3*b-3*T;for(var oe=0;oe<2;++oe)if(oe>0&&(D=6*C-12*O+6*U,M=-3*C+9*O-9*U+3*z,G=3*O-3*C),ae(M)<1e-12){if(ae(D)<1e-12)continue;0<(q=-G/D)&&q<1&&ne.push(q)}else(F=D*D-4*G*M)<0||(0<(J=(-D+(Y=Q(F)))/(2*M))&&J<1&&ne.push(J),0<(B=(-D-Y)/(2*M))&&B<1&&ne.push(B));for(var se,he,_e,le=ne.length,Oe=le;le--;)se=(_e=1-(q=ne[le]))*_e*_e*T+3*_e*_e*q*b+3*_e*q*q*j+q*q*q*$,ie[0][le]=se,he=_e*_e*_e*C+3*_e*_e*q*O+3*_e*q*q*U+q*q*q*z,ie[1][le]=he;ie[0][Oe]=T,ie[1][Oe]=C,ie[0][Oe+1]=$,ie[1][Oe+1]=z;var Ue=[{x:Z.apply(null,ie[0]),y:Z.apply(null,ie[1])},{x:te.apply(null,ie[0]),y:te.apply(null,ie[1])}];return p.cachesBoundsOfCurve&&(p.boundsOfCurveCache[H]=Ue),Ue},p.util.getPointOnPath=function(T,C,b){b||(b=E(T));for(var O=0;C-b[O].length>0&&O<b.length-2;)C-=b[O].length,O++;var j,U=b[O],$=C/U.length,z=U.command,H=T[O];switch(z){case"M":return{x:U.x,y:U.y,angle:0};case"Z":case"z":return(j=new p.Point(U.x,U.y).lerp(new p.Point(U.destX,U.destY),$)).angle=Math.atan2(U.destY-U.y,U.destX-U.x),j;case"L":return(j=new p.Point(U.x,U.y).lerp(new p.Point(H[1],H[2]),$)).angle=Math.atan2(H[2]-U.y,H[1]-U.x),j;case"C":case"Q":return function(M,D){for(var G,q,J,B=0,F=0,Y=M.iterator,Q={x:M.x,y:M.y},Z=.01,te=M.angleFinder;F<D&&Z>1e-4;)G=Y(B),J=B,(q=o(Q.x,Q.y,G.x,G.y))+F>D?(B-=Z,Z/=2):(Q=G,B+=Z,F+=q);return G.angle=te(J),G}(U,C)}},p.util.transformPath=function(T,C,b){return b&&(C=p.util.multiplyTransformMatrices(C,[1,0,0,1,-b.x,-b.y])),T.map(function(O){for(var j=O.slice(0),U={},$=1;$<O.length-1;$+=2)U.x=O[$],U.y=O[$+1],U=p.util.transformPoint(U,C),j[$]=U.x,j[$+1]=U.y;return j})}}(),function(){var s=Array.prototype.slice;function r(n,l,e){if(n&&n.length!==0){var i=n.length-1,o=l?n[i][l]:n[i];if(l)for(;i--;)e(n[i][l],o)&&(o=n[i][l]);else for(;i--;)e(n[i],o)&&(o=n[i]);return o}}p.util.array={fill:function(n,l){for(var e=n.length;e--;)n[e]=l;return n},invoke:function(n,l){for(var e=s.call(arguments,2),i=[],o=0,d=n.length;o<d;o++)i[o]=e.length?n[o][l].apply(n[o],e):n[o][l].call(n[o]);return i},min:function(n,l){return r(n,l,function(e,i){return e<i})},max:function(n,l){return r(n,l,function(e,i){return e>=i})}}}(),function(){function s(r,n,l){if(l)if(!p.isLikelyNode&&n instanceof Element)r=n;else if(n instanceof Array){r=[];for(var e=0,i=n.length;e<i;e++)r[e]=s({},n[e],l)}else if(n&&typeof n=="object")for(var o in n)o==="canvas"||o==="group"?r[o]=null:n.hasOwnProperty(o)&&(r[o]=s({},n[o],l));else r=n;else for(var o in n)r[o]=n[o];return r}p.util.object={extend:s,clone:function(r,n){return s({},r,n)}},p.util.object.extend(p.util,p.Observable)}(),function(){function s(r,n){var l=r.charCodeAt(n);if(isNaN(l))return"";if(l<55296||l>57343)return r.charAt(n);if(55296<=l&&l<=56319){if(r.length<=n+1)throw"High surrogate without following low surrogate";var e=r.charCodeAt(n+1);if(56320>e||e>57343)throw"High surrogate without following low surrogate";return r.charAt(n)+r.charAt(n+1)}if(n===0)throw"Low surrogate without preceding high surrogate";var i=r.charCodeAt(n-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1}p.util.string={camelize:function(r){return r.replace(/-+(.)?/g,function(n,l){return l?l.toUpperCase():""})},capitalize:function(r,n){return r.charAt(0).toUpperCase()+(n?r.slice(1):r.slice(1).toLowerCase())},escapeXml:function(r){return r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(r){var n,l=0,e=[];for(l=0;l<r.length;l++)(n=s(r,l))!==!1&&e.push(n);return e}}}(),function(){var s=Array.prototype.slice,r=function(){},n=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),l=function(o,d,c){for(var u in d)u in o.prototype&&typeof o.prototype[u]=="function"&&(d[u]+"").indexOf("callSuper")>-1?o.prototype[u]=function(m){return function(){var _=this.constructor.superclass;this.constructor.superclass=c;var E=d[m].apply(this,arguments);if(this.constructor.superclass=_,m!=="initialize")return E}}(u):o.prototype[u]=d[u],n&&(d.toString!==Object.prototype.toString&&(o.prototype.toString=d.toString),d.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=d.valueOf))};function e(){}function i(o){for(var d=null,c=this;c.constructor.superclass;){var u=c.constructor.superclass.prototype[o];if(c[o]!==u){d=u;break}c=c.constructor.superclass.prototype}return d?arguments.length>1?d.apply(this,s.call(arguments,1)):d.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}p.util.createClass=function(){var o=null,d=s.call(arguments,0);function c(){this.initialize.apply(this,arguments)}typeof d[0]=="function"&&(o=d.shift()),c.superclass=o,c.subclasses=[],o&&(e.prototype=o.prototype,c.prototype=new e,o.subclasses.push(c));for(var u=0,m=d.length;u<m;u++)l(c,d[u],o);return c.prototype.initialize||(c.prototype.initialize=r),c.prototype.constructor=c,c.prototype.callSuper=i,c}}(),x=!!p.document.createElement("div").attachEvent,A=["touchstart","touchmove","touchend"],p.util.addListener=function(s,r,n,l){s&&s.addEventListener(r,n,!x&&l)},p.util.removeListener=function(s,r,n,l){s&&s.removeEventListener(r,n,!x&&l)},p.util.getPointer=function(s){var r=s.target,n=p.util.getScrollLeftTop(r),l=function(e){var i=e.changedTouches;return i&&i[0]?i[0]:e}(s);return{x:l.clientX+n.left,y:l.clientY+n.top}},p.util.isTouchEvent=function(s){return A.indexOf(s.type)>-1||s.pointerType==="touch"},k=typeof(L=p.document.createElement("div")).style.opacity=="string",N=typeof L.style.filter=="string",P=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,V=function(s){return s},k?V=function(s,r){return s.style.opacity=r,s}:N&&(V=function(s,r){var n=s.style;return s.currentStyle&&!s.currentStyle.hasLayout&&(n.zoom=1),P.test(n.filter)?(r=r>=.9999?"":"alpha(opacity="+100*r+")",n.filter=n.filter.replace(P,r)):n.filter+=" alpha(opacity="+100*r+")",s}),p.util.setStyle=function(s,r){var n=s.style;if(!n)return s;if(typeof r=="string")return s.style.cssText+=";"+r,r.indexOf("opacity")>-1?V(s,r.match(/opacity:\s*(\d?\.?\d*)/)[1]):s;for(var l in r)l==="opacity"?V(s,r[l]):n[l==="float"||l==="cssFloat"?n.styleFloat===void 0?"cssFloat":"styleFloat":l]=r[l];return s},function(){var s,r,n,l,e=Array.prototype.slice,i=function(c){return e.call(c,0)};try{s=i(p.document.childNodes)instanceof Array}catch{}function o(c,u){var m=p.document.createElement(c);for(var _ in u)_==="class"?m.className=u[_]:_==="for"?m.htmlFor=u[_]:m.setAttribute(_,u[_]);return m}function d(c){for(var u=0,m=0,_=p.document.documentElement,E=p.document.body||{scrollLeft:0,scrollTop:0};c&&(c.parentNode||c.host)&&((c=c.parentNode||c.host)===p.document?(u=E.scrollLeft||_.scrollLeft||0,m=E.scrollTop||_.scrollTop||0):(u+=c.scrollLeft||0,m+=c.scrollTop||0),c.nodeType!==1||c.style.position!=="fixed"););return{left:u,top:m}}s||(i=function(c){for(var u=new Array(c.length),m=c.length;m--;)u[m]=c[m];return u}),r=p.document.defaultView&&p.document.defaultView.getComputedStyle?function(c,u){var m=p.document.defaultView.getComputedStyle(c,null);return m?m[u]:void 0}:function(c,u){var m=c.style[u];return!m&&c.currentStyle&&(m=c.currentStyle[u]),m},n=p.document.documentElement.style,l="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"",p.util.makeElementUnselectable=function(c){return c.onselectstart!==void 0&&(c.onselectstart=p.util.falseFunction),l?c.style[l]="none":typeof c.unselectable=="string"&&(c.unselectable="on"),c},p.util.makeElementSelectable=function(c){return c.onselectstart!==void 0&&(c.onselectstart=null),l?c.style[l]="":typeof c.unselectable=="string"&&(c.unselectable=""),c},p.util.setImageSmoothing=function(c,u){c.imageSmoothingEnabled=c.imageSmoothingEnabled||c.webkitImageSmoothingEnabled||c.mozImageSmoothingEnabled||c.msImageSmoothingEnabled||c.oImageSmoothingEnabled,c.imageSmoothingEnabled=u},p.util.getById=function(c){return typeof c=="string"?p.document.getElementById(c):c},p.util.toArray=i,p.util.addClass=function(c,u){c&&(" "+c.className+" ").indexOf(" "+u+" ")===-1&&(c.className+=(c.className?" ":"")+u)},p.util.makeElement=o,p.util.wrapElement=function(c,u,m){return typeof u=="string"&&(u=o(u,m)),c.parentNode&&c.parentNode.replaceChild(u,c),u.appendChild(c),u},p.util.getScrollLeftTop=d,p.util.getElementOffset=function(c){var u,m,_=c&&c.ownerDocument,E={left:0,top:0},T={left:0,top:0},C={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!_)return T;for(var b in C)T[C[b]]+=parseInt(r(c,b),10)||0;return u=_.documentElement,c.getBoundingClientRect!==void 0&&(E=c.getBoundingClientRect()),m=d(c),{left:E.left+m.left-(u.clientLeft||0)+T.left,top:E.top+m.top-(u.clientTop||0)+T.top}},p.util.getNodeCanvas=function(c){var u=p.jsdomImplForWrapper(c);return u._canvas||u._image},p.util.cleanUpJsdomNode=function(c){if(p.isLikelyNode){var u=p.jsdomImplForWrapper(c);u&&(u._image=null,u._canvas=null,u._currentSrc=null,u._attributes=null,u._classList=null)}}}(),function(){function s(){}p.util.request=function(r,n){n||(n={});var l=n.method?n.method.toUpperCase():"GET",e=n.onComplete||function(){},i=new p.window.XMLHttpRequest,o=n.body||n.parameters;return i.onreadystatechange=function(){i.readyState===4&&(e(i),i.onreadystatechange=s)},l==="GET"&&(o=null,typeof n.parameters=="string"&&(r=function(d,c){return d+(/\?/.test(d)?"&":"?")+c}(r,n.parameters))),i.open(l,r,!0),l!=="POST"&&l!=="PUT"||i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(o),i}}(),p.log=console.log,p.warn=console.warn,function(){var s=p.util.object.extend,r=p.util.object.clone,n=[];function l(){return!1}function e(c,u,m,_){return-m*Math.cos(c/_*(Math.PI/2))+m+u}p.util.object.extend(n,{cancelAll:function(){var c=this.splice(0);return c.forEach(function(u){u.cancel()}),c},cancelByCanvas:function(c){if(!c)return[];var u=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===c});return u.forEach(function(m){m.cancel()}),u},cancelByTarget:function(c){var u=this.findAnimationsByTarget(c);return u.forEach(function(m){m.cancel()}),u},findAnimationIndex:function(c){return this.indexOf(this.findAnimation(c))},findAnimation:function(c){return this.find(function(u){return u.cancel===c})},findAnimationsByTarget:function(c){return c?this.filter(function(u){return u.target===c}):[]}});var i=p.window.requestAnimationFrame||p.window.webkitRequestAnimationFrame||p.window.mozRequestAnimationFrame||p.window.oRequestAnimationFrame||p.window.msRequestAnimationFrame||function(c){return p.window.setTimeout(c,1e3/60)},o=p.window.cancelAnimationFrame||p.window.clearTimeout;function d(){return i.apply(p.window,arguments)}p.util.animate=function(c){c||(c={});var u,m=!1,_=function(){var E=p.runningAnimations.indexOf(u);return E>-1&&p.runningAnimations.splice(E,1)[0]};return u=s(r(c),{cancel:function(){return m=!0,_()},currentValue:"startValue"in c?c.startValue:0,completionRate:0,durationRate:0}),p.runningAnimations.push(u),d(function(E){var T,C=E||+new Date,b=c.duration||500,O=C+b,j=c.onChange||l,U=c.abort||l,$=c.onComplete||l,z=c.easing||e,H="startValue"in c&&c.startValue.length>0,M="startValue"in c?c.startValue:0,D="endValue"in c?c.endValue:100,G=c.byValue||(H?M.map(function(q,J){return D[J]-M[J]}):D-M);c.onStart&&c.onStart(),function q(J){var B=(T=J||+new Date)>O?b:T-C,F=B/b,Y=H?M.map(function(Z,te){return z(B,M[te],G[te],b)}):z(B,M,G,b),Q=Math.abs(H?(Y[0]-M[0])/G[0]:(Y-M)/G);if(u.currentValue=H?Y.slice():Y,u.completionRate=Q,u.durationRate=F,!m){if(!U(Y,Q,F))return T>O?(u.currentValue=H?D.slice():D,u.completionRate=1,u.durationRate=1,j(H?D.slice():D,1,1),$(D,1,1),void _()):(j(Y,Q,F),void d(q));_()}}(C)}),u.cancel},p.util.requestAnimFrame=d,p.util.cancelAnimFrame=function(){return o.apply(p.window,arguments)},p.runningAnimations=n}(),function(){function s(r,n,l){var e="rgba("+parseInt(r[0]+l*(n[0]-r[0]),10)+","+parseInt(r[1]+l*(n[1]-r[1]),10)+","+parseInt(r[2]+l*(n[2]-r[2]),10);return(e+=","+(r&&n?parseFloat(r[3]+l*(n[3]-r[3])):1))+")"}p.util.animateColor=function(r,n,l,e){var i=new p.Color(r).getSource(),o=new p.Color(n).getSource(),d=e.onComplete,c=e.onChange;return e=e||{},p.util.animate(p.util.object.extend(e,{duration:l||500,startValue:i,endValue:o,byValue:o,easing:function(u,m,_,E){return s(m,_,e.colorEasing?e.colorEasing(u,E):1-Math.cos(u/E*(Math.PI/2)))},onComplete:function(u,m,_){if(d)return d(s(o,o,0),m,_)},onChange:function(u,m,_){if(c){if(Array.isArray(u))return c(s(u,u,0),m,_);c(u,m,_)}}}))}}(),function(){function s(e,i,o,d){return e<Math.abs(i)?(e=i,d=o/4):d=i===0&&e===0?o/(2*Math.PI)*Math.asin(1):o/(2*Math.PI)*Math.asin(i/e),{a:e,c:i,p:o,s:d}}function r(e,i,o){return e.a*Math.pow(2,10*(i-=1))*Math.sin((i*o-e.s)*(2*Math.PI)/e.p)}function n(e,i,o,d){return o-l(d-e,0,o,d)+i}function l(e,i,o,d){return(e/=d)<1/2.75?o*(7.5625*e*e)+i:e<2/2.75?o*(7.5625*(e-=1.5/2.75)*e+.75)+i:e<2.5/2.75?o*(7.5625*(e-=2.25/2.75)*e+.9375)+i:o*(7.5625*(e-=2.625/2.75)*e+.984375)+i}p.util.ease={easeInQuad:function(e,i,o,d){return o*(e/=d)*e+i},easeOutQuad:function(e,i,o,d){return-o*(e/=d)*(e-2)+i},easeInOutQuad:function(e,i,o,d){return(e/=d/2)<1?o/2*e*e+i:-o/2*(--e*(e-2)-1)+i},easeInCubic:function(e,i,o,d){return o*(e/=d)*e*e+i},easeOutCubic:function(e,i,o,d){return o*((e=e/d-1)*e*e+1)+i},easeInOutCubic:function(e,i,o,d){return(e/=d/2)<1?o/2*e*e*e+i:o/2*((e-=2)*e*e+2)+i},easeInQuart:function(e,i,o,d){return o*(e/=d)*e*e*e+i},easeOutQuart:function(e,i,o,d){return-o*((e=e/d-1)*e*e*e-1)+i},easeInOutQuart:function(e,i,o,d){return(e/=d/2)<1?o/2*e*e*e*e+i:-o/2*((e-=2)*e*e*e-2)+i},easeInQuint:function(e,i,o,d){return o*(e/=d)*e*e*e*e+i},easeOutQuint:function(e,i,o,d){return o*((e=e/d-1)*e*e*e*e+1)+i},easeInOutQuint:function(e,i,o,d){return(e/=d/2)<1?o/2*e*e*e*e*e+i:o/2*((e-=2)*e*e*e*e+2)+i},easeInSine:function(e,i,o,d){return-o*Math.cos(e/d*(Math.PI/2))+o+i},easeOutSine:function(e,i,o,d){return o*Math.sin(e/d*(Math.PI/2))+i},easeInOutSine:function(e,i,o,d){return-o/2*(Math.cos(Math.PI*e/d)-1)+i},easeInExpo:function(e,i,o,d){return e===0?i:o*Math.pow(2,10*(e/d-1))+i},easeOutExpo:function(e,i,o,d){return e===d?i+o:o*(1-Math.pow(2,-10*e/d))+i},easeInOutExpo:function(e,i,o,d){return e===0?i:e===d?i+o:(e/=d/2)<1?o/2*Math.pow(2,10*(e-1))+i:o/2*(2-Math.pow(2,-10*--e))+i},easeInCirc:function(e,i,o,d){return-o*(Math.sqrt(1-(e/=d)*e)-1)+i},easeOutCirc:function(e,i,o,d){return o*Math.sqrt(1-(e=e/d-1)*e)+i},easeInOutCirc:function(e,i,o,d){return(e/=d/2)<1?-o/2*(Math.sqrt(1-e*e)-1)+i:o/2*(Math.sqrt(1-(e-=2)*e)+1)+i},easeInElastic:function(e,i,o,d){var c=0;return e===0?i:(e/=d)==1?i+o:(c||(c=.3*d),-r(s(o,o,c,1.70158),e,d)+i)},easeOutElastic:function(e,i,o,d){var c=0;if(e===0)return i;if((e/=d)==1)return i+o;c||(c=.3*d);var u=s(o,o,c,1.70158);return u.a*Math.pow(2,-10*e)*Math.sin((e*d-u.s)*(2*Math.PI)/u.p)+u.c+i},easeInOutElastic:function(e,i,o,d){var c=0;if(e===0)return i;if((e/=d/2)==2)return i+o;c||(c=d*(.3*1.5));var u=s(o,o,c,1.70158);return e<1?-.5*r(u,e,d)+i:u.a*Math.pow(2,-10*(e-=1))*Math.sin((e*d-u.s)*(2*Math.PI)/u.p)*.5+u.c+i},easeInBack:function(e,i,o,d,c){return c===void 0&&(c=1.70158),o*(e/=d)*e*((c+1)*e-c)+i},easeOutBack:function(e,i,o,d,c){return c===void 0&&(c=1.70158),o*((e=e/d-1)*e*((c+1)*e+c)+1)+i},easeInOutBack:function(e,i,o,d,c){return c===void 0&&(c=1.70158),(e/=d/2)<1?o/2*(e*e*((1+(c*=1.525))*e-c))+i:o/2*((e-=2)*e*((1+(c*=1.525))*e+c)+2)+i},easeInBounce:n,easeOutBounce:l,easeInOutBounce:function(e,i,o,d){return e<d/2?.5*n(2*e,0,o,d)+i:.5*l(2*e-d,0,o,d)+.5*o+i}}}(),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.object.clone,e=r.util.toFixed,i=r.util.parseUnit,o=r.util.multiplyTransformMatrices,d={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},c={stroke:"strokeOpacity",fill:"fillOpacity"},u="font-size",m="clip-path";function _(M){return M in d?d[M]:M}function E(M,D,G,q){var J,B=Array.isArray(D);if(M!=="fill"&&M!=="stroke"||D!=="none"){if(M==="strokeUniform")return D==="non-scaling-stroke";if(M==="strokeDashArray")D=D==="none"?null:D.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(M==="transformMatrix")D=G&&G.transformMatrix?o(G.transformMatrix,r.parseTransformAttribute(D)):r.parseTransformAttribute(D);else if(M==="visible")D=D!=="none"&&D!=="hidden",G&&G.visible===!1&&(D=!1);else if(M==="opacity")D=parseFloat(D),G&&G.opacity!==void 0&&(D*=G.opacity);else if(M==="textAnchor")D=D==="start"?"left":D==="end"?"right":"center";else if(M==="charSpacing")J=i(D,q)/q*1e3;else if(M==="paintFirst"){var F=D.indexOf("fill"),Y=D.indexOf("stroke");D="fill",(F>-1&&Y>-1&&Y<F||F===-1&&Y>-1)&&(D="stroke")}else{if(M==="href"||M==="xlink:href"||M==="font")return D;if(M==="imageSmoothing")return D==="optimizeQuality";J=B?D.map(i):i(D,q)}}else D="";return!B&&isNaN(J)?D:J}function T(M){return new RegExp("^("+M.join("|")+")\\b","i")}function C(M,D){var G,q,J,B,F=[];for(J=0,B=D.length;J<B;J++)G=D[J],q=M.getElementsByTagName(G),F=F.concat(Array.prototype.slice.call(q));return F}function b(M,D){var G,q=!0;return(G=O(M,D.pop()))&&D.length&&(q=function(J,B){for(var F,Y=!0;J.parentNode&&J.parentNode.nodeType===1&&B.length;)Y&&(F=B.pop()),Y=O(J=J.parentNode,F);return B.length===0}(M,D)),G&&q&&D.length===0}function O(M,D){var G,q,J=M.nodeName,B=M.getAttribute("class"),F=M.getAttribute("id");if(G=new RegExp("^"+J,"i"),D=D.replace(G,""),F&&D.length&&(G=new RegExp("#"+F+"(?![a-zA-Z\\-]+)","i"),D=D.replace(G,"")),B&&D.length)for(q=(B=B.split(" ")).length;q--;)G=new RegExp("\\."+B[q]+"(?![a-zA-Z\\-]+)","i"),D=D.replace(G,"");return D.length===0}function j(M,D){var G;if(M.getElementById&&(G=M.getElementById(D)),G)return G;var q,J,B,F=M.getElementsByTagName("*");for(J=0,B=F.length;J<B;J++)if(D===(q=F[J]).getAttribute("id"))return q}r.svgValidTagNamesRegEx=T(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),r.svgViewBoxElementsRegEx=T(["symbol","image","marker","pattern","view","svg"]),r.svgInvalidAncestorsRegEx=T(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),r.svgValidParentsRegEx=T(["symbol","g","a","svg","clipPath","defs"]),r.cssRules={},r.gradientDefs={},r.clipPaths={},r.parseTransformAttribute=function(){function M(Y,Q,Z){Y[Z]=Math.tan(r.util.degreesToRadians(Q[0]))}var D=r.iMatrix,G=r.reNum,q=r.commaWsp,J="(?:(?:(matrix)\\s*\\(\\s*("+G+")"+q+"("+G+")"+q+"("+G+")"+q+"("+G+")"+q+"("+G+")"+q+"("+G+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+G+")(?:"+q+"("+G+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+G+")(?:"+q+"("+G+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+G+")(?:"+q+"("+G+")"+q+"("+G+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+G+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+G+")\\s*\\)))",B=new RegExp("^\\s*(?:(?:"+J+"(?:"+q+"*"+J+")*)?)\\s*$"),F=new RegExp(J,"g");return function(Y){var Q=D.concat(),Z=[];if(!Y||Y&&!B.test(Y))return Q;Y.replace(F,function(ae){var ne=new RegExp(J).exec(ae).filter(function(se){return!!se}),ie=ne[1],oe=ne.slice(2).map(parseFloat);switch(ie){case"translate":(function(se,he){se[4]=he[0],he.length===2&&(se[5]=he[1])})(Q,oe);break;case"rotate":oe[0]=r.util.degreesToRadians(oe[0]),function(se,he){var _e=r.util.cos(he[0]),le=r.util.sin(he[0]),Oe=0,Ue=0;he.length===3&&(Oe=he[1],Ue=he[2]),se[0]=_e,se[1]=le,se[2]=-le,se[3]=_e,se[4]=Oe-(_e*Oe-le*Ue),se[5]=Ue-(le*Oe+_e*Ue)}(Q,oe);break;case"scale":(function(se,he){var _e=he[0],le=he.length===2?he[1]:he[0];se[0]=_e,se[3]=le})(Q,oe);break;case"skewX":M(Q,oe,2);break;case"skewY":M(Q,oe,1);break;case"matrix":Q=oe}Z.push(Q.concat()),Q=D.concat()});for(var te=Z[0];Z.length>1;)Z.shift(),te=r.util.multiplyTransformMatrices(te,Z[0]);return te}}();var U=new RegExp("^\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*$");function $(M){if(!r.svgViewBoxElementsRegEx.test(M.nodeName))return{};var D,G,q,J,B,F,Y=M.getAttribute("viewBox"),Q=1,Z=1,te=M.getAttribute("width"),ae=M.getAttribute("height"),ne=M.getAttribute("x")||0,ie=M.getAttribute("y")||0,oe=M.getAttribute("preserveAspectRatio")||"",se=!Y||!(Y=Y.match(U)),he=!te||!ae||te==="100%"||ae==="100%",_e=se&&he,le={},Oe="",Ue=0,mt=0;if(le.width=0,le.height=0,le.toBeParsed=_e,se&&(ne||ie)&&M.parentNode&&M.parentNode.nodeName!=="#document"&&(Oe=" translate("+i(ne)+" "+i(ie)+") ",B=(M.getAttribute("transform")||"")+Oe,M.setAttribute("transform",B),M.removeAttribute("x"),M.removeAttribute("y")),_e)return le;if(se)return le.width=i(te),le.height=i(ae),le;if(D=-parseFloat(Y[1]),G=-parseFloat(Y[2]),q=parseFloat(Y[3]),J=parseFloat(Y[4]),le.minX=D,le.minY=G,le.viewBoxWidth=q,le.viewBoxHeight=J,he?(le.width=q,le.height=J):(le.width=i(te),le.height=i(ae),Q=le.width/q,Z=le.height/J),(oe=r.util.parsePreserveAspectRatioAttribute(oe)).alignX!=="none"&&(oe.meetOrSlice==="meet"&&(Z=Q=Q>Z?Z:Q),oe.meetOrSlice==="slice"&&(Z=Q=Q>Z?Q:Z),Ue=le.width-q*Q,mt=le.height-J*Q,oe.alignX==="Mid"&&(Ue/=2),oe.alignY==="Mid"&&(mt/=2),oe.alignX==="Min"&&(Ue=0),oe.alignY==="Min"&&(mt=0)),Q===1&&Z===1&&D===0&&G===0&&ne===0&&ie===0)return le;if((ne||ie)&&M.parentNode.nodeName!=="#document"&&(Oe=" translate("+i(ne)+" "+i(ie)+") "),B=Oe+" matrix("+Q+" 0 0 "+Z+" "+(D*Q+Ue)+" "+(G*Z+mt)+") ",M.nodeName==="svg"){for(F=M.ownerDocument.createElementNS(r.svgNS,"g");M.firstChild;)F.appendChild(M.firstChild);M.appendChild(F)}else(F=M).removeAttribute("x"),F.removeAttribute("y"),B=F.getAttribute("transform")+B;return F.setAttribute("transform",B),le}function z(M,D){var G="xlink:href",q=j(M,D.getAttribute(G).slice(1));if(q&&q.getAttribute(G)&&z(M,q),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(B){q&&!D.hasAttribute(B)&&q.hasAttribute(B)&&D.setAttribute(B,q.getAttribute(B))}),!D.children.length)for(var J=q.cloneNode(!0);J.firstChild;)D.appendChild(J.firstChild);D.removeAttribute(G)}r.parseSVGDocument=function(M,D,G,q){if(M){(function(ne){for(var ie=C(ne,["use","svg:use"]),oe=0;ie.length&&oe<ie.length;){var se=ie[oe],he=se.getAttribute("xlink:href")||se.getAttribute("href");if(he===null)return;var _e,le,Oe,Ue,mt=he.slice(1),Rt=se.getAttribute("x")||0,yi=se.getAttribute("y")||0,Xe=j(ne,mt).cloneNode(!0),pt=(Xe.getAttribute("transform")||"")+" translate("+Rt+", "+yi+")",Wi=ie.length,Ei=r.svgNS;if($(Xe),/^svg$/i.test(Xe.nodeName)){var ni=Xe.ownerDocument.createElementNS(Ei,"g");for(le=0,Ue=(Oe=Xe.attributes).length;le<Ue;le++)_e=Oe.item(le),ni.setAttributeNS(Ei,_e.nodeName,_e.nodeValue);for(;Xe.firstChild;)ni.appendChild(Xe.firstChild);Xe=ni}for(le=0,Ue=(Oe=se.attributes).length;le<Ue;le++)(_e=Oe.item(le)).nodeName!=="x"&&_e.nodeName!=="y"&&_e.nodeName!=="xlink:href"&&_e.nodeName!=="href"&&(_e.nodeName==="transform"?pt=_e.nodeValue+" "+pt:Xe.setAttribute(_e.nodeName,_e.nodeValue));Xe.setAttribute("transform",pt),Xe.setAttribute("instantiated_by_use","1"),Xe.removeAttribute("id"),se.parentNode.replaceChild(Xe,se),ie.length===Wi&&oe++}})(M);var J,B,F=r.Object.__uid++,Y=$(M),Q=r.util.toArray(M.getElementsByTagName("*"));if(Y.crossOrigin=q&&q.crossOrigin,Y.svgUid=F,Q.length===0&&r.isLikelyNode){var Z=[];for(J=0,B=(Q=M.selectNodes('//*[name(.)!="svg"]')).length;J<B;J++)Z[J]=Q[J];Q=Z}var te=Q.filter(function(ne){return $(ne),r.svgValidTagNamesRegEx.test(ne.nodeName.replace("svg:",""))&&!function(ie,oe){for(;ie&&(ie=ie.parentNode);)if(ie.nodeName&&oe.test(ie.nodeName.replace("svg:",""))&&!ie.getAttribute("instantiated_by_use"))return!0;return!1}(ne,r.svgInvalidAncestorsRegEx)});if(!te||te&&!te.length)D&&D([],{});else{var ae={};Q.filter(function(ne){return ne.nodeName.replace("svg:","")==="clipPath"}).forEach(function(ne){var ie=ne.getAttribute("id");ae[ie]=r.util.toArray(ne.getElementsByTagName("*")).filter(function(oe){return r.svgValidTagNamesRegEx.test(oe.nodeName.replace("svg:",""))})}),r.gradientDefs[F]=r.getGradientDefs(M),r.cssRules[F]=r.getCSSRules(M),r.clipPaths[F]=ae,r.parseElements(te,function(ne,ie){D&&(D(ne,Y,ie,Q),delete r.gradientDefs[F],delete r.cssRules[F],delete r.clipPaths[F])},l(Y),G,q)}}};var H=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+r.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+r.reNum+"))?\\s+(.*)");n(r,{parseFontDeclaration:function(M,D){var G=M.match(H);if(G){var q=G[1],J=G[3],B=G[4],F=G[5],Y=G[6];q&&(D.fontStyle=q),J&&(D.fontWeight=isNaN(parseFloat(J))?J:parseFloat(J)),B&&(D.fontSize=i(B)),Y&&(D.fontFamily=Y),F&&(D.lineHeight=F==="normal"?1:F)}},getGradientDefs:function(M){var D,G=C(M,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),q=0,J={};for(q=G.length;q--;)(D=G[q]).getAttribute("xlink:href")&&z(M,D),J[D.getAttribute("id")]=D;return J},parseAttributes:function(M,D,G){if(M){var q,J,B,F={};G===void 0&&(G=M.getAttribute("svgUid")),M.parentNode&&r.svgValidParentsRegEx.test(M.parentNode.nodeName)&&(F=r.parseAttributes(M.parentNode,D,G));var Y=D.reduce(function(oe,se){return(q=M.getAttribute(se))&&(oe[se]=q),oe},{}),Q=n(function(oe,se){var he={};for(var _e in r.cssRules[se])if(b(oe,_e.split(" ")))for(var le in r.cssRules[se][_e])he[le]=r.cssRules[se][_e][le];return he}(M,G),r.parseStyleAttribute(M));Y=n(Y,Q),Q[m]&&M.setAttribute(m,Q[m]),J=B=F.fontSize||r.Text.DEFAULT_SVG_FONT_SIZE,Y[u]&&(Y[u]=J=i(Y[u],B));var Z,te,ae={};for(var ne in Y)te=E(Z=_(ne),Y[ne],F,J),ae[Z]=te;ae&&ae.font&&r.parseFontDeclaration(ae.font,ae);var ie=n(F,ae);return r.svgValidParentsRegEx.test(M.nodeName)?ie:function(oe){for(var se in c)if(oe[c[se]]!==void 0&&oe[se]!==""){if(oe[se]===void 0){if(!r.Object.prototype[se])continue;oe[se]=r.Object.prototype[se]}if(oe[se].indexOf("url(")!==0){var he=new r.Color(oe[se]);oe[se]=he.setAlpha(e(he.getAlpha()*oe[c[se]],2)).toRgba()}}return oe}(ie)}},parseElements:function(M,D,G,q,J){new r.ElementsParser(M,D,G,q,J).parse()},parseStyleAttribute:function(M){var D={},G=M.getAttribute("style");return G&&(typeof G=="string"?function(q,J){var B,F;q.replace(/;\s*$/,"").split(";").forEach(function(Y){var Q=Y.split(":");B=Q[0].trim().toLowerCase(),F=Q[1].trim(),J[B]=F})}(G,D):function(q,J){var B,F;for(var Y in q)q[Y]!==void 0&&(B=Y.toLowerCase(),F=q[Y],J[B]=F)}(G,D)),D},parsePointsAttribute:function(M){if(!M)return null;var D,G,q=[];for(D=0,G=(M=(M=M.replace(/,/g," ").trim()).split(/\s+/)).length;D<G;D+=2)q.push({x:parseFloat(M[D]),y:parseFloat(M[D+1])});return q},getCSSRules:function(M){var D,G,q=M.getElementsByTagName("style"),J={};for(D=0,G=q.length;D<G;D++){var B=q[D].textContent;(B=B.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&B.split("}").filter(function(F){return F.trim()}).forEach(function(F){var Y=F.split("{"),Q={},Z=Y[1].trim().split(";").filter(function(ie){return ie.trim()});for(D=0,G=Z.length;D<G;D++){var te=Z[D].split(":"),ae=te[0].trim(),ne=te[1].trim();Q[ae]=ne}(F=Y[0].trim()).split(",").forEach(function(ie){(ie=ie.replace(/^svg/i,"").trim())!==""&&(J[ie]?r.util.object.extend(J[ie],Q):J[ie]=r.util.object.clone(Q))})})}return J},loadSVGFromURL:function(M,D,G,q){M=M.replace(/^\n\s*/,"").trim(),new r.util.request(M,{method:"get",onComplete:function(J){var B=J.responseXML;if(!B||!B.documentElement)return D&&D(null),!1;r.parseSVGDocument(B.documentElement,function(F,Y,Q,Z){D&&D(F,Y,Q,Z)},G,q)}})},loadSVGFromString:function(M,D,G,q){var J=new r.window.DOMParser().parseFromString(M.trim(),"text/xml");r.parseSVGDocument(J.documentElement,function(B,F,Y,Q){D(B,F,Y,Q)},G,q)}})}(t),p.ElementsParser=function(s,r,n,l,e,i){this.elements=s,this.callback=r,this.options=n,this.reviver=l,this.svgUid=n&&n.svgUid||0,this.parsingOptions=e,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=i},(W=p.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},W.createObjects=function(){var s=this;this.elements.forEach(function(r,n){r.setAttribute("svgUid",s.svgUid),s.createObject(r,n)})},W.findTag=function(s){return p[p.util.string.capitalize(s.tagName.replace("svg:",""))]},W.createObject=function(s,r){var n=this.findTag(s);if(n&&n.fromElement)try{n.fromElement(s,this.createCallback(r,s),this.options)}catch(l){p.log(l)}else this.checkIfDone()},W.createCallback=function(s,r){var n=this;return function(l){var e;n.resolveGradient(l,r,"fill"),n.resolveGradient(l,r,"stroke"),l instanceof p.Image&&l._originalElement&&(e=l.parsePreserveAspectRatioAttribute(r)),l._removeTransformMatrix(e),n.resolveClipPath(l,r),n.reviver&&n.reviver(r,l),n.instances[s]=l,n.checkIfDone()}},W.extractPropertyDefinition=function(s,r,n){var l=s[r],e=this.regexUrl;if(e.test(l)){e.lastIndex=0;var i=e.exec(l)[1];return e.lastIndex=0,p[n][this.svgUid][i]}},W.resolveGradient=function(s,r,n){var l=this.extractPropertyDefinition(s,n,"gradientDefs");if(l){var e=r.getAttribute(n+"-opacity"),i=p.Gradient.fromElement(l,s,e,this.options);s.set(n,i)}},W.createClipPathCallback=function(s,r){return function(n){n._removeTransformMatrix(),n.fillRule=n.clipRule,r.push(n)}},W.resolveClipPath=function(s,r){var n,l,e,i,o=this.extractPropertyDefinition(s,"clipPath","clipPaths");if(o){e=[],l=p.util.invertTransform(s.calcTransformMatrix());for(var d=o[0].parentNode,c=r;c.parentNode&&c.getAttribute("clip-path")!==s.clipPath;)c=c.parentNode;c.parentNode.appendChild(d);for(var u=0;u<o.length;u++)n=o[u],this.findTag(n).fromElement(n,this.createClipPathCallback(s,e),this.options);o=e.length===1?e[0]:new p.Group(e),i=p.util.multiplyTransformMatrices(l,o.calcTransformMatrix()),o.clipPath&&this.resolveClipPath(o,c);var m=p.util.qrDecompose(i);o.flipX=!1,o.flipY=!1,o.set("scaleX",m.scaleX),o.set("scaleY",m.scaleY),o.angle=m.angle,o.skewX=m.skewX,o.skewY=0,o.setPositionByOrigin({x:m.translateX,y:m.translateY},"center","center"),s.clipPath=o}else delete s.clipPath},W.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))},function(s){var r=s.fabric||(s.fabric={});function n(l,e){this.x=l,this.y=e}r.Point?r.warn("fabric.Point is already defined"):(r.Point=n,n.prototype={type:"point",constructor:n,add:function(l){return new n(this.x+l.x,this.y+l.y)},addEquals:function(l){return this.x+=l.x,this.y+=l.y,this},scalarAdd:function(l){return new n(this.x+l,this.y+l)},scalarAddEquals:function(l){return this.x+=l,this.y+=l,this},subtract:function(l){return new n(this.x-l.x,this.y-l.y)},subtractEquals:function(l){return this.x-=l.x,this.y-=l.y,this},scalarSubtract:function(l){return new n(this.x-l,this.y-l)},scalarSubtractEquals:function(l){return this.x-=l,this.y-=l,this},multiply:function(l){return new n(this.x*l,this.y*l)},multiplyEquals:function(l){return this.x*=l,this.y*=l,this},divide:function(l){return new n(this.x/l,this.y/l)},divideEquals:function(l){return this.x/=l,this.y/=l,this},eq:function(l){return this.x===l.x&&this.y===l.y},lt:function(l){return this.x<l.x&&this.y<l.y},lte:function(l){return this.x<=l.x&&this.y<=l.y},gt:function(l){return this.x>l.x&&this.y>l.y},gte:function(l){return this.x>=l.x&&this.y>=l.y},lerp:function(l,e){return e===void 0&&(e=.5),e=Math.max(Math.min(1,e),0),new n(this.x+(l.x-this.x)*e,this.y+(l.y-this.y)*e)},distanceFrom:function(l){var e=this.x-l.x,i=this.y-l.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(l){return this.lerp(l)},min:function(l){return new n(Math.min(this.x,l.x),Math.min(this.y,l.y))},max:function(l){return new n(Math.max(this.x,l.x),Math.max(this.y,l.y))},toString:function(){return this.x+","+this.y},setXY:function(l,e){return this.x=l,this.y=e,this},setX:function(l){return this.x=l,this},setY:function(l){return this.y=l,this},setFromPoint:function(l){return this.x=l.x,this.y=l.y,this},swap:function(l){var e=this.x,i=this.y;this.x=l.x,this.y=l.y,l.x=e,l.y=i},clone:function(){return new n(this.x,this.y)}})}(t),function(s){var r=s.fabric||(s.fabric={});function n(l){this.status=l,this.points=[]}r.Intersection?r.warn("fabric.Intersection is already defined"):(r.Intersection=n,r.Intersection.prototype={constructor:n,appendPoint:function(l){return this.points.push(l),this},appendPoints:function(l){return this.points=this.points.concat(l),this}},r.Intersection.intersectLineLine=function(l,e,i,o){var d,c=(o.x-i.x)*(l.y-i.y)-(o.y-i.y)*(l.x-i.x),u=(e.x-l.x)*(l.y-i.y)-(e.y-l.y)*(l.x-i.x),m=(o.y-i.y)*(e.x-l.x)-(o.x-i.x)*(e.y-l.y);if(m!==0){var _=c/m,E=u/m;0<=_&&_<=1&&0<=E&&E<=1?(d=new n("Intersection")).appendPoint(new r.Point(l.x+_*(e.x-l.x),l.y+_*(e.y-l.y))):d=new n}else d=new n(c===0||u===0?"Coincident":"Parallel");return d},r.Intersection.intersectLinePolygon=function(l,e,i){var o,d,c,u,m=new n,_=i.length;for(u=0;u<_;u++)o=i[u],d=i[(u+1)%_],c=n.intersectLineLine(l,e,o,d),m.appendPoints(c.points);return m.points.length>0&&(m.status="Intersection"),m},r.Intersection.intersectPolygonPolygon=function(l,e){var i,o=new n,d=l.length;for(i=0;i<d;i++){var c=l[i],u=l[(i+1)%d],m=n.intersectLinePolygon(c,u,e);o.appendPoints(m.points)}return o.points.length>0&&(o.status="Intersection"),o},r.Intersection.intersectPolygonRectangle=function(l,e,i){var o=e.min(i),d=e.max(i),c=new r.Point(d.x,o.y),u=new r.Point(o.x,d.y),m=n.intersectLinePolygon(o,c,l),_=n.intersectLinePolygon(c,d,l),E=n.intersectLinePolygon(d,u,l),T=n.intersectLinePolygon(u,o,l),C=new n;return C.appendPoints(m.points),C.appendPoints(_.points),C.appendPoints(E.points),C.appendPoints(T.points),C.points.length>0&&(C.status="Intersection"),C})}(t),function(s){var r=s.fabric||(s.fabric={});function n(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function l(e,i,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+6*(i-e)*o:o<.5?i:o<2/3?e+(i-e)*(2/3-o)*6:e}r.Color?r.warn("fabric.Color is already defined."):(r.Color=n,r.Color.prototype={_tryParsingColor:function(e){var i;e in n.colorNameMap&&(e=n.colorNameMap[e]),e==="transparent"&&(i=[255,255,255,0]),i||(i=n.sourceFromHex(e)),i||(i=n.sourceFromRgb(e)),i||(i=n.sourceFromHsl(e)),i||(i=[0,0,0,1]),i&&this.setSource(i)},_rgbToHsl:function(e,i,o){e/=255,i/=255,o/=255;var d,c,u,m=r.util.array.max([e,i,o]),_=r.util.array.min([e,i,o]);if(u=(m+_)/2,m===_)d=c=0;else{var E=m-_;switch(c=u>.5?E/(2-m-_):E/(m+_),m){case e:d=(i-o)/E+(i<o?6:0);break;case i:d=(o-e)/E+2;break;case o:d=(e-i)/E+4}d/=6}return[Math.round(360*d),Math.round(100*c),Math.round(100*u)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),i=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+i[0]+","+i[1]+"%,"+i[2]+"%)"},toHsla:function(){var e=this.getSource(),i=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+i[0]+","+i[1]+"%,"+i[2]+"%,"+e[3]+")"},toHex:function(){var e,i,o,d=this.getSource();return e=(e=d[0].toString(16)).length===1?"0"+e:e,i=(i=d[1].toString(16)).length===1?"0"+i:i,o=(o=d[2].toString(16)).length===1?"0"+o:o,e.toUpperCase()+i.toUpperCase()+o.toUpperCase()},toHexa:function(){var e,i=this.getSource();return e=(e=(e=Math.round(255*i[3])).toString(16)).length===1?"0"+e:e,this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var i=this.getSource();return i[3]=e,this.setSource(i),this},toGrayscale:function(){var e=this.getSource(),i=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10),o=e[3];return this.setSource([i,i,i,o]),this},toBlackWhite:function(e){var i=this.getSource(),o=(.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),d=i[3];return e=e||127,o=Number(o)<Number(e)?0:255,this.setSource([o,o,o,d]),this},overlayWith:function(e){e instanceof n||(e=new n(e));var i,o=[],d=this.getAlpha(),c=this.getSource(),u=e.getSource();for(i=0;i<3;i++)o.push(Math.round(.5*c[i]+.5*u[i]));return o[3]=d,this.setSource(o),this}},r.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,r.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,r.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,r.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},r.Color.fromRgb=function(e){return n.fromSource(n.sourceFromRgb(e))},r.Color.sourceFromRgb=function(e){var i=e.match(n.reRGBa);if(i){var o=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),d=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),c=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(o,10),parseInt(d,10),parseInt(c,10),i[4]?parseFloat(i[4]):1]}},r.Color.fromRgba=n.fromRgb,r.Color.fromHsl=function(e){return n.fromSource(n.sourceFromHsl(e))},r.Color.sourceFromHsl=function(e){var i=e.match(n.reHSLa);if(i){var o,d,c,u=(parseFloat(i[1])%360+360)%360/360,m=parseFloat(i[2])/(/%$/.test(i[2])?100:1),_=parseFloat(i[3])/(/%$/.test(i[3])?100:1);if(m===0)o=d=c=_;else{var E=_<=.5?_*(m+1):_+m-_*m,T=2*_-E;o=l(T,E,u+1/3),d=l(T,E,u),c=l(T,E,u-1/3)}return[Math.round(255*o),Math.round(255*d),Math.round(255*c),i[4]?parseFloat(i[4]):1]}},r.Color.fromHsla=n.fromHsl,r.Color.fromHex=function(e){return n.fromSource(n.sourceFromHex(e))},r.Color.sourceFromHex=function(e){if(e.match(n.reHex)){var i=e.slice(e.indexOf("#")+1),o=i.length===3||i.length===4,d=i.length===8||i.length===4,c=o?i.charAt(0)+i.charAt(0):i.substring(0,2),u=o?i.charAt(1)+i.charAt(1):i.substring(2,4),m=o?i.charAt(2)+i.charAt(2):i.substring(4,6),_=d?o?i.charAt(3)+i.charAt(3):i.substring(6,8):"FF";return[parseInt(c,16),parseInt(u,16),parseInt(m,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},r.Color.fromSource=function(e){var i=new n;return i.setSource(e),i})}(t),function(s){var r=s.fabric||(s.fabric={}),n=["e","se","s","sw","w","nw","n","ne","e"],l=["ns","nesw","ew","nwse"],e={},i="left",o="top",d="right",c="bottom",u="center",m={top:c,bottom:o,left:d,right:i,center:u},_=r.util.radiansToDegrees,E=Math.sign||function(B){return(B>0)-(B<0)||+B};function T(B,F){var Y=B.angle+_(Math.atan2(F.y,F.x))+360;return Math.round(Y%360/45)}function C(B,F){var Y=F.transform.target,Q=Y.canvas,Z=r.util.object.clone(F);Z.target=Y,Q&&Q.fire("object:"+B,Z),Y.fire(B,F)}function b(B,F){var Y=F.canvas,Q=B[Y.uniScaleKey];return Y.uniformScaling&&!Q||!Y.uniformScaling&&Q}function O(B){return B.originX===u&&B.originY===u}function j(B,F,Y){var Q=B.lockScalingX,Z=B.lockScalingY;return!((!Q||!Z)&&(F||!Q&&!Z||!Y)&&(!Q||F!=="x")&&(!Z||F!=="y"))}function U(B,F,Y,Q){return{e:B,transform:F,pointer:{x:Y,y:Q}}}function $(B){return function(F,Y,Q,Z){var te=Y.target,ae=te.getCenterPoint(),ne=te.translateToOriginPoint(ae,Y.originX,Y.originY),ie=B(F,Y,Q,Z);return te.setPositionByOrigin(ne,Y.originX,Y.originY),ie}}function z(B,F){return function(Y,Q,Z,te){var ae=F(Y,Q,Z,te);return ae&&C(B,U(Y,Q,Z,te)),ae}}function H(B,F,Y,Q,Z){var te=B.target,ae=te.controls[B.corner],ne=te.canvas.getZoom(),ie=te.padding/ne,oe=te.toLocalPoint(new r.Point(Q,Z),F,Y);return oe.x>=ie&&(oe.x-=ie),oe.x<=-ie&&(oe.x+=ie),oe.y>=ie&&(oe.y-=ie),oe.y<=ie&&(oe.y+=ie),oe.x-=ae.offsetX,oe.y-=ae.offsetY,oe}function M(B){return B.flipX!==B.flipY}function D(B,F,Y,Q,Z){if(B[F]!==0){var te=Z/B._getTransformedDimensions()[Q]*B[Y];B.set(Y,te)}}function G(B,F,Y,Q){var Z,te=F.target,ae=te._getTransformedDimensions(0,te.skewY),ne=H(F,F.originX,F.originY,Y,Q),ie=Math.abs(2*ne.x)-ae.x,oe=te.skewX;ie<2?Z=0:(Z=_(Math.atan2(ie/te.scaleX,ae.y/te.scaleY)),F.originX===i&&F.originY===c&&(Z=-Z),F.originX===d&&F.originY===o&&(Z=-Z),M(te)&&(Z=-Z));var se=oe!==Z;if(se){var he=te._getTransformedDimensions().y;te.set("skewX",Z),D(te,"skewY","scaleY","y",he)}return se}function q(B,F,Y,Q){var Z,te=F.target,ae=te._getTransformedDimensions(te.skewX,0),ne=H(F,F.originX,F.originY,Y,Q),ie=Math.abs(2*ne.y)-ae.y,oe=te.skewY;ie<2?Z=0:(Z=_(Math.atan2(ie/te.scaleY,ae.x/te.scaleX)),F.originX===i&&F.originY===c&&(Z=-Z),F.originX===d&&F.originY===o&&(Z=-Z),M(te)&&(Z=-Z));var se=oe!==Z;if(se){var he=te._getTransformedDimensions().x;te.set("skewY",Z),D(te,"skewX","scaleX","x",he)}return se}function J(B,F,Y,Q,Z){Z=Z||{};var te,ae,ne,ie,oe,se,he=F.target,_e=he.lockScalingX,le=he.lockScalingY,Oe=Z.by,Ue=b(B,he),mt=j(he,Oe,Ue),Rt=F.gestureScale;if(mt)return!1;if(Rt)ae=F.scaleX*Rt,ne=F.scaleY*Rt;else{if(te=H(F,F.originX,F.originY,Y,Q),oe=Oe!=="y"?E(te.x):1,se=Oe!=="x"?E(te.y):1,F.signX||(F.signX=oe),F.signY||(F.signY=se),he.lockScalingFlip&&(F.signX!==oe||F.signY!==se))return!1;if(ie=he._getTransformedDimensions(),Ue&&!Oe){var yi=Math.abs(te.x)+Math.abs(te.y),Xe=F.original,pt=yi/(Math.abs(ie.x*Xe.scaleX/he.scaleX)+Math.abs(ie.y*Xe.scaleY/he.scaleY));ae=Xe.scaleX*pt,ne=Xe.scaleY*pt}else ae=Math.abs(te.x*he.scaleX/ie.x),ne=Math.abs(te.y*he.scaleY/ie.y);O(F)&&(ae*=2,ne*=2),F.signX!==oe&&Oe!=="y"&&(F.originX=m[F.originX],ae*=-1,F.signX=oe),F.signY!==se&&Oe!=="x"&&(F.originY=m[F.originY],ne*=-1,F.signY=se)}var Wi=he.scaleX,Ei=he.scaleY;return Oe?(Oe==="x"&&he.set("scaleX",ae),Oe==="y"&&he.set("scaleY",ne)):(!_e&&he.set("scaleX",ae),!le&&he.set("scaleY",ne)),Wi!==he.scaleX||Ei!==he.scaleY}e.scaleCursorStyleHandler=function(B,F,Y){var Q=b(B,Y),Z="";if(F.x!==0&&F.y===0?Z="x":F.x===0&&F.y!==0&&(Z="y"),j(Y,Z,Q))return"not-allowed";var te=T(Y,F);return n[te]+"-resize"},e.skewCursorStyleHandler=function(B,F,Y){var Q="not-allowed";if(F.x!==0&&Y.lockSkewingY||F.y!==0&&Y.lockSkewingX)return Q;var Z=T(Y,F)%4;return l[Z]+"-resize"},e.scaleSkewCursorStyleHandler=function(B,F,Y){return B[Y.canvas.altActionKey]?e.skewCursorStyleHandler(B,F,Y):e.scaleCursorStyleHandler(B,F,Y)},e.rotationWithSnapping=z("rotating",$(function(B,F,Y,Q){var Z=F,te=Z.target,ae=te.translateToOriginPoint(te.getCenterPoint(),Z.originX,Z.originY);if(te.lockRotation)return!1;var ne,ie=Math.atan2(Z.ey-ae.y,Z.ex-ae.x),oe=Math.atan2(Q-ae.y,Y-ae.x),se=_(oe-ie+Z.theta);if(te.snapAngle>0){var he=te.snapAngle,_e=te.snapThreshold||he,le=Math.ceil(se/he)*he,Oe=Math.floor(se/he)*he;Math.abs(se-Oe)<_e?se=Oe:Math.abs(se-le)<_e&&(se=le)}return se<0&&(se=360+se),se%=360,ne=te.angle!==se,te.angle=se,ne})),e.scalingEqually=z("scaling",$(function(B,F,Y,Q){return J(B,F,Y,Q)})),e.scalingX=z("scaling",$(function(B,F,Y,Q){return J(B,F,Y,Q,{by:"x"})})),e.scalingY=z("scaling",$(function(B,F,Y,Q){return J(B,F,Y,Q,{by:"y"})})),e.scalingYOrSkewingX=function(B,F,Y,Q){return B[F.target.canvas.altActionKey]?e.skewHandlerX(B,F,Y,Q):e.scalingY(B,F,Y,Q)},e.scalingXOrSkewingY=function(B,F,Y,Q){return B[F.target.canvas.altActionKey]?e.skewHandlerY(B,F,Y,Q):e.scalingX(B,F,Y,Q)},e.changeWidth=z("resizing",$(function(B,F,Y,Q){var Z=F.target,te=H(F,F.originX,F.originY,Y,Q),ae=Z.strokeWidth/(Z.strokeUniform?Z.scaleX:1),ne=O(F)?2:1,ie=Z.width,oe=Math.abs(te.x*ne/Z.scaleX)-ae;return Z.set("width",Math.max(oe,0)),ie!==oe})),e.skewHandlerX=function(B,F,Y,Q){var Z,te=F.target,ae=te.skewX,ne=F.originY;return!te.lockSkewingX&&(ae===0?Z=H(F,u,u,Y,Q).x>0?i:d:(ae>0&&(Z=ne===o?i:d),ae<0&&(Z=ne===o?d:i),M(te)&&(Z=Z===i?d:i)),F.originX=Z,z("skewing",$(G))(B,F,Y,Q))},e.skewHandlerY=function(B,F,Y,Q){var Z,te=F.target,ae=te.skewY,ne=F.originX;return!te.lockSkewingY&&(ae===0?Z=H(F,u,u,Y,Q).y>0?o:c:(ae>0&&(Z=ne===i?o:c),ae<0&&(Z=ne===i?c:o),M(te)&&(Z=Z===o?c:o)),F.originY=Z,z("skewing",$(q))(B,F,Y,Q))},e.dragHandler=function(B,F,Y,Q){var Z=F.target,te=Y-F.offsetX,ae=Q-F.offsetY,ne=!Z.get("lockMovementX")&&Z.left!==te,ie=!Z.get("lockMovementY")&&Z.top!==ae;return ne&&Z.set("left",te),ie&&Z.set("top",ae),(ne||ie)&&C("moving",U(B,F,Y,Q)),ne||ie},e.scaleOrSkewActionName=function(B,F,Y){var Q=B[Y.canvas.altActionKey];return F.x===0?Q?"skewX":"scaleY":F.y===0?Q?"skewY":"scaleX":void 0},e.rotationStyleHandler=function(B,F,Y){return Y.lockRotation?"not-allowed":F.cursorStyle},e.fireEvent=C,e.wrapWithFixedAnchor=$,e.wrapWithFireEvent=z,e.getLocalPoint=H,r.controlsUtils=e}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.degreesToRadians,l=r.controlsUtils;l.renderCircleControl=function(e,i,o,d,c){d=d||{};var u,m=this.sizeX||d.cornerSize||c.cornerSize,_=this.sizeY||d.cornerSize||c.cornerSize,E=d.transparentCorners!==void 0?d.transparentCorners:c.transparentCorners,T=E?"stroke":"fill",C=!E&&(d.cornerStrokeColor||c.cornerStrokeColor),b=i,O=o;e.save(),e.fillStyle=d.cornerColor||c.cornerColor,e.strokeStyle=d.cornerStrokeColor||c.cornerStrokeColor,m>_?(u=m,e.scale(1,_/m),O=o*m/_):_>m?(u=_,e.scale(m/_,1),b=i*_/m):u=m,e.lineWidth=1,e.beginPath(),e.arc(b,O,u/2,0,2*Math.PI,!1),e[T](),C&&e.stroke(),e.restore()},l.renderSquareControl=function(e,i,o,d,c){d=d||{};var u=this.sizeX||d.cornerSize||c.cornerSize,m=this.sizeY||d.cornerSize||c.cornerSize,_=d.transparentCorners!==void 0?d.transparentCorners:c.transparentCorners,E=_?"stroke":"fill",T=!_&&(d.cornerStrokeColor||c.cornerStrokeColor),C=u/2,b=m/2;e.save(),e.fillStyle=d.cornerColor||c.cornerColor,e.strokeStyle=d.cornerStrokeColor||c.cornerStrokeColor,e.lineWidth=1,e.translate(i,o),e.rotate(n(c.angle)),e[E+"Rect"](-C,-b,u,m),T&&e.strokeRect(-C,-b,u,m),e.restore()}}(t),function(s){var r=s.fabric||(s.fabric={});r.Control=function(n){for(var l in n)this[l]=n[l]},r.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(n,l){return l.cursorStyle},getActionName:function(n,l){return l.actionName},getVisibility:function(n,l){var e=n._controlsVisibility;return e&&e[l]!==void 0?e[l]:this.visible},setVisibility:function(n){this.visible=n},positionHandler:function(n,l){return r.util.transformPoint({x:this.x*n.x+this.offsetX,y:this.y*n.y+this.offsetY},l)},calcCornerCoords:function(n,l,e,i,o){var d,c,u,m,_=o?this.touchSizeX:this.sizeX,E=o?this.touchSizeY:this.sizeY;if(_&&E&&_!==E){var T=Math.atan2(E,_),C=Math.sqrt(_*_+E*E)/2,b=T-r.util.degreesToRadians(n),O=Math.PI/2-T-r.util.degreesToRadians(n);d=C*r.util.cos(b),c=C*r.util.sin(b),u=C*r.util.cos(O),m=C*r.util.sin(O)}else C=.7071067812*(_&&E?_:l),b=r.util.degreesToRadians(45-n),d=u=C*r.util.cos(b),c=m=C*r.util.sin(b);return{tl:{x:e-m,y:i-u},tr:{x:e+d,y:i-c},bl:{x:e-d,y:i+c},br:{x:e+m,y:i+u}}},render:function(n,l,e,i,o){((i=i||{}).cornerStyle||o.cornerStyle)==="circle"?r.controlsUtils.renderCircleControl.call(this,n,l,e,i,o):r.controlsUtils.renderSquareControl.call(this,n,l,e,i,o)}}}(t),function(){function s(n,l){var e,i,o,d,c=n.getAttribute("style"),u=n.getAttribute("offset")||0;if(u=(u=parseFloat(u)/(/%$/.test(u)?100:1))<0?0:u>1?1:u,c){var m=c.split(/\s*;\s*/);for(m[m.length-1]===""&&m.pop(),d=m.length;d--;){var _=m[d].split(/\s*:\s*/),E=_[0].trim(),T=_[1].trim();E==="stop-color"?e=T:E==="stop-opacity"&&(o=T)}}return e||(e=n.getAttribute("stop-color")||"rgb(0,0,0)"),o||(o=n.getAttribute("stop-opacity")),i=(e=new p.Color(e)).getAlpha(),o=isNaN(parseFloat(o))?1:parseFloat(o),o*=i*l,{offset:u,color:e.toRgb(),opacity:o}}var r=p.util.object.clone;p.Gradient=p.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(n){n||(n={}),n.coords||(n.coords={});var l,e=this;Object.keys(n).forEach(function(i){e[i]=n[i]}),this.id?this.id+="_"+p.Object.__uid++:this.id=p.Object.__uid++,l={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0},this.type==="radial"&&(l.r1=n.coords.r1||0,l.r2=n.coords.r2||0),this.coords=l,this.colorStops=n.colorStops.slice()},addColorStop:function(n){for(var l in n){var e=new p.Color(n[l]);this.colorStops.push({offset:parseFloat(l),color:e.toRgb(),opacity:e.getAlpha()})}return this},toObject:function(n){var l={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return p.util.populateWithProperties(this,l,n),l},toSVG:function(n,l){var e,i,o,d,c=r(this.coords,!0),u=(l=l||{},r(this.colorStops,!0)),m=c.r1>c.r2,_=this.gradientTransform?this.gradientTransform.concat():p.iMatrix.concat(),E=-this.offsetX,T=-this.offsetY,C=!!l.additionalTransform,b=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(u.sort(function($,z){return $.offset-z.offset}),b==="objectBoundingBox"?(E/=n.width,T/=n.height):(E+=n.width/2,T+=n.height/2),n.type==="path"&&this.gradientUnits!=="percentage"&&(E-=n.pathOffset.x,T-=n.pathOffset.y),_[4]-=E,_[5]-=T,d='id="SVGID_'+this.id+'" gradientUnits="'+b+'"',d+=' gradientTransform="'+(C?l.additionalTransform+" ":"")+p.util.matrixToSVG(_)+'" ',this.type==="linear"?o=["<linearGradient ",d,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`">
`]:this.type==="radial"&&(o=["<radialGradient ",d,' cx="',m?c.x1:c.x2,'" cy="',m?c.y1:c.y2,'" r="',m?c.r1:c.r2,'" fx="',m?c.x2:c.x1,'" fy="',m?c.y2:c.y1,`">
`]),this.type==="radial"){if(m)for((u=u.concat()).reverse(),e=0,i=u.length;e<i;e++)u[e].offset=1-u[e].offset;var O=Math.min(c.r1,c.r2);if(O>0){var j=O/Math.max(c.r1,c.r2);for(e=0,i=u.length;e<i;e++)u[e].offset+=j*(1-u[e].offset)}}for(e=0,i=u.length;e<i;e++){var U=u[e];o.push("<stop ",'offset="',100*U.offset+"%",'" style="stop-color:',U.color,U.opacity!==void 0?";stop-opacity: "+U.opacity:";",`"/>
`)}return o.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),o.join("")},toLive:function(n){var l,e,i,o=p.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?l=n.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(l=n.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),e=0,i=this.colorStops.length;e<i;e++){var d=this.colorStops[e].color,c=this.colorStops[e].opacity,u=this.colorStops[e].offset;c!==void 0&&(d=new p.Color(d).setAlpha(c).toRgba()),l.addColorStop(u,d)}return l}}}),p.util.object.extend(p.Gradient,{fromElement:function(n,l,e,i){var o=parseFloat(e)/(/%$/.test(e)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var d,c,u,m,_=n.getElementsByTagName("stop"),E=n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",T=n.getAttribute("gradientTransform")||"",C=[],b=0,O=0;for(n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?(d="linear",c=function(j){return{x1:j.getAttribute("x1")||0,y1:j.getAttribute("y1")||0,x2:j.getAttribute("x2")||"100%",y2:j.getAttribute("y2")||0}}(n)):(d="radial",c=function(j){return{x1:j.getAttribute("fx")||j.getAttribute("cx")||"50%",y1:j.getAttribute("fy")||j.getAttribute("cy")||"50%",r1:0,x2:j.getAttribute("cx")||"50%",y2:j.getAttribute("cy")||"50%",r2:j.getAttribute("r")||"50%"}}(n)),u=_.length;u--;)C.push(s(_[u],o));return m=p.parseTransformAttribute(T),function(j,U,$,z){var H,M;Object.keys(U).forEach(function(D){(H=U[D])==="Infinity"?M=1:H==="-Infinity"?M=0:(M=parseFloat(U[D],10),typeof H=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(H)&&(M*=.01,z==="pixels"&&(D!=="x1"&&D!=="x2"&&D!=="r2"||(M*=$.viewBoxWidth||$.width),D!=="y1"&&D!=="y2"||(M*=$.viewBoxHeight||$.height)))),U[D]=M})}(0,c,i,E),E==="pixels"&&(b=-l.left,O=-l.top),new p.Gradient({id:n.getAttribute("id"),type:d,coords:c,colorStops:C,gradientUnits:E,gradientTransform:m,offsetX:b,offsetY:O})}})}(),X=p.util.toFixed,p.Pattern=p.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,r){if(s||(s={}),this.id=p.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string")r&&r(this);else{var n=this;this.source=p.util.createImage(),p.util.loadImage(s.source,function(l,e){n.source=l,r&&r(n,e)},null,this.crossOrigin)}},toObject:function(s){var r,n,l=p.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?r=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(r=this.source.toDataURL()),n={type:"pattern",source:r,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:X(this.offsetX,l),offsetY:X(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},p.util.populateWithProperties(this,n,s),n},toSVG:function(s){var r=typeof this.source=="function"?this.source():this.source,n=r.width/s.width,l=r.height/s.height,e=this.offsetX/s.width,i=this.offsetY/s.height,o="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(l=1,i&&(l+=Math.abs(i))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(n=1,e&&(n+=Math.abs(e))),r.src?o=r.src:r.toDataURL&&(o=r.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+i+'" width="'+n+'" height="'+l+`">
<image x="0" y="0" width="`+r.width+'" height="'+r.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(s){for(var r in s)this[r]=s[r]},toLive:function(s){var r=this.source;return!r||r.src!==void 0&&(!r.complete||r.naturalWidth===0||r.naturalHeight===0)?"":s.createPattern(r,this.repeat)}}),function(s){var r=s.fabric||(s.fabric={}),n=r.util.toFixed;r.Shadow?r.warn("fabric.Shadow is already defined."):(r.Shadow=r.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(l){for(var e in typeof l=="string"&&(l=this._parseShadow(l)),l)this[e]=l[e];this.id=r.Object.__uid++},_parseShadow:function(l){var e=l.trim(),i=r.Shadow.reOffsetsAndBlur.exec(e)||[];return{color:(e.replace(r.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(i[1],10)||0,offsetY:parseFloat(i[2],10)||0,blur:parseFloat(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(l){var e=40,i=40,o=r.Object.NUM_FRACTION_DIGITS,d=r.util.rotateVector({x:this.offsetX,y:this.offsetY},r.util.degreesToRadians(-l.angle)),c=new r.Color(this.color);return l.width&&l.height&&(e=100*n((Math.abs(d.x)+this.blur)/l.width,o)+20,i=100*n((Math.abs(d.y)+this.blur)/l.height,o)+20),l.flipX&&(d.x*=-1),l.flipY&&(d.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" x="-'+e+'%" width="'+(100+2*e)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+n(this.blur?this.blur/2:0,o)+`"></feGaussianBlur>
	<feOffset dx="`+n(d.x,o)+'" dy="'+n(d.y,o)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+c.toRgb()+'" flood-opacity="'+c.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var l={},e=r.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(i){this[i]!==e[i]&&(l[i]=this[i])},this),l}}),r.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(t),function(){if(p.StaticCanvas)p.warn("fabric.StaticCanvas is already defined.");else{var s=p.util.object.extend,r=p.util.getElementOffset,n=p.util.removeFromArray,l=p.util.toFixed,e=p.util.transformPoint,i=p.util.invertTransform,o=p.util.getNodeCanvas,d=p.util.createCanvasElement,c=new Error("Could not initialize `canvas` element");p.StaticCanvas=p.util.createClass(p.CommonMethods,{initialize:function(u,m){m||(m={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(u,m)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:p.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(u,m){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(u),this._initOptions(m),this.interactive||this._initRetinaScaling(),m.overlayImage&&this.setOverlayImage(m.overlayImage,_),m.backgroundImage&&this.setBackgroundImage(m.backgroundImage,_),m.backgroundColor&&this.setBackgroundColor(m.backgroundColor,_),m.overlayColor&&this.setOverlayColor(m.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return p.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,p.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var u=p.devicePixelRatio;this.__initRetinaScaling(u,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(u,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(u,m,_){m.setAttribute("width",this.width*u),m.setAttribute("height",this.height*u),_.scale(u,u)},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(u,m,_){return this.__setBgOverlayImage("overlayImage",u,m,_)},setBackgroundImage:function(u,m,_){return this.__setBgOverlayImage("backgroundImage",u,m,_)},setOverlayColor:function(u,m){return this.__setBgOverlayColor("overlayColor",u,m)},setBackgroundColor:function(u,m){return this.__setBgOverlayColor("backgroundColor",u,m)},__setBgOverlayImage:function(u,m,_,E){return typeof m=="string"?p.util.loadImage(m,function(T,C){if(T){var b=new p.Image(T,E);this[u]=b,b.canvas=this}_&&_(T,C)},this,E&&E.crossOrigin):(E&&m.setOptions(E),this[u]=m,m&&(m.canvas=this),_&&_(m,!1)),this},__setBgOverlayColor:function(u,m,_){return this[u]=m,this._initGradient(m,u),this._initPattern(m,u,_),this},_createCanvasElement:function(){var u=d();if(!u||(u.style||(u.style={}),u.getContext===void 0))throw c;return u},_initOptions:function(u){var m=this.lowerCanvasEl;this._setOptions(u),this.width=this.width||parseInt(m.width,10)||0,this.height=this.height||parseInt(m.height,10)||0,this.lowerCanvasEl.style&&(m.width=this.width,m.height=this.height,m.style.width=this.width+"px",m.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(u){u&&u.getContext?this.lowerCanvasEl=u:this.lowerCanvasEl=p.util.getById(u)||this._createCanvasElement(),p.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(u,m){return this.setDimensions({width:u},m)},setHeight:function(u,m){return this.setDimensions({height:u},m)},setDimensions:function(u,m){var _;for(var E in m=m||{},u)_=u[E],m.cssOnly||(this._setBackstoreDimension(E,u[E]),_+="px",this.hasLostContext=!0),m.backstoreOnly||this._setCssDimension(E,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),m.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(u,m){return this.lowerCanvasEl[u]=m,this.upperCanvasEl&&(this.upperCanvasEl[u]=m),this.cacheCanvasEl&&(this.cacheCanvasEl[u]=m),this[u]=m,this},_setCssDimension:function(u,m){return this.lowerCanvasEl.style[u]=m,this.upperCanvasEl&&(this.upperCanvasEl.style[u]=m),this.wrapperEl&&(this.wrapperEl.style[u]=m),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(u){var m,_,E,T=this._activeObject,C=this.backgroundImage,b=this.overlayImage;for(this.viewportTransform=u,_=0,E=this._objects.length;_<E;_++)(m=this._objects[_]).group||m.setCoords(!0);return T&&T.setCoords(),C&&C.setCoords(!0),b&&b.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(u,m){var _=u,E=this.viewportTransform.slice(0);u=e(u,i(this.viewportTransform)),E[0]=m,E[3]=m;var T=e(u,E);return E[4]+=_.x-T.x,E[5]+=_.y-T.y,this.setViewportTransform(E)},setZoom:function(u){return this.zoomToPoint(new p.Point(0,0),u),this},absolutePan:function(u){var m=this.viewportTransform.slice(0);return m[4]=-u.x,m[5]=-u.y,this.setViewportTransform(m)},relativePan:function(u){return this.absolutePan(new p.Point(-u.x-this.viewportTransform[4],-u.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(u){this.stateful&&u.setupState(),u._set("canvas",this),u.setCoords(),this.fire("object:added",{target:u}),u.fire("added")},_onObjectRemoved:function(u){this.fire("object:removed",{target:u}),u.fire("removed"),delete u.canvas},clearContext:function(u){return u.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var u=this.contextContainer;return this.renderCanvas(u,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=p.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var u={},m=this.width,_=this.height,E=i(this.viewportTransform);return u.tl=e({x:0,y:0},E),u.br=e({x:m,y:_},E),u.tr=new p.Point(u.br.x,u.tl.y),u.bl=new p.Point(u.tl.x,u.br.y),this.vptCoords=u,u},cancelRequestedRender:function(){this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(u,m){var _=this.viewportTransform,E=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(u),p.util.setImageSmoothing(u,this.imageSmoothingEnabled),this.fire("before:render",{ctx:u}),this._renderBackground(u),u.save(),u.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(u,m),u.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(u),E&&(E.canvas=this,E.shouldCache(),E._transformDone=!0,E.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(u)),this._renderOverlay(u),this.controlsAboveOverlay&&this.interactive&&this.drawControls(u),this.fire("after:render",{ctx:u})},drawClipPathOnCanvas:function(u){var m=this.viewportTransform,_=this.clipPath;u.save(),u.transform(m[0],m[1],m[2],m[3],m[4],m[5]),u.globalCompositeOperation="destination-in",_.transform(u),u.scale(1/_.zoomX,1/_.zoomY),u.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),u.restore()},_renderObjects:function(u,m){var _,E;for(_=0,E=m.length;_<E;++_)m[_]&&m[_].render(u)},_renderBackgroundOrOverlay:function(u,m){var _=this[m+"Color"],E=this[m+"Image"],T=this.viewportTransform,C=this[m+"Vpt"];if(_||E){if(_){u.save(),u.beginPath(),u.moveTo(0,0),u.lineTo(this.width,0),u.lineTo(this.width,this.height),u.lineTo(0,this.height),u.closePath(),u.fillStyle=_.toLive?_.toLive(u,this):_,C&&u.transform(T[0],T[1],T[2],T[3],T[4],T[5]),u.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var b=_.gradientTransform||_.patternTransform;b&&u.transform(b[0],b[1],b[2],b[3],b[4],b[5]),u.fill(),u.restore()}E&&(u.save(),C&&u.transform(T[0],T[1],T[2],T[3],T[4],T[5]),E.render(u),u.restore())}},_renderBackground:function(u){this._renderBackgroundOrOverlay(u,"background")},_renderOverlay:function(u){this._renderBackgroundOrOverlay(u,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new p.Point(this.width/2,this.height/2)},centerObjectH:function(u){return this._centerObject(u,new p.Point(this.getCenterPoint().x,u.getCenterPoint().y))},centerObjectV:function(u){return this._centerObject(u,new p.Point(u.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(u){var m=this.getCenterPoint();return this._centerObject(u,m)},viewportCenterObject:function(u){var m=this.getVpCenter();return this._centerObject(u,m)},viewportCenterObjectH:function(u){var m=this.getVpCenter();return this._centerObject(u,new p.Point(m.x,u.getCenterPoint().y)),this},viewportCenterObjectV:function(u){var m=this.getVpCenter();return this._centerObject(u,new p.Point(u.getCenterPoint().x,m.y))},getVpCenter:function(){var u=this.getCenterPoint(),m=i(this.viewportTransform);return e(u,m)},_centerObject:function(u,m){return u.setPositionByOrigin(m,"center","center"),u.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(u){return this.toDatalessObject(u)},toObject:function(u){return this._toObjectMethod("toObject",u)},toDatalessObject:function(u){return this._toObjectMethod("toDatalessObject",u)},_toObjectMethod:function(u,m){var _=this.clipPath,E={version:p.version,objects:this._toObjects(u,m)};return _&&!_.excludeFromExport&&(E.clipPath=this._toObject(this.clipPath,u,m)),s(E,this.__serializeBgOverlay(u,m)),p.util.populateWithProperties(this,E,m),E},_toObjects:function(u,m){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,u,m)},this)},_toObject:function(u,m,_){var E;this.includeDefaultValues||(E=u.includeDefaultValues,u.includeDefaultValues=!1);var T=u[m](_);return this.includeDefaultValues||(u.includeDefaultValues=E),T},__serializeBgOverlay:function(u,m){var _={},E=this.backgroundImage,T=this.overlayImage,C=this.backgroundColor,b=this.overlayColor;return C&&C.toObject?C.excludeFromExport||(_.background=C.toObject(m)):C&&(_.background=C),b&&b.toObject?b.excludeFromExport||(_.overlay=b.toObject(m)):b&&(_.overlay=b),E&&!E.excludeFromExport&&(_.backgroundImage=this._toObject(E,u,m)),T&&!T.excludeFromExport&&(_.overlayImage=this._toObject(T,u,m)),_},svgViewportTransformation:!0,toSVG:function(u,m){u||(u={}),u.reviver=m;var _=[];return this._setSVGPreamble(_,u),this._setSVGHeader(_,u),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",m),this._setSVGObjects(_,m),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",m),_.push("</svg>"),_.join("")},_setSVGPreamble:function(u,m){m.suppressPreamble||u.push('<?xml version="1.0" encoding="',m.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(u,m){var _,E=m.width||this.width,T=m.height||this.height,C='viewBox="0 0 '+this.width+" "+this.height+'" ',b=p.Object.NUM_FRACTION_DIGITS;m.viewBox?C='viewBox="'+m.viewBox.x+" "+m.viewBox.y+" "+m.viewBox.width+" "+m.viewBox.height+'" ':this.svgViewportTransformation&&(_=this.viewportTransform,C='viewBox="'+l(-_[4]/_[0],b)+" "+l(-_[5]/_[3],b)+" "+l(this.width/_[0],b)+" "+l(this.height/_[3],b)+'" '),u.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',E,'" ','height="',T,'" ',C,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",p.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(m),`</defs>
`)},createSVGClipPathMarkup:function(u){var m=this.clipPath;return m?(m.clipPathId="CLIPPATH_"+p.Object.__uid++,'<clipPath id="'+m.clipPathId+`" >
`+this.clipPath.toClipPathSVG(u.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var u=this;return["background","overlay"].map(function(m){var _=u[m+"Color"];if(_&&_.toLive){var E=u[m+"Vpt"],T=u.viewportTransform,C={width:u.width/(E?T[0]:1),height:u.height/(E?T[3]:1)};return _.toSVG(C,{additionalTransform:E?p.util.matrixToSVG(T):""})}}).join("")},createSVGFontFacesMarkup:function(){var u,m,_,E,T,C,b,O,j="",U={},$=p.fontPaths,z=[];for(this._objects.forEach(function M(D){z.push(D),D._objects&&D._objects.forEach(M)}),b=0,O=z.length;b<O;b++)if(m=(u=z[b]).fontFamily,u.type.indexOf("text")!==-1&&!U[m]&&$[m]&&(U[m]=!0,u.styles))for(T in _=u.styles)for(C in E=_[T])!U[m=E[C].fontFamily]&&$[m]&&(U[m]=!0);for(var H in U)j+=[`		@font-face {
`,"			font-family: '",H,`';
`,"			src: url('",$[H],`');
`,`		}
`].join("");return j&&(j=['	<style type="text/css">',`<![CDATA[
`,j,"]]>",`</style>
`].join("")),j},_setSVGObjects:function(u,m){var _,E,T,C=this._objects;for(E=0,T=C.length;E<T;E++)(_=C[E]).excludeFromExport||this._setSVGObject(u,_,m)},_setSVGObject:function(u,m,_){u.push(m.toSVG(_))},_setSVGBgOverlayImage:function(u,m,_){this[m]&&!this[m].excludeFromExport&&this[m].toSVG&&u.push(this[m].toSVG(_))},_setSVGBgOverlayColor:function(u,m){var _=this[m+"Color"],E=this.viewportTransform,T=this.width,C=this.height;if(_)if(_.toLive){var b=_.repeat,O=p.util.invertTransform(E),j=this[m+"Vpt"]?p.util.matrixToSVG(O):"";u.push('<rect transform="'+j+" translate(",T/2,",",C/2,')"',' x="',_.offsetX-T/2,'" y="',_.offsetY-C/2,'" ','width="',b==="repeat-y"||b==="no-repeat"?_.source.width:T,'" height="',b==="repeat-x"||b==="no-repeat"?_.source.height:C,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else u.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(u){if(!u)return this;var m,_,E,T=this._activeObject;if(u===T&&u.type==="activeSelection")for(m=(E=T._objects).length;m--;)_=E[m],n(this._objects,_),this._objects.unshift(_);else n(this._objects,u),this._objects.unshift(u);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(u){if(!u)return this;var m,_,E,T=this._activeObject;if(u===T&&u.type==="activeSelection")for(E=T._objects,m=0;m<E.length;m++)_=E[m],n(this._objects,_),this._objects.push(_);else n(this._objects,u),this._objects.push(u);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(u,m){if(!u)return this;var _,E,T,C,b,O=this._activeObject,j=0;if(u===O&&u.type==="activeSelection")for(b=O._objects,_=0;_<b.length;_++)E=b[_],(T=this._objects.indexOf(E))>0+j&&(C=T-1,n(this._objects,E),this._objects.splice(C,0,E)),j++;else(T=this._objects.indexOf(u))!==0&&(C=this._findNewLowerIndex(u,T,m),n(this._objects,u),this._objects.splice(C,0,u));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(u,m,_){var E,T;if(_){for(E=m,T=m-1;T>=0;--T)if(u.intersectsWithObject(this._objects[T])||u.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(u)){E=T;break}}else E=m-1;return E},bringForward:function(u,m){if(!u)return this;var _,E,T,C,b,O=this._activeObject,j=0;if(u===O&&u.type==="activeSelection")for(_=(b=O._objects).length;_--;)E=b[_],(T=this._objects.indexOf(E))<this._objects.length-1-j&&(C=T+1,n(this._objects,E),this._objects.splice(C,0,E)),j++;else(T=this._objects.indexOf(u))!==this._objects.length-1&&(C=this._findNewUpperIndex(u,T,m),n(this._objects,u),this._objects.splice(C,0,u));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(u,m,_){var E,T,C;if(_){for(E=m,T=m+1,C=this._objects.length;T<C;++T)if(u.intersectsWithObject(this._objects[T])||u.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(u)){E=T;break}}else E=m+1;return E},moveTo:function(u,m){return n(this._objects,u),this._objects.splice(m,0,u),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(p.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(u){u.dispose&&u.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),p.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),p.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),s(p.StaticCanvas.prototype,p.Observable),s(p.StaticCanvas.prototype,p.Collection),s(p.StaticCanvas.prototype,p.DataURLExporter),s(p.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(u){var m=d();if(!m||!m.getContext)return null;var _=m.getContext("2d");return _&&u==="setLineDash"?_.setLineDash!==void 0:null}}),p.StaticCanvas.prototype.toJSON=p.StaticCanvas.prototype.toObject,p.isLikelyNode&&(p.StaticCanvas.prototype.createPNGStream=function(){var u=o(this.lowerCanvasEl);return u&&u.createPNGStream()},p.StaticCanvas.prototype.createJPEGStream=function(u){var m=o(this.lowerCanvasEl);return m&&m.createJPEGStream(u)})}}(),p.BaseBrush=p.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(s){s.strokeStyle=this.color,s.lineWidth=this.width,s.lineCap=this.strokeLineCap,s.miterLimit=this.strokeMiterLimit,s.lineJoin=this.strokeLineJoin,s.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(s){var r=this.canvas.viewportTransform;s.save(),s.transform(r[0],r[1],r[2],r[3],r[4],r[5])},_setShadow:function(){if(this.shadow){var s=this.canvas,r=this.shadow,n=s.contextTop,l=s.getZoom();s&&s._isRetinaScaling()&&(l*=p.devicePixelRatio),n.shadowColor=r.color,n.shadowBlur=r.blur*l,n.shadowOffsetX=r.offsetX*l,n.shadowOffsetY=r.offsetY*l}},needsFullRender:function(){return new p.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var s=this.canvas.contextTop;s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0},_isOutSideCanvas:function(s){return s.x<0||s.x>this.canvas.getWidth()||s.y<0||s.y>this.canvas.getHeight()}}),p.PencilBrush=p.util.createClass(p.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(s){this.canvas=s,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(s,r,n){var l=r.midPointFrom(n);return s.quadraticCurveTo(r.x,r.y,l.x,l.y),l},onMouseDown:function(s,r){this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],this._prepareForDrawing(s),this._captureDrawingPath(s),this._render())},onMouseMove:function(s,r){if(this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(s))&&this._captureDrawingPath(s)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var n=this._points,l=n.length,e=this.canvas.contextTop;this._saveAndTransform(e),this.oldEnd&&(e.beginPath(),e.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(e,n[l-2],n[l-1],!0),e.stroke(),e.restore()}},onMouseUp:function(s){return!this.canvas._isMainEvent(s.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(s){var r=new p.Point(s.x,s.y);this._reset(),this._addPoint(r),this.canvas.contextTop.moveTo(r.x,r.y)},_addPoint:function(s){return!(this._points.length>1&&s.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(s),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(s){var r=new p.Point(s.x,s.y);return this._addPoint(r)},_render:function(s){var r,n,l=this._points[0],e=this._points[1];if(s=s||this.canvas.contextTop,this._saveAndTransform(s),s.beginPath(),this._points.length===2&&l.x===e.x&&l.y===e.y){var i=this.width/1e3;l=new p.Point(l.x,l.y),e=new p.Point(e.x,e.y),l.x-=i,e.x+=i}for(s.moveTo(l.x,l.y),r=1,n=this._points.length;r<n;r++)this._drawSegment(s,l,e),l=this._points[r],e=this._points[r+1];s.lineTo(l.x,l.y),s.stroke(),s.restore()},convertPointsToSVGPath:function(s){var r=this.width/1e3;return p.util.getSmoothPathFromPoints(s,r)},_isEmptySVGPath:function(s){return p.util.joinPath(s)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(s){var r=new p.Path(s,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,r.shadow=new p.Shadow(this.shadow)),r},decimatePoints:function(s,r){if(s.length<=2)return s;var n,l=this.canvas.getZoom(),e=Math.pow(r/l,2),i=s.length-1,o=s[0],d=[o];for(n=1;n<i-1;n++)Math.pow(o.x-s[n].x,2)+Math.pow(o.y-s[n].y,2)>=e&&(o=s[n],d.push(o));return d.push(s[i]),d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s))this.canvas.requestRenderAll();else{var r=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:r}),this.canvas.add(r),this.canvas.requestRenderAll(),r.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:r})}}}),p.CircleBrush=p.util.createClass(p.BaseBrush,{width:10,initialize:function(s){this.canvas=s,this.points=[]},drawDot:function(s){var r=this.addPoint(s),n=this.canvas.contextTop;this._saveAndTransform(n),this.dot(n,r),n.restore()},dot:function(s,r){s.fillStyle=r.fill,s.beginPath(),s.arc(r.x,r.y,r.radius,0,2*Math.PI,!1),s.closePath(),s.fill()},onMouseDown:function(s){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(s)},_render:function(){var s,r,n=this.canvas.contextTop,l=this.points;for(this._saveAndTransform(n),s=0,r=l.length;s<r;s++)this.dot(n,l[s]);n.restore()},onMouseMove:function(s){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(s),this._render()):this.drawDot(s))},onMouseUp:function(){var s,r,n=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var l=[];for(s=0,r=this.points.length;s<r;s++){var e=this.points[s],i=new p.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&(i.shadow=new p.Shadow(this.shadow)),l.push(i)}var o=new p.Group(l);o.canvas=this.canvas,this.canvas.fire("before:path:created",{path:o}),this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=n,this.canvas.requestRenderAll()},addPoint:function(s){var r=new p.Point(s.x,s.y),n=p.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,l=new p.Color(this.color).setAlpha(p.util.getRandomInt(0,100)/100).toRgba();return r.radius=n,r.fill=l,this.points.push(r),r}}),p.SprayBrush=p.util.createClass(p.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(s){this.canvas=s,this.sprayChunks=[]},onMouseDown:function(s){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(s),this.render(this.sprayChunkPoints)},onMouseMove:function(s){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s)||(this.addSprayChunk(s),this.render(this.sprayChunkPoints))},onMouseUp:function(){var s=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var r=[],n=0,l=this.sprayChunks.length;n<l;n++)for(var e=this.sprayChunks[n],i=0,o=e.length;i<o;i++){var d=new p.Rect({width:e[i].width,height:e[i].width,left:e[i].x+1,top:e[i].y+1,originX:"center",originY:"center",fill:this.color});r.push(d)}this.optimizeOverlapping&&(r=this._getOptimizedRects(r));var c=new p.Group(r);this.shadow&&c.set("shadow",new p.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=s,this.canvas.requestRenderAll()},_getOptimizedRects:function(s){var r,n,l,e={};for(n=0,l=s.length;n<l;n++)e[r=s[n].left+""+s[n].top]||(e[r]=s[n]);var i=[];for(r in e)i.push(e[r]);return i},render:function(s){var r,n,l=this.canvas.contextTop;for(l.fillStyle=this.color,this._saveAndTransform(l),r=0,n=s.length;r<n;r++){var e=s[r];e.opacity!==void 0&&(l.globalAlpha=e.opacity),l.fillRect(e.x,e.y,e.width,e.width)}l.restore()},_render:function(){var s,r,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),s=0,r=this.sprayChunks.length;s<r;s++)this.render(this.sprayChunks[s]);n.restore()},addSprayChunk:function(s){this.sprayChunkPoints=[];var r,n,l,e,i=this.width/2;for(e=0;e<this.density;e++){r=p.util.getRandomInt(s.x-i,s.x+i),n=p.util.getRandomInt(s.y-i,s.y+i),l=this.dotWidthVariance?p.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var o=new p.Point(r,n);o.width=l,this.randomOpacity&&(o.opacity=p.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),p.PatternBrush=p.util.createClass(p.PencilBrush,{getPatternSrc:function(){var s=p.util.createCanvasElement(),r=s.getContext("2d");return s.width=s.height=25,r.fillStyle=this.color,r.beginPath(),r.arc(10,10,10,0,2*Math.PI,!1),r.closePath(),r.fill(),s},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(s){return s.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(s){this.callSuper("_setBrushStyles",s),s.strokeStyle=this.getPattern(s)},createPath:function(s){var r=this.callSuper("createPath",s),n=r._getLeftTopCoords().scalarAdd(r.strokeWidth/2);return r.stroke=new p.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-n.x,offsetY:-n.y}),r}}),function(){var s=p.util.getPointer,r=p.util.degreesToRadians,n=p.util.isTouchEvent;for(var l in p.Canvas=p.util.createClass(p.StaticCanvas,{initialize:function(e,i){i||(i={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,i),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=p.PencilBrush&&new p.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e,i,o,d=this.getActiveObjects();if(d.length>0&&!this.preserveObjectStacking){i=[],o=[];for(var c=0,u=this._objects.length;c<u;c++)e=this._objects[c],d.indexOf(e)===-1?i.push(e):o.push(e);d.length>1&&(this._activeObject._objects=o),i.push.apply(i,o)}else i=this._objects;return i},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_normalizePointer:function(e,i){var o=e.calcTransformMatrix(),d=p.util.invertTransform(o),c=this.restorePointerVpt(i);return p.util.transformPoint(c,d)},isTargetTransparent:function(e,i,o){if(e.shouldCache()&&e._cacheCanvas&&e!==this._activeObject){var d=this._normalizePointer(e,{x:i,y:o}),c=Math.max(e.cacheTranslationX+d.x*e.zoomX,0),u=Math.max(e.cacheTranslationY+d.y*e.zoomY,0);return p.util.isTransparent(e._cacheContext,Math.round(c),Math.round(u),this.targetFindTolerance)}var m=this.contextCache,_=e.selectionBackgroundColor,E=this.viewportTransform;return e.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(E[0],E[1],E[2],E[3],E[4],E[5]),e.render(m),m.restore(),e.selectionBackgroundColor=_,p.util.isTransparent(m,i,o,this.targetFindTolerance)},_isSelectionKeyPressed:function(e){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(i){return e[i]===!0}):e[this.selectionKey]},_shouldClearSelection:function(e,i){var o=this.getActiveObjects(),d=this._activeObject;return!i||i&&d&&o.length>1&&o.indexOf(i)===-1&&d!==i&&!this._isSelectionKeyPressed(e)||i&&!i.evented||i&&!i.selectable&&d&&d!==i},_shouldCenterTransform:function(e,i,o){var d;if(e)return i==="scale"||i==="scaleX"||i==="scaleY"||i==="resizing"?d=this.centeredScaling||e.centeredScaling:i==="rotate"&&(d=this.centeredRotation||e.centeredRotation),d?!o:o},_getOriginFromCorner:function(e,i){var o={x:e.originX,y:e.originY};return i==="ml"||i==="tl"||i==="bl"?o.x="right":i!=="mr"&&i!=="tr"&&i!=="br"||(o.x="left"),i==="tl"||i==="mt"||i==="tr"?o.y="bottom":i!=="bl"&&i!=="mb"&&i!=="br"||(o.y="top"),o},_getActionFromCorner:function(e,i,o,d){if(!i||!e)return"drag";var c=d.controls[i];return c.getActionName(o,c,d)},_setupCurrentTransform:function(e,i,o){if(i){var d=this.getPointer(e),c=i.__corner,u=i.controls[c],m=o&&c?u.getActionHandler(e,i,u):p.controlsUtils.dragHandler,_=this._getActionFromCorner(o,c,e,i),E=this._getOriginFromCorner(i,c),T=e[this.centeredKey],C={target:i,action:_,actionHandler:m,corner:c,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:d.x-i.left,offsetY:d.y-i.top,originX:E.x,originY:E.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,theta:r(i.angle),width:i.width*i.scaleX,shiftKey:e.shiftKey,altKey:T,original:p.util.saveObjectTransform(i)};this._shouldCenterTransform(i,_,T)&&(C.originX="center",C.originY="center"),C.original.originX=E.x,C.original.originY=E.y,this._currentTransform=C,this._beforeTransform(e)}},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var i=this._groupSelector,o=new p.Point(i.ex,i.ey),d=p.util.transformPoint(o,this.viewportTransform),c=new p.Point(i.ex+i.left,i.ey+i.top),u=p.util.transformPoint(c,this.viewportTransform),m=Math.min(d.x,u.x),_=Math.min(d.y,u.y),E=Math.max(d.x,u.x),T=Math.max(d.y,u.y),C=this.selectionLineWidth/2;this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(m,_,E-m,T-_)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,m+=C,_+=C,E-=C,T-=C,p.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(m,_,E-m,T-_))},findTarget:function(e,i){if(!this.skipTargetFind){var o,d,c=this.getPointer(e,!0),u=this._activeObject,m=this.getActiveObjects(),_=n(e),E=m.length>1&&!i||m.length===1;if(this.targets=[],E&&u._findTargetCorner(c,_)||m.length>1&&!i&&u===this._searchPossibleTargets([u],c))return u;if(m.length===1&&u===this._searchPossibleTargets([u],c)){if(!this.preserveObjectStacking)return u;o=u,d=this.targets,this.targets=[]}var T=this._searchPossibleTargets(this._objects,c);return e[this.altSelectionKey]&&T&&o&&T!==o&&(T=o,this.targets=d),T}},_checkTarget:function(e,i,o){if(i&&i.visible&&i.evented&&i.containsPoint(e)&&(!this.perPixelTargetFind&&!i.perPixelTargetFind||i.isEditing||!this.isTargetTransparent(i,o.x,o.y)))return!0},_searchPossibleTargets:function(e,i){for(var o,d,c=e.length;c--;){var u=e[c],m=u.group?this._normalizePointer(u.group,i):i;if(this._checkTarget(m,u,i)){(o=e[c]).subTargetCheck&&o instanceof p.Group&&(d=this._searchPossibleTargets(o._objects,i))&&this.targets.push(d);break}}return o},restorePointerVpt:function(e){return p.util.transformPoint(e,p.util.invertTransform(this.viewportTransform))},getPointer:function(e,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var o,d=s(e),c=this.upperCanvasEl,u=c.getBoundingClientRect(),m=u.width||0,_=u.height||0;m&&_||("top"in u&&"bottom"in u&&(_=Math.abs(u.top-u.bottom)),"right"in u&&"left"in u&&(m=Math.abs(u.right-u.left))),this.calcOffset(),d.x=d.x-this._offset.left,d.y=d.y-this._offset.top,i||(d=this.restorePointerVpt(d));var E=this.getRetinaScaling();return E!==1&&(d.x/=E,d.y/=E),o=m===0||_===0?{width:1,height:1}:{width:c.width/m,height:c.height/_},{x:d.x*o.width,y:d.y*o.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),i=this.lowerCanvasEl,o=this.upperCanvasEl;o?o.className="":(o=this._createCanvasElement(),this.upperCanvasEl=o),p.util.addClass(o,"upper-canvas "+e),this.wrapperEl.appendChild(o),this._copyCanvasStyle(i,o),this._applyCanvasStyle(o),this.contextTop=o.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=p.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),p.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),p.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var i=this.width||e.width,o=this.height||e.height;p.util.setStyle(e,{position:"absolute",width:i+"px",height:o+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=i,e.height=o,p.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,i){i.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?e.type==="activeSelection"&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),e===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,i){var o=!1,d=this.getActiveObjects(),c=[],u=[];e.forEach(function(m){d.indexOf(m)===-1&&(o=!0,m.fire("deselected",{e:i,target:m}),u.push(m))}),d.forEach(function(m){e.indexOf(m)===-1&&(o=!0,m.fire("selected",{e:i,target:m}),c.push(m))}),e.length>0&&d.length>0?o&&this.fire("selection:updated",{e:i,selected:c,deselected:u}):d.length>0?this.fire("selection:created",{e:i,selected:c}):e.length>0&&this.fire("selection:cleared",{e:i,deselected:u})},setActiveObject:function(e,i){var o=this.getActiveObjects();return this._setActiveObject(e,i),this._fireSelectionEvents(o,i),this},_setActiveObject:function(e,i){return this._activeObject!==e&&!!this._discardActiveObject(i,e)&&!e.onSelect({e:i})&&(this._activeObject=e,!0)},_discardActiveObject:function(e,i){var o=this._activeObject;if(o){if(o.onDeselect({e,object:i}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var i=this.getActiveObjects(),o=this.getActiveObject();return i.length&&this.fire("before:selection:cleared",{target:o,e}),this._discardActiveObject(e),this._fireSelectionEvents(i,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(i){p.util.cleanUpJsdomNode(this[i]),this[i]=void 0}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,p.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var i=this._activeObject;i&&i._renderControls(e)},_toObject:function(e,i,o){var d=this._realizeGroupTransformOnObject(e),c=this.callSuper("_toObject",e,i,o);return this._unwindGroupTransformOnObject(e,d),c},_realizeGroupTransformOnObject:function(e){if(e.group&&e.group.type==="activeSelection"&&this._activeObject===e.group){var i={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(o){i[o]=e[o]}),p.util.addTransformToObject(e,this._activeObject.calcOwnMatrix()),i}return null},_unwindGroupTransformOnObject:function(e,i){i&&e.set(i)},_setSVGObject:function(e,i,o){var d=this._realizeGroupTransformOnObject(i);this.callSuper("_setSVGObject",e,i,o),this._unwindGroupTransformOnObject(i,d)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),p.StaticCanvas.prototype.setViewportTransform.call(this,e)}}),p.StaticCanvas)l!=="prototype"&&(p.Canvas[l]=p.StaticCanvas[l])}(),function(){var s=p.util.addListener,r=p.util.removeListener,n={passive:!1};function l(e,i){return e.button&&e.button===i-1}p.util.object.extend(p.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(s,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(e,i){var o=this.upperCanvasEl,d=this._getEventPrefix();e(p.window,"resize",this._onResize),e(o,d+"down",this._onMouseDown),e(o,d+"move",this._onMouseMove,n),e(o,d+"out",this._onMouseOut),e(o,d+"enter",this._onMouseEnter),e(o,"wheel",this._onMouseWheel),e(o,"contextmenu",this._onContextMenu),e(o,"dblclick",this._onDoubleClick),e(o,"dragover",this._onDragOver),e(o,"dragenter",this._onDragEnter),e(o,"dragleave",this._onDragLeave),e(o,"drop",this._onDrop),this.enablePointerEvents||e(o,"touchstart",this._onTouchStart,n),typeof eventjs<"u"&&i in eventjs&&(eventjs[i](o,"gesture",this._onGesture),eventjs[i](o,"drag",this._onDrag),eventjs[i](o,"orientation",this._onOrientationChange),eventjs[i](o,"shake",this._onShake),eventjs[i](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(r,"remove");var e=this._getEventPrefix();r(p.document,e+"up",this._onMouseUp),r(p.document,"touchend",this._onTouchEnd,n),r(p.document,e+"move",this._onMouseMove,n),r(p.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(e,i){this.__onTransformGesture&&this.__onTransformGesture(e,i)},_onDrag:function(e,i){this.__onDrag&&this.__onDrag(e,i)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var i=this._hoveredTarget;this.fire("mouse:out",{target:i,e}),this._hoveredTarget=null,i&&i.fire("mouseout",{e});var o=this;this._hoveredTargets.forEach(function(d){o.fire("mouse:out",{target:i,e}),d&&i.fire("mouseout",{e})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(d){d.isEditing&&d.hiddenTextarea.focus()})},_onMouseEnter:function(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",{target:null,e}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(e,i){this.__onOrientationChange&&this.__onOrientationChange(e,i)},_onShake:function(e,i){this.__onShake&&this.__onShake(e,i)},_onLongPress:function(e,i){this.__onLongPress&&this.__onLongPress(e,i)},_onDragOver:function(e){e.preventDefault();var i=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(i,e)},_onDrop:function(e){return this._simpleEventHandler("drop:before",e),this._simpleEventHandler("drop",e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},getPointerId:function(e){var i=e.changedTouches;return i?i[0]&&i[0].identifier:this.enablePointerEvents?e.pointerId:-1},_isMainEvent:function(e){return e.isPrimary===!0||e.isPrimary!==!1&&(e.type==="touchend"&&e.touches.length===0||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(e){e.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();s(p.document,"touchend",this._onTouchEnd,n),s(p.document,"touchmove",this._onMouseMove,n),r(i,o+"down",this._onMouseDown)},_onMouseDown:function(e){this.__onMouseDown(e),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();r(i,o+"move",this._onMouseMove,n),s(p.document,o+"up",this._onMouseUp),s(p.document,o+"move",this._onMouseMove,n)},_onTouchEnd:function(e){if(!(e.touches.length>0)){this.__onMouseUp(e),this._resetTransformEventData(),this.mainTouchId=null;var i=this._getEventPrefix();r(p.document,"touchend",this._onTouchEnd,n),r(p.document,"touchmove",this._onMouseMove,n);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){s(o.upperCanvasEl,i+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(e){this.__onMouseUp(e),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(e)&&(r(p.document,o+"up",this._onMouseUp),r(p.document,o+"move",this._onMouseMove,n),s(i,o+"move",this._onMouseMove,n))},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var i=this._activeObject;return!!(!!i!=!!e||i&&e&&i!==e)||(i&&i.isEditing,!1)},__onMouseUp:function(e){var i,o=this._currentTransform,d=this._groupSelector,c=!1,u=!d||d.left===0&&d.top===0;if(this._cacheTransformEventData(e),i=this._target,this._handleEvent(e,"up:before"),l(e,3))this.fireRightClick&&this._handleEvent(e,"up",3,u);else{if(l(e,2))return this.fireMiddleClick&&this._handleEvent(e,"up",2,u),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(e);else if(this._isMainEvent(e)){if(o&&(this._finalizeCurrentTransform(e),c=o.actionPerformed),!u){var m=i===this._activeObject;this._maybeGroupObjects(e),c||(c=this._shouldRender(i)||!m&&i===this._activeObject)}var _,E;if(i){if(_=i._findTargetCorner(this.getPointer(e,!0),p.util.isTouchEvent(e)),i.selectable&&i!==this._activeObject&&i.activeOn==="up")this.setActiveObject(i,e),c=!0;else{var T=i.controls[_],C=T&&T.getMouseUpHandler(e,i,T);C&&C(e,o,(E=this.getPointer(e)).x,E.y)}i.isMoving=!1}if(o&&(o.target!==i||o.corner!==_)){var b=o.target&&o.target.controls[o.corner],O=b&&b.getMouseUpHandler(e,i,T);E=E||this.getPointer(e),O&&O(e,o,E.x,E.y)}this._setCursorFromEvent(e,i),this._handleEvent(e,"up",1,u),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=0),c?this.requestRenderAll():u||this.renderTop()}}},_simpleEventHandler:function(e,i){var o=this.findTarget(i),d=this.targets,c={e:i,target:o,subTargets:d};if(this.fire(e,c),o&&o.fire(e,c),!d)return o;for(var u=0;u<d.length;u++)d[u].fire(e,c);return o},_handleEvent:function(e,i,o,d){var c=this._target,u=this.targets||[],m={e,target:c,subTargets:u,button:o||1,isClick:d||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};i==="up"&&(m.currentTarget=this.findTarget(e),m.currentSubTargets=this.targets),this.fire("mouse:"+i,m),c&&c.fire("mouse"+i,m);for(var _=0;_<u.length;_++)u[_].fire("mouse"+i,m)},_finalizeCurrentTransform:function(e){var i=this._currentTransform,o=i.target,d={e,target:o,transform:i,action:i.action};o._scaling&&(o._scaling=!1),o.setCoords(),(i.actionPerformed||this.stateful&&o.hasStateChanged())&&this._fire("modified",d)},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll();var i=this.getPointer(e);this.freeDrawingBrush.onMouseDown(i,{e,pointer:i}),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var i=this.getPointer(e);this.freeDrawingBrush.onMouseMove(i,{e,pointer:i})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){var i=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e,pointer:i}),this._handleEvent(e,"up")},__onMouseDown:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"down:before");var i=this._target;if(l(e,3))this.fireRightClick&&this._handleEvent(e,"down",3);else if(l(e,2))this.fireMiddleClick&&this._handleEvent(e,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(e);else if(this._isMainEvent(e)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var d=this._shouldRender(i),c=this._shouldGroup(e,i);if(this._shouldClearSelection(e,i)?this.discardActiveObject(e):c&&(this._handleGrouping(e,i),i=this._activeObject),!this.selection||i&&(i.selectable||i.isEditing||i===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),i){var u=i===this._activeObject;i.selectable&&i.activeOn==="down"&&this.setActiveObject(i,e);var m=i._findTargetCorner(this.getPointer(e,!0),p.util.isTouchEvent(e));if(i.__corner=m,i===this._activeObject&&(m||!c)){this._setupCurrentTransform(e,i,u);var _=i.controls[m],E=(o=this.getPointer(e),_&&_.getMouseDownHandler(e,i,_));E&&E(e,this._currentTransform,o.x,o.y)}}this._handleEvent(e,"down"),(d||c)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var i=this._currentTransform;this.stateful&&i.target.saveState(),this.fire("before:transform",{e,transform:i})},__onMouseMove:function(e){var i,o;if(this._handleEvent(e,"move:before"),this._cacheTransformEventData(e),this.isDrawingMode)this._onMouseMoveInDrawingMode(e);else if(this._isMainEvent(e)){var d=this._groupSelector;d?(o=this._absolutePointer,d.left=o.x-d.ex,d.top=o.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(i=this.findTarget(e)||null,this._setCursorFromEvent(e,i),this._fireOverOutEvents(i,e)),this._handleEvent(e,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(e,i){var o=this._hoveredTarget,d=this._hoveredTargets,c=this.targets,u=Math.max(d.length,c.length);this.fireSyntheticInOutEvents(e,i,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var m=0;m<u;m++)this.fireSyntheticInOutEvents(c[m],i,{oldTarget:d[m],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(e,i){var o=this._draggedoverTarget,d=this._hoveredTargets,c=this.targets,u=Math.max(d.length,c.length);this.fireSyntheticInOutEvents(e,i,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var m=0;m<u;m++)this.fireSyntheticInOutEvents(c[m],i,{oldTarget:d[m],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=e},fireSyntheticInOutEvents:function(e,i,o){var d,c,u,m=o.oldTarget,_=m!==e,E=o.canvasEvtIn,T=o.canvasEvtOut;_&&(d={e:i,target:e,previousTarget:m},c={e:i,target:m,nextTarget:e}),u=e&&_,m&&_&&(T&&this.fire(T,c),m.fire(o.evtOut,c)),u&&(E&&this.fire(E,d),e.fire(o.evtIn,d))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var i=this.getPointer(e),o=this._currentTransform;o.reset=!1,o.shiftKey=e.shiftKey,o.altKey=e[this.centeredKey],this._performTransformAction(e,o,i),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,i,o){var d=o.x,c=o.y,u=i.action,m=!1,_=i.actionHandler;_&&(m=_(e,i,d,c)),u==="drag"&&m&&(i.target.isMoving=!0,this.setCursor(i.target.moveCursor||this.moveCursor)),i.actionPerformed=i.actionPerformed||m},_fire:p.controlsUtils.fireEvent,_setCursorFromEvent:function(e,i){if(!i)return this.setCursor(this.defaultCursor),!1;var o=i.hoverCursor||this.hoverCursor,d=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,c=(!d||!d.contains(i))&&i._findTargetCorner(this.getPointer(e,!0));c?this.setCursor(this.getCornerCursor(c,i,e)):(i.subTargetCheck&&this.targets.concat().reverse().map(function(u){o=u.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(e,i,o){var d=i.controls[e];return d.cursorStyleHandler(o,d,i)}})}(),K=Math.min,ee=Math.max,p.util.object.extend(p.Canvas.prototype,{_shouldGroup:function(s,r){var n=this._activeObject;return n&&this._isSelectionKeyPressed(s)&&r&&r.selectable&&this.selection&&(n!==r||n.type==="activeSelection")&&!r.onSelect({e:s})},_handleGrouping:function(s,r){var n=this._activeObject;n.__corner||(r!==n||(r=this.findTarget(s,!0))&&r.selectable)&&(n&&n.type==="activeSelection"?this._updateActiveSelection(r,s):this._createActiveSelection(r,s))},_updateActiveSelection:function(s,r){var n=this._activeObject,l=n._objects.slice(0);n.contains(s)?(n.removeWithUpdate(s),this._hoveredTarget=s,this._hoveredTargets=this.targets.concat(),n.size()===1&&this._setActiveObject(n.item(0),r)):(n.addWithUpdate(s),this._hoveredTarget=n,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(l,r)},_createActiveSelection:function(s,r){var n=this.getActiveObjects(),l=this._createGroup(s);this._hoveredTarget=l,this._setActiveObject(l,r),this._fireSelectionEvents(n,r)},_createGroup:function(s){var r=this._objects,n=r.indexOf(this._activeObject)<r.indexOf(s)?[this._activeObject,s]:[s,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new p.ActiveSelection(n,{canvas:this})},_groupSelectedObjects:function(s){var r,n=this._collectObjects(s);n.length===1?this.setActiveObject(n[0],s):n.length>1&&(r=new p.ActiveSelection(n.reverse(),{canvas:this}),this.setActiveObject(r,s))},_collectObjects:function(s){for(var r,n=[],l=this._groupSelector.ex,e=this._groupSelector.ey,i=l+this._groupSelector.left,o=e+this._groupSelector.top,d=new p.Point(K(l,i),K(e,o)),c=new p.Point(ee(l,i),ee(e,o)),u=!this.selectionFullyContained,m=l===i&&e===o,_=this._objects.length;_--&&!((r=this._objects[_])&&r.selectable&&r.visible&&(u&&r.intersectsWithRect(d,c,!0)||r.isContainedWithinRect(d,c,!0)||u&&r.containsPoint(d,null,!0)||u&&r.containsPoint(c,null,!0))&&(n.push(r),m)););return n.length>1&&(n=n.filter(function(E){return!E.onSelect({e:s})})),n},_maybeGroupObjects:function(s){this.selection&&this._groupSelector&&this._groupSelectedObjects(s),this.setCursor(this.defaultCursor),this._groupSelector=null}}),p.util.object.extend(p.StaticCanvas.prototype,{toDataURL:function(s){s||(s={});var r=s.format||"png",n=s.quality||1,l=(s.multiplier||1)*(s.enableRetinaScaling?this.getRetinaScaling():1),e=this.toCanvasElement(l,s);return p.util.toDataURL(e,r,n)},toCanvasElement:function(s,r){s=s||1;var n=((r=r||{}).width||this.width)*s,l=(r.height||this.height)*s,e=this.getZoom(),i=this.width,o=this.height,d=e*s,c=this.viewportTransform,u=(c[4]-(r.left||0))*s,m=(c[5]-(r.top||0))*s,_=this.interactive,E=[d,0,0,d,u,m],T=this.enableRetinaScaling,C=p.util.createCanvasElement(),b=this.contextTop;return C.width=n,C.height=l,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=E,this.width=n,this.height=l,this.calcViewportBoundaries(),this.renderCanvas(C.getContext("2d"),this._objects),this.viewportTransform=c,this.width=i,this.height=o,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=T,this.contextTop=b,C}}),p.util.object.extend(p.StaticCanvas.prototype,{loadFromJSON:function(s,r,n){if(s){var l=typeof s=="string"?JSON.parse(s):p.util.object.clone(s),e=this,i=l.clipPath,o=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete l.clipPath,this._enlivenObjects(l.objects,function(d){e.clear(),e._setBgOverlay(l,function(){i?e._enlivenObjects([i],function(c){e.clipPath=c[0],e.__setupCanvas.call(e,l,d,o,r)}):e.__setupCanvas.call(e,l,d,o,r)})},n),this}},__setupCanvas:function(s,r,n,l){var e=this;r.forEach(function(i,o){e.insertAt(i,o)}),this.renderOnAddRemove=n,delete s.objects,delete s.backgroundImage,delete s.overlayImage,delete s.background,delete s.overlay,this._setOptions(s),this.renderAll(),l&&l()},_setBgOverlay:function(s,r){var n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(s.backgroundImage||s.overlayImage||s.background||s.overlay){var l=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&r&&r()};this.__setBgOverlay("backgroundImage",s.backgroundImage,n,l),this.__setBgOverlay("overlayImage",s.overlayImage,n,l),this.__setBgOverlay("backgroundColor",s.background,n,l),this.__setBgOverlay("overlayColor",s.overlay,n,l)}else r&&r()},__setBgOverlay:function(s,r,n,l){var e=this;if(!r)return n[s]=!0,void(l&&l());s==="backgroundImage"||s==="overlayImage"?p.util.enlivenObjects([r],function(i){e[s]=i[0],n[s]=!0,l&&l()}):this["set"+p.util.string.capitalize(s,!0)](r,function(){n[s]=!0,l&&l()})},_enlivenObjects:function(s,r,n){s&&s.length!==0?p.util.enlivenObjects(s,function(l){r&&r(l)},null,n):r&&r([])},_toDataURL:function(s,r){this.clone(function(n){r(n.toDataURL(s))})},_toDataURLWithMultiplier:function(s,r,n){this.clone(function(l){n(l.toDataURLWithMultiplier(s,r))})},clone:function(s,r){var n=JSON.stringify(this.toJSON(r));this.cloneWithoutData(function(l){l.loadFromJSON(n,function(){s&&s(l)})})},cloneWithoutData:function(s){var r=p.util.createCanvasElement();r.width=this.width,r.height=this.height;var n=new p.Canvas(r);this.backgroundImage?(n.setBackgroundImage(this.backgroundImage.src,function(){n.renderAll(),s&&s(n)}),n.backgroundImageOpacity=this.backgroundImageOpacity,n.backgroundImageStretch=this.backgroundImageStretch):s&&s(n)}}),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.object.clone,e=r.util.toFixed,i=r.util.string.capitalize,o=r.util.degreesToRadians,d=!r.isLikelyNode;r.Object||(r.Object=r.util.createClass(r.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:d,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(c){c&&this.setOptions(c)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=r.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(c){var u=r.perfLimitSizeTotal,m=c.width,_=c.height,E=r.maxCacheSideLimit,T=r.minCacheSideLimit;if(m<=E&&_<=E&&m*_<=u)return m<T&&(c.width=T),_<T&&(c.height=T),c;var C=m/_,b=r.util.limitDimsByArea(C,u),O=r.util.capValue,j=O(T,b.x,E),U=O(T,b.y,E);return m>j&&(c.zoomX/=m/j,c.width=j,c.capped=!0),_>U&&(c.zoomY/=_/U,c.height=U,c.capped=!0),c},_getCacheCanvasDimensions:function(){var c=this.getTotalObjectScaling(),u=this._getTransformedDimensions(0,0),m=u.x*c.scaleX/this.scaleX,_=u.y*c.scaleY/this.scaleY;return{width:m+2,height:_+2,zoomX:c.scaleX,zoomY:c.scaleY,x:m,y:_}},_updateCacheCanvas:function(){var c=this.canvas;if(this.noScaleCache&&c&&c._currentTransform){var u=c._currentTransform.target,m=c._currentTransform.action;if(this===u&&m.slice&&m.slice(0,5)==="scale")return!1}var _,E,T=this._cacheCanvas,C=this._limitCacheSize(this._getCacheCanvasDimensions()),b=r.minCacheSideLimit,O=C.width,j=C.height,U=C.zoomX,$=C.zoomY,z=O!==this.cacheWidth||j!==this.cacheHeight,H=this.zoomX!==U||this.zoomY!==$,M=z||H,D=0,G=0,q=!1;if(z){var J=this._cacheCanvas.width,B=this._cacheCanvas.height,F=O>J||j>B;q=F||(O<.9*J||j<.9*B)&&J>b&&B>b,F&&!C.capped&&(O>b||j>b)&&(D=.1*O,G=.1*j)}return this instanceof r.Text&&this.path&&(M=!0,q=!0,D+=this.getHeightOfLine(0)*this.zoomX,G+=this.getHeightOfLine(0)*this.zoomY),!!M&&(q?(T.width=Math.ceil(O+D),T.height=Math.ceil(j+G)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,T.width,T.height)),_=C.x/2,E=C.y/2,this.cacheTranslationX=Math.round(T.width/2-_)+_,this.cacheTranslationY=Math.round(T.height/2-E)+E,this.cacheWidth=O,this.cacheHeight=j,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(U,$),this.zoomX=U,this.zoomY=$,!0)},setOptions:function(c){this._setOptions(c),this._initGradient(c.fill,"fill"),this._initGradient(c.stroke,"stroke"),this._initPattern(c.fill,"fill"),this._initPattern(c.stroke,"stroke")},transform:function(c){var u=this.group&&!this.group._transformDone||this.group&&this.canvas&&c===this.canvas.contextTop,m=this.calcTransformMatrix(!u);c.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(c){var u=r.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:r.version,originX:this.originX,originY:this.originY,left:e(this.left,u),top:e(this.top,u),width:e(this.width,u),height:e(this.height,u),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,u),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:e(this.strokeMiterLimit,u),scaleX:e(this.scaleX,u),scaleY:e(this.scaleY,u),angle:e(this.angle,u),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,u),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:e(this.skewX,u),skewY:e(this.skewY,u)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(c),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),r.util.populateWithProperties(this,m,c),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(c){return this.toObject(c)},_removeDefaultValues:function(c){var u=r.util.getKlass(c.type).prototype;return u.stateProperties.forEach(function(m){m!=="left"&&m!=="top"&&(c[m]===u[m]&&delete c[m],Array.isArray(c[m])&&Array.isArray(u[m])&&c[m].length===0&&u[m].length===0&&delete c[m])}),c},toString:function(){return"#<fabric."+i(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var c=r.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(c.scaleX),scaleY:Math.abs(c.scaleY)}},getTotalObjectScaling:function(){var c=this.getObjectScaling(),u=c.scaleX,m=c.scaleY;if(this.canvas){var _=this.canvas.getZoom(),E=this.canvas.getRetinaScaling();u*=_*E,m*=_*E}return{scaleX:u,scaleY:m}},getObjectOpacity:function(){var c=this.opacity;return this.group&&(c*=this.group.getObjectOpacity()),c},_set:function(c,u){var m=c==="scaleX"||c==="scaleY",_=this[c]!==u,E=!1;return m&&(u=this._constrainScale(u)),c==="scaleX"&&u<0?(this.flipX=!this.flipX,u*=-1):c==="scaleY"&&u<0?(this.flipY=!this.flipY,u*=-1):c!=="shadow"||!u||u instanceof r.Shadow?c==="dirty"&&this.group&&this.group.set("dirty",u):u=new r.Shadow(u),this[c]=u,_&&(E=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(c)>-1?(this.dirty=!0,E&&this.group.set("dirty",!0)):E&&this.stateProperties.indexOf(c)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:r.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(c){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(c.save(),this._setupCompositeOperation(c),this.drawSelectionBackground(c),this.transform(c),this._setOpacity(c),this._setShadow(c,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(c)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(c),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),c.restore())},renderCache:function(c){c=c||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,c.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(c,u){if(c.save(),u.inverted?c.globalCompositeOperation="destination-out":c.globalCompositeOperation="destination-in",u.absolutePositioned){var m=r.util.invertTransform(this.calcTransformMatrix());c.transform(m[0],m[1],m[2],m[3],m[4],m[5])}u.transform(c),c.scale(1/u.zoomX,1/u.zoomY),c.drawImage(u._cacheCanvas,-u.cacheTranslationX,-u.cacheTranslationY),c.restore()},drawObject:function(c,u){var m=this.fill,_=this.stroke;u?(this.fill="black",this.stroke="",this._setClippingProperties(c)):this._renderBackground(c),this._render(c),this._drawClipPath(c,this.clipPath),this.fill=m,this.stroke=_},_drawClipPath:function(c,u){u&&(u.canvas=this.canvas,u.shouldCache(),u._transformDone=!0,u.renderCache({forClipping:!0}),this.drawClipPathOnCache(c,u))},drawCacheOnCanvas:function(c){c.scale(1/this.zoomX,1/this.zoomY),c.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(c){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!c&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!c){var u=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-u/2,-m/2,u,m)}return!0}return!1},_renderBackground:function(c){if(this.backgroundColor){var u=this._getNonTransformedDimensions();c.fillStyle=this.backgroundColor,c.fillRect(-u.x/2,-u.y/2,u.x,u.y),this._removeShadow(c)}},_setOpacity:function(c){this.group&&!this.group._transformDone?c.globalAlpha=this.getObjectOpacity():c.globalAlpha*=this.opacity},_setStrokeStyles:function(c,u){var m=u.stroke;m&&(c.lineWidth=u.strokeWidth,c.lineCap=u.strokeLineCap,c.lineDashOffset=u.strokeDashOffset,c.lineJoin=u.strokeLineJoin,c.miterLimit=u.strokeMiterLimit,m.toLive?m.gradientUnits==="percentage"||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(c,m):(c.strokeStyle=m.toLive(c,this),this._applyPatternGradientTransform(c,m)):c.strokeStyle=u.stroke)},_setFillStyles:function(c,u){var m=u.fill;m&&(m.toLive?(c.fillStyle=m.toLive(c,this),this._applyPatternGradientTransform(c,u.fill)):c.fillStyle=m)},_setClippingProperties:function(c){c.globalAlpha=1,c.strokeStyle="transparent",c.fillStyle="#000000"},_setLineDash:function(c,u){u&&u.length!==0&&(1&u.length&&u.push.apply(u,u),c.setLineDash(u))},_renderControls:function(c,u){var m,_,E,T=this.getViewportTransform(),C=this.calcTransformMatrix();_=(u=u||{}).hasBorders!==void 0?u.hasBorders:this.hasBorders,E=u.hasControls!==void 0?u.hasControls:this.hasControls,C=r.util.multiplyTransformMatrices(T,C),m=r.util.qrDecompose(C),c.save(),c.translate(m.translateX,m.translateY),c.lineWidth=1*this.borderScaleFactor,this.group||(c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(m.angle-=180),c.rotate(o(this.group?m.angle:this.angle)),u.forActiveSelection||this.group?_&&this.drawBordersInGroup(c,m,u):_&&this.drawBorders(c,u),E&&this.drawControls(c,u),c.restore()},_setShadow:function(c){if(this.shadow){var u,m=this.shadow,_=this.canvas,E=_&&_.viewportTransform[0]||1,T=_&&_.viewportTransform[3]||1;u=m.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),_&&_._isRetinaScaling()&&(E*=r.devicePixelRatio,T*=r.devicePixelRatio),c.shadowColor=m.color,c.shadowBlur=m.blur*r.browserShadowBlurConstant*(E+T)*(u.scaleX+u.scaleY)/4,c.shadowOffsetX=m.offsetX*E*u.scaleX,c.shadowOffsetY=m.offsetY*T*u.scaleY}},_removeShadow:function(c){this.shadow&&(c.shadowColor="",c.shadowBlur=c.shadowOffsetX=c.shadowOffsetY=0)},_applyPatternGradientTransform:function(c,u){if(!u||!u.toLive)return{offsetX:0,offsetY:0};var m=u.gradientTransform||u.patternTransform,_=-this.width/2+u.offsetX||0,E=-this.height/2+u.offsetY||0;return u.gradientUnits==="percentage"?c.transform(this.width,0,0,this.height,_,E):c.transform(1,0,0,1,_,E),m&&c.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:_,offsetY:E}},_renderPaintInOrder:function(c){this.paintFirst==="stroke"?(this._renderStroke(c),this._renderFill(c)):(this._renderFill(c),this._renderStroke(c))},_render:function(){},_renderFill:function(c){this.fill&&(c.save(),this._setFillStyles(c,this),this.fillRule==="evenodd"?c.fill("evenodd"):c.fill(),c.restore())},_renderStroke:function(c){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(c),c.save(),this.strokeUniform&&this.group){var u=this.getObjectScaling();c.scale(1/u.scaleX,1/u.scaleY)}else this.strokeUniform&&c.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(c,this.strokeDashArray),this._setStrokeStyles(c,this),c.stroke(),c.restore()}},_applyPatternForTransformedGradient:function(c,u){var m,_=this._limitCacheSize(this._getCacheCanvasDimensions()),E=r.util.createCanvasElement(),T=this.canvas.getRetinaScaling(),C=_.x/this.scaleX/T,b=_.y/this.scaleY/T;E.width=C,E.height=b,(m=E.getContext("2d")).beginPath(),m.moveTo(0,0),m.lineTo(C,0),m.lineTo(C,b),m.lineTo(0,b),m.closePath(),m.translate(C/2,b/2),m.scale(_.zoomX/this.scaleX/T,_.zoomY/this.scaleY/T),this._applyPatternGradientTransform(m,u),m.fillStyle=u.toLive(c),m.fill(),c.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),c.scale(T*this.scaleX/_.zoomX,T*this.scaleY/_.zoomY),c.strokeStyle=m.createPattern(E,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var c=r.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",c.scaleX),this.set("scaleY",c.scaleY),this.angle=c.angle,this.skewX=c.skewX,this.skewY=0}},_removeTransformMatrix:function(c){var u=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),u=r.util.transformPoint(u,this.transformMatrix)),this.transformMatrix=null,c&&(this.scaleX*=c.scaleX,this.scaleY*=c.scaleY,this.cropX=c.cropX,this.cropY=c.cropY,u.x+=c.offsetLeft,u.y+=c.offsetTop,this.width=c.width,this.height=c.height),this.setPositionByOrigin(u,"center","center")},clone:function(c,u){var m=this.toObject(u);this.constructor.fromObject?this.constructor.fromObject(m,c):r.Object._fromObject("Object",m,c)},cloneAsImage:function(c,u){var m=this.toCanvasElement(u);return c&&c(new r.Image(m)),this},toCanvasElement:function(c){c||(c={});var u=r.util,m=u.saveObjectTransform(this),_=this.group,E=this.shadow,T=Math.abs,C=(c.multiplier||1)*(c.enableRetinaScaling?r.devicePixelRatio:1);delete this.group,c.withoutTransform&&u.resetObjectTransform(this),c.withoutShadow&&(this.shadow=null);var b,O,j,U,$=r.util.createCanvasElement(),z=this.getBoundingRect(!0,!0),H=this.shadow,M={x:0,y:0};H&&(O=H.blur,b=H.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),M.x=2*Math.round(T(H.offsetX)+O)*T(b.scaleX),M.y=2*Math.round(T(H.offsetY)+O)*T(b.scaleY)),j=z.width+M.x,U=z.height+M.y,$.width=Math.ceil(j),$.height=Math.ceil(U);var D=new r.StaticCanvas($,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});c.format==="jpeg"&&(D.backgroundColor="#fff"),this.setPositionByOrigin(new r.Point(D.width/2,D.height/2),"center","center");var G=this.canvas;D.add(this);var q=D.toCanvasElement(C||1,c);return this.shadow=E,this.set("canvas",G),_&&(this.group=_),this.set(m).setCoords(),D._objects=[],D.dispose(),D=null,q},toDataURL:function(c){return c||(c={}),r.util.toDataURL(this.toCanvasElement(c),c.format||"png",c.quality||1)},isType:function(c){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===c},complexity:function(){return 1},toJSON:function(c){return this.toObject(c)},rotate:function(c){var u=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return u&&this._setOriginToCenter(),this.set("angle",c),u&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(c,u){u=u||this.canvas.getPointer(c);var m=new r.Point(u.x,u.y),_=this._getLeftTopCoords();return this.angle&&(m=r.util.rotatePoint(m,_,o(-this.angle))),{x:m.x-_.x,y:m.y-_.y}},_setupCompositeOperation:function(c){this.globalCompositeOperation&&(c.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){r.runningAnimations&&r.runningAnimations.cancelByTarget(this)}}),r.util.createAccessors&&r.util.createAccessors(r.Object),n(r.Object.prototype,r.Observable),r.Object.NUM_FRACTION_DIGITS=2,r.Object.ENLIVEN_PROPS=["clipPath"],r.Object._fromObject=function(c,u,m,_){var E=r[c];u=l(u,!0),r.util.enlivenPatterns([u.fill,u.stroke],function(T){T[0]!==void 0&&(u.fill=T[0]),T[1]!==void 0&&(u.stroke=T[1]),r.util.enlivenObjectEnlivables(u,u,function(){var C=_?new E(u[_],u):new E(u);m&&m(C)})})},r.Object.__uid=0)}(t),ge=p.util.degreesToRadians,ce={left:-.5,center:0,right:.5},Se={top:-.5,center:0,bottom:.5},p.util.object.extend(p.Object.prototype,{translateToGivenOrigin:function(s,r,n,l,e){var i,o,d,c=s.x,u=s.y;return typeof r=="string"?r=ce[r]:r-=.5,typeof l=="string"?l=ce[l]:l-=.5,typeof n=="string"?n=Se[n]:n-=.5,typeof e=="string"?e=Se[e]:e-=.5,o=e-n,((i=l-r)||o)&&(d=this._getTransformedDimensions(),c=s.x+i*d.x,u=s.y+o*d.y),new p.Point(c,u)},translateToCenterPoint:function(s,r,n){var l=this.translateToGivenOrigin(s,r,n,"center","center");return this.angle?p.util.rotatePoint(l,s,ge(this.angle)):l},translateToOriginPoint:function(s,r,n){var l=this.translateToGivenOrigin(s,"center","center",r,n);return this.angle?p.util.rotatePoint(l,s,ge(this.angle)):l},getCenterPoint:function(){var s=new p.Point(this.left,this.top);return this.translateToCenterPoint(s,this.originX,this.originY)},getPointByOrigin:function(s,r){var n=this.getCenterPoint();return this.translateToOriginPoint(n,s,r)},toLocalPoint:function(s,r,n){var l,e,i=this.getCenterPoint();return l=r!==void 0&&n!==void 0?this.translateToGivenOrigin(i,"center","center",r,n):new p.Point(this.left,this.top),e=new p.Point(s.x,s.y),this.angle&&(e=p.util.rotatePoint(e,i,-ge(this.angle))),e.subtractEquals(l)},setPositionByOrigin:function(s,r,n){var l=this.translateToCenterPoint(s,r,n),e=this.translateToOriginPoint(l,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(s){var r,n,l=ge(this.angle),e=this.getScaledWidth(),i=p.util.cos(l)*e,o=p.util.sin(l)*e;r=typeof this.originX=="string"?ce[this.originX]:this.originX-.5,n=typeof s=="string"?ce[s]:s-.5,this.left+=i*(n-r),this.top+=o*(n-r),this.setCoords(),this.originX=s},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var s=this.getCenterPoint();this.originX="center",this.originY="center",this.left=s.x,this.top=s.y},_resetOrigin:function(){var s=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=s.x,this.top=s.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var s=p.util,r=s.degreesToRadians,n=s.multiplyTransformMatrices,l=s.transformPoint;s.object.extend(p.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(e,i){return i?e?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),e?this.aCoords:this.lineCoords)},getCoords:function(e,i){return o=this._getCoords(e,i),[new p.Point(o.tl.x,o.tl.y),new p.Point(o.tr.x,o.tr.y),new p.Point(o.br.x,o.br.y),new p.Point(o.bl.x,o.bl.y)];var o},intersectsWithRect:function(e,i,o,d){var c=this.getCoords(o,d);return p.Intersection.intersectPolygonRectangle(c,e,i).status==="Intersection"},intersectsWithObject:function(e,i,o){return p.Intersection.intersectPolygonPolygon(this.getCoords(i,o),e.getCoords(i,o)).status==="Intersection"||e.isContainedWithinObject(this,i,o)||this.isContainedWithinObject(e,i,o)},isContainedWithinObject:function(e,i,o){for(var d=this.getCoords(i,o),c=i?e.aCoords:e.lineCoords,u=0,m=e._getImageLines(c);u<4;u++)if(!e.containsPoint(d[u],m))return!1;return!0},isContainedWithinRect:function(e,i,o,d){var c=this.getBoundingRect(o,d);return c.left>=e.x&&c.left+c.width<=i.x&&c.top>=e.y&&c.top+c.height<=i.y},containsPoint:function(e,i,o,d){var c=this._getCoords(o,d),u=(i=i||this._getImageLines(c),this._findCrossPoints(e,i));return u!==0&&u%2==1},isOnScreen:function(e){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;return!!this.getCoords(!0,e).some(function(d){return d.x<=o.x&&d.x>=i.x&&d.y<=o.y&&d.y>=i.y})||!!this.intersectsWithRect(i,o,!0,e)||this._containsCenterOfCanvas(i,o,e)},_containsCenterOfCanvas:function(e,i,o){var d={x:(e.x+i.x)/2,y:(e.y+i.y)/2};return!!this.containsPoint(d,null,!0,o)},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;return!!this.intersectsWithRect(i,o,!0,e)||this.getCoords(!0,e).every(function(d){return(d.x>=o.x||d.x<=i.x)&&(d.y>=o.y||d.y<=i.y)})&&this._containsCenterOfCanvas(i,o,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,i){var o,d,c,u=0;for(var m in i)if(!((c=i[m]).o.y<e.y&&c.d.y<e.y||c.o.y>=e.y&&c.d.y>=e.y||(c.o.x===c.d.x&&c.o.x>=e.x?d=c.o.x:(o=(c.d.y-c.o.y)/(c.d.x-c.o.x),d=-(e.y-0*e.x-(c.o.y-o*c.o.x))/(0-o)),d>=e.x&&(u+=1),u!==2)))break;return u},getBoundingRect:function(e,i){var o=this.getCoords(e,i);return s.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e===0?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,i){var o=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(e/this.width/o)},scaleToHeight:function(e,i){var o=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(e/this.height/o)},calcLineCoords:function(){var e=this.getViewportTransform(),i=this.padding,o=r(this.angle),d=s.cos(o)*i,c=s.sin(o)*i,u=d+c,m=d-c,_=this.calcACoords(),E={tl:l(_.tl,e),tr:l(_.tr,e),bl:l(_.bl,e),br:l(_.br,e)};return i&&(E.tl.x-=m,E.tl.y-=u,E.tr.x+=u,E.tr.y-=m,E.bl.x-=u,E.bl.y+=m,E.br.x+=m,E.br.y+=u),E},calcOCoords:function(){var e=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=this.getViewportTransform(),d=n(o,i),c=n(d,e),u=(c=n(c,[1/o[0],0,0,1/o[3],0,0]),this._calculateCurrentDimensions()),m={};return this.forEachControl(function(_,E,T){m[E]=_.positionHandler(u,c,T)}),m},calcACoords:function(){var e=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=n(i,e),d=this._getTransformedDimensions(),c=d.x/2,u=d.y/2;return{tl:l({x:-c,y:-u},o),tr:l({x:c,y:-u},o),bl:l({x:-c,y:u},o),br:l({x:c,y:u},o)}},setCoords:function(e){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),e||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var i="_",o="";return!e&&this.group&&(o=this.group.transformMatrixKey(e)+i),o+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){var i=this.calcOwnMatrix();if(e||!this.group)return i;var o=this.transformMatrixKey(e),d=this.matrixCache||(this.matrixCache={});return d.key===o?d.value:(this.group&&(i=n(this.group.calcTransformMatrix(!1),i)),d.key=o,d.value=i,i)},calcOwnMatrix:function(){var e=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===e)return i.value;var o=this._calcTranslateMatrix(),d={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=e,i.value=s.composeMatrix(d),i.value},_getNonTransformedDimensions:function(){var e=this.strokeWidth;return{x:this.width+e,y:this.height+e}},_getTransformedDimensions:function(e,i){e===void 0&&(e=this.skewX),i===void 0&&(i=this.skewY);var o,d,c,u=e===0&&i===0;if(this.strokeUniform?(d=this.width,c=this.height):(d=(o=this._getNonTransformedDimensions()).x,c=o.y),u)return this._finalizeDimensions(d*this.scaleX,c*this.scaleY);var m=s.sizeAfterTransform(d,c,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:e,skewY:i});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(e,i){return this.strokeUniform?{x:e+this.strokeWidth,y:i+this.strokeWidth}:{x:e,y:i}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),i=this._getTransformedDimensions();return l(i,e,!0).scalarAdd(2*this.padding)}})}(),p.util.object.extend(p.Object.prototype,{sendToBack:function(){return this.group?p.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?p.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(s){return this.group?p.StaticCanvas.prototype.sendBackwards.call(this.group,this,s):this.canvas&&this.canvas.sendBackwards(this,s),this},bringForward:function(s){return this.group?p.StaticCanvas.prototype.bringForward.call(this.group,this,s):this.canvas&&this.canvas.bringForward(this,s),this},moveTo:function(s){return this.group&&this.group.type!=="activeSelection"?p.StaticCanvas.prototype.moveTo.call(this.group,this,s):this.canvas&&this.canvas.moveTo(this,s),this}}),function(){function s(n,l){if(l){if(l.toLive)return n+": url(#SVGID_"+l.id+"); ";var e=new p.Color(l),i=n+": "+e.toRgb()+"; ",o=e.getAlpha();return o!==1&&(i+=n+"-opacity: "+o.toString()+"; "),i}return n+": none; "}var r=p.util.toFixed;p.util.object.extend(p.Object.prototype,{getSvgStyles:function(n){var l=this.fillRule?this.fillRule:"nonzero",e=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeDashOffset?this.strokeDashOffset:"0",d=this.strokeLineCap?this.strokeLineCap:"butt",c=this.strokeLineJoin?this.strokeLineJoin:"miter",u=this.strokeMiterLimit?this.strokeMiterLimit:"4",m=this.opacity!==void 0?this.opacity:"1",_=this.visible?"":" visibility: hidden;",E=n?"":this.getSvgFilter(),T=s("fill",this.fill);return[s("stroke",this.stroke),"stroke-width: ",e,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",d,"; ","stroke-dashoffset: ",o,"; ","stroke-linejoin: ",c,"; ","stroke-miterlimit: ",u,"; ",T,"fill-rule: ",l,"; ","opacity: ",m,";",E,_].join("")},getSvgSpanStyles:function(n,l){var e="; ",i=n.fontFamily?"font-family: "+(n.fontFamily.indexOf("'")===-1&&n.fontFamily.indexOf('"')===-1?"'"+n.fontFamily+"'":n.fontFamily)+e:"",o=n.strokeWidth?"stroke-width: "+n.strokeWidth+e:"",d=n.fontSize?"font-size: "+n.fontSize+"px"+e:"",c=n.fontStyle?"font-style: "+n.fontStyle+e:"",u=n.fontWeight?"font-weight: "+n.fontWeight+e:"",m=n.fill?s("fill",n.fill):"",_=n.stroke?s("stroke",n.stroke):"",E=this.getSvgTextDecoration(n);return E&&(E="text-decoration: "+E+e),[_,o,i,d,c,u,E,m,n.deltaY?"baseline-shift: "+-n.deltaY+"; ":"",l?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(n){return["overline","underline","line-through"].filter(function(l){return n[l.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(n,l){var e=n?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+p.util.matrixToSVG(e)+(l||"")+'" '},_setSVGBg:function(n){if(this.backgroundColor){var l=p.Object.NUM_FRACTION_DIGITS;n.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,l),'" y="',r(-this.height/2,l),'" width="',r(this.width,l),'" height="',r(this.height,l),`"></rect>
`)}},toSVG:function(n){return this._createBaseSVGMarkup(this._toSVG(n),{reviver:n})},toClipPathSVG:function(n){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(n),{reviver:n})},_createBaseClipPathSVGMarkup:function(n,l){var e=(l=l||{}).reviver,i=l.additionalTransform||"",o=[this.getSvgTransform(!0,i),this.getSvgCommons()].join(""),d=n.indexOf("COMMON_PARTS");return n[d]=o,e?e(n.join("")):n.join("")},_createBaseSVGMarkup:function(n,l){var e,i,o=(l=l||{}).noStyle,d=l.reviver,c=o?"":'style="'+this.getSvgStyles()+'" ',u=l.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,_=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",E=m&&m.absolutePositioned,T=this.stroke,C=this.fill,b=this.shadow,O=[],j=n.indexOf("COMMON_PARTS"),U=l.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+p.Object.__uid++,i='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(d)+`</clipPath>
`),E&&O.push("<g ",u,this.getSvgCommons(),` >
`),O.push("<g ",this.getSvgTransform(!1),E?"":u+this.getSvgCommons(),` >
`),e=[c,_,o?"":this.addPaintOrder()," ",U?'transform="'+U+'" ':""].join(""),n[j]=e,C&&C.toLive&&O.push(C.toSVG(this)),T&&T.toLive&&O.push(T.toSVG(this)),b&&O.push(b.toSVG(this)),m&&O.push(i),O.push(n.join("")),O.push(`</g>
`),E&&O.push(`</g>
`),d?d(O.join("")):O.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var s=p.util.object.extend,r="stateProperties";function n(e,i,o){var d={};o.forEach(function(c){d[c]=e[c]}),s(e[i],d,!0)}function l(e,i,o){if(e===i)return!0;if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var d=0,c=e.length;d<c;d++)if(!l(e[d],i[d]))return!1;return!0}if(e&&typeof e=="object"){var u,m=Object.keys(e);if(!i||typeof i!="object"||!o&&m.length!==Object.keys(i).length)return!1;for(d=0,c=m.length;d<c;d++)if((u=m[d])!=="canvas"&&u!=="group"&&!l(e[u],i[u]))return!1;return!0}}p.util.object.extend(p.Object.prototype,{hasStateChanged:function(e){var i="_"+(e=e||r);return Object.keys(this[i]).length<this[e].length||!l(this[i],this,!0)},saveState:function(e){var i=e&&e.propertySet||r,o="_"+i;return this[o]?(n(this,o,this[i]),e&&e.stateProperties&&n(this,o,e.stateProperties),this):this.setupState(e)},setupState:function(e){var i=(e=e||{}).propertySet||r;return e.propertySet=i,this["_"+i]={},this.saveState(e),this}})}(),function(){var s=p.util.degreesToRadians;p.util.object.extend(p.Object.prototype,{_findTargetCorner:function(r,n){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var l,e,i,o=r.x,d=r.y,c=Object.keys(this.oCoords),u=c.length-1;for(this.__corner=0;u>=0;u--)if(i=c[u],this.isControlVisible(i)&&(e=this._getImageLines(n?this.oCoords[i].touchCorner:this.oCoords[i].corner),(l=this._findCrossPoints({x:o,y:d},e))!==0&&l%2==1))return this.__corner=i,i;return!1},forEachControl:function(r){for(var n in this.controls)r(this.controls[n],n,this)},_setCornerCoords:function(){var r=this.oCoords;for(var n in r){var l=this.controls[n];r[n].corner=l.calcCornerCoords(this.angle,this.cornerSize,r[n].x,r[n].y,!1),r[n].touchCorner=l.calcCornerCoords(this.angle,this.touchCornerSize,r[n].x,r[n].y,!0)}},drawSelectionBackground:function(r){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;r.save();var n=this.getCenterPoint(),l=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;return r.translate(n.x,n.y),r.scale(1/e[0],1/e[3]),r.rotate(s(this.angle)),r.fillStyle=this.selectionBackgroundColor,r.fillRect(-l.x/2,-l.y/2,l.x,l.y),r.restore(),this},drawBorders:function(r,n){n=n||{};var l=this._calculateCurrentDimensions(),e=this.borderScaleFactor,i=l.x+e,o=l.y+e,d=n.hasControls!==void 0?n.hasControls:this.hasControls,c=!1;return r.save(),r.strokeStyle=n.borderColor||this.borderColor,this._setLineDash(r,n.borderDashArray||this.borderDashArray),r.strokeRect(-i/2,-o/2,i,o),d&&(r.beginPath(),this.forEachControl(function(u,m,_){u.withConnection&&u.getVisibility(_,m)&&(c=!0,r.moveTo(u.x*i,u.y*o),r.lineTo(u.x*i+u.offsetX,u.y*o+u.offsetY))}),c&&r.stroke()),r.restore(),this},drawBordersInGroup:function(r,n,l){l=l||{};var e=p.util.sizeAfterTransform(this.width,this.height,n),i=this.strokeWidth,o=this.strokeUniform,d=this.borderScaleFactor,c=e.x+i*(o?this.canvas.getZoom():n.scaleX)+d,u=e.y+i*(o?this.canvas.getZoom():n.scaleY)+d;return r.save(),this._setLineDash(r,l.borderDashArray||this.borderDashArray),r.strokeStyle=l.borderColor||this.borderColor,r.strokeRect(-c/2,-u/2,c,u),r.restore(),this},drawControls:function(r,n){n=n||{},r.save();var l,e,i=this.canvas.getRetinaScaling();return r.setTransform(i,0,0,i,0,0),r.strokeStyle=r.fillStyle=n.cornerColor||this.cornerColor,this.transparentCorners||(r.strokeStyle=n.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(r,n.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(l=this.group.calcTransformMatrix()),this.forEachControl(function(o,d,c){e=c.oCoords[d],o.getVisibility(c,d)&&(l&&(e=p.util.transformPoint(e,l)),o.render(r,e.x,e.y,n,c))}),r.restore(),this},isControlVisible:function(r){return this.controls[r]&&this.controls[r].getVisibility(this,r)},setControlVisible:function(r,n){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[r]=n,this},setControlsVisibility:function(r){for(var n in r||(r={}),r)this.setControlVisible(n,r[n]);return this},onDeselect:function(){},onSelect:function(){}})}(),p.util.object.extend(p.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(s,r){var n=function(){},l=(r=r||{}).onComplete||n,e=r.onChange||n,i=this;return p.util.animate({target:this,startValue:s.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(o){s.set("left",o),i.requestRenderAll(),e()},onComplete:function(){s.setCoords(),l()}})},fxCenterObjectV:function(s,r){var n=function(){},l=(r=r||{}).onComplete||n,e=r.onChange||n,i=this;return p.util.animate({target:this,startValue:s.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(o){s.set("top",o),i.requestRenderAll(),e()},onComplete:function(){s.setCoords(),l()}})},fxRemove:function(s,r){var n=function(){},l=(r=r||{}).onComplete||n,e=r.onChange||n,i=this;return p.util.animate({target:this,startValue:s.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(o){s.set("opacity",o),i.requestRenderAll(),e()},onComplete:function(){i.remove(s),l()}})}}),p.util.object.extend(p.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var s,r,n=[],l=[];for(s in arguments[0])n.push(s);for(var e=0,i=n.length;e<i;e++)s=n[e],r=e!==i-1,l.push(this._animate(s,arguments[0][s],arguments[1],r));return l}return this._animate.apply(this,arguments)},_animate:function(s,r,n,l){var e,i=this;r=r.toString(),n=n?p.util.object.clone(n):{},~s.indexOf(".")&&(e=s.split("."));var o=i.colorProperties.indexOf(s)>-1||e&&i.colorProperties.indexOf(e[1])>-1,d=e?this.get(e[0])[e[1]]:this.get(s);"from"in n||(n.from=d),o||(r=~r.indexOf("=")?d+parseFloat(r.replace("=","")):parseFloat(r));var c={target:this,startValue:n.from,endValue:r,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(u,m,_){return n.abort.call(i,u,m,_)},onChange:function(u,m,_){e?i[e[0]][e[1]]=u:i.set(s,u),l||n.onChange&&n.onChange(u,m,_)},onComplete:function(u,m,_){l||(i.setCoords(),n.onComplete&&n.onComplete(u,m,_))}};return o?p.util.animateColor(c.startValue,c.endValue,c.duration,c):p.util.animate(c)}}),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.object.clone,e={x1:1,x2:1,y1:1,y2:1};function i(o,d){var c=o.origin,u=o.axis1,m=o.axis2,_=o.dimension,E=d.nearest,T=d.center,C=d.farthest;return function(){switch(this.get(c)){case E:return Math.min(this.get(u),this.get(m));case T:return Math.min(this.get(u),this.get(m))+.5*this.get(_);case C:return Math.max(this.get(u),this.get(m))}}}r.Line?r.warn("fabric.Line is already defined"):(r.Line=r.util.createClass(r.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:r.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(o,d){o||(o=[0,0,0,0]),this.callSuper("initialize",d),this.set("x1",o[0]),this.set("y1",o[1]),this.set("x2",o[2]),this.set("y2",o[3]),this._setWidthHeight(d)},_setWidthHeight:function(o){o||(o={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in o?o.left:this._getLeftToOriginX(),this.top="top"in o?o.top:this._getTopToOriginY()},_set:function(o,d){return this.callSuper("_set",o,d),e[o]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:i({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:i({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(o){o.beginPath();var d=this.calcLinePoints();o.moveTo(d.x1,d.y1),o.lineTo(d.x2,d.y2),o.lineWidth=this.strokeWidth;var c=o.strokeStyle;o.strokeStyle=this.stroke||o.fillStyle,this.stroke&&this._renderStroke(o),o.strokeStyle=c},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(o){return n(this.callSuper("toObject",o),this.calcLinePoints())},_getNonTransformedDimensions:function(){var o=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(o.y-=this.strokeWidth),this.height===0&&(o.x-=this.strokeWidth)),o},calcLinePoints:function(){var o=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,c=o*this.width*.5,u=d*this.height*.5;return{x1:c,x2:o*this.width*-.5,y1:u,y2:d*this.height*-.5}},_toSVG:function(){var o=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`" />
`]}}),r.Line.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),r.Line.fromElement=function(o,d,c){c=c||{};var u=r.parseAttributes(o,r.Line.ATTRIBUTE_NAMES),m=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];d(new r.Line(m,n(u,c)))},r.Line.fromObject=function(o,d){var c=l(o,!0);c.points=[o.x1,o.y1,o.x2,o.y2],r.Object._fromObject("Line",c,function(u){delete u.points,d&&d(u)},"points")})}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.degreesToRadians;r.Circle?r.warn("fabric.Circle is already defined."):(r.Circle=r.util.createClass(r.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:r.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(l,e){return this.callSuper("_set",l,e),l==="radius"&&this.setRadius(e),this},toObject:function(l){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(l))},_toSVG:function(){var l,e=(this.endAngle-this.startAngle)%360;if(e===0)l=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var i=n(this.startAngle),o=n(this.endAngle),d=this.radius;l=['<path d="M '+r.util.cos(i)*d+" "+r.util.sin(i)*d," A "+d+" "+d," 0 ",+(e>180?"1":"0")+" 1"," "+r.util.cos(o)*d+" "+r.util.sin(o)*d,'" ',"COMMON_PARTS",` />
`]}return l},_render:function(l){l.beginPath(),l.arc(0,0,this.radius,n(this.startAngle),n(this.endAngle),!1),this._renderPaintInOrder(l)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(l){return this.radius=l,this.set("width",2*l).set("height",2*l)}}),r.Circle.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),r.Circle.fromElement=function(l,e){var i,o=r.parseAttributes(l,r.Circle.ATTRIBUTE_NAMES);if(!("radius"in(i=o)&&i.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");o.left=(o.left||0)-o.radius,o.top=(o.top||0)-o.radius,e(new r.Circle(o))},r.Circle.fromObject=function(l,e){r.Object._fromObject("Circle",l,e)})}(t),function(s){var r=s.fabric||(s.fabric={});r.Triangle?r.warn("fabric.Triangle is already defined"):(r.Triangle=r.util.createClass(r.Object,{type:"triangle",width:100,height:100,_render:function(n){var l=this.width/2,e=this.height/2;n.beginPath(),n.moveTo(-l,e),n.lineTo(0,-e),n.lineTo(l,e),n.closePath(),this._renderPaintInOrder(n)},_toSVG:function(){var n=this.width/2,l=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-n+" "+l,"0 "+-l,n+" "+l].join(","),'" />']}}),r.Triangle.fromObject=function(n,l){return r.Object._fromObject("Triangle",n,l)})}(t),function(s){var r=s.fabric||(s.fabric={}),n=2*Math.PI;r.Ellipse?r.warn("fabric.Ellipse is already defined."):(r.Ellipse=r.util.createClass(r.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this.set("rx",l&&l.rx||0),this.set("ry",l&&l.ry||0)},_set:function(l,e){switch(this.callSuper("_set",l,e),l){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(l){l.beginPath(),l.save(),l.transform(1,0,0,this.ry/this.rx,0,0),l.arc(0,0,this.rx,0,n,!1),l.restore(),this._renderPaintInOrder(l)}}),r.Ellipse.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),r.Ellipse.fromElement=function(l,e){var i=r.parseAttributes(l,r.Ellipse.ATTRIBUTE_NAMES);i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,e(new r.Ellipse(i))},r.Ellipse.fromObject=function(l,e){r.Object._fromObject("Ellipse",l,e)})}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend;r.Rect?r.warn("fabric.Rect is already defined"):(r.Rect=r.util.createClass(r.Object,{stateProperties:r.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(l){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,o=this.width,d=this.height,c=-this.width/2,u=-this.height/2,m=e!==0||i!==0,_=.4477152502;l.beginPath(),l.moveTo(c+e,u),l.lineTo(c+o-e,u),m&&l.bezierCurveTo(c+o-_*e,u,c+o,u+_*i,c+o,u+i),l.lineTo(c+o,u+d-i),m&&l.bezierCurveTo(c+o,u+d-_*i,c+o-_*e,u+d,c+o-e,u+d),l.lineTo(c+e,u+d),m&&l.bezierCurveTo(c+_*e,u+d,c,u+d-_*i,c,u+d-i),l.lineTo(c,u+i),m&&l.bezierCurveTo(c,u+_*i,c+_*e,u,c+e,u),l.closePath(),this._renderPaintInOrder(l)},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),r.Rect.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),r.Rect.fromElement=function(l,e,i){if(!l)return e(null);i=i||{};var o=r.parseAttributes(l,r.Rect.ATTRIBUTE_NAMES);o.left=o.left||0,o.top=o.top||0,o.height=o.height||0,o.width=o.width||0;var d=new r.Rect(n(i?r.util.object.clone(i):{},o));d.visible=d.visible&&d.width>0&&d.height>0,e(d)},r.Rect.fromObject=function(l,e){return r.Object._fromObject("Rect",l,e)})}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.util.array.min,e=r.util.array.max,i=r.util.toFixed,o=r.util.projectStrokeOnPoints;r.Polyline?r.warn("fabric.Polyline is already defined"):(r.Polyline=r.util.createClass(r.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:r.Object.prototype.cacheProperties.concat("points"),initialize:function(d,c){c=c||{},this.points=d||[],this.callSuper("initialize",c),this._setPositionDimensions(c)},_projectStrokeOnPoints:function(){return o(this.points,this,!0)},_setPositionDimensions:function(d){var c,u=this._calcDimensions(d),m=this.exactBoundingBox?this.strokeWidth:0;this.width=u.width-m,this.height=u.height-m,d.fromSVG||(c=this.translateToGivenOrigin({x:u.left-this.strokeWidth/2+m/2,y:u.top-this.strokeWidth/2+m/2},"left","top",this.originX,this.originY)),d.left===void 0&&(this.left=d.fromSVG?u.left:c.x),d.top===void 0&&(this.top=d.fromSVG?u.top:c.y),this.pathOffset={x:u.left+this.width/2+m/2,y:u.top+this.height/2+m/2}},_calcDimensions:function(){var d=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,c=l(d,"x")||0,u=l(d,"y")||0;return{left:c,top:u,width:(e(d,"x")||0)-c,height:(e(d,"y")||0)-u}},toObject:function(d){return n(this.callSuper("toObject",d),{points:this.points.concat()})},_toSVG:function(){for(var d=[],c=this.pathOffset.x,u=this.pathOffset.y,m=r.Object.NUM_FRACTION_DIGITS,_=0,E=this.points.length;_<E;_++)d.push(i(this.points[_].x-c,m),",",i(this.points[_].y-u,m)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',d.join(""),`" />
`]},commonRender:function(d){var c,u=this.points.length,m=this.pathOffset.x,_=this.pathOffset.y;if(!u||isNaN(this.points[u-1].y))return!1;d.beginPath(),d.moveTo(this.points[0].x-m,this.points[0].y-_);for(var E=0;E<u;E++)c=this.points[E],d.lineTo(c.x-m,c.y-_);return!0},_render:function(d){this.commonRender(d)&&this._renderPaintInOrder(d)},complexity:function(){return this.get("points").length}}),r.Polyline.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polyline.fromElementGenerator=function(d){return function(c,u,m){if(!c)return u(null);m||(m={});var _=r.parsePointsAttribute(c.getAttribute("points")),E=r.parseAttributes(c,r[d].ATTRIBUTE_NAMES);E.fromSVG=!0,u(new r[d](_,n(E,m)))}},r.Polyline.fromElement=r.Polyline.fromElementGenerator("Polyline"),r.Polyline.fromObject=function(d,c){return r.Object._fromObject("Polyline",d,c,"points")})}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.projectStrokeOnPoints;r.Polygon?r.warn("fabric.Polygon is already defined"):(r.Polygon=r.util.createClass(r.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return n(this.points,this)},_render:function(l){this.commonRender(l)&&(l.closePath(),this._renderPaintInOrder(l))}}),r.Polygon.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polygon.fromElement=r.Polyline.fromElementGenerator("Polygon"),r.Polygon.fromObject=function(l,e){r.Object._fromObject("Polygon",l,e,"points")})}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.array.min,l=r.util.array.max,e=r.util.object.extend,i=r.util.object.clone,o=r.util.toFixed;r.Path?r.warn("fabric.Path is already defined"):(r.Path=r.util.createClass(r.Object,{type:"path",path:null,cacheProperties:r.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:r.Object.prototype.stateProperties.concat("path"),initialize:function(d,c){delete(c=i(c||{})).path,this.callSuper("initialize",c),this._setPath(d||[],c)},_setPath:function(d,c){this.path=r.util.makePathSimpler(Array.isArray(d)?d:r.util.parsePath(d)),r.Polyline.prototype._setPositionDimensions.call(this,c||{})},_renderPathCommands:function(d){var c,u=0,m=0,_=0,E=0,T=0,C=0,b=-this.pathOffset.x,O=-this.pathOffset.y;d.beginPath();for(var j=0,U=this.path.length;j<U;++j)switch((c=this.path[j])[0]){case"L":_=c[1],E=c[2],d.lineTo(_+b,E+O);break;case"M":u=_=c[1],m=E=c[2],d.moveTo(_+b,E+O);break;case"C":_=c[5],E=c[6],T=c[3],C=c[4],d.bezierCurveTo(c[1]+b,c[2]+O,T+b,C+O,_+b,E+O);break;case"Q":d.quadraticCurveTo(c[1]+b,c[2]+O,c[3]+b,c[4]+O),_=c[3],E=c[4],T=c[1],C=c[2];break;case"z":case"Z":_=u,E=m,d.closePath()}},_render:function(d){this._renderPathCommands(d),this._renderPaintInOrder(d)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(d){return e(this.callSuper("toObject",d),{path:this.path.map(function(c){return c.slice()})})},toDatalessObject:function(d){var c=this.toObject(["sourcePath"].concat(d));return c.sourcePath&&delete c.path,c},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',r.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var d=r.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,d)+", "+o(-this.pathOffset.y,d)+")"},toClipPathSVG:function(d){var c=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:c})},toSVG:function(d){var c=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:c})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var d,c,u=[],m=[],_=0,E=0,T=0,C=0,b=0,O=this.path.length;b<O;++b){switch((d=this.path[b])[0]){case"L":T=d[1],C=d[2],c=[];break;case"M":_=T=d[1],E=C=d[2],c=[];break;case"C":c=r.util.getBoundsOfCurve(T,C,d[1],d[2],d[3],d[4],d[5],d[6]),T=d[5],C=d[6];break;case"Q":c=r.util.getBoundsOfCurve(T,C,d[1],d[2],d[1],d[2],d[3],d[4]),T=d[3],C=d[4];break;case"z":case"Z":T=_,C=E}c.forEach(function($){u.push($.x),m.push($.y)}),u.push(T),m.push(C)}var j=n(u)||0,U=n(m)||0;return{left:j,top:U,width:(l(u)||0)-j,height:(l(m)||0)-U}}}),r.Path.fromObject=function(d,c){if(typeof d.sourcePath=="string"){var u=d.sourcePath;r.loadSVGFromURL(u,function(m){var _=m[0];_.setOptions(d),c&&c(_)})}else r.Object._fromObject("Path",d,c,"path")},r.Path.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(["d"]),r.Path.fromElement=function(d,c,u){var m=r.parseAttributes(d,r.Path.ATTRIBUTE_NAMES);m.fromSVG=!0,c(new r.Path(m.d,e(m,u)))})}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.array.min,l=r.util.array.max;r.Group||(r.Group=r.util.createClass(r.Object,r.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,i,o){i=i||{},this._objects=[],o&&this.callSuper("initialize",i),this._objects=e||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(o)this._updateObjectsACoords();else{var c=i&&i.centerPoint;i.originX!==void 0&&(this.originX=i.originX),i.originY!==void 0&&(this.originY=i.originY),c||this._calcBounds(),this._updateObjectsCoords(c),delete i.centerPoint,this.callSuper("initialize",i)}this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0)},_updateObjectsCoords:function(e){e=e||this.getCenterPoint();for(var i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],e)},_updateObjectCoords:function(e,i){var o=e.left,d=e.top;e.set({left:o-i.x,top:d-i.y}),e.group=this,e.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){var i=!!this.group;return this._restoreObjectsState(),r.util.resetObjectTransform(this),e&&(i&&r.util.removeTransformFromObject(e,this.group.calcTransformMatrix()),this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,i?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(e){return this._restoreObjectsState(),r.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,i){var o=this._objects.length;if(this.useSetOnGroup)for(;o--;)this._objects[o].setOnGroup(e,i);if(e==="canvas")for(;o--;)this._objects[o]._set(e,i);r.Object.prototype._set.call(this,e,i)},toObject:function(e){var i=this.includeDefaultValues,o=this._objects.filter(function(c){return!c.excludeFromExport}).map(function(c){var u=c.includeDefaultValues;c.includeDefaultValues=i;var m=c.toObject(e);return c.includeDefaultValues=u,m}),d=r.Object.prototype.toObject.call(this,e);return d.objects=o,d},toDatalessObject:function(e){var i,o=this.sourcePath;if(o)i=o;else{var d=this.includeDefaultValues;i=this._objects.map(function(u){var m=u.includeDefaultValues;u.includeDefaultValues=d;var _=u.toDatalessObject(e);return u.includeDefaultValues=m,_})}var c=r.Object.prototype.toDatalessObject.call(this,e);return c.objects=i,c},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=r.Object.prototype.shouldCache.call(this);if(e){for(var i=0,o=this._objects.length;i<o;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1}return e},willDrawShadow:function(){if(r.Object.prototype.willDrawShadow.call(this))return!0;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var i=0,o=this._objects.length;i<o;i++)this._objects[i].render(e);this._drawClipPath(e,this.clipPath)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var i=0,o=this._objects.length;i<o;i++)if(this._objects[i].isCacheDirty(!0)){if(this._cacheCanvas){var d=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-c/2,d,c)}return!0}return!1},_restoreObjectsState:function(){var e=this.calcOwnMatrix();return this._objects.forEach(function(i){r.util.addTransformToObject(i,e),delete i.group,i.setCoords()}),this},destroy:function(){return this._objects.forEach(function(e){e.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(e){e.dispose&&e.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var e=this._objects,i=this.canvas;this._objects=[];var o=this.toObject();delete o.objects;var d=new r.ActiveSelection([]);return d.set(o),d.type="activeSelection",i.remove(this),e.forEach(function(c){c.group=d,c.dirty=!0,i.add(c)}),d.canvas=i,d._objects=e,i._activeObject=d,d.setCoords(),d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(e){e.setCoords(!0)}),this},_calcBounds:function(e){for(var i,o,d,c,u=[],m=[],_=["tr","br","bl","tl"],E=0,T=this._objects.length,C=_.length;E<T;++E){for(d=(i=this._objects[E]).calcACoords(),c=0;c<C;c++)o=_[c],u.push(d[o].x),m.push(d[o].y);i.aCoords=d}this._getBounds(u,m,e)},_getBounds:function(e,i,o){var d=new r.Point(n(e),n(i)),c=new r.Point(l(e),l(i)),u=d.y||0,m=d.x||0,_=c.x-d.x||0,E=c.y-d.y||0;this.width=_,this.height=E,o||this.setPositionByOrigin({x:m,y:u},"left","top")},_toSVG:function(e){for(var i=["<g ","COMMON_PARTS",` >
`],o=0,d=this._objects.length;o<d;o++)i.push("		",this._objects[o].toSVG(e));return i.push(`</g>
`),i},getSvgStyles:function(){var e=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",i=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),i].join("")},toClipPathSVG:function(e){for(var i=[],o=0,d=this._objects.length;o<d;o++)i.push("	",this._objects[o].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(i,{reviver:e})}}),r.Group.fromObject=function(e,i){var o=e.objects,d=r.util.object.clone(e,!0);delete d.objects,typeof o!="string"?r.util.enlivenObjects(o,function(c){var u=r.util.object.clone(e,!0);delete u.objects,r.util.enlivenObjectEnlivables(e,u,function(){i&&i(new r.Group(c,u,!0))})}):r.loadSVGFromURL(o,function(c){var u=r.util.groupSVGElements(c,e,o);u.set(d),i&&i(u)})})}(t),function(s){var r=s.fabric||(s.fabric={});r.ActiveSelection||(r.ActiveSelection=r.util.createClass(r.Group,{type:"activeSelection",initialize:function(n,l){l=l||{},this._objects=n||[];for(var e=this._objects.length;e--;)this._objects[e].group=this;l.originX&&(this.originX=l.originX),l.originY&&(this.originY=l.originY),this._calcBounds(),this._updateObjectsCoords(),r.Object.prototype.initialize.call(this,l),this.setCoords()},toGroup:function(){var n=this._objects.concat();this._objects=[];var l=r.Object.prototype.toObject.call(this),e=new r.Group([]);if(delete l.type,e.set(l),n.forEach(function(o){o.canvas.remove(o),o.group=e}),e._objects=n,!this.canvas)return e;var i=this.canvas;return i.add(e),i._activeObject=e,e.setCoords(),e},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(n,l,e){n.save(),n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",n,l),(e=e||{}).hasControls===void 0&&(e.hasControls=!1),e.forActiveSelection=!0;for(var i=0,o=this._objects.length;i<o;i++)this._objects[i]._renderControls(n,e);n.restore()}}),r.ActiveSelection.fromObject=function(n,l){r.util.enlivenObjects(n.objects,function(e){delete n.objects,l&&l(new r.ActiveSelection(e,n,!0))})})}(t),function(s){var r=p.util.object.extend;s.fabric||(s.fabric={}),s.fabric.Image?p.warn("fabric.Image is already defined."):(p.Image=p.util.createClass(p.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:p.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:p.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(n,l){l||(l={}),this.filters=[],this.cacheKey="texture"+p.Object.__uid++,this.callSuper("initialize",l),this._initElement(n,l)},getElement:function(){return this._element||{}},setElement:function(n,l){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=n,this._originalElement=n,this._initConfig(l),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(n){var l=p.filterBackend;l&&l.evictCachesForKey&&l.evictCachesForKey(n)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(n){p.util.cleanUpJsdomNode(this[n]),this[n]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var n=this.getElement();return{width:n.naturalWidth||n.width,height:n.naturalHeight||n.height}},_stroke:function(n){if(this.stroke&&this.strokeWidth!==0){var l=this.width/2,e=this.height/2;n.beginPath(),n.moveTo(-l,-e),n.lineTo(l,-e),n.lineTo(l,e),n.lineTo(-l,e),n.lineTo(-l,-e),n.closePath()}},toObject:function(n){var l=[];this.filters.forEach(function(i){i&&l.push(i.toObject())});var e=r(this.callSuper("toObject",["cropX","cropY"].concat(n)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:l});return this.resizeFilter&&(e.resizeFilter=this.resizeFilter.toObject()),e},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var n,l=[],e=[],i=this._element,o=-this.width/2,d=-this.height/2,c="",u="";if(!i)return[];if(this.hasCrop()){var m=p.Object.__uid++;l.push('<clipPath id="imageCrop_'+m+`">
`,'	<rect x="'+o+'" y="'+d+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+m+')" '}if(this.imageSmoothing||(u='" image-rendering="optimizeSpeed'),e.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',o-this.cropX,'" y="',d-this.cropY,'" width="',i.width||i.naturalWidth,'" height="',i.height||i.height,u,'"',c,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,n=["	<rect ",'x="',o,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?l.concat(n,e):l.concat(e,n)},getSrc:function(n){var l=n?this._element:this._originalElement;return l?l.toDataURL?l.toDataURL():this.srcFromAttribute?l.getAttribute("src"):l.src:this.src||""},setSrc:function(n,l,e){return p.util.loadImage(n,function(i,o){this.setElement(i,e),this._setWidthHeight(),l&&l(this,o)},this,e&&e.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var n=this.resizeFilter,l=this.minimumScaleTrigger,e=this.getTotalObjectScaling(),i=e.scaleX,o=e.scaleY,d=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!n||i>l&&o>l)return this._element=d,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=o);p.filterBackend||(p.filterBackend=p.initFilterBackend());var c=p.util.createCanvasElement(),u=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,m=d.width,_=d.height;c.width=m,c.height=_,this._element=c,this._lastScaleX=n.scaleX=i,this._lastScaleY=n.scaleY=o,p.filterBackend.applyFilters([n],d,m,_,this._element,u),this._filterScalingX=c.width/this._originalElement.width,this._filterScalingY=c.height/this._originalElement.height},applyFilters:function(n){if(n=(n=n||this.filters||[]).filter(function(d){return d&&!d.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),n.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var l=this._originalElement,e=l.naturalWidth||l.width,i=l.naturalHeight||l.height;if(this._element===this._originalElement){var o=p.util.createCanvasElement();o.width=e,o.height=i,this._element=o,this._filteredEl=o}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,e,i),this._lastScaleX=1,this._lastScaleY=1;return p.filterBackend||(p.filterBackend=p.initFilterBackend()),p.filterBackend.applyFilters(n,this._originalElement,e,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(n){p.util.setImageSmoothing(n,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(n),this._renderPaintInOrder(n)},drawCacheOnCanvas:function(n){p.util.setImageSmoothing(n,this.imageSmoothing),p.Object.prototype.drawCacheOnCanvas.call(this,n)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(n){var l=this._element;if(l){var e=this._filterScalingX,i=this._filterScalingY,o=this.width,d=this.height,c=Math.min,u=Math.max,m=u(this.cropX,0),_=u(this.cropY,0),E=l.naturalWidth||l.width,T=l.naturalHeight||l.height,C=m*e,b=_*i,O=c(o*e,E-C),j=c(d*i,T-b),U=-o/2,$=-d/2,z=c(o,E/e-m),H=c(d,T/i-_);l&&n.drawImage(l,C,b,O,j,U,$,z,H)}},_needsResize:function(){var n=this.getTotalObjectScaling();return n.scaleX!==this._lastScaleX||n.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(n,l){this.setElement(p.util.getById(n),l),p.util.addClass(this.getElement(),p.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={}),this.setOptions(n),this._setWidthHeight(n)},_initFilters:function(n,l){n&&n.length?p.util.enlivenObjects(n,function(e){l&&l(e)},"fabric.Image.filters"):l&&l()},_setWidthHeight:function(n){n||(n={});var l=this.getElement();this.width=n.width||l.naturalWidth||l.width||0,this.height=n.height||l.naturalHeight||l.height||0},parsePreserveAspectRatioAttribute:function(){var n,l=p.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),e=this._element.width,i=this._element.height,o=1,d=1,c=0,u=0,m=0,_=0,E=this.width,T=this.height,C={width:E,height:T};return!l||l.alignX==="none"&&l.alignY==="none"?(o=E/e,d=T/i):(l.meetOrSlice==="meet"&&(n=(E-e*(o=d=p.util.findScaleToFit(this._element,C)))/2,l.alignX==="Min"&&(c=-n),l.alignX==="Max"&&(c=n),n=(T-i*d)/2,l.alignY==="Min"&&(u=-n),l.alignY==="Max"&&(u=n)),l.meetOrSlice==="slice"&&(n=e-E/(o=d=p.util.findScaleToCover(this._element,C)),l.alignX==="Mid"&&(m=n/2),l.alignX==="Max"&&(m=n),n=i-T/d,l.alignY==="Mid"&&(_=n/2),l.alignY==="Max"&&(_=n),e=E/o,i=T/d)),{width:e,height:i,scaleX:o,scaleY:d,offsetLeft:c,offsetTop:u,cropX:m,cropY:_}}}),p.Image.CSS_CANVAS="canvas-img",p.Image.prototype.getSvgSrc=p.Image.prototype.getSrc,p.Image.fromObject=function(n,l){var e=p.util.object.clone(n);p.util.loadImage(e.src,function(i,o){o?l&&l(null,!0):p.Image.prototype._initFilters.call(e,e.filters,function(d){e.filters=d||[],p.Image.prototype._initFilters.call(e,[e.resizeFilter],function(c){e.resizeFilter=c[0],p.util.enlivenObjectEnlivables(e,e,function(){var u=new p.Image(i,e);l(u,!1)})})})},null,e.crossOrigin)},p.Image.fromURL=function(n,l,e){p.util.loadImage(n,function(i,o){l&&l(new p.Image(i,e),o)},null,e&&e.crossOrigin)},p.Image.ATTRIBUTE_NAMES=p.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),p.Image.fromElement=function(n,l,e){var i=p.parseAttributes(n,p.Image.ATTRIBUTE_NAMES);p.Image.fromURL(i["xlink:href"],l,r(e?p.util.object.clone(e):{},i))})}(t),p.util.object.extend(p.Object.prototype,{_getAngleValueForStraighten:function(){var s=this.angle%360;return s>0?90*Math.round((s-1)/90):90*Math.round(s/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(s){var r=function(){},n=(s=s||{}).onComplete||r,l=s.onChange||r,e=this;return p.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(i){e.rotate(i),l()},onComplete:function(){e.setCoords(),n()}})}}),p.util.object.extend(p.StaticCanvas.prototype,{straightenObject:function(s){return s.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(s){return s.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function s(n,l){var e="precision "+l+` float;
void main(){}`,i=n.createShader(n.FRAGMENT_SHADER);return n.shaderSource(i,e),n.compileShader(i),!!n.getShaderParameter(i,n.COMPILE_STATUS)}function r(n){n&&n.tileSize&&(this.tileSize=n.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}p.isWebglSupported=function(n){if(p.isLikelyNode)return!1;n=n||p.WebglFilterBackend.prototype.tileSize;var l=document.createElement("canvas"),e=l.getContext("webgl")||l.getContext("experimental-webgl"),i=!1;if(e){p.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),i=p.maxTextureSize>=n;for(var o=["highp","mediump","lowp"],d=0;d<3;d++)if(s(e,o[d])){p.webGlPrecision=o[d];break}}return this.isSupported=i,i},p.WebglFilterBackend=r,r.prototype={tileSize:2048,resources:{},setupGLContext:function(n,l){this.dispose(),this.createWebGLCanvas(n,l),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(n,l)},chooseFastestCopyGLTo2DMethod:function(n,l){var e,i=window.performance!==void 0;try{new ImageData(1,1),e=!0}catch{e=!1}var o=typeof ArrayBuffer<"u",d=typeof Uint8ClampedArray<"u";if(i&&e&&o&&d){var c=p.util.createCanvasElement(),u=new ArrayBuffer(n*l*4);if(p.forceGLPutImageData)return this.imageBuffer=u,void(this.copyGLTo2D=ue);var m,_,E={imageBuffer:u,destinationWidth:n,destinationHeight:l,targetCanvas:c};c.width=n,c.height=l,m=window.performance.now(),Te.call(E,this.gl,E),_=window.performance.now()-m,m=window.performance.now(),ue.call(E,this.gl,E),_>window.performance.now()-m?(this.imageBuffer=u,this.copyGLTo2D=ue):this.copyGLTo2D=Te}},createWebGLCanvas:function(n,l){var e=p.util.createCanvasElement();e.width=n,e.height=l;var i={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},o=e.getContext("webgl",i);o||(o=e.getContext("experimental-webgl",i)),o&&(o.clearColor(0,0,0,0),this.canvas=e,this.gl=o)},applyFilters:function(n,l,e,i,o,d){var c,u=this.gl;d&&(c=this.getCachedTexture(d,l));var m={originalWidth:l.width||l.originalWidth,originalHeight:l.height||l.originalHeight,sourceWidth:e,sourceHeight:i,destinationWidth:e,destinationHeight:i,context:u,sourceTexture:this.createTexture(u,e,i,!c&&l),targetTexture:this.createTexture(u,e,i),originalTexture:c||this.createTexture(u,e,i,!c&&l),passes:n.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:o},_=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,_),n.forEach(function(E){E&&E.applyTo(m)}),function(E){var T=E.targetCanvas,C=T.width,b=T.height,O=E.destinationWidth,j=E.destinationHeight;C===O&&b===j||(T.width=O,T.height=j)}(m),this.copyGLTo2D(u,m),u.bindTexture(u.TEXTURE_2D,null),u.deleteTexture(m.sourceTexture),u.deleteTexture(m.targetTexture),u.deleteFramebuffer(_),o.getContext("2d").setTransform(1,0,0,1,0,0),m},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(n,l,e,i){var o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,l,e,0,n.RGBA,n.UNSIGNED_BYTE,null),o},getCachedTexture:function(n,l){if(this.textureCache[n])return this.textureCache[n];var e=this.createTexture(this.gl,l.width,l.height,l);return this.textureCache[n]=e,e},evictCachesForKey:function(n){this.textureCache[n]&&(this.gl.deleteTexture(this.textureCache[n]),delete this.textureCache[n])},copyGLTo2D:Te,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var n=this.gl,l={renderer:"",vendor:""};if(!n)return l;var e=n.getExtension("WEBGL_debug_renderer_info");if(e){var i=n.getParameter(e.UNMASKED_RENDERER_WEBGL),o=n.getParameter(e.UNMASKED_VENDOR_WEBGL);i&&(l.renderer=i.toLowerCase()),o&&(l.vendor=o.toLowerCase())}return this.gpuInfo=l,l}}}(),function(){var s=function(){};function r(){}p.Canvas2dFilterBackend=r,r.prototype={evictCachesForKey:s,dispose:s,clearWebGLCaches:s,resources:{},applyFilters:function(n,l,e,i,o){var d=o.getContext("2d");d.drawImage(l,0,0,e,i);var c={sourceWidth:e,sourceHeight:i,imageData:d.getImageData(0,0,e,i),originalEl:l,originalImageData:d.getImageData(0,0,e,i),canvasEl:o,ctx:d,filterBackend:this};return n.forEach(function(u){u.applyTo(c)}),c.imageData.width===e&&c.imageData.height===i||(o.width=c.imageData.width,o.height=c.imageData.height),d.putImageData(c.imageData,0,0),c}}}(),p.Image=p.Image||{},p.Image.filters=p.Image.filters||{},p.Image.filters.BaseFilter=p.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(s){s&&this.setOptions(s)},setOptions:function(s){for(var r in s)this[r]=s[r]},createProgram:function(s,r,n){r=r||this.fragmentSource,n=n||this.vertexSource,p.webGlPrecision!=="highp"&&(r=r.replace(/precision highp float/g,"precision "+p.webGlPrecision+" float"));var l=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(l,n),s.compileShader(l),!s.getShaderParameter(l,s.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+s.getShaderInfoLog(l));var e=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(e,r),s.compileShader(e),!s.getShaderParameter(e,s.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+s.getShaderInfoLog(e));var i=s.createProgram();if(s.attachShader(i,l),s.attachShader(i,e),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+s.getProgramInfoLog(i));var o=this.getAttributeLocations(s,i),d=this.getUniformLocations(s,i)||{};return d.uStepW=s.getUniformLocation(i,"uStepW"),d.uStepH=s.getUniformLocation(i,"uStepH"),{program:i,attributeLocations:o,uniformLocations:d}},getAttributeLocations:function(s,r){return{aPosition:s.getAttribLocation(r,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(s,r,n){var l=r.aPosition,e=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,e),s.enableVertexAttribArray(l),s.vertexAttribPointer(l,2,s.FLOAT,!1,0,0),s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW)},_setupFrameBuffer:function(s){var r,n,l=s.context;s.passes>1?(r=s.destinationWidth,n=s.destinationHeight,s.sourceWidth===r&&s.sourceHeight===n||(l.deleteTexture(s.targetTexture),s.targetTexture=s.filterBackend.createTexture(l,r,n)),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,s.targetTexture,0)):(l.bindFramebuffer(l.FRAMEBUFFER,null),l.finish())},_swapTextures:function(s){s.passes--,s.pass++;var r=s.targetTexture;s.targetTexture=s.sourceTexture,s.sourceTexture=r},isNeutralState:function(){var s=this.mainParameter,r=p.Image.filters[this.type].prototype;if(s){if(Array.isArray(r[s])){for(var n=r[s].length;n--;)if(this[s][n]!==r[s][n])return!1;return!0}return r[s]===this[s]}return!1},applyTo:function(s){s.webgl?(this._setupFrameBuffer(s),this.applyToWebGL(s),this._swapTextures(s)):this.applyTo2d(s)},retrieveShader:function(s){return s.programCache.hasOwnProperty(this.type)||(s.programCache[this.type]=this.createProgram(s.context)),s.programCache[this.type]},applyToWebGL:function(s){var r=s.context,n=this.retrieveShader(s);s.pass===0&&s.originalTexture?r.bindTexture(r.TEXTURE_2D,s.originalTexture):r.bindTexture(r.TEXTURE_2D,s.sourceTexture),r.useProgram(n.program),this.sendAttributeData(r,n.attributeLocations,s.aPosition),r.uniform1f(n.uniformLocations.uStepW,1/s.sourceWidth),r.uniform1f(n.uniformLocations.uStepH,1/s.sourceHeight),this.sendUniformData(r,n.uniformLocations),r.viewport(0,0,s.destinationWidth,s.destinationHeight),r.drawArrays(r.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(s,r,n){s.activeTexture(n),s.bindTexture(s.TEXTURE_2D,r),s.activeTexture(s.TEXTURE0)},unbindAdditionalTexture:function(s,r){s.activeTexture(r),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(s){this[this.mainParameter]=s},sendUniformData:function(){},createHelpLayer:function(s){if(!s.helpLayer){var r=document.createElement("canvas");r.width=s.sourceWidth,r.height=s.sourceHeight,s.helpLayer=r}},toObject:function(){var s={type:this.type},r=this.mainParameter;return r&&(s[r]=this[r]),s},toJSON:function(){return this.toObject()}}),p.Image.filters.BaseFilter.fromObject=function(s,r){var n=new p.Image.filters[s.type](s);return r&&r(n),n},function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.ColorMatrix=l(n.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var i,o,d,c,u,m=e.imageData.data,_=m.length,E=this.matrix,T=this.colorsOnly;for(u=0;u<_;u+=4)i=m[u],o=m[u+1],d=m[u+2],T?(m[u]=i*E[0]+o*E[1]+d*E[2]+255*E[4],m[u+1]=i*E[5]+o*E[6]+d*E[7]+255*E[9],m[u+2]=i*E[10]+o*E[11]+d*E[12]+255*E[14]):(c=m[u+3],m[u]=i*E[0]+o*E[1]+d*E[2]+c*E[3]+255*E[4],m[u+1]=i*E[5]+o*E[6]+d*E[7]+c*E[8]+255*E[9],m[u+2]=i*E[10]+o*E[11]+d*E[12]+c*E[13]+255*E[14],m[u+3]=i*E[15]+o*E[16]+d*E[17]+c*E[18]+255*E[19])},getUniformLocations:function(e,i){return{uColorMatrix:e.getUniformLocation(i,"uColorMatrix"),uConstants:e.getUniformLocation(i,"uConstants")}},sendUniformData:function(e,i){var o=this.matrix,d=[o[0],o[1],o[2],o[3],o[5],o[6],o[7],o[8],o[10],o[11],o[12],o[13],o[15],o[16],o[17],o[18]],c=[o[4],o[9],o[14],o[19]];e.uniformMatrix4fv(i.uColorMatrix,!1,d),e.uniform4fv(i.uConstants,c)}}),r.Image.filters.ColorMatrix.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Brightness=l(n.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(this.brightness!==0){var i,o=e.imageData.data,d=o.length,c=Math.round(255*this.brightness);for(i=0;i<d;i+=4)o[i]=o[i]+c,o[i+1]=o[i+1]+c,o[i+2]=o[i+2]+c}},getUniformLocations:function(e,i){return{uBrightness:e.getUniformLocation(i,"uBrightness")}},sendUniformData:function(e,i){e.uniform1f(i.uBrightness,this.brightness)}}),r.Image.filters.Brightness.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.Image.filters,e=r.util.createClass;l.Convolute=e(l.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(i){var o=Math.sqrt(this.matrix.length),d=this.type+"_"+o+"_"+(this.opaque?1:0),c=this.fragmentSource[d];return i.programCache.hasOwnProperty(d)||(i.programCache[d]=this.createProgram(i.context,c)),i.programCache[d]},applyTo2d:function(i){var o,d,c,u,m,_,E,T,C,b,O,j,U,$=i.imageData,z=$.data,H=this.matrix,M=Math.round(Math.sqrt(H.length)),D=Math.floor(M/2),G=$.width,q=$.height,J=i.ctx.createImageData(G,q),B=J.data,F=this.opaque?1:0;for(O=0;O<q;O++)for(b=0;b<G;b++){for(m=4*(O*G+b),o=0,d=0,c=0,u=0,U=0;U<M;U++)for(j=0;j<M;j++)_=b+j-D,(E=O+U-D)<0||E>=q||_<0||_>=G||(T=4*(E*G+_),C=H[U*M+j],o+=z[T]*C,d+=z[T+1]*C,c+=z[T+2]*C,F||(u+=z[T+3]*C));B[m]=o,B[m+1]=d,B[m+2]=c,B[m+3]=F?z[m+3]:u}i.imageData=J},getUniformLocations:function(i,o){return{uMatrix:i.getUniformLocation(o,"uMatrix"),uOpaque:i.getUniformLocation(o,"uOpaque"),uHalfSize:i.getUniformLocation(o,"uHalfSize"),uSize:i.getUniformLocation(o,"uSize")}},sendUniformData:function(i,o){i.uniform1fv(o.uMatrix,this.matrix)},toObject:function(){return n(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),r.Image.filters.Convolute.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Grayscale=l(n.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(e){var i,o,d=e.imageData.data,c=d.length,u=this.mode;for(i=0;i<c;i+=4)u==="average"?o=(d[i]+d[i+1]+d[i+2])/3:u==="lightness"?o=(Math.min(d[i],d[i+1],d[i+2])+Math.max(d[i],d[i+1],d[i+2]))/2:u==="luminosity"&&(o=.21*d[i]+.72*d[i+1]+.07*d[i+2]),d[i]=o,d[i+1]=o,d[i+2]=o},retrieveShader:function(e){var i=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(i)){var o=this.fragmentSource[this.mode];e.programCache[i]=this.createProgram(e.context,o)}return e.programCache[i]},getUniformLocations:function(e,i){return{uMode:e.getUniformLocation(i,"uMode")}},sendUniformData:function(e,i){e.uniform1i(i.uMode,1)},isNeutralState:function(){return!1}}),r.Image.filters.Grayscale.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Invert=l(n.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(e){var i,o=e.imageData.data,d=o.length;for(i=0;i<d;i+=4)o[i]=255-o[i],o[i+1]=255-o[i+1],o[i+2]=255-o[i+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,i){return{uInvert:e.getUniformLocation(i,"uInvert")}},sendUniformData:function(e,i){e.uniform1i(i.uInvert,this.invert)}}),r.Image.filters.Invert.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.Image.filters,e=r.util.createClass;l.Noise=e(l.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(i){if(this.noise!==0){var o,d,c=i.imageData.data,u=c.length,m=this.noise;for(o=0,u=c.length;o<u;o+=4)d=(.5-Math.random())*m,c[o]+=d,c[o+1]+=d,c[o+2]+=d}},getUniformLocations:function(i,o){return{uNoise:i.getUniformLocation(o,"uNoise"),uSeed:i.getUniformLocation(o,"uSeed")}},sendUniformData:function(i,o){i.uniform1f(o.uNoise,this.noise/255),i.uniform1f(o.uSeed,Math.random())},toObject:function(){return n(this.callSuper("toObject"),{noise:this.noise})}}),r.Image.filters.Noise.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Pixelate=l(n.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(e){var i,o,d,c,u,m,_,E,T,C,b,O=e.imageData,j=O.data,U=O.height,$=O.width;for(o=0;o<U;o+=this.blocksize)for(d=0;d<$;d+=this.blocksize)for(c=j[i=4*o*$+4*d],u=j[i+1],m=j[i+2],_=j[i+3],C=Math.min(o+this.blocksize,U),b=Math.min(d+this.blocksize,$),E=o;E<C;E++)for(T=d;T<b;T++)j[i=4*E*$+4*T]=c,j[i+1]=u,j[i+2]=m,j[i+3]=_},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(e,i){return{uBlocksize:e.getUniformLocation(i,"uBlocksize"),uStepW:e.getUniformLocation(i,"uStepW"),uStepH:e.getUniformLocation(i,"uStepH")}},sendUniformData:function(e,i){e.uniform1f(i.uBlocksize,this.blocksize)}}),r.Image.filters.Pixelate.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.extend,l=r.Image.filters,e=r.util.createClass;l.RemoveColor=e(l.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(i){var o,d,c,u,m=i.imageData.data,_=255*this.distance,E=new r.Color(this.color).getSource(),T=[E[0]-_,E[1]-_,E[2]-_],C=[E[0]+_,E[1]+_,E[2]+_];for(o=0;o<m.length;o+=4)d=m[o],c=m[o+1],u=m[o+2],d>T[0]&&c>T[1]&&u>T[2]&&d<C[0]&&c<C[1]&&u<C[2]&&(m[o+3]=0)},getUniformLocations:function(i,o){return{uLow:i.getUniformLocation(o,"uLow"),uHigh:i.getUniformLocation(o,"uHigh")}},sendUniformData:function(i,o){var d=new r.Color(this.color).getSource(),c=parseFloat(this.distance),u=[0+d[0]/255-c,0+d[1]/255-c,0+d[2]/255-c,1],m=[d[0]/255+c,d[1]/255+c,d[2]/255+c,1];i.uniform4fv(o.uLow,u),i.uniform4fv(o.uHigh,m)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),r.Image.filters.RemoveColor.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass,e={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var i in e)n[i]=l(n.ColorMatrix,{type:i,matrix:e[i],mainParameter:!1,colorsOnly:!0}),r.Image.filters[i].fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric,n=r.Image.filters,l=r.util.createClass;n.BlendColor=l(n.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(e){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[e]+`}
}`},retrieveShader:function(e){var i,o=this.type+"_"+this.mode;return e.programCache.hasOwnProperty(o)||(i=this.buildSource(this.mode),e.programCache[o]=this.createProgram(e.context,i)),e.programCache[o]},applyTo2d:function(e){var i,o,d,c,u,m,_,E=e.imageData.data,T=E.length,C=1-this.alpha;i=(_=new r.Color(this.color).getSource())[0]*this.alpha,o=_[1]*this.alpha,d=_[2]*this.alpha;for(var b=0;b<T;b+=4)switch(c=E[b],u=E[b+1],m=E[b+2],this.mode){case"multiply":E[b]=c*i/255,E[b+1]=u*o/255,E[b+2]=m*d/255;break;case"screen":E[b]=255-(255-c)*(255-i)/255,E[b+1]=255-(255-u)*(255-o)/255,E[b+2]=255-(255-m)*(255-d)/255;break;case"add":E[b]=c+i,E[b+1]=u+o,E[b+2]=m+d;break;case"diff":case"difference":E[b]=Math.abs(c-i),E[b+1]=Math.abs(u-o),E[b+2]=Math.abs(m-d);break;case"subtract":E[b]=c-i,E[b+1]=u-o,E[b+2]=m-d;break;case"darken":E[b]=Math.min(c,i),E[b+1]=Math.min(u,o),E[b+2]=Math.min(m,d);break;case"lighten":E[b]=Math.max(c,i),E[b+1]=Math.max(u,o),E[b+2]=Math.max(m,d);break;case"overlay":E[b]=i<128?2*c*i/255:255-2*(255-c)*(255-i)/255,E[b+1]=o<128?2*u*o/255:255-2*(255-u)*(255-o)/255,E[b+2]=d<128?2*m*d/255:255-2*(255-m)*(255-d)/255;break;case"exclusion":E[b]=i+c-2*i*c/255,E[b+1]=o+u-2*o*u/255,E[b+2]=d+m-2*d*m/255;break;case"tint":E[b]=i+c*C,E[b+1]=o+u*C,E[b+2]=d+m*C}},getUniformLocations:function(e,i){return{uColor:e.getUniformLocation(i,"uColor")}},sendUniformData:function(e,i){var o=new r.Color(this.color).getSource();o[0]=this.alpha*o[0]/255,o[1]=this.alpha*o[1]/255,o[2]=this.alpha*o[2]/255,o[3]=this.alpha,e.uniform4fv(i.uColor,o)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendColor.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric,n=r.Image.filters,l=r.util.createClass;n.BlendImage=l(n.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(e){var i=this.type+"_"+this.mode,o=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(i)||(e.programCache[i]=this.createProgram(e.context,o)),e.programCache[i]},applyToWebGL:function(e){var i=e.context,o=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(i,o,i.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(i,i.TEXTURE1)},createTexture:function(e,i){return e.getCachedTexture(i.cacheKey,i._element)},calculateMatrix:function(){var e=this.image,i=e._element.width,o=e._element.height;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/i,-e.top/o,1]},applyTo2d:function(e){var i,o,d,c,u,m,_,E,T,C,b,O=e.imageData,j=e.filterBackend.resources,U=O.data,$=U.length,z=O.width,H=O.height,M=this.image;j.blendImage||(j.blendImage=r.util.createCanvasElement()),C=(T=j.blendImage).getContext("2d"),T.width!==z||T.height!==H?(T.width=z,T.height=H):C.clearRect(0,0,z,H),C.setTransform(M.scaleX,0,0,M.scaleY,M.left,M.top),C.drawImage(M._element,0,0,z,H),b=C.getImageData(0,0,z,H).data;for(var D=0;D<$;D+=4)switch(u=U[D],m=U[D+1],_=U[D+2],E=U[D+3],i=b[D],o=b[D+1],d=b[D+2],c=b[D+3],this.mode){case"multiply":U[D]=u*i/255,U[D+1]=m*o/255,U[D+2]=_*d/255,U[D+3]=E*c/255;break;case"mask":U[D+3]=c}},getUniformLocations:function(e,i){return{uTransformMatrix:e.getUniformLocation(i,"uTransformMatrix"),uImage:e.getUniformLocation(i,"uImage")}},sendUniformData:function(e,i){var o=this.calculateMatrix();e.uniform1i(i.uImage,1),e.uniformMatrix3fv(i.uTransformMatrix,!1,o)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendImage.fromObject=function(e,i){r.Image.fromObject(e.image,function(o){var d=r.util.object.clone(e);d.image=o,i(new r.Image.filters.BlendImage(d))})}}(t),function(s){var r=s.fabric||(s.fabric={}),n=Math.pow,l=Math.floor,e=Math.sqrt,i=Math.abs,o=Math.round,d=Math.sin,c=Math.ceil,u=r.Image.filters,m=r.util.createClass;u.Resize=m(u.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,E){return{uDelta:_.getUniformLocation(E,"uDelta"),uTaps:_.getUniformLocation(E,"uTaps")}},sendUniformData:function(_,E){_.uniform2fv(E.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(E.uTaps,this.taps)},retrieveShader:function(_){var E=this.getFilterWindow(),T=this.type+"_"+E;if(!_.programCache.hasOwnProperty(T)){var C=this.generateShader(E);_.programCache[T]=this.createProgram(_.context,C)}return _.programCache[T]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),E=this.tempScale,T=this.getFilterWindow(),C=new Array(T),b=1;b<=T;b++)C[b-1]=_(b*E);return C},generateShader:function(_){for(var E=new Array(_),T=this.fragmentSourceTOP,C=1;C<=_;C++)E[C-1]=C+".0 * uDelta";return T+="uniform float uTaps["+_+`];
`,T+=`void main() {
`,T+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,T+=`  float sum = 1.0;
`,E.forEach(function(b,O){T+="  color += texture2D(uTexture, vTexCoord + "+b+") * uTaps["+O+`];
`,T+="  color += texture2D(uTexture, vTexCoord - "+b+") * uTaps["+O+`];
`,T+="  sum += 2.0 * uTaps["+O+`];
`}),T+=`  gl_FragColor = color / sum;
`,T+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(E){if(E>=_||E<=-_)return 0;if(E<11920929e-14&&E>-11920929e-14)return 1;var T=(E*=Math.PI)/_;return d(E)/E*d(T)/T}},applyTo2d:function(_){var E=_.imageData,T=this.scaleX,C=this.scaleY;this.rcpScaleX=1/T,this.rcpScaleY=1/C;var b,O=E.width,j=E.height,U=o(O*T),$=o(j*C);this.resizeType==="sliceHack"?b=this.sliceByTwo(_,O,j,U,$):this.resizeType==="hermite"?b=this.hermiteFastResize(_,O,j,U,$):this.resizeType==="bilinear"?b=this.bilinearFiltering(_,O,j,U,$):this.resizeType==="lanczos"&&(b=this.lanczosResize(_,O,j,U,$)),_.imageData=b},sliceByTwo:function(_,E,T,C,b){var O,j,U=_.imageData,$=.5,z=!1,H=!1,M=E*$,D=T*$,G=r.filterBackend.resources,q=0,J=0,B=E,F=0;for(G.sliceByTwo||(G.sliceByTwo=document.createElement("canvas")),((O=G.sliceByTwo).width<1.5*E||O.height<T)&&(O.width=1.5*E,O.height=T),(j=O.getContext("2d")).clearRect(0,0,1.5*E,T),j.putImageData(U,0,0),C=l(C),b=l(b);!z||!H;)E=M,T=D,C<l(M*$)?M=l(M*$):(M=C,z=!0),b<l(D*$)?D=l(D*$):(D=b,H=!0),j.drawImage(O,q,J,E,T,B,F,M,D),q=B,J=F,F+=D;return j.getImageData(q,J,C,b)},lanczosResize:function(_,E,T,C,b){var O=_.imageData.data,j=_.ctx.createImageData(C,b),U=j.data,$=this.lanczosCreate(this.lanczosLobes),z=this.rcpScaleX,H=this.rcpScaleY,M=2/this.rcpScaleX,D=2/this.rcpScaleY,G=c(z*this.lanczosLobes/2),q=c(H*this.lanczosLobes/2),J={},B={},F={};return function Y(Q){var Z,te,ae,ne,ie,oe,se,he,_e,le,Oe;for(B.x=(Q+.5)*z,F.x=l(B.x),Z=0;Z<b;Z++){for(B.y=(Z+.5)*H,F.y=l(B.y),ie=0,oe=0,se=0,he=0,_e=0,te=F.x-G;te<=F.x+G;te++)if(!(te<0||te>=E)){le=l(1e3*i(te-B.x)),J[le]||(J[le]={});for(var Ue=F.y-q;Ue<=F.y+q;Ue++)Ue<0||Ue>=T||(Oe=l(1e3*i(Ue-B.y)),J[le][Oe]||(J[le][Oe]=$(e(n(le*M,2)+n(Oe*D,2))/1e3)),(ae=J[le][Oe])>0&&(ie+=ae,oe+=ae*O[ne=4*(Ue*E+te)],se+=ae*O[ne+1],he+=ae*O[ne+2],_e+=ae*O[ne+3]))}U[ne=4*(Z*C+Q)]=oe/ie,U[ne+1]=se/ie,U[ne+2]=he/ie,U[ne+3]=_e/ie}return++Q<C?Y(Q):j}(0)},bilinearFiltering:function(_,E,T,C,b){var O,j,U,$,z,H,M,D,G,q=0,J=this.rcpScaleX,B=this.rcpScaleY,F=4*(E-1),Y=_.imageData.data,Q=_.ctx.createImageData(C,b),Z=Q.data;for(U=0;U<b;U++)for($=0;$<C;$++)for(z=J*$-(O=l(J*$)),H=B*U-(j=l(B*U)),G=4*(j*E+O),M=0;M<4;M++)D=Y[G+M]*(1-z)*(1-H)+Y[G+4+M]*z*(1-H)+Y[G+F+M]*H*(1-z)+Y[G+F+4+M]*z*H,Z[q++]=D;return Q},hermiteFastResize:function(_,E,T,C,b){for(var O=this.rcpScaleX,j=this.rcpScaleY,U=c(O/2),$=c(j/2),z=_.imageData.data,H=_.ctx.createImageData(C,b),M=H.data,D=0;D<b;D++)for(var G=0;G<C;G++){for(var q=4*(G+D*C),J=0,B=0,F=0,Y=0,Q=0,Z=0,te=0,ae=(D+.5)*j,ne=l(D*j);ne<(D+1)*j;ne++)for(var ie=i(ae-(ne+.5))/$,oe=(G+.5)*O,se=ie*ie,he=l(G*O);he<(G+1)*O;he++){var _e=i(oe-(he+.5))/U,le=e(se+_e*_e);le>1&&le<-1||(J=2*le*le*le-3*le*le+1)>0&&(te+=J*z[3+(_e=4*(he+ne*E))],F+=J,z[_e+3]<255&&(J=J*z[_e+3]/250),Y+=J*z[_e],Q+=J*z[_e+1],Z+=J*z[_e+2],B+=J)}M[q]=Y/B,M[q+1]=Q/B,M[q+2]=Z/B,M[q+3]=te/F}return H},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),r.Image.filters.Resize.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Contrast=l(n.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(this.contrast!==0){var i,o=e.imageData.data,d=o.length,c=Math.floor(255*this.contrast),u=259*(c+255)/(255*(259-c));for(i=0;i<d;i+=4)o[i]=u*(o[i]-128)+128,o[i+1]=u*(o[i+1]-128)+128,o[i+2]=u*(o[i+2]-128)+128}},getUniformLocations:function(e,i){return{uContrast:e.getUniformLocation(i,"uContrast")}},sendUniformData:function(e,i){e.uniform1f(i.uContrast,this.contrast)}}),r.Image.filters.Contrast.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Saturation=l(n.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(this.saturation!==0){var i,o,d=e.imageData.data,c=d.length,u=-this.saturation;for(i=0;i<c;i+=4)o=Math.max(d[i],d[i+1],d[i+2]),d[i]+=o!==d[i]?(o-d[i])*u:0,d[i+1]+=o!==d[i+1]?(o-d[i+1])*u:0,d[i+2]+=o!==d[i+2]?(o-d[i+2])*u:0}},getUniformLocations:function(e,i){return{uSaturation:e.getUniformLocation(i,"uSaturation")}},sendUniformData:function(e,i){e.uniform1f(i.uSaturation,-this.saturation)}}),r.Image.filters.Saturation.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Vibrance=l(n.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(e){if(this.vibrance!==0){var i,o,d,c,u=e.imageData.data,m=u.length,_=-this.vibrance;for(i=0;i<m;i+=4)o=Math.max(u[i],u[i+1],u[i+2]),d=(u[i]+u[i+1]+u[i+2])/3,c=2*Math.abs(o-d)/255*_,u[i]+=o!==u[i]?(o-u[i])*c:0,u[i+1]+=o!==u[i+1]?(o-u[i+1])*c:0,u[i+2]+=o!==u[i+2]?(o-u[i+2])*c:0}},getUniformLocations:function(e,i){return{uVibrance:e.getUniformLocation(i,"uVibrance")}},sendUniformData:function(e,i){e.uniform1f(i.uVibrance,-this.vibrance)}}),r.Image.filters.Vibrance.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Blur=l(n.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var i,o,d=e.filterBackend.resources,c=e.imageData.width,u=e.imageData.height;d.blurLayer1||(d.blurLayer1=r.util.createCanvasElement(),d.blurLayer2=r.util.createCanvasElement()),i=d.blurLayer1,o=d.blurLayer2,i.width===c&&i.height===u||(o.width=i.width=c,o.height=i.height=u);var m,_,E,T,C=i.getContext("2d"),b=o.getContext("2d"),O=.06*this.blur*.5;for(C.putImageData(e.imageData,0,0),b.clearRect(0,0,c,u),T=-15;T<=15;T++)E=O*(_=T/15)*c+(m=(Math.random()-.5)/4),b.globalAlpha=1-Math.abs(_),b.drawImage(i,E,m),C.drawImage(o,0,0),b.globalAlpha=1,b.clearRect(0,0,o.width,o.height);for(T=-15;T<=15;T++)E=O*(_=T/15)*u+(m=(Math.random()-.5)/4),b.globalAlpha=1-Math.abs(_),b.drawImage(i,m,E),C.drawImage(o,0,0),b.globalAlpha=1,b.clearRect(0,0,o.width,o.height);e.ctx.drawImage(i,0,0);var j=e.ctx.getImageData(0,0,i.width,i.height);return C.globalAlpha=1,C.clearRect(0,0,i.width,i.height),j},getUniformLocations:function(e,i){return{delta:e.getUniformLocation(i,"uDelta")}},sendUniformData:function(e,i){var o=this.chooseRightDelta();e.uniform2fv(i.delta,o)},chooseRightDelta:function(){var e,i=1,o=[0,0];return this.horizontal?this.aspectRatio>1&&(i=1/this.aspectRatio):this.aspectRatio<1&&(i=this.aspectRatio),e=i*this.blur*.12,this.horizontal?o[0]=e:o[1]=e,o}}),n.Blur.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Gamma=l(n.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],n.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var i,o=e.imageData.data,d=this.gamma,c=o.length,u=1/d[0],m=1/d[1],_=1/d[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),i=0,c=256;i<c;i++)this.rVals[i]=255*Math.pow(i/255,u),this.gVals[i]=255*Math.pow(i/255,m),this.bVals[i]=255*Math.pow(i/255,_);for(i=0,c=o.length;i<c;i+=4)o[i]=this.rVals[o[i]],o[i+1]=this.gVals[o[i+1]],o[i+2]=this.bVals[o[i+2]]},getUniformLocations:function(e,i){return{uGamma:e.getUniformLocation(i,"uGamma")}},sendUniformData:function(e,i){e.uniform3fv(i.uGamma,this.gamma)}}),r.Image.filters.Gamma.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.Composed=l(n.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach(function(i){i.applyTo(e)})},toObject:function(){return r.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(e){return!e.isNeutralState()})}}),r.Image.filters.Composed.fromObject=function(e,i){var o=(e.subFilters||[]).map(function(c){return new r.Image.filters[c.type](c)}),d=new r.Image.filters.Composed({subFilters:o});return i&&i(d),d}}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.Image.filters,l=r.util.createClass;n.HueRotation=l(n.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,i=r.util.cos(e),o=r.util.sin(e),d=1/3,c=Math.sqrt(d)*o,u=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+u/3,this.matrix[1]=d*u-c,this.matrix[2]=d*u+c,this.matrix[5]=d*u+c,this.matrix[6]=i+d*u,this.matrix[7]=d*u-c,this.matrix[10]=d*u-c,this.matrix[11]=d*u+c,this.matrix[12]=i+d*u},isNeutralState:function(e){return this.calculateMatrix(),n.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),n.BaseFilter.prototype.applyTo.call(this,e)}}),r.Image.filters.HueRotation.fromObject=r.Image.filters.BaseFilter.fromObject}(t),function(s){var r=s.fabric||(s.fabric={}),n=r.util.object.clone;if(r.Text)r.warn("fabric.Text is already defined");else{var l="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");r.Text=r.util.createClass(r.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:r.Object.prototype.stateProperties.concat(l),cacheProperties:r.Object.prototype.cacheProperties.concat(l),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,i){this.styles=i&&i.styles||{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",i),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var e=this.path;e&&(e.segmentsInfo=r.util.getPathSegmentsInfo(e.path))},getMeasuringContext:function(){return r._measuringContext||(r._measuringContext=this.canvas&&this.canvas.contextCache||r.util.createCanvasElement().getContext("2d")),r._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e,i,o,d,c,u,m,_=0,E=this._textLines.length;_<E;_++)if((this.textAlign==="justify"||_!==E-1&&!this.isEndOfWrapping(_))&&(d=0,c=this._textLines[_],(i=this.getLineWidth(_))<this.width&&(m=this.textLines[_].match(this._reSpacesAndTabs)))){o=m.length,e=(this.width-i)/o;for(var T=0,C=c.length;T<=C;T++)u=this.__charBounds[_][T],this._reSpaceAndTab.test(c[T])?(u.width+=e,u.kernedWidth+=e,u.left+=d,d+=e):u.left+=d}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),i=this.fontSize;return e.width+=i*e.zoomX,e.height+=i*e.zoomY,e},_render:function(e){var i=this.path;i&&!i.isNotVisible()&&i._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){this.paintFirst==="stroke"?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,i,o){if(e.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":e.textBaseline="middle";break;case"ascender":e.textBaseline="top";break;case"descender":e.textBaseline="bottom"}e.font=this._getFontDeclaration(i,o)},calcTextWidth:function(){for(var e=this.getLineWidth(0),i=1,o=this._textLines.length;i<o;i++){var d=this.getLineWidth(i);d>e&&(e=d)}return e},_renderTextLine:function(e,i,o,d,c,u){this._renderChars(e,i,o,d,c,u)},_renderTextLinesBackground:function(e){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var i,o,d,c,u,m,_,E=e.fillStyle,T=this._getLeftOffset(),C=this._getTopOffset(),b=0,O=0,j=this.path,U=0,$=this._textLines.length;U<$;U++)if(i=this.getHeightOfLine(U),this.textBackgroundColor||this.styleHas("textBackgroundColor",U)){d=this._textLines[U],o=this._getLineLeftOffset(U),O=0,b=0,c=this.getValueOfPropertyAt(U,0,"textBackgroundColor");for(var z=0,H=d.length;z<H;z++)u=this.__charBounds[U][z],m=this.getValueOfPropertyAt(U,z,"textBackgroundColor"),j?(e.save(),e.translate(u.renderLeft,u.renderTop),e.rotate(u.angle),e.fillStyle=m,m&&e.fillRect(-u.width/2,-i/this.lineHeight*(1-this._fontSizeFraction),u.width,i/this.lineHeight),e.restore()):m!==c?(_=T+o+b,this.direction==="rtl"&&(_=this.width-_-O),e.fillStyle=c,c&&e.fillRect(_,C,O,i/this.lineHeight),b=u.left,O=u.width,c=m):O+=u.kernedWidth;m&&!j&&(_=T+o+b,this.direction==="rtl"&&(_=this.width-_-O),e.fillStyle=m,e.fillRect(_,C,O,i/this.lineHeight)),C+=i}else C+=i;e.fillStyle=E,this._removeShadow(e)}},getFontCache:function(e){var i=e.fontFamily.toLowerCase();r.charWidthsCache[i]||(r.charWidthsCache[i]={});var o=r.charWidthsCache[i],d=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return o[d]||(o[d]={}),o[d]},_measureChar:function(e,i,o,d){var c,u,m,_,E=this.getFontCache(i),T=o+e,C=this._getFontDeclaration(i)===this._getFontDeclaration(d),b=i.fontSize/this.CACHE_FONT_SIZE;if(o&&E[o]!==void 0&&(m=E[o]),E[e]!==void 0&&(_=c=E[e]),C&&E[T]!==void 0&&(_=(u=E[T])-m),c===void 0||m===void 0||u===void 0){var O=this.getMeasuringContext();this._setTextStyles(O,i,!0)}return c===void 0&&(_=c=O.measureText(e).width,E[e]=c),m===void 0&&C&&o&&(m=O.measureText(o).width,E[o]=m),C&&u===void 0&&(u=O.measureText(T).width,E[T]=u,_=u-m),{width:c*b,kernedWidth:_*b}},getHeightOfChar:function(e,i){return this.getValueOfPropertyAt(e,i,"fontSize")},measureLine:function(e){var i=this._measureLine(e);return this.charSpacing!==0&&(i.width-=this._getWidthOfCharSpacing()),i.width<0&&(i.width=0),i},_measureLine:function(e){var i,o,d,c,u,m,_=0,E=this._textLines[e],T=new Array(E.length),C=0,b=this.path,O=this.pathSide==="right";for(this.__charBounds[e]=T,i=0;i<E.length;i++)o=E[i],c=this._getGraphemeBox(o,e,i,d),T[i]=c,_+=c.kernedWidth,d=o;if(T[i]={left:c?c.left+c.width:0,width:0,kernedWidth:0,height:this.fontSize},b){switch(m=b.segmentsInfo[b.segmentsInfo.length-1].length,(u=r.util.getPointOnPath(b.path,0,b.segmentsInfo)).x+=b.pathOffset.x,u.y+=b.pathOffset.y,this.textAlign){case"left":C=O?m-_:0;break;case"center":C=(m-_)/2;break;case"right":C=O?0:m-_}for(C+=this.pathStartOffset*(O?-1:1),i=O?E.length-1:0;O?i>=0:i<E.length;O?i--:i++)c=T[i],C>m?C%=m:C<0&&(C+=m),this._setGraphemeOnPath(C,c,u),C+=c.kernedWidth}return{width:_,numOfSpaces:0}},_setGraphemeOnPath:function(e,i,o){var d=e+i.kernedWidth/2,c=this.path,u=r.util.getPointOnPath(c.path,d,c.segmentsInfo);i.renderLeft=u.x-o.x,i.renderTop=u.y-o.y,i.angle=u.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(e,i,o,d,c){var u,m=this.getCompleteStyleDeclaration(i,o),_=d?this.getCompleteStyleDeclaration(i,o-1):{},E=this._measureChar(e,m,d,_),T=E.kernedWidth,C=E.width;this.charSpacing!==0&&(C+=u=this._getWidthOfCharSpacing(),T+=u);var b={width:C,left:0,height:m.fontSize,kernedWidth:T,deltaY:m.deltaY};if(o>0&&!c){var O=this.__charBounds[i][o-1];b.left=O.left+O.width+E.kernedWidth-E.width}return b},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],o=this.getHeightOfChar(e,0),d=1,c=i.length;d<c;d++)o=Math.max(this.getHeightOfChar(e,d),o);return this.__lineHeights[e]=o*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e,i=0,o=0,d=this._textLines.length;o<d;o++)e=this.getHeightOfLine(o),i+=o===d-1?e/this.lineHeight:e;return i},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(e,i){e.save();for(var o=0,d=this._getLeftOffset(),c=this._getTopOffset(),u=0,m=this._textLines.length;u<m;u++){var _=this.getHeightOfLine(u),E=_/this.lineHeight,T=this._getLineLeftOffset(u);this._renderTextLine(i,e,this._textLines[u],d+T,c+o+E,u),o+=_}e.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,i,o,d,c,u){var m,_,E,T,C,b=this.getHeightOfLine(u),O=this.textAlign.indexOf("justify")!==-1,j="",U=0,$=this.path,z=!O&&this.charSpacing===0&&this.isEmptyStyles(u)&&!$,H=this.direction==="ltr",M=this.direction==="ltr"?1:-1,D=i.canvas.getAttribute("dir");if(i.save(),D!==this.direction&&(i.canvas.setAttribute("dir",H?"ltr":"rtl"),i.direction=H?"ltr":"rtl",i.textAlign=H?"left":"right"),c-=b*this._fontSizeFraction/this.lineHeight,z)return this._renderChar(e,i,u,0,o.join(""),d,c,b),void i.restore();for(var G=0,q=o.length-1;G<=q;G++)T=G===q||this.charSpacing||$,j+=o[G],E=this.__charBounds[u][G],U===0?(d+=M*(E.kernedWidth-E.width),U+=E.width):U+=E.kernedWidth,O&&!T&&this._reSpaceAndTab.test(o[G])&&(T=!0),T||(m=m||this.getCompleteStyleDeclaration(u,G),_=this.getCompleteStyleDeclaration(u,G+1),T=this._hasStyleChanged(m,_)),T&&($?(i.save(),i.translate(E.renderLeft,E.renderTop),i.rotate(E.angle),this._renderChar(e,i,u,G,j,-U/2,0,b),i.restore()):(C=d,this._renderChar(e,i,u,G,j,C,c,b)),j="",m=_,d+=M*U,U=0);i.restore()},_applyPatternGradientTransformText:function(e){var i,o=r.util.createCanvasElement(),d=this.width+this.strokeWidth,c=this.height+this.strokeWidth;return o.width=d,o.height=c,(i=o.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(d,0),i.lineTo(d,c),i.lineTo(0,c),i.closePath(),i.translate(d/2,c/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(o,"no-repeat")},handleFiller:function(e,i,o){var d,c;return o.toLive?o.gradientUnits==="percentage"||o.gradientTransform||o.patternTransform?(d=-this.width/2,c=-this.height/2,e.translate(d,c),e[i]=this._applyPatternGradientTransformText(o),{offsetX:d,offsetY:c}):(e[i]=o.toLive(e,this),this._applyPatternGradientTransform(e,o)):(e[i]=o,{offsetX:0,offsetY:0})},_setStrokeStyles:function(e,i){return e.lineWidth=i.strokeWidth,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",i.stroke)},_setFillStyles:function(e,i){return this.handleFiller(e,"fillStyle",i.fill)},_renderChar:function(e,i,o,d,c,u,m){var _,E,T=this._getStyleDeclaration(o,d),C=this.getCompleteStyleDeclaration(o,d),b=e==="fillText"&&C.fill,O=e==="strokeText"&&C.stroke&&C.strokeWidth;(O||b)&&(i.save(),b&&(_=this._setFillStyles(i,C)),O&&(E=this._setStrokeStyles(i,C)),i.font=this._getFontDeclaration(C),T&&T.textBackgroundColor&&this._removeShadow(i),T&&T.deltaY&&(m+=T.deltaY),b&&i.fillText(c,u-_.offsetX,m-_.offsetY),O&&i.strokeText(c,u-E.offsetX,m-E.offsetY),i.restore())},setSuperscript:function(e,i){return this._setScript(e,i,this.superscript)},setSubscript:function(e,i){return this._setScript(e,i,this.subscript)},_setScript:function(e,i,o){var d=this.get2DCursorLocation(e,!0),c=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),u=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),m={fontSize:c*o.size,deltaY:u+c*o.baseline};return this.setSelectionStyles(m,e,i),this},_hasStyleChanged:function(e,i){return e.fill!==i.fill||e.stroke!==i.stroke||e.strokeWidth!==i.strokeWidth||e.fontSize!==i.fontSize||e.fontFamily!==i.fontFamily||e.fontWeight!==i.fontWeight||e.fontStyle!==i.fontStyle||e.deltaY!==i.deltaY},_hasStyleChangedForSvg:function(e,i){return this._hasStyleChanged(e,i)||e.overline!==i.overline||e.underline!==i.underline||e.linethrough!==i.linethrough},_getLineLeftOffset:function(e){var i=this.getLineWidth(e),o=this.width-i,d=this.textAlign,c=this.direction,u=0,m=this.isEndOfWrapping(e);return d==="justify"||d==="justify-center"&&!m||d==="justify-right"&&!m||d==="justify-left"&&!m?0:(d==="center"&&(u=o/2),d==="right"&&(u=o),d==="justify-center"&&(u=o/2),d==="justify-right"&&(u=o),c==="rtl"&&(u-=o),u)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){if(this.__lineWidths[e]!==void 0)return this.__lineWidths[e];var i=this.measureLine(e).width;return this.__lineWidths[e]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(e,i,o){var d=this._getStyleDeclaration(e,i);return d&&d[o]!==void 0?d[o]:this[o]},_renderTextDecoration:function(e,i){if(this[i]||this.styleHas(i)){for(var o,d,c,u,m,_,E,T,C,b,O,j,U,$,z,H,M=this._getLeftOffset(),D=this._getTopOffset(),G=this.path,q=this._getWidthOfCharSpacing(),J=this.offsets[i],B=0,F=this._textLines.length;B<F;B++)if(o=this.getHeightOfLine(B),this[i]||this.styleHas(i,B)){E=this._textLines[B],$=o/this.lineHeight,u=this._getLineLeftOffset(B),b=0,O=0,T=this.getValueOfPropertyAt(B,0,i),H=this.getValueOfPropertyAt(B,0,"fill"),C=D+$*(1-this._fontSizeFraction),d=this.getHeightOfChar(B,0),m=this.getValueOfPropertyAt(B,0,"deltaY");for(var Y=0,Q=E.length;Y<Q;Y++)if(j=this.__charBounds[B][Y],U=this.getValueOfPropertyAt(B,Y,i),z=this.getValueOfPropertyAt(B,Y,"fill"),c=this.getHeightOfChar(B,Y),_=this.getValueOfPropertyAt(B,Y,"deltaY"),G&&U&&z)e.save(),e.fillStyle=H,e.translate(j.renderLeft,j.renderTop),e.rotate(j.angle),e.fillRect(-j.kernedWidth/2,J*c+_,j.kernedWidth,this.fontSize/15),e.restore();else if((U!==T||z!==H||c!==d||_!==m)&&O>0){var Z=M+u+b;this.direction==="rtl"&&(Z=this.width-Z-O),T&&H&&(e.fillStyle=H,e.fillRect(Z,C+J*d+m,O,this.fontSize/15)),b=j.left,O=j.width,T=U,H=z,d=c,m=_}else O+=j.kernedWidth;Z=M+u+b,this.direction==="rtl"&&(Z=this.width-Z-O),e.fillStyle=z,U&&z&&e.fillRect(Z,C+J*d+m,O-q,this.fontSize/15),D+=o}else D+=o;this._removeShadow(e)}},_getFontDeclaration:function(e,i){var o=e||this,d=this.fontFamily,c=r.Text.genericFonts.indexOf(d.toLowerCase())>-1,u=d===void 0||d.indexOf("'")>-1||d.indexOf(",")>-1||d.indexOf('"')>-1||c?o.fontFamily:'"'+o.fontFamily+'"';return[r.isLikelyNode?o.fontWeight:o.fontStyle,r.isLikelyNode?o.fontStyle:o.fontWeight,i?this.CACHE_FONT_SIZE+"px":o.fontSize+"px",u].join(" ")},render:function(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e)))},_splitTextIntoLines:function(e){for(var i=e.split(this._reNewline),o=new Array(i.length),d=[`
`],c=[],u=0;u<i.length;u++)o[u]=r.util.string.graphemeSplit(i[u]),c=c.concat(o[u],d);return c.pop(),{_unwrappedLines:o,lines:i,graphemeText:c,graphemeLines:o}},toObject:function(e){var i=l.concat(e),o=this.callSuper("toObject",i);return o.styles=n(this.styles,!0),o.path&&(o.path=this.path.toObject()),o},set:function(e,i){this.callSuper("set",e,i);var o=!1,d=!1;if(typeof e=="object")for(var c in e)c==="path"&&this.setPathInfo(),o=o||this._dimensionAffectingProps.indexOf(c)!==-1,d=d||c==="path";else o=this._dimensionAffectingProps.indexOf(e)!==-1,d=e==="path";return d&&this.setPathInfo(),o&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),r.Text.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),r.Text.DEFAULT_SVG_FONT_SIZE=16,r.Text.fromElement=function(e,i,o){if(!e)return i(null);var d=r.parseAttributes(e,r.Text.ATTRIBUTE_NAMES),c=d.textAnchor||"left";if((o=r.util.object.extend(o?n(o):{},d)).top=o.top||0,o.left=o.left||0,d.textDecoration){var u=d.textDecoration;u.indexOf("underline")!==-1&&(o.underline=!0),u.indexOf("overline")!==-1&&(o.overline=!0),u.indexOf("line-through")!==-1&&(o.linethrough=!0),delete o.textDecoration}"dx"in d&&(o.left+=d.dx),"dy"in d&&(o.top+=d.dy),"fontSize"in o||(o.fontSize=r.Text.DEFAULT_SVG_FONT_SIZE);var m="";"textContent"in e?m=e.textContent:"firstChild"in e&&e.firstChild!==null&&"data"in e.firstChild&&e.firstChild.data!==null&&(m=e.firstChild.data),m=m.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=o.strokeWidth;o.strokeWidth=0;var E=new r.Text(m,o),T=E.getScaledHeight()/E.height,C=((E.height+E.strokeWidth)*E.lineHeight-E.height)*T,b=E.getScaledHeight()+C,O=0;c==="center"&&(O=E.getScaledWidth()/2),c==="right"&&(O=E.getScaledWidth()),E.set({left:E.left-O,top:E.top-(b-E.fontSize*(.07+E._fontSizeFraction))/E.lineHeight,strokeWidth:_!==void 0?_:1}),i(E)},r.Text.fromObject=function(e,i){var o=n(e),d=e.path;return delete o.path,r.Object._fromObject("Text",o,function(c){d?r.Object._fromObject("Path",d,function(u){c.set("path",u),i(c)},"path"):i(c)},"text")},r.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],r.util.createAccessors&&r.util.createAccessors(r.Text)}}(t),p.util.object.extend(p.Text.prototype,{isEmptyStyles:function(s){if(!this.styles||s!==void 0&&!this.styles[s])return!0;var r=s===void 0?this.styles:{line:this.styles[s]};for(var n in r)for(var l in r[n])for(var e in r[n][l])return!1;return!0},styleHas:function(s,r){if(!this.styles||!s||s===""||r!==void 0&&!this.styles[r])return!1;var n=r===void 0?this.styles:{0:this.styles[r]};for(var l in n)for(var e in n[l])if(n[l][e][s]!==void 0)return!0;return!1},cleanStyle:function(s){if(!this.styles||!s||s==="")return!1;var r,n,l=this.styles,e=0,i=!0,o=0;for(var d in l){for(var c in r=0,l[d]){var u;e++,(u=l[d][c]).hasOwnProperty(s)?(n?u[s]!==n&&(i=!1):n=u[s],u[s]===this[s]&&delete u[s]):i=!1,Object.keys(u).length!==0?r++:delete l[d][c]}r===0&&delete l[d]}for(var m=0;m<this._textLines.length;m++)o+=this._textLines[m].length;i&&e===o&&(this[s]=n,this.removeStyle(s))},removeStyle:function(s){if(this.styles&&s&&s!==""){var r,n,l,e=this.styles;for(n in e){for(l in r=e[n])delete r[l][s],Object.keys(r[l]).length===0&&delete r[l];Object.keys(r).length===0&&delete e[n]}}},_extendStyles:function(s,r){var n=this.get2DCursorLocation(s);this._getLineStyle(n.lineIndex)||this._setLineStyle(n.lineIndex),this._getStyleDeclaration(n.lineIndex,n.charIndex)||this._setStyleDeclaration(n.lineIndex,n.charIndex,{}),p.util.object.extend(this._getStyleDeclaration(n.lineIndex,n.charIndex),r)},get2DCursorLocation:function(s,r){s===void 0&&(s=this.selectionStart);for(var n=r?this._unwrappedTextLines:this._textLines,l=n.length,e=0;e<l;e++){if(s<=n[e].length)return{lineIndex:e,charIndex:s};s-=n[e].length+this.missingNewlineOffset(e)}return{lineIndex:e-1,charIndex:n[e-1].length<s?n[e-1].length:s}},getSelectionStyles:function(s,r,n){s===void 0&&(s=this.selectionStart||0),r===void 0&&(r=this.selectionEnd||s);for(var l=[],e=s;e<r;e++)l.push(this.getStyleAtPosition(e,n));return l},getStyleAtPosition:function(s,r){var n=this.get2DCursorLocation(s);return(r?this.getCompleteStyleDeclaration(n.lineIndex,n.charIndex):this._getStyleDeclaration(n.lineIndex,n.charIndex))||{}},setSelectionStyles:function(s,r,n){r===void 0&&(r=this.selectionStart||0),n===void 0&&(n=this.selectionEnd||r);for(var l=r;l<n;l++)this._extendStyles(l,s);return this._forceClearCache=!0,this},_getStyleDeclaration:function(s,r){var n=this.styles&&this.styles[s];return n?n[r]:null},getCompleteStyleDeclaration:function(s,r){for(var n,l=this._getStyleDeclaration(s,r)||{},e={},i=0;i<this._styleProperties.length;i++)e[n=this._styleProperties[i]]=l[n]===void 0?this[n]:l[n];return e},_setStyleDeclaration:function(s,r,n){this.styles[s][r]=n},_deleteStyleDeclaration:function(s,r){delete this.styles[s][r]},_getLineStyle:function(s){return!!this.styles[s]},_setLineStyle:function(s){this.styles[s]={}},_deleteLineStyle:function(s){delete this.styles[s]}}),function(){function s(r){r.textDecoration&&(r.textDecoration.indexOf("underline")>-1&&(r.underline=!0),r.textDecoration.indexOf("line-through")>-1&&(r.linethrough=!0),r.textDecoration.indexOf("overline")>-1&&(r.overline=!0),delete r.textDecoration)}p.IText=p.util.createClass(p.Text,p.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(r,n){this.callSuper("initialize",r,n),this.initBehavior()},setSelectionStart:function(r){r=Math.max(r,0),this._updateAndFire("selectionStart",r)},setSelectionEnd:function(r){r=Math.min(r,this.text.length),this._updateAndFire("selectionEnd",r)},_updateAndFire:function(r,n){this[r]!==n&&(this._fireSelectionChanged(),this[r]=n),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(r){this.clearContextTop(),this.callSuper("render",r),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(r){this.callSuper("_render",r)},clearContextTop:function(r){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var n=this.canvas.contextTop,l=this.canvas.viewportTransform;n.save(),n.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this.transform(n),this._clearTextArea(n),r||n.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var r=this._getCursorBoundaries(),n=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(r,n):this.renderSelection(r,n),n.restore()}},_clearTextArea:function(r){var n=this.width+4,l=this.height+4;r.clearRect(-n/2,-l/2,n,l)},_getCursorBoundaries:function(r){r===void 0&&(r=this.selectionStart);var n=this._getLeftOffset(),l=this._getTopOffset(),e=this._getCursorBoundariesOffsets(r);return{left:n,top:l,leftOffset:e.left,topOffset:e.top}},_getCursorBoundariesOffsets:function(r){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var n,l,e,i,o=0,d=0,c=this.get2DCursorLocation(r);e=c.charIndex,l=c.lineIndex;for(var u=0;u<l;u++)o+=this.getHeightOfLine(u);n=this._getLineLeftOffset(l);var m=this.__charBounds[l][e];return m&&(d=m.left),this.charSpacing!==0&&e===this._textLines[l].length&&(d-=this._getWidthOfCharSpacing()),i={top:o,left:n+(d>0?d:0)},this.direction==="rtl"&&(i.left*=-1),this.cursorOffsetCache=i,this.cursorOffsetCache},renderCursor:function(r,n){var l=this.get2DCursorLocation(),e=l.lineIndex,i=l.charIndex>0?l.charIndex-1:0,o=this.getValueOfPropertyAt(e,i,"fontSize"),d=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/d,u=r.topOffset,m=this.getValueOfPropertyAt(e,i,"deltaY");u+=(1-this._fontSizeFraction)*this.getHeightOfLine(e)/this.lineHeight-o*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(r,n),n.fillStyle=this.cursorColor||this.getValueOfPropertyAt(e,i,"fill"),n.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,n.fillRect(r.left+r.leftOffset-c/2,u+r.top+m,c,o)},renderSelection:function(r,n){for(var l=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,e=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,i=this.textAlign.indexOf("justify")!==-1,o=this.get2DCursorLocation(l),d=this.get2DCursorLocation(e),c=o.lineIndex,u=d.lineIndex,m=o.charIndex<0?0:o.charIndex,_=d.charIndex<0?0:d.charIndex,E=c;E<=u;E++){var T,C=this._getLineLeftOffset(E)||0,b=this.getHeightOfLine(E),O=0,j=0;if(E===c&&(O=this.__charBounds[c][m].left),E>=c&&E<u)j=i&&!this.isEndOfWrapping(E)?this.width:this.getLineWidth(E)||5;else if(E===u)if(_===0)j=this.__charBounds[u][_].left;else{var U=this._getWidthOfCharSpacing();j=this.__charBounds[u][_-1].left+this.__charBounds[u][_-1].width-U}T=b,(this.lineHeight<1||E===u&&this.lineHeight>1)&&(b/=this.lineHeight);var $=r.left+C+O,z=j-O,H=b,M=0;this.inCompositionMode?(n.fillStyle=this.compositionColor||"black",H=1,M=b):n.fillStyle=this.selectionColor,this.direction==="rtl"&&($=this.width-$-z),n.fillRect($,r.top+r.topOffset+M,z,H),r.topOffset+=T}},getCurrentCharFontSize:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fontSize")},getCurrentCharColor:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fill")},_getCurrentCharIndex:function(){var r=this.get2DCursorLocation(this.selectionStart,!0),n=r.charIndex>0?r.charIndex-1:0;return{l:r.lineIndex,c:n}}}),p.IText.fromObject=function(r,n){if(s(r),r.styles)for(var l in r.styles)for(var e in r.styles[l])s(r.styles[l][e]);p.Object._fromObject("IText",r,n,"text")}}(),De=p.util.object.clone,p.util.object.extend(p.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var r=s.canvas;r&&(r._hasITextHandlers||(r._hasITextHandlers=!0,s._initCanvasHandlers(r)),r._iTextInstances=r._iTextInstances||[],r._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var r=s.canvas;r&&(r._iTextInstances=r._iTextInstances||[],p.util.removeFromArray(r._iTextInstances,s),r._iTextInstances.length===0&&(r._hasITextHandlers=!1,s._removeCanvasHandlers(r)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(r){r.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,r,n,l){var e;return e={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",r,{duration:n,onComplete:function(){e.isAborted||s[l]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return e.isAborted}}),e},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var r=this,n=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){r._tick()},n)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,r=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&r&&r.clearContext(r.contextTop||r.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var r=0,n=s-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)r++,n--;for(;/\S/.test(this._text[n])&&n>-1;)r++,n--;return s-r},findWordBoundaryRight:function(s){var r=0,n=s;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)r++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)r++,n++;return s+r},findLineBoundaryLeft:function(s){for(var r=0,n=s-1;!/\n/.test(this._text[n])&&n>-1;)r++,n--;return s-r},findLineBoundaryRight:function(s){for(var r=0,n=s;!/\n/.test(this._text[n])&&n<this._text.length;)r++,n++;return s+r},searchWordBoundary:function(s,r){for(var n=this._text,l=this._reSpace.test(n[s])?s-1:s,e=n[l],i=p.reNonWord;!i.test(e)&&l>0&&l<n.length;)e=n[l+=r];return i.test(e)&&(l+=r===1?0:1),l},selectWord:function(s){s=s||this.selectionStart;var r=this.searchWordBoundary(s,-1),n=this.searchWordBoundary(s,1);this.selectionStart=r,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var r=this.findLineBoundaryLeft(s),n=this.findLineBoundaryRight(s);return this.selectionStart=r,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(r){r.selected=!1,r.isEditing&&r.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(this.__isMousedown&&this.isEditing){var r=this.getSelectionStartFromPointer(s.e),n=this.selectionStart,l=this.selectionEnd;(r===this.__selectionStartOnMouseDown&&n!==l||n!==r&&l!==r)&&(r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===n&&this.selectionEnd===l||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,r,n){var l=n.slice(0,s),e=p.util.string.graphemeSplit(l).length;if(s===r)return{selectionStart:e,selectionEnd:e};var i=n.slice(s,r);return{selectionStart:e,selectionEnd:e+p.util.string.graphemeSplit(i).length}},fromGraphemeToStringSelection:function(s,r,n){var l=n.slice(0,s).join("").length;return s===r?{selectionStart:l,selectionEnd:l}:{selectionStart:l,selectionEnd:l+n.slice(s,r).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,r=this._getCursorBoundaries(s),n=this.get2DCursorLocation(s),l=n.lineIndex,e=n.charIndex,i=this.getValueOfPropertyAt(l,e,"fontSize")*this.lineHeight,o=r.leftOffset,d=this.calcTransformMatrix(),c={x:r.left+o,y:r.top+r.topOffset+i},u=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,_=m.width/u,E=m.height/u,T=_-i,C=E-i,b=m.clientWidth/_,O=m.clientHeight/E;return c=p.util.transformPoint(c,d),(c=p.util.transformPoint(c,this.canvas.viewportTransform)).x*=b,c.y*=O,c.x<0&&(c.x=0),c.x>T&&(c.x=T),c.y<0&&(c.y=0),c.y>C&&(c.y=C),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,r=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,r&&(r.blur&&r.blur(),r.parentNode&&r.parentNode.removeChild(r)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,r){var n,l,e=this.get2DCursorLocation(s,!0),i=this.get2DCursorLocation(r,!0),o=e.lineIndex,d=e.charIndex,c=i.lineIndex,u=i.charIndex;if(o!==c){if(this.styles[o])for(n=d;n<this._unwrappedTextLines[o].length;n++)delete this.styles[o][n];if(this.styles[c])for(n=u;n<this._unwrappedTextLines[c].length;n++)(l=this.styles[c][n])&&(this.styles[o]||(this.styles[o]={}),this.styles[o][d+n-u]=l);for(n=o+1;n<=c;n++)delete this.styles[n];this.shiftLineStyles(c,o-c)}else if(this.styles[o]){l=this.styles[o];var m,_,E=u-d;for(n=d;n<u;n++)delete l[n];for(_ in this.styles[o])(m=parseInt(_,10))>=u&&(l[m-E]=l[_],delete l[_])}},shiftLineStyles:function(s,r){var n=De(this.styles);for(var l in this.styles){var e=parseInt(l,10);e>s&&(this.styles[e+r]=n[e],n[e-r]||delete this.styles[e])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(s,r,n,l){var e,i={},o=!1,d=this._unwrappedTextLines[s].length===r;for(var c in n||(n=1),this.shiftLineStyles(s,n),this.styles[s]&&(e=this.styles[s][r===0?r:r-1]),this.styles[s]){var u=parseInt(c,10);u>=r&&(o=!0,i[u-r]=this.styles[s][c],d&&r===0||delete this.styles[s][c])}var m=!1;for(o&&!d&&(this.styles[s+n]=i,m=!0),m&&n--;n>0;)l&&l[n-1]?this.styles[s+n]={0:De(l[n-1])}:e?this.styles[s+n]={0:De(e)}:delete this.styles[s+n],n--;this._forceClearCache=!0},insertCharStyleObject:function(s,r,n,l){this.styles||(this.styles={});var e=this.styles[s],i=e?De(e):{};for(var o in n||(n=1),i){var d=parseInt(o,10);d>=r&&(e[d+n]=i[d],i[d-n]||delete e[d])}if(this._forceClearCache=!0,l)for(;n--;)Object.keys(l[n]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][r+n]=De(l[n]));else if(e)for(var c=e[r?r-1:1];c&&n--;)this.styles[s][r+n]=De(c)},insertNewStyleBlock:function(s,r,n){for(var l=this.get2DCursorLocation(r,!0),e=[0],i=0,o=0;o<s.length;o++)s[o]===`
`?e[++i]=0:e[i]++;for(e[0]>0&&(this.insertCharStyleObject(l.lineIndex,l.charIndex,e[0],n),n=n&&n.slice(e[0]+1)),i&&this.insertNewlineStyleObject(l.lineIndex,l.charIndex+e[0],i),o=1;o<i;o++)e[o]>0?this.insertCharStyleObject(l.lineIndex+o,0,e[o],n):n&&this.styles[l.lineIndex+o]&&n[0]&&(this.styles[l.lineIndex+o][0]=n[0]),n=n&&n.slice(e[o]+1);e[o]>0&&this.insertCharStyleObject(l.lineIndex+o,0,e[o],n)},setSelectionStartEndWithShift:function(s,r,n){n<=s?(r===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=n):n>s&&n<r?this._selectionDirection==="right"?this.selectionEnd=n:this.selectionStart=n:(r===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=r),this.selectionEnd=n)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}}),p.util.object.extend(p.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(s){if(this.canvas){this.__newClickTime=+new Date;var r=s.pointer;this.isTripleClick(r)&&(this.fire("tripleclick",s),this._stopEvent(s.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=r,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(s){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===s.x&&this.__lastPointer.y===s.y},_stopEvent:function(s){s.preventDefault&&s.preventDefault(),s.stopPropagation&&s.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(s){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(s.e))},tripleClickHandler:function(s){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(s.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(s){!this.canvas||!this.editable||s.e.button&&s.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(s.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(s){!this.canvas||!this.editable||s.e.button&&s.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(s){if(this.__isMousedown=!1,!(!this.editable||this.group||s.transform&&s.transform.actionPerformed||s.e.button&&s.e.button!==1)){if(this.canvas){var r=this.canvas._activeObject;if(r&&r!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(s.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(s){var r=this.getSelectionStartFromPointer(s),n=this.selectionStart,l=this.selectionEnd;s.shiftKey?this.setSelectionStartEndWithShift(n,l,r):(this.selectionStart=r,this.selectionEnd=r),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(s){for(var r,n=this.getLocalPointer(s),l=0,e=0,i=0,o=0,d=0,c=0,u=this._textLines.length;c<u&&i<=n.y;c++)i+=this.getHeightOfLine(c)*this.scaleY,d=c,c>0&&(o+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));e=this._getLineLeftOffset(d)*this.scaleX,r=this._textLines[d],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+e);for(var m=0,_=r.length;m<_&&(l=e,(e+=this.__charBounds[d][m].kernedWidth*this.scaleX)<=n.x);m++)o++;return this._getNewSelectionStartFromOffset(n,l,e,o,_)},_getNewSelectionStartFromOffset:function(s,r,n,l,e){var i=s.x-r,o=n-s.x,d=l+(o>i||o<0?0:1);return this.flipX&&(d=e-d),d>this._text.length&&(d=this._text.length),d}}),p.util.object.extend(p.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=p.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var s=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+s.top+"; left: "+s.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+s.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):p.document.body.appendChild(this.hiddenTextarea),p.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),p.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),p.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),p.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),p.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),p.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(p.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(s){if(this.isEditing){var r=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(s.keyCode in r)this[r[s.keyCode]](s);else{if(!(s.keyCode in this.ctrlKeysMapDown)||!s.ctrlKey&&!s.metaKey)return;this[this.ctrlKeysMapDown[s.keyCode]](s)}s.stopImmediatePropagation(),s.preventDefault(),s.keyCode>=33&&s.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(s){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:s.keyCode in this.ctrlKeysMapUp&&(s.ctrlKey||s.metaKey)&&(this[this.ctrlKeysMapUp[s.keyCode]](s),s.stopImmediatePropagation(),s.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(s){var r=this.fromPaste;if(this.fromPaste=!1,s&&s.stopPropagation(),this.isEditing){var n,l,e,i,o,d=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,c=this._text.length,u=d.length,m=u-c,_=this.selectionStart,E=this.selectionEnd,T=_!==E;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var C=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),b=_>C.selectionStart;T?(n=this._text.slice(_,E),m+=E-_):u<c&&(n=b?this._text.slice(E+m,E):this._text.slice(_,_-m)),l=d.slice(C.selectionEnd-m,C.selectionEnd),n&&n.length&&(l.length&&(e=this.getSelectionStyles(_,_+1,!1),e=l.map(function(){return e[0]})),T?(i=_,o=E):b?(i=E-n.length,o=E):(i=E,o=E+n.length),this.removeStyleFromTo(i,o)),l.length&&(r&&l.join("")===p.copiedText&&!p.disableStyleCopyPaste&&(e=p.copiedTextStyle),this.insertNewStyleBlock(l,_,e)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(s){this.compositionStart=s.target.selectionStart,this.compositionEnd=s.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(p.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?p.copiedTextStyle=null:p.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(s){return s&&s.clipboardData||p.window.clipboardData},_getWidthBeforeCursor:function(s,r){var n,l=this._getLineLeftOffset(s);return r>0&&(l+=(n=this.__charBounds[s][r-1]).left+n.width),l},getDownCursorOffset:function(s,r){var n=this._getSelectionForOffset(s,r),l=this.get2DCursorLocation(n),e=l.lineIndex;if(e===this._textLines.length-1||s.metaKey||s.keyCode===34)return this._text.length-n;var i=l.charIndex,o=this._getWidthBeforeCursor(e,i),d=this._getIndexOnLine(e+1,o);return this._textLines[e].slice(i).length+d+1+this.missingNewlineOffset(e)},_getSelectionForOffset:function(s,r){return s.shiftKey&&this.selectionStart!==this.selectionEnd&&r?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(s,r){var n=this._getSelectionForOffset(s,r),l=this.get2DCursorLocation(n),e=l.lineIndex;if(e===0||s.metaKey||s.keyCode===33)return-n;var i=l.charIndex,o=this._getWidthBeforeCursor(e,i),d=this._getIndexOnLine(e-1,o),c=this._textLines[e].slice(0,i),u=this.missingNewlineOffset(e-1);return-this._textLines[e-1].length+d-c.length+(1-u)},_getIndexOnLine:function(s,r){for(var n,l,e=this._textLines[s],i=this._getLineLeftOffset(s),o=0,d=0,c=e.length;d<c;d++)if((i+=n=this.__charBounds[s][d].width)>r){l=!0;var u=i-n,m=i,_=Math.abs(u-r);o=Math.abs(m-r)<_?d:d-1;break}return l||(o=e.length-1),o},moveCursorDown:function(s){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",s)},moveCursorUp:function(s){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",s)},_moveCursorUpOrDown:function(s,r){var n=this["get"+s+"CursorOffset"](r,this._selectionDirection==="right");r.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),n!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(s){var r=this._selectionDirection==="left"?this.selectionStart+s:this.selectionEnd+s;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,r),s!==0},moveCursorWithoutShift:function(s){return s<0?(this.selectionStart+=s,this.selectionEnd=this.selectionStart):(this.selectionEnd+=s,this.selectionStart=this.selectionEnd),s!==0},moveCursorLeft:function(s){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",s)},_move:function(s,r,n){var l;if(s.altKey)l=this["findWordBoundary"+n](this[r]);else{if(!s.metaKey&&s.keyCode!==35&&s.keyCode!==36)return this[r]+=n==="Left"?-1:1,!0;l=this["findLineBoundary"+n](this[r])}if(typeof l!==void 0&&this[r]!==l)return this[r]=l,!0},_moveLeft:function(s,r){return this._move(s,r,"Left")},_moveRight:function(s,r){return this._move(s,r,"Right")},moveCursorLeftWithoutShift:function(s){var r=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(r=this._moveLeft(s,"selectionStart")),this.selectionEnd=this.selectionStart,r},moveCursorLeftWithShift:function(s){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(s,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(s,"selectionStart")):void 0},moveCursorRight:function(s){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",s)},_moveCursorLeftOrRight:function(s,r){var n="moveCursor"+s+"With";this._currentCursorOpacity=1,r.shiftKey?n+="Shift":n+="outShift",this[n](r)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(s){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(s,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(s,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(s){var r=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(r=this._moveRight(s,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,r},removeChars:function(s,r){r===void 0&&(r=s+1),this.removeStyleFromTo(s,r),this._text.splice(s,r-s),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(s,r,n,l){l===void 0&&(l=n),l>n&&this.removeStyleFromTo(n,l);var e=p.util.string.graphemeSplit(s);this.insertNewStyleBlock(e,n,r),this._text=[].concat(this._text.slice(0,n),e,this._text.slice(l)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var s=p.util.toFixed,r=/  +/g;p.util.object.extend(p.Text.prototype,{_toSVG:function(){var n=this._getSVGLeftTopOffsets(),l=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(l)},toSVG:function(n){return this._createBaseSVGMarkup(this._toSVG(),{reviver:n,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(n){var l=this.getSvgTextDecoration(this);return[n.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",l?'text-decoration="'+l+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",n.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(n,l){var e,i=[],o=[],d=n;this._setSVGBg(o);for(var c=0,u=this._textLines.length;c<u;c++)e=this._getLineLeftOffset(c),(this.textBackgroundColor||this.styleHas("textBackgroundColor",c))&&this._setSVGTextLineBg(o,c,l+e,d),this._setSVGTextLineText(i,c,l+e,d),d+=this.getHeightOfLine(c);return{textSpans:i,textBgRects:o}},_createTextCharSpan:function(n,l,e,i){var o=n!==n.trim()||n.match(r),d=this.getSvgSpanStyles(l,o),c=d?'style="'+d+'"':"",u=l.deltaY,m="",_=p.Object.NUM_FRACTION_DIGITS;return u&&(m=' dy="'+s(u,_)+'" '),['<tspan x="',s(e,_),'" y="',s(i,_),'" ',m,c,">",p.util.string.escapeXml(n),"</tspan>"].join("")},_setSVGTextLineText:function(n,l,e,i){var o,d,c,u,m,_=this.getHeightOfLine(l),E=this.textAlign.indexOf("justify")!==-1,T="",C=0,b=this._textLines[l];i+=_*(1-this._fontSizeFraction)/this.lineHeight;for(var O=0,j=b.length-1;O<=j;O++)m=O===j||this.charSpacing,T+=b[O],c=this.__charBounds[l][O],C===0?(e+=c.kernedWidth-c.width,C+=c.width):C+=c.kernedWidth,E&&!m&&this._reSpaceAndTab.test(b[O])&&(m=!0),m||(o=o||this.getCompleteStyleDeclaration(l,O),d=this.getCompleteStyleDeclaration(l,O+1),m=this._hasStyleChangedForSvg(o,d)),m&&(u=this._getStyleDeclaration(l,O)||{},n.push(this._createTextCharSpan(T,u,e,i)),T="",o=d,e+=C,C=0)},_pushTextBgRect:function(n,l,e,i,o,d){var c=p.Object.NUM_FRACTION_DIGITS;n.push("		<rect ",this._getFillAttributes(l),' x="',s(e,c),'" y="',s(i,c),'" width="',s(o,c),'" height="',s(d,c),`"></rect>
`)},_setSVGTextLineBg:function(n,l,e,i){for(var o,d,c=this._textLines[l],u=this.getHeightOfLine(l)/this.lineHeight,m=0,_=0,E=this.getValueOfPropertyAt(l,0,"textBackgroundColor"),T=0,C=c.length;T<C;T++)o=this.__charBounds[l][T],(d=this.getValueOfPropertyAt(l,T,"textBackgroundColor"))!==E?(E&&this._pushTextBgRect(n,E,e+_,i,m,u),_=o.left,m=o.width,E=d):m+=o.kernedWidth;d&&this._pushTextBgRect(n,d,e+_,i,m,u)},_getFillAttributes:function(n){var l=n&&typeof n=="string"?new p.Color(n):"";return l&&l.getSource()&&l.getAlpha()!==1?'opacity="'+l.getAlpha()+'" fill="'+l.setAlpha(1).toRgb()+'"':'fill="'+n+'"'},_getSVGLineTopOffset:function(n){for(var l,e=0,i=0;i<n;i++)e+=this.getHeightOfLine(i);return l=this.getHeightOfLine(i),{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*l/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(n){return p.Object.prototype.getSvgStyles.call(this,n)+" white-space: pre;"}})}(),function(s){var r=s.fabric||(s.fabric={});r.Textbox=r.util.createClass(r.IText,r.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:r.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(n){for(var l=0,e=0,i=0,o={},d=0;d<n.graphemeLines.length;d++)n.graphemeText[i]===`
`&&d>0?(e=0,i++,l++):!this.splitByGrapheme&&this._reSpaceAndTab.test(n.graphemeText[i])&&d>0&&(e++,i++),o[d]={line:l,offset:e},i+=n.graphemeLines[d].length,e+=n.graphemeLines[d].length;return o},styleHas:function(n,l){if(this._styleMap&&!this.isWrapping){var e=this._styleMap[l];e&&(l=e.line)}return r.Text.prototype.styleHas.call(this,n,l)},isEmptyStyles:function(n){if(!this.styles)return!0;var l,e,i=0,o=!1,d=this._styleMap[n],c=this._styleMap[n+1];for(var u in d&&(n=d.line,i=d.offset),c&&(o=c.line===n,l=c.offset),e=n===void 0?this.styles:{line:this.styles[n]})for(var m in e[u])if(m>=i&&(!o||m<l))for(var _ in e[u][m])return!1;return!0},_getStyleDeclaration:function(n,l){if(this._styleMap&&!this.isWrapping){var e=this._styleMap[n];if(!e)return null;n=e.line,l=e.offset+l}return this.callSuper("_getStyleDeclaration",n,l)},_setStyleDeclaration:function(n,l,e){var i=this._styleMap[n];n=i.line,l=i.offset+l,this.styles[n][l]=e},_deleteStyleDeclaration:function(n,l){var e=this._styleMap[n];n=e.line,l=e.offset+l,delete this.styles[n][l]},_getLineStyle:function(n){var l=this._styleMap[n];return!!this.styles[l.line]},_setLineStyle:function(n){var l=this._styleMap[n];this.styles[l.line]={}},_wrapText:function(n,l){var e,i=[];for(this.isWrapping=!0,e=0;e<n.length;e++)i=i.concat(this._wrapLine(n[e],e,l));return this.isWrapping=!1,i},_measureWord:function(n,l,e){var i,o=0;e=e||0;for(var d=0,c=n.length;d<c;d++)o+=this._getGraphemeBox(n[d],l,d+e,i,!0).kernedWidth,i=n[d];return o},_wrapLine:function(n,l,e,i){var o=0,d=this.splitByGrapheme,c=[],u=[],m=d?r.util.string.graphemeSplit(n):n.split(this._wordJoiners),_="",E=0,T=d?"":" ",C=0,b=0,O=0,j=!0,U=this._getWidthOfCharSpacing();i=i||0,m.length===0&&m.push([]),e-=i;for(var $=0;$<m.length;$++)_=d?m[$]:r.util.string.graphemeSplit(m[$]),C=this._measureWord(_,l,E),E+=_.length,(o+=b+C-U)>e&&!j?(c.push(u),u=[],o=C,j=!0):o+=U,j||d||u.push(T),u=u.concat(_),b=d?0:this._measureWord([T],l,E),E++,j=!1,C>O&&(O=C);return $&&c.push(u),O+i>this.dynamicMinWidth&&(this.dynamicMinWidth=O-U+i),c},isEndOfWrapping:function(n){return!this._styleMap[n+1]||this._styleMap[n+1].line!==this._styleMap[n].line},missingNewlineOffset:function(n){return this.splitByGrapheme?this.isEndOfWrapping(n)?1:0:1},_splitTextIntoLines:function(n){for(var l=r.Text.prototype._splitTextIntoLines.call(this,n),e=this._wrapText(l.lines,this.width),i=new Array(e.length),o=0;o<e.length;o++)i[o]=e[o].join("");return l.lines=i,l.graphemeLines=e,l},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var n={};for(var l in this._styleMap)this._textLines[l]&&(n[this._styleMap[l].line]=1);for(var l in this.styles)n[l]||delete this.styles[l]},toObject:function(n){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(n))}}),r.Textbox.fromObject=function(n,l){return r.Object._fromObject("Textbox",n,l,"text")}}(t),function(){var s=p.controlsUtils,r=s.scaleSkewCursorStyleHandler,n=s.scaleCursorStyleHandler,l=s.scalingEqually,e=s.scalingYOrSkewingX,i=s.scalingXOrSkewingY,o=s.scaleOrSkewActionName,d=p.Object.prototype.controls;if(d.ml=new p.Control({x:-.5,y:0,cursorStyleHandler:r,actionHandler:i,getActionName:o}),d.mr=new p.Control({x:.5,y:0,cursorStyleHandler:r,actionHandler:i,getActionName:o}),d.mb=new p.Control({x:0,y:.5,cursorStyleHandler:r,actionHandler:e,getActionName:o}),d.mt=new p.Control({x:0,y:-.5,cursorStyleHandler:r,actionHandler:e,getActionName:o}),d.tl=new p.Control({x:-.5,y:-.5,cursorStyleHandler:n,actionHandler:l}),d.tr=new p.Control({x:.5,y:-.5,cursorStyleHandler:n,actionHandler:l}),d.bl=new p.Control({x:-.5,y:.5,cursorStyleHandler:n,actionHandler:l}),d.br=new p.Control({x:.5,y:.5,cursorStyleHandler:n,actionHandler:l}),d.mtr=new p.Control({x:0,y:-.5,actionHandler:s.rotationWithSnapping,cursorStyleHandler:s.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),p.Textbox){var c=p.Textbox.prototype.controls={};c.mtr=d.mtr,c.tr=d.tr,c.br=d.br,c.tl=d.tl,c.bl=d.bl,c.mt=d.mt,c.mb=d.mb,c.mr=new p.Control({x:.5,y:0,actionHandler:s.changeWidth,cursorStyleHandler:r,actionName:"resizing"}),c.ml=new p.Control({x:-.5,y:0,actionHandler:s.changeWidth,cursorStyleHandler:r,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Rs={};function mi(h){var t=Rs[h];if(t!==void 0)return t.exports;var a=Rs[h]={exports:{}};return ua[h](a,a.exports,mi),a.exports}mi.d=(h,t)=>{for(var a in t)mi.o(t,a)&&!mi.o(h,a)&&Object.defineProperty(h,a,{enumerable:!0,get:t[a]})},mi.o=(h,t)=>Object.prototype.hasOwnProperty.call(h,t);var _o={};(()=>{let h;mi.d(_o,{R:()=>h}),h=typeof document<"u"&&typeof window<"u"?mi(653).fabric:{version:"5.2.1"}})();var it,gt,Qt,Ds,Ne=_o.R;(function(h){h[h.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",h[h.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",h[h.DIMT_TEXT=4]="DIMT_TEXT",h[h.DIMT_ARC=8]="DIMT_ARC",h[h.DIMT_IMAGE=16]="DIMT_IMAGE",h[h.DIMT_POLYGON=32]="DIMT_POLYGON",h[h.DIMT_LINE=64]="DIMT_LINE",h[h.DIMT_GROUP=128]="DIMT_GROUP"})(it||(it={})),function(h){h[h.DIS_DEFAULT=1]="DIS_DEFAULT",h[h.DIS_SELECTED=2]="DIS_SELECTED"}(gt||(gt={})),function(h){h[h.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",h[h.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",h[h.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Qt||(Qt={})),function(h){h.GREY="grey",h.GREY32="grey32",h.RGBA="rgba",h.RBGA="rbga",h.GRBA="grba",h.GBRA="gbra",h.BRGA="brga",h.BGRA="bgra"}(Ds||(Ds={}));const Vi=h=>typeof h=="number"&&!Number.isNaN(h),Bn=h=>typeof h=="string";var Or,tr,xi,jn,bt,sn;(function(h){h[h.ARC=0]="ARC",h[h.IMAGE=1]="IMAGE",h[h.LINE=2]="LINE",h[h.POLYGON=3]="POLYGON",h[h.QUAD=4]="QUAD",h[h.RECT=5]="RECT",h[h.TEXT=6]="TEXT",h[h.GROUP=7]="GROUP"})(bt||(bt={})),function(h){h[h.DEFAULT=0]="DEFAULT",h[h.SELECTED=1]="SELECTED"}(sn||(sn={}));class ht{get mediaType(){return new Map([["rect",it.DIMT_RECTANGLE],["quad",it.DIMT_QUADRILATERAL],["text",it.DIMT_TEXT],["arc",it.DIMT_ARC],["image",it.DIMT_IMAGE],["polygon",it.DIMT_POLYGON],["line",it.DIMT_LINE],["group",it.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(S(this,tr,"f")){case gt.DIS_DEFAULT:return"default";case gt.DIS_SELECTED:return"selected"}}set drawingStyleId(t){this.styleId=t}get drawingStyleId(){return this.styleId}set coordinateBase(t){if(!["view","image"].includes(t))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&(S(this,xi,"f")==="image"&&t==="view"?this.updateCoordinateBaseFromImageToView():S(this,xi,"f")==="view"&&t==="image"&&this.updateCoordinateBaseFromViewToImage()),ye(this,xi,t)}get coordinateBase(){return S(this,xi,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(t,a){if(Or.add(this),tr.set(this,void 0),xi.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,a!=null&&!Vi(a))throw new TypeError("Invalid 'drawingStyleId'.");t&&this._setFabricObject(t),this.setState(gt.DIS_DEFAULT),this.styleId=a}_setFabricObject(t){this._fabricObject=t,this._fabricObject.on("selected",()=>{this.setState(gt.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(gt.DIS_SELECTED):this.setState(gt.DIS_DEFAULT),this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),t.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(t){ye(this,tr,t)}getState(){return S(this,tr,"f")}_on(t,a){if(!a)return;const f=t.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${t}' does not exist.`);let v=g.get(a);v||(v=y=>{const w=y.e;if(!w)return void(a&&a.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const I={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let x,A,L,k;const N=w.target.getBoundingClientRect();x=N.left,A=N.top,L=x+window.scrollX,k=A+window.scrollY;const{width:P,height:V}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),W=this._drawingLayer.width,X=this._drawingLayer.height,K=P/V,ee=W/X,ge=this._drawingLayer._getObjectFit();let ce,Se,De,p,me=1;if(ge==="contain")K<ee?(me=P/W,ce=x+this.get("x")*me,Se=A+this.get("y")*me+(V-X*me)/2,De=L+this.get("x")*me,p=k+this.get("y")*me+(V-X*me)/2):(me=V/X,ce=x+this.get("x")*me+(P-W*me)/2,Se=A+this.get("y")*me,De=L+this.get("x")*me+(P-W*me)/2,p=k+this.get("y")*me);else if(ge==="cover")if(K<ee){me=V/X;let Te=this.get("x")*me-(W*me-P)/2;Te=Math.max(Te,0),Te=Math.min(Te,P),ce=x+Te,Se=A+this.get("y")*me,De=L+Te,p=k+this.get("y")*me}else{me=P/W;let Te=this.get("y")*me-(X*me-V)/2;Te=Math.max(Te,0),Te=Math.min(Te,V),ce=x+this.get("x")*me,Se=A+Te,De=L+this.get("x")*me,p=k+Te}I.itemClientX=Math.round(ce),I.itemClientY=Math.round(Se),I.itemPageX=Math.round(De),I.itemPageY=Math.round(p)}for(let x of Object.getOwnPropertyNames(I))Object.defineProperty(w,x,{value:I[x],writable:!0});a&&a.apply(this,[w])},g.set(a,v),this._fabricObject.on(f==="dblclick"?"mousedblclick":f,v))}on(t,a){this._on(t,a)}_off(t,a){const f=t.toLowerCase(),g=this.mapEvent_Callbacks.get(f);if(!g)throw new Error(`Event '${t}' does not exist.`);let v=g.get(a);v&&(g.delete(a),this._fabricObject.off(f==="dblclick"?"mousedblclick":f,v))}off(t,a){this._off(t,a)}_setEditable(t){const a=this._fabricObject;t?(a.selectable=!0,a.hasControls=!0,a.hoverCursor=null):(a.selectable=!1,a.hasControls=!1,a.hoverCursor="default")}hasNote(t){return this.mapNoteName_Content.has(t)}addNote(t,a){if(this.hasNote(t.name)&&!a)throw new Error("A note with the same name already exists, please use a different name.");const f=t.content?JSON.parse(JSON.stringify(t.content)):t.content;this.mapNoteName_Content.set(t.name,[f])}getNote(t){const a=this.mapNoteName_Content.get(t);return a?a.length===1?{name:t,content:a[0]?JSON.parse(JSON.stringify(a[0])):a[0]}:{name:t,content:JSON.parse(JSON.stringify(a))}:null}getNotes(){const t=[];for(let a of this.mapNoteName_Content){let f=a[1].length===1?a[1][0]:a[1];f=f&&JSON.parse(JSON.stringify(f)),t.push({name:a[0],content:f})}return t}updateNote(t,a,f){const g=this.mapNoteName_Content.get(t);if(!g)throw new Error("The note name does not exist.");f||(g.length=0),a=a&&JSON.parse(JSON.stringify(a)),g.push(a)}deleteNote(t){this.mapNoteName_Content.delete(t)}clearNotes(){this.mapNoteName_Content.clear()}set(t,a){if(!this.extendSet(t,a))if(t==="x"){const f=this._fabricObject.group;f?(this._fabricObject.set("left",a-f.left-f.width/2),f.addWithUpdate()):this._fabricObject.set("left",a)}else if(t==="y"){const f=this._fabricObject.group;f?(this._fabricObject.set("top",a-f.top-f.height/2),f.addWithUpdate()):this._fabricObject.set("top",a)}else t==="styleId"?this.styleId=a:this._fabricObject.set(t,a);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(t)&&this._fabricObject.setCoords()}get(t){let a=this.extendGet(t);if(a===void 0)if(t==="x"){const f=this._fabricObject.group;a=f?this._fabricObject.get("left")+f.left+f.width/2:this._fabricObject.get("left")}else if(t==="y"){const f=this._fabricObject.group;a=f?this._fabricObject.get("top")+f.top+f.height/2:this._fabricObject.get("top")}else a=t==="scaledWidth"?this._fabricObject.getScaledWidth():t==="scaledHeight"?this._fabricObject.getScaledHeight():["type","mediaType"].includes(t)?this.mediaType:t==="state"?this.getState():t==="styleId"?this.styleId:t==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(t);return a}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(t){if(typeof t!="number")throw new TypeError("Invalid value.");return t*S(this,Or,"m",jn).call(this)}convertPropFromViewToImage(t){if(typeof t!="number")throw new TypeError("Invalid value.");return t/S(this,Or,"m",jn).call(this)}_setLineWidth(t){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("strokeWidth",this.convertPropFromViewToImage(t));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",t)}}_getLineWidth(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("strokeWidth"));if(this.coordinateBase==="image")return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(t){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("fontSize",this.convertPropFromViewToImage(t));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",t)}}_getFontSize(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("fontSize"));if(this.coordinateBase==="image")return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}tr=new WeakMap,xi=new WeakMap,Or=new WeakSet,jn=function(){const h=this._drawingLayer;if(!h)return 1;const t=h.width,a=h.height,{width:f,height:g}=h.fabricCanvas.wrapperEl.getBoundingClientRect();if(f<=0||g<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const v=f/t,y=g/a,w=h._getObjectFit();let I=1;return w==="contain"?v<y?I=f/t:I=g/a:w==="cover"&&(v<y?I=g/a:I=f/t),I},ht.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],ht.mapItemType=new Map([[bt.ARC,"arc"],[bt.IMAGE,"image"],[bt.LINE,"line"],[bt.POLYGON,"polygon"],[bt.QUAD,"quad"],[bt.RECT,"rect"],[bt.TEXT,"text"],[bt.GROUP,"group"]]),ht.arrStyleSelectors=["default","selected"],ht.mapItemState=new Map([[sn.DEFAULT,"default"],[sn.SELECTED,"selected"]]);const vo=h=>h!==null&&typeof h=="object"&&!Array.isArray(h),yn=h=>!!Bn(h)&&h!=="",as=Yo,Ls=Xo,da=is,Ms=zo,vi=Zo,Fs=h=>!!vo(h)&&!("id"in h&&!Vi(h.id))&&!("lineWidth"in h&&!Vi(h.lineWidth))&&!("fillStyle"in h&&!yn(h.fillStyle))&&!("strokeStyle"in h&&!yn(h.strokeStyle))&&!("paintMode"in h&&!["fill","stroke","strokeAndFill"].includes(h.paintMode))&&!("fontFamily"in h&&!yn(h.fontFamily))&&!("fontSize"in h&&!Vi(h.fontSize));class Rr{static convert(t,a,f){const g={x:0,y:0,width:a,height:f};if(!t)return g;if(vi(t))t.isMeasuredInPercentage?(g.x=t.x/100*a,g.y=t.y/100*f,g.width=t.width/100*a,g.height=t.height/100*f):(g.x=t.x,g.y=t.y,g.width=t.width,g.height=t.height);else{if(!as(t))throw TypeError("Invalid region.");t.isMeasuredInPercentage?(g.x=t.left/100*a,g.y=t.top/100*f,g.width=(t.right-t.left)/100*a,g.height=(t.bottom-t.top)/100*f):(g.x=t.left,g.y=t.top,g.width=t.right-t.left,g.height=t.bottom-t.top)}return g.x=Math.round(g.x),g.y=Math.round(g.y),g.width=Math.round(g.width),g.height=Math.round(g.height),g}}var li,Dr;class yo{constructor(){li.set(this,new Map),Dr.set(this,!1)}get disposed(){return S(this,Dr,"f")}on(t,a){t=t.toLowerCase();const f=S(this,li,"f").get(t);if(f){if(f.includes(a))return;f.push(a)}else S(this,li,"f").set(t,[a])}off(t,a){t=t.toLowerCase();const f=S(this,li,"f").get(t);if(!f)return;const g=f.indexOf(a);g!==-1&&f.splice(g,1)}offAll(t){t=t.toLowerCase();const a=S(this,li,"f").get(t);a&&(a.length=0)}fire(t,a=[],f={async:!1,copy:!0}){a||(a=[]),t=t.toLowerCase();const g=S(this,li,"f").get(t);if(g&&g.length){f=Object.assign({async:!1,copy:!0},f);for(let v of g){if(!v)continue;let y=[];if(f.copy)for(let I of a){try{I=JSON.parse(JSON.stringify(I))}catch{}y.push(I)}else y=a;let w=!1;if(f.async)setTimeout(()=>{this.disposed||g.includes(v)&&v.apply(f.target,y)},0);else try{w=v.apply(f.target,y)}catch{}if(w===!0)break}}}dispose(){ye(this,Dr,!0)}}function fa(h,t,a){return(a.x-h.x)*(t.y-h.y)==(t.x-h.x)*(a.y-h.y)&&Math.min(h.x,t.x)<=a.x&&a.x<=Math.max(h.x,t.x)&&Math.min(h.y,t.y)<=a.y&&a.y<=Math.max(h.y,t.y)}function En(h){return Math.abs(h)<1e-6?0:h<0?-1:1}function Ir(h,t,a,f){let g=h[0]*(a[1]-t[1])+t[0]*(h[1]-a[1])+a[0]*(t[1]-h[1]),v=h[0]*(f[1]-t[1])+t[0]*(h[1]-f[1])+f[0]*(t[1]-h[1]);return!((g^v)>=0&&g!==0&&v!==0)&&(g=a[0]*(h[1]-f[1])+f[0]*(a[1]-h[1])+h[0]*(f[1]-a[1]),v=a[0]*(t[1]-f[1])+f[0]*(a[1]-t[1])+t[0]*(f[1]-a[1]),!((g^v)>=0&&g!==0&&v!==0))}li=new WeakMap,Dr=new WeakMap;const Ps=async h=>{if(typeof h!="string")throw new TypeError("Invalid url.");const t=await fetch(h);if(!t.ok)throw Error("Network Error: "+t.statusText);const a=await t.text();if(!a.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const f=document.createElement("div");f.insertAdjacentHTML("beforeend",a);for(let g=0;g<f.childElementCount;++g){let v=f.children[g];v instanceof HTMLStyleElement&&document.head.append(v)}return f.childElementCount==1?f.children[0]:f};var Xt,zt,Zt;class Si extends ht{constructor(t,a){if(super(null,a),Xt.set(this,void 0),!vi(t))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Ne.Rect({left:t.x,top:t.y,width:t.width,height:t.height})),ye(this,Xt,JSON.parse(JSON.stringify(t))),this._mediaType="rect"}extendSet(t,a){return!1}extendGet(t){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(t){this.setRect(t)}getPosition(){return this.getRect()}updatePosition(){S(this,Xt,"f")&&this.setRect(S(this,Xt,"f"))}setRect(t){if(!vi(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),this.set("width",this.convertPropFromViewToImage(t.width)),this.set("height",this.convertPropFromViewToImage(t.height));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",t.x),this.set("top",t.y),this.set("width",t.width),this.set("height",t.height)}this._drawingLayer.renderAll()}else ye(this,Xt,JSON.parse(JSON.stringify(t)))}getRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return S(this,Xt,"f")?JSON.parse(JSON.stringify(S(this,Xt,"f"))):null}}function ks(h,t,a){let f=a.points[this.pointIndex].x-a.pathOffset.x,g=a.points[this.pointIndex].y-a.pathOffset.y;return Ne.util.transformPoint({x:f,y:g},a.calcTransformMatrix())}function Eo(h){let t=new Ne.Point(h.strokeUniform?1/h.scaleX:1,h.strokeUniform?1/h.scaleY:1).multiply(h.strokeWidth);return new Ne.Point(h.width+t.x,h.height+t.y)}function Ns(h,t,a,f){let g=t.target,v=g.controls[g.__corner],y=g.toLocalPoint(new Ne.Point(a,f),"center","center"),w=Eo(g),I=g._getTransformedDimensions(0,0),x={x:y.x*w.x/I.x+g.pathOffset.x,y:y.y*w.y/I.y+g.pathOffset.y};return g.points[v.pointIndex]=x,Ne.controlsUtils.fireEvent("scaling",{e:h,transform:t,pointer:{x:a,y:f}}),!0}function Bs(h,t){return function(a,f,g,v){let y=f.target,w=Ne.util.transformPoint({x:y.points[h].x-y.pathOffset.x,y:y.points[h].y-y.pathOffset.y},y.calcTransformMatrix()),I=t(a,f,g,v);y._setPositionDimensions({});let x=Eo(y),A=(y.points[h].x-y.pathOffset.x)/x.x,L=(y.points[h].y-y.pathOffset.y)/x.y;return y.setPositionByOrigin(w,A+.5,L+.5),I}}Xt=new WeakMap;class Un extends ht{constructor(t,a){if(super(null,a),zt.set(this,void 0),!Ls(t))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Ne.Polygon(t.points,{objectCaching:!1}));const f=this._fabricObject;let g=f.points.length-1;f.controls=f.points.reduce(function(v,y,w){return v["p"+w]=new Ne.Control({positionHandler:ks,actionHandler:Bs(w>0?w-1:g,Ns),actionName:"modifyPolygon",pointIndex:w}),v},{}),ye(this,zt,JSON.parse(JSON.stringify(t))),this._mediaType="polygon"}extendSet(t,a){if(t==="vertices"){const f=this._fabricObject;if(f.group){const v=f.group;f.points=a.map(y=>({x:y.x-v.left-v.width/2,y:y.y-v.top-v.height/2})),v.addWithUpdate()}else f.points=a;const g=f.points.length-1;return f.controls=f.points.reduce(function(v,y,w){return v["p"+w]=new Ne.Control({positionHandler:ks,actionHandler:Bs(w>0?w-1:g,Ns),actionName:"modifyPolygon",pointIndex:w}),v},{}),f._setPositionDimensions({}),!0}}extendGet(t){if(t==="vertices"){const a=[],f=this._fabricObject;if(f.selectable&&!f.group)for(let g in f.oCoords)a.push({x:f.oCoords[g].x,y:f.oCoords[g].y});else for(let g of f.points){let v=g.x-f.pathOffset.x,y=g.y-f.pathOffset.y;const w=Ne.util.transformPoint({x:v,y},f.calcTransformMatrix());a.push({x:w.x,y:w.y})}return a}}updateCoordinateBaseFromImageToView(){const t=this.get("vertices").map(a=>({x:this.convertPropFromViewToImage(a.x),y:this.convertPropFromViewToImage(a.y)}));this.set("vertices",t)}updateCoordinateBaseFromViewToImage(){const t=this.get("vertices").map(a=>({x:this.convertPropFromImageToView(a.x),y:this.convertPropFromImageToView(a.y)}));this.set("vertices",t)}setPosition(t){this.setPolygon(t)}getPosition(){return this.getPolygon()}updatePosition(){S(this,zt,"f")&&this.setPolygon(S(this,zt,"f"))}setPolygon(t){if(!Ls(t))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const a=t.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",a)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",t.points)}this._drawingLayer.renderAll()}else ye(this,zt,JSON.parse(JSON.stringify(t)))}getPolygon(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return S(this,zt,"f")?JSON.parse(JSON.stringify(S(this,zt,"f"))):null}}zt=new WeakMap;const js=h=>{let t=(a=>a.split(`
`).map(f=>f.split("	")))(h);return(a=>{for(let f=0;;f++){let g=-1;for(let v=0;v<a.length;v++){let y=a[v][f];y!==void 0&&y.length>g&&(g=y.length)}if(g===-1)break;for(let v=0;v<a.length;v++){if(f>=a[v].length-1)continue;let y=" ".repeat(g+2-a[v][f].length);a[v][f]=a[v][f].concat(y)}}})(t),(a=>{let f="";for(let g=0;g<a.length;g++)f=f.concat(...a[g],g===a.length-1?"":`
`);return f})(t)};class ga extends ht{constructor(t,a,f){if(super(null,f),Zt.set(this,void 0),!Bn(t))throw new TypeError("Invalid 'text'.");if(!vi(a))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Ne.Textbox(js(t),{left:a.x,top:a.y,width:a.width})),this._text=t,ye(this,Zt,JSON.parse(JSON.stringify(a))),this._mediaType="text"}extendSet(t,a){if(t==="text")return this._text=a,this._fabricObject.set("text",js(a)),!0}extendGet(t){if(t==="text")return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(t){this.setTextRect(t)}getPosition(){return this.getTextRect()}updatePosition(){S(this,Zt,"f")&&this.setTextRect(S(this,Zt,"f"))}setText(t){if(!Bn(t))throw new TypeError("Invalid 'text'.");this.set("text",t)}getText(){return this.get("text")}setTextRect(t){if(!vi(t))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(t.x)),this.set("top",this.convertPropFromViewToImage(t.y)),this.set("width",this.convertPropFromViewToImage(t.width));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",t.x),this.set("top",t.y),this.set("width",t.width)}this._drawingLayer.renderAll()}else ye(this,Zt,JSON.parse(JSON.stringify(t)))}getTextRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return S(this,Zt,"f")?JSON.parse(JSON.stringify(S(this,Zt,"f"))):null}}var Kt,qt,Ai,Gn,Oi,ir,Ri,ut,rr,nr,sr,Co,wo,So,To,Lr,Ve,or,ar,hr,$e,Mr,Fr,Pr,$t,lr,cr,Vn,ct,kr,Io,Wn,Yn,ur,Nr;Zt=new WeakMap;class ma extends Un{constructor(t,a){if(super({points:t?.points},a),Kt.set(this,void 0),!Ms(t))throw new TypeError("Invalid 'quad'.");ye(this,Kt,JSON.parse(JSON.stringify(t))),this._mediaType="quad"}setPosition(t){this.setQuad(t)}getPosition(){return this.getQuad()}updatePosition(){S(this,Kt,"f")&&this.setQuad(S(this,Kt,"f"))}setPolygon(){}getPolygon(){return null}setQuad(t){if(!Ms(t))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const a=t.points.map(f=>({x:this.convertPropFromViewToImage(f.x),y:this.convertPropFromViewToImage(f.y)}));this.set("vertices",a)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",t.points)}this._drawingLayer.renderAll()}else ye(this,Kt,JSON.parse(JSON.stringify(t)))}getQuad(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(t=>({x:this.convertPropFromImageToView(t.x),y:this.convertPropFromImageToView(t.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return S(this,Kt,"f")?JSON.parse(JSON.stringify(S(this,Kt,"f"))):null}}Kt=new WeakMap;class pa extends ht{constructor(t){super(new Ne.Group(t.map(a=>a._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(gt.DIS_SELECTED);const a=this._fabricObject._objects;for(let f of a)setTimeout(()=>{f&&f.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(gt.DIS_DEFAULT);const a=this._fabricObject._objects;for(let f of a)setTimeout(()=>{f&&f.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(t,a){return!1}extendGet(t){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}setChildDrawingItems(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}class re{static createDrawingStyle(t){if(!Fs(t))throw new Error("Invalid style definition.");let a,f=re.USER_START_STYLE_ID;for(;S(re,qt,"f",Ai).has(f);)f++;a=f;const g=JSON.parse(JSON.stringify(t));g.id=a;for(let v in S(re,qt,"f",Gn))g.hasOwnProperty(v)||(g[v]=S(re,qt,"f",Gn)[v]);return S(re,qt,"f",Ai).set(a,g),g.id}static _getDrawingStyle(t,a){if(typeof t!="number")throw new Error("Invalid style id.");const f=S(re,qt,"f",Ai).get(t);return f?a?JSON.parse(JSON.stringify(f)):f:null}static getDrawingStyle(t){return this._getDrawingStyle(t,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(S(re,qt,"f",Ai).values())))}static _updateDrawingStyle(t,a){if(!Fs(a))throw new Error("Invalid style definition.");const f=S(re,qt,"f",Ai).get(t);if(f)for(let g in a)f.hasOwnProperty(g)&&(f[g]=a[g])}static updateDrawingStyle(t,a){this._updateDrawingStyle(t,a)}}qt=re,re.STYLE_BLUE_STROKE=1,re.STYLE_GREEN_STROKE=2,re.STYLE_ORANGE_STROKE=3,re.STYLE_YELLOW_STROKE=4,re.STYLE_BLUE_STROKE_FILL=5,re.STYLE_GREEN_STROKE_FILL=6,re.STYLE_ORANGE_STROKE_FILL=7,re.STYLE_YELLOW_STROKE_FILL=8,re.STYLE_BLUE_STROKE_TRANSPARENT=9,re.STYLE_GREEN_STROKE_TRANSPARENT=10,re.STYLE_ORANGE_STROKE_TRANSPARENT=11,re.USER_START_STYLE_ID=1024,Ai={value:new Map([[re.STYLE_BLUE_STROKE,{id:re.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[re.STYLE_GREEN_STROKE,{id:re.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_ORANGE_STROKE,{id:re.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_YELLOW_STROKE,{id:re.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[re.STYLE_BLUE_STROKE_FILL,{id:re.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_GREEN_STROKE_FILL,{id:re.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_ORANGE_STROKE_FILL,{id:re.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_YELLOW_STROKE_FILL,{id:re.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_BLUE_STROKE_TRANSPARENT,{id:re.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_GREEN_STROKE_TRANSPARENT,{id:re.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[re.STYLE_ORANGE_STROKE_TRANSPARENT,{id:re.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},Gn={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(Ne.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Ne.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(h){h.dispose&&h.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Ne.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Ne.Object.prototype.transparentCorners=!1,Ne.Object.prototype.cornerSize=20,Ne.Object.prototype.touchCornerSize=100,Ne.Object.prototype.cornerColor="rgb(254,142,20)",Ne.Object.prototype.cornerStyle="circle",Ne.Object.prototype.strokeUniform=!0,Ne.Object.prototype.hasBorders=!1,Ne.Canvas.prototype.containerClass="",Ne.Canvas.prototype.getPointer=function(h,t){if(this._absolutePointer&&!t)return this._absolutePointer;if(this._pointer&&t)return this._pointer;var a,f=this.upperCanvasEl,g=Ne.util.getPointer(h,f),v=f.getBoundingClientRect(),y=v.width||0,w=v.height||0;y&&w||("top"in v&&"bottom"in v&&(w=Math.abs(v.top-v.bottom)),"right"in v&&"left"in v&&(y=Math.abs(v.right-v.left))),this.calcOffset(),g.x=g.x-this._offset.left,g.y=g.y-this._offset.top,t||(g=this.restorePointerVpt(g));var I=this.getRetinaScaling();if(I!==1&&(g.x/=I,g.y/=I),y!==0&&w!==0){var x=window.getComputedStyle(f).objectFit,A=f.width,L=f.height,k=y,N=w;a={width:A/k,height:L/N};var P,V,W=A/L,X=k/N;return x==="contain"?W>X?(P=k,V=k/W,{x:g.x*a.width,y:(g.y-(N-V)/2)*a.width}):(P=N*W,V=N,{x:(g.x-(k-P)/2)*a.height,y:g.y*a.height}):x==="cover"?W>X?{x:(A-a.height*k)/2+g.x*a.height,y:g.y*a.height}:{x:g.x*a.width,y:(L-a.width*N)/2+g.y*a.width}:{x:g.x*a.width,y:g.y*a.height}}return a={width:1,height:1},{x:g.x*a.width,y:g.y*a.height}},Ne.Canvas.prototype._onTouchStart=function(h){var t=this.findTarget(h);!this.allowTouchScrolling&&h.cancelable&&h.preventDefault&&h.preventDefault(),t&&h.cancelable&&h.preventDefault&&h.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(h)),this.__onMouseDown(h),this._resetTransformEventData();var a=this.upperCanvasEl,f=this._getEventPrefix();Ne.util.addListener(Ne.document,"touchend",this._onTouchEnd,{passive:!1}),Ne.util.addListener(Ne.document,"touchmove",this._onMouseMove,{passive:!1}),Ne.util.removeListener(a,f+"down",this._onMouseDown)},Ne.Textbox.prototype._wrapLine=function(h,t,a,f){const g=h.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),v=!(!g||!g.length);var y=0,w=this.splitByGrapheme||v,I=[],x=[],A=w?Ne.util.string.graphemeSplit(h):h.split(this._wordJoiners),L="",k=0,N=w?"":" ",P=0,V=0,W=0,X=!0,K=this._getWidthOfCharSpacing();f=f||0,A.length===0&&A.push([]),a-=f;for(var ee=0;ee<A.length;ee++)L=w?A[ee]:Ne.util.string.graphemeSplit(A[ee]),P=this._measureWord(L,t,k),k+=L.length,(y+=V+P-K)>a&&!X?(I.push(x),x=[],y=P,X=!0):y+=K,X||w||x.push(N),x=x.concat(L),V=w?0:this._measureWord([N],t,k),k++,X=!1,P>W&&(W=P);return ee&&I.push(x),W+f>this.dynamicMinWidth&&(this.dynamicMinWidth=W-K+f),I});class He{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(t){this.fabricCanvas.selection=t,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(t,a,f){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,t.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=t.getFabricCanvas();else{let y=this.fabricCanvas=new Ne.Canvas(t,Object.assign(f,{allowTouchScrolling:!0,selection:!1}));y.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),y.lowerCanvasEl.className="",y.upperCanvasEl.className="",y.on("selection:created",function(w){const I=w.selected,x=[];for(let A of I){const L=A.getDrawingItem()._drawingLayer;L&&!x.includes(L)&&x.push(L)}for(let A of x){const L=[];for(let k of I){const N=k.getDrawingItem();N._drawingLayer===A&&L.push(N)}setTimeout(()=>{A.onSelectionChanged&&A.onSelectionChanged(L,[])},0)}}),y.on("before:selection:cleared",function(w){const I=this.getActiveObjects(),x=[];for(let A of I){const L=A.getDrawingItem()._drawingLayer;L&&!x.includes(L)&&x.push(L)}for(let A of x){const L=[];for(let k of I){const N=k.getDrawingItem();N._drawingLayer===A&&L.push(N)}setTimeout(()=>{const k=[];for(let N of L)A.hasDrawingItem(N)&&k.push(N);k.length>0&&A.onSelectionChanged&&A.onSelectionChanged([],k)},0)}}),y.on("selection:updated",function(w){const I=w.selected,x=w.deselected,A=[];for(let L of I){const k=L.getDrawingItem()._drawingLayer;k&&!A.includes(k)&&A.push(k)}for(let L of x){const k=L.getDrawingItem()._drawingLayer;k&&!A.includes(k)&&A.push(k)}for(let L of A){const k=[],N=[];for(let P of I){const V=P.getDrawingItem();V._drawingLayer===L&&k.push(V)}for(let P of x){const V=P.getDrawingItem();V._drawingLayer===L&&N.push(V)}setTimeout(()=>{L.onSelectionChanged&&L.onSelectionChanged(k,N)},0)}}),y.wrapperEl.style.position="absolute",t.getFabricCanvas=()=>this.fabricCanvas}let g,v;switch(this.id=a,a){case He.DDN_LAYER_ID:g=re.getDrawingStyle(re.STYLE_BLUE_STROKE),v=re.getDrawingStyle(re.STYLE_BLUE_STROKE_FILL);break;case He.DBR_LAYER_ID:g=re.getDrawingStyle(re.STYLE_ORANGE_STROKE),v=re.getDrawingStyle(re.STYLE_ORANGE_STROKE_FILL);break;case He.DLR_LAYER_ID:g=re.getDrawingStyle(re.STYLE_GREEN_STROKE),v=re.getDrawingStyle(re.STYLE_GREEN_STROKE_FILL);break;default:g=re.getDrawingStyle(re.STYLE_YELLOW_STROKE),v=re.getDrawingStyle(re.STYLE_YELLOW_STROKE_FILL)}for(let y of ht.arrMediaTypes)this.mapType_StateAndStyleId.set(y,{default:g.id,selected:v.id})}getId(){return this.id}setVisible(t){if(t){for(let a of this._arrFabricObject)a.visible=!0,a.hasControls=!0;this._visible=!0}else{for(let a of this._arrFabricObject)a.visible=!1,a.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(t){return t.styleId?re.getDrawingStyle(t.styleId):re.getDrawingStyle(t._mapState_StyleId.get(t.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(t,a,f,g){const v=this.getDrawingItems(y=>y._mediaType===t);for(let y of v)y.styleSelector===a&&this._changeItemStyle(y,f,!0);g||this.fabricCanvas.renderAll()}_changeItemStyle(t,a,f){if(!t||!a)return;const g=t._getFabricObject();typeof t.styleId=="number"&&(a=re.getDrawingStyle(t.styleId)),g.strokeWidth=a.lineWidth,a.paintMode==="fill"?(g.fill=a.fillStyle,g.stroke=a.fillStyle):a.paintMode==="stroke"?(g.fill="transparent",g.stroke=a.strokeStyle):a.paintMode==="strokeAndFill"&&(g.fill=a.fillStyle,g.stroke=a.strokeStyle),g.fontFamily&&(g.fontFamily=a.fontFamily),g.fontSize&&(g.fontSize=a.fontSize),g.group||(g.dirty=!0),f||this.fabricCanvas.renderAll()}_updateGroupItem(t,a,f){if(!t||!a)return;const g=t.getChildDrawingItems();if(f==="add"){if(g.includes(a))return;const v=a._getFabricObject();if(this.fabricCanvas.getObjects().includes(v)){if(!this._arrFabricObject.includes(v))throw new Error("Existed in other drawing layers.");a._zIndex=null}else{let y;if(a.styleId)y=re.getDrawingStyle(a.styleId);else{const w=this.mapType_StateAndStyleId.get(a._mediaType);y=re.getDrawingStyle(w[t.styleSelector]);const I=()=>{this._changeItemStyle(a,re.getDrawingStyle(this.mapType_StateAndStyleId.get(a._mediaType).selected),!0)},x=()=>{this._changeItemStyle(a,re.getDrawingStyle(this.mapType_StateAndStyleId.get(a._mediaType).default),!0)};a._on("selected",I),a._on("deselected",x),a._funcChangeStyleToSelected=I,a._funcChangeStyleToDefault=x}a._drawingLayer=this,a._drawingLayerId=this.id,this._changeItemStyle(a,y,!0)}t._fabricObject.addWithUpdate(a._getFabricObject())}else{if(f!=="remove"||!g.includes(a))return;a._zIndex=null,a._drawingLayer=null,a._drawingLayerId=null,a._off("selected",a._funcChangeStyleToSelected),a._off("deselected",a._funcChangeStyleToDefault),a._funcChangeStyleToSelected=null,a._funcChangeStyleToDefault=null,t._fabricObject.removeWithUpdate(a._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(t,a){if(!(t instanceof ht))throw new TypeError("Invalid 'drawingItem'.");if(t._drawingLayer){if(t._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let f=t._getFabricObject();const g=this.fabricCanvas.getObjects();let v,y;if(g.includes(f)){if(this._arrFabricObject.includes(f))return;throw new Error("Existed in other drawing layers.")}if(t._mediaType==="group"){v=t.getChildDrawingItems();for(let x of v)if(x._drawingLayer&&x._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(a&&typeof a=="object"&&!Array.isArray(a))for(let x in a)f.set(x,a[x]);if(v){for(let x of v){const A=this.mapType_StateAndStyleId.get(x._mediaType);for(let L of ht.arrStyleSelectors)x._mapState_StyleId.set(L,A[L]);if(x.styleId)y=re.getDrawingStyle(x.styleId);else{y=re.getDrawingStyle(A.default);const L=()=>{this._changeItemStyle(x,re.getDrawingStyle(this.mapType_StateAndStyleId.get(x._mediaType).selected),!0)},k=()=>{this._changeItemStyle(x,re.getDrawingStyle(this.mapType_StateAndStyleId.get(x._mediaType).default),!0)};x._on("selected",L),x._on("deselected",k),x._funcChangeStyleToSelected=L,x._funcChangeStyleToDefault=k}x._drawingLayer=this,x._drawingLayerId=this.id,this._changeItemStyle(x,y,!0)}f.dirty=!0,this.fabricCanvas.renderAll()}else{const x=this.mapType_StateAndStyleId.get(t._mediaType);for(let A of ht.arrStyleSelectors)t._mapState_StyleId.set(A,x[A]);if(t.styleId)y=re.getDrawingStyle(t.styleId);else{y=re.getDrawingStyle(x.default);const A=()=>{this._changeItemStyle(t,re.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).selected))},L=()=>{this._changeItemStyle(t,re.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).default))};t._on("selected",A),t._on("deselected",L),t._funcChangeStyleToSelected=A,t._funcChangeStyleToDefault=L}this._changeItemStyle(t,y)}t._zIndex=this.id,t._drawingLayer=this,t._drawingLayerId=this.id;const w=this._arrFabricObject.length;let I=g.length;if(w)I=g.indexOf(this._arrFabricObject[w-1])+1;else for(let x=0;x<g.length;x++)if(t._zIndex<g[x].getDrawingItem()._zIndex){I=x;break}this._arrDrwaingItem.push(t),this._arrFabricObject.push(f),this._visible?f.visible=!0:f.visible=!1,this.fabricCanvas.insertAt(f,I,!1)}addDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")t._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");t._setEditable(!0)}this._addDrawingItem(t),t.updatePosition()}addDrawingItems(t){for(let a of t)this.addDrawingItem(a)}removeDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(t))return;if(t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,t._mediaType==="group"){const f=t.getChildDrawingItems();for(let g of f)g._zIndex=null,g._drawingLayer=null,g._drawingLayerId=null,g._off("selected",g._funcChangeStyleToSelected),g._off("deselected",g._funcChangeStyleToDefault),g._funcChangeStyleToSelected=null,g._funcChangeStyleToDefault=null,g._mapState_StyleId.clear()}else t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,t._mapState_StyleId.clear();const a=t._getFabricObject();t.styleSelector==="selected"&&(a.group?a.group.removeWithUpdate(a):this.fabricCanvas._activeObject=null,t.setState(gt.DIS_DEFAULT)),this.fabricCanvas.remove(a),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(t),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(a),1)}removeDrawingItems(t){for(let a of t)this.removeDrawingItem(a)}setDrawingItems(t){this.clearDrawingItems(),this.addDrawingItems(t)}getDrawingItems(t){return t&&typeof t=="function"?this._arrDrwaingItem.filter(t):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const t=this.fabricCanvas.getActiveObjects(),a=[];for(let f of t)this._arrFabricObject.includes(f)&&a.push(f.getDrawingItem());return a}hasDrawingItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(t)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(t,a,f){a?a.forEach(y=>y.toLowerCase()):a=ht.arrMediaTypes,f?f.forEach(y=>y.toLowerCase()):f=ht.arrStyleSelectors;const g=re.getDrawingStyle(t);if(!g)throw new Error(`The 'drawingStyle' with id '${t}' doesn't exist.`);let v;for(let y of a)if(v=this.mapType_StateAndStyleId.get(y),v)for(let w of f){this._changeMediaTypeCurStyleInStyleSelector(y,w,g,!0),v[w]=t;for(let I of this._arrDrwaingItem)I._mediaType===y&&I._mapState_StyleId.set(w,t)}this.fabricCanvas.renderAll()}setDefaultStyle(t,a,f){const g=[];f&it.DIMT_RECTANGLE&&g.push("rect"),f&it.DIMT_QUADRILATERAL&&g.push("quad"),f&it.DIMT_TEXT&&g.push("text"),f&it.DIMT_ARC&&g.push("arc"),f&it.DIMT_IMAGE&&g.push("image"),f&it.DIMT_POLYGON&&g.push("polygon"),f&it.DIMT_LINE&&g.push("line");const v=[];a&gt.DIS_DEFAULT&&v.push("default"),a&gt.DIS_SELECTED&&v.push("selected"),this._setDefaultStyle(t,g.length?g:null,v.length?v:null)}setMode(t){if((t=t.toLowerCase())==="viewer"){for(let a of this._arrDrwaingItem)a._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(t!=="editor")throw new RangeError("Invalid value.");for(let a of this._arrDrwaingItem)a._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(t,a){this.fabricCanvas.setDimensions(t,a)}_setObjectFit(t){if(t=t.toLowerCase(),!["contain","cover"].includes(t))throw new Error(`Unsupported value '${t}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=t,this.fabricCanvas.upperCanvasEl.style.objectFit=t}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let t of this._arrDrwaingItem){const a=this._getItemCurrentStyle(t);this._changeItemStyle(t,a,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}He.DDN_LAYER_ID=1,He.DBR_LAYER_ID=2,He.DLR_LAYER_ID=3,He.USER_DEFINED_LAYER_BASE_ID=100,He.TIP_LAYER_ID=999;class _a{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(t,a){if(this.getDrawingLayer(a))throw new Error("Existed drawing layer id.");const f=new He(t,a,{enableRetinaScaling:!1});return f._manager=this,this._arrDrawingLayer.push(f),this._switchPointerEvent(),f}deleteDrawingLayer(t){const a=this.getDrawingLayer(t);if(!a)return;const f=this._arrDrawingLayer;a.dispose(),f.splice(f.indexOf(a),1),this._switchPointerEvent()}clearDrawingLayers(){for(let t of this._arrDrawingLayer)t.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(t){for(let a of this._arrDrawingLayer)if(a.getId()===t)return a;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const t=this._getFabricCanvas().getActiveObjects(),a=[];for(let f of t)a.push(f.getDrawingItem());return a}setDimensions(t,a){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(t,a)}setObjectFit(t){for(let a of this._arrDrawingLayer)a&&a._setObjectFit(t)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(t){if(!this._arrDrawingLayer.length)return;const a=this._getFabricCanvas();a.wrapperEl.style.display=t?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let t of this._arrDrawingLayer)t.getMode()}}class va extends ga{constructor(t,a,f,g,v){super(t,{x:a,y:f,width:g,height:0},v),Oi.set(this,void 0),ir.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var y=0,w=0,I=this._textLines.length;w<I;w++)y+=this.getHeightOfLine(w);return y+=2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(t){ye(this,Oi,t),S(this,ir,"f")&&clearTimeout(S(this,ir,"f")),S(this,Oi,"f")>=0&&ye(this,ir,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},S(this,Oi,"f")))}getDuration(){return S(this,Oi,"f")}}Oi=new WeakMap,ir=new WeakMap;class ya{constructor(){Ri.add(this),ut.set(this,void 0),rr.set(this,void 0),nr.set(this,void 0),sr.set(this,!0),this._drawingLayerManager=new _a}createDrawingLayerBaseCvs(t,a,f="contain"){if(typeof t!="number"||t<=1)throw new Error("Invalid 'width'.");if(typeof a!="number"||a<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(f))throw new Error("Unsupported 'objectFit'.");const g=document.createElement("canvas");return g.width==t&&g.height==a||(g.width=t,g.height=a),g.style.objectFit=f,g}_createDrawingLayer(t,a,f,g){if(!this._layerBaseCvs){let w;try{w=this.getContentDimensions()}catch(I){if((I.message||I)!=="Invalid content dimensions.")throw I}a||(a=w?.width||1280),f||(f=w?.height||720),g||(g=w?.objectFit||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(a,f,g)}const v=this._layerBaseCvs,y=this._drawingLayerManager.createDrawingLayer(v,t);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",v.parentElement),y}createDrawingLayer(){let t;for(let a=He.USER_DEFINED_LAYER_BASE_ID;;a++)if(!this._drawingLayerManager.getDrawingLayer(a)&&a!==He.TIP_LAYER_ID){t=a;break}return this._createDrawingLayer(t)}deleteDrawingLayer(t){var a;this._drawingLayerManager.deleteDrawingLayer(t),this._drawingLayerManager.getAllDrawingLayers().length||((a=this._innerComponent)===null||a===void 0||a.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(t){if(typeof t!="number")throw new TypeError("Invalid id.");if(t<He.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${t} is not defined by users.`);this.deleteDrawingLayer(t)}_clearDrawingLayers(){const t=this.getAllDrawingLayers();for(let a of t)this.deleteDrawingLayer(a.getId())}clearUserDefinedDrawingLayers(){const t=this.getAllDrawingLayers();for(let a of t){const f=a.getId();f<He.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(f)}}getDrawingLayer(t){return t==He.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(t)||([He.DDN_LAYER_ID,He.DBR_LAYER_ID,He.DLR_LAYER_ID].includes(t)?this._createDrawingLayer(t):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(t=>t.getId()>=0&&t.getId()!==He.TIP_LAYER_ID)}updateDrawingLayers(t){((a,f,g)=>{if(!(a<=1||f<=1)){if(!["contain","cover"].includes(g))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:a,height:f},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(g)}})(t.width,t.height,t.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(t){if(!(vo(a=t)&&da(a.topLeftPoint)&&Vi(a.width))||a.width<=0||!Vi(a.duration)||"coordinateBase"in a&&!["view","image"].includes(a.coordinateBase))throw new Error("Invalid tip config.");var a;ye(this,ut,JSON.parse(JSON.stringify(t))),S(this,ut,"f").coordinateBase||(S(this,ut,"f").coordinateBase="view"),ye(this,nr,t.duration),S(this,Ri,"m",To).call(this)}getTipConfig(){return S(this,ut,"f")?S(this,ut,"f"):null}setTipVisible(t){if(typeof t!="boolean")throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",t),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),ye(this,sr,t)}isTipVisible(){return S(this,sr,"f")}updateTipMessage(t){if(!S(this,ut,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=re.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(He.TIP_LAYER_ID)||this._createDrawingLayer(He.TIP_LAYER_ID)),this._tip?this._tip.set("text",t):this._tip=S(this,Ri,"m",Co).call(this,t,S(this,ut,"f").topLeftPoint.x,S(this,ut,"f").topLeftPoint.y,S(this,ut,"f").width,S(this,ut,"f").coordinateBase,this._tipStyleId),S(this,Ri,"m",wo).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",S(this,sr,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),S(this,rr,"f")&&clearTimeout(S(this,rr,"f")),S(this,nr,"f")>=0&&ye(this,rr,setTimeout(()=>{S(this,Ri,"m",So).call(this)},S(this,nr,"f")))}}ut=new WeakMap,rr=new WeakMap,nr=new WeakMap,sr=new WeakMap,Ri=new WeakSet,Co=function(h,t,a,f,g,v){const y=new va(h,t,a,f,v);return y.coordinateBase=g,y},wo=function(h,t){t.hasDrawingItem(h)||t.addDrawingItems([h])},So=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},To=function(){if(!this._tip)return;const h=S(this,ut,"f");this._tip.coordinateBase=h.coordinateBase,this._tip.setTextRect({x:h.topLeftPoint.x,y:h.topLeftPoint.y,width:h.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class bo extends HTMLElement{constructor(){super(),Lr.set(this,void 0);const t=document.createElement("template").content,a=document.createElement("div");a.setAttribute("class","wrapper"),t.appendChild(a),ye(this,Lr,a);const f=document.createElement("slot");f.setAttribute("name","single-frame-input-container"),a.append(f);const g=document.createElement("slot");g.setAttribute("name","content"),a.append(g);const v=document.createElement("slot");v.setAttribute("name","drawing-layer"),a.append(v);const y=document.createElement("style");y.textContent=`
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}
::slotted(canvas[slot="content"]) {
  object-fit: contain;
  pointer-events: none;
}
::slotted(div[slot="single-frame-input-container"]) {
  width: 1px;
  height: 1px;
  overflow: hidden;
  pointer-events: none;
}
::slotted(*) {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
    `,t.appendChild(y),this.attachShadow({mode:"open"}).appendChild(t.cloneNode(!0))}getWrapper(){return S(this,Lr,"f")}setElement(t,a){if(!(a instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");this.removeElement(t),a.setAttribute("slot",t),this.appendChild(a)}getElement(t){if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${t}"]`)}removeElement(t){var a;if(!["content","single-frame-input-container","drawing-layer"].includes(t))throw new TypeError("Invalid 'slot'.");(a=this.querySelectorAll(`[slot="${t}"]`))===null||a===void 0||a.forEach(f=>f.remove())}}Lr=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",bo);class Ti extends HTMLElement{constructor(){super();const t=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(t.cloneNode(!0))}showScanLaser(){const t=this.shadowRoot.querySelector(".dce-scanlight");t&&(t.style.display="")}hideScanLaser(){const t=this.shadowRoot.querySelector(".dce-scanlight");t&&(t.style.display="none")}getElement(t){return this.shadowRoot.querySelector(t)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class qe extends ya{static get engineResourcePath(){return Ze.engineResourcePaths.dce}static set defaultUIElementURL(t){qe._defaultUIElementURL=t}static get defaultUIElementURL(){var t;return(t=qe._defaultUIElementURL)===null||t===void 0?void 0:t.replace("@engineResourcePath/",qe.engineResourcePath)}static async createInstance(t){customElements.get(qe.uiComponentName)||customElements.define(qe.uiComponentName,Ti);const a=new qe;return await a.setUIElement(t||qe.defaultUIElementURL),a}static _transformCoordinates(t,a,f,g,v,y,w){const I=y/g,x=w/v;t.x=Math.round(t.x/I+a),t.y=Math.round(t.y/x+f)}set _singleFrameMode(t){if(!["disabled","image","camera"].includes(t))throw new Error("Invalid value.");if(t!==S(this,lr,"f")){if(ye(this,lr,t),S(this,Ve,"m",ct).call(this))ye(this,$e,null),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!S(this,$e,"f")){const a=document.createElement("video");a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.objectFit=this.getVideoFit(),a.setAttribute("autoplay","true"),a.setAttribute("playsinline","true"),a.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(tt.OS)&&a.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),ye(this,$e,a);const f=document.createElement("div");f.append(a),f.style.overflow="hidden",this._videoContainer=f,this._innerComponent.setElement("content",f)}S(this,Ve,"m",ct).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return S(this,lr,"f")}get disposed(){return S(this,Vn,"f")}constructor(){super(),Ve.add(this),or.set(this,void 0),ar.set(this,void 0),hr.set(this,void 0),this.containerClassName="dce-video-container",$e.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,Mr.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,Fr.set(this,!1),Pr.set(this,!1),$t.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{S(this,Ve,"m",ur).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&S(this,Ve,"m",Yn).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{qe._onLog&&qe._onLog("window resize event triggered."),S(this,$t,"f").width===document.documentElement.clientWidth&&S(this,$t,"f").height===document.documentElement.clientHeight||(S(this,$t,"f").width=document.documentElement.clientWidth,S(this,$t,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},lr.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!S(this,Ve,"m",ct).call(this))return;let t;if(this._singleFrameInputContainer)t=this._singleFrameInputContainer.firstElementChild;else{t=document.createElement("input"),t.setAttribute("type","file"),this._singleFrameMode==="camera"?(t.setAttribute("capture",""),t.setAttribute("accept","image/*")):this._singleFrameMode==="image"&&(t.removeAttribute("capture"),t.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),t.addEventListener("change",async()=>{const f=t.files[0];t.value="";{const g=async k=>{let N=null,P=null;if(typeof createImageBitmap<"u")try{if(N=await createImageBitmap(k),N)return N}catch{}var V;return N||(P=await(V=k,new Promise((W,X)=>{let K=URL.createObjectURL(V),ee=new Image;ee.src=K,ee.onload=()=>{URL.revokeObjectURL(ee.src),W(ee)},ee.onerror=ge=>{X(new Error("Can't convert blob to image : "+(ge instanceof Event?ge.type:ge)))}}))),P},v=(k,N,P,V)=>{k.width==P&&k.height==V||(k.width=P,k.height=V);const W=k.getContext("2d");W.clearRect(0,0,k.width,k.height),W.drawImage(N,0,0)},y=await g(f),w=y instanceof HTMLImageElement?y.naturalWidth:y.width,I=y instanceof HTMLImageElement?y.naturalHeight:y.height;let x=this._cvsSingleFrameMode;const A=x?.width,L=x?.height;x||(x=document.createElement("canvas"),this._cvsSingleFrameMode=x),v(x,y,w,I),this._innerComponent.setElement("content",x),A===x.width&&L===x.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout(()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)},0)}),t.style.position="absolute",t.style.top="-9999px",t.style.backgroundColor="transparent",t.style.color="transparent";const a=document.createElement("div");a.append(t),this._innerComponent.setElement("single-frame-input-container",a),this._singleFrameInputContainer=a}t?.click()},cr.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(t,a)=>{var f,g,v,y;if(this.disposed||(this.clearAllInnerDrawingItems(),!t))return;const w=t.originalImageTag;if(!w)return;const I=t.items;if(!I?.length)return;const x=((f=w.cropRegion)===null||f===void 0?void 0:f.left)||0,A=((g=w.cropRegion)===null||g===void 0?void 0:g.top)||0,L=!((v=w.cropRegion)===null||v===void 0)&&v.right?w.cropRegion.right-x:w.originalWidth,k=!((y=w.cropRegion)===null||y===void 0)&&y.bottom?w.cropRegion.bottom-A:w.originalHeight,N=w.currentWidth,P=w.currentHeight,V=(K,ee,ge,ce,Se,De,p,me,Te=[],ue)=>{ee.forEach(r=>qe._transformCoordinates(r,ge,ce,Se,De,p,me));const s=new ma({points:[{x:ee[0].x,y:ee[0].y},{x:ee[1].x,y:ee[1].y},{x:ee[2].x,y:ee[2].y},{x:ee[3].x,y:ee[3].y}]},ue);for(let r of Te)s.addNote(r);K.addDrawingItems([s]),S(this,cr,"f").push(s)};let W,X;for(let K of I)switch(K.type){case Ce.CRIT_ORIGINAL_IMAGE:break;case Ce.CRIT_BARCODE:W=this.getDrawingLayer(He.DBR_LAYER_ID),X=[{name:"format",content:K.formatString},{name:"text",content:K.text}],a?.isBarcodeVerifyOpen?K.verified?V(W,K.location.points,x,A,L,k,N,P,X):V(W,K.location.points,x,A,L,k,N,P,X,re.STYLE_ORANGE_STROKE_TRANSPARENT):V(W,K.location.points,x,A,L,k,N,P,X);break;case Ce.CRIT_TEXT_LINE:W=this.getDrawingLayer(He.DLR_LAYER_ID),X=[{name:"text",content:K.text}],a.isLabelVerifyOpen?K.verified?V(W,K.location.points,x,A,L,k,N,P,X):V(W,K.location.points,x,A,L,k,N,P,X,re.STYLE_GREEN_STROKE_TRANSPARENT):V(W,K.location.points,x,A,L,k,N,P,X);break;case Ce.CRIT_DETECTED_QUAD:W=this.getDrawingLayer(He.DDN_LAYER_ID),a?.isDetectVerifyOpen?K.verified?V(W,K.location.points,x,A,L,k,N,P,[]):V(W,K.location.points,x,A,L,k,N,P,[],re.STYLE_BLUE_STROKE_TRANSPARENT):V(W,K.location.points,x,A,L,k,N,P,[]);break;case Ce.CRIT_NORMALIZED_IMAGE:W=this.getDrawingLayer(He.DDN_LAYER_ID),a?.isNormalizeVerifyOpen?K.verified?V(W,K.location.points,x,A,L,k,N,P,[]):V(W,K.location.points,x,A,L,k,N,P,[],re.STYLE_BLUE_STROKE_TRANSPARENT):V(W,K.location.points,x,A,L,k,N,P,[]);break;case Ce.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},Vn.set(this,!1),this.eventHandler=new yo,this.eventHandler.on("content:updated",()=>{S(this,or,"f")&&clearTimeout(S(this,or,"f")),ye(this,or,setTimeout(()=>{if(this.disposed)return;let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(a){if((a.message||a)==="Invalid content dimensions.")return;throw a}this.updateDrawingLayers(t),this.updateConvertedRegion(t)},0))}),this.eventHandler.on("videoEl:resized",()=>{S(this,ar,"f")&&clearTimeout(S(this,ar,"f")),ye(this,ar,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0))})}_setUIElement(t){t instanceof HTMLTemplateElement?(window._dce_default_template=t,this.UIElement=new Ti):this.UIElement=t,this._unbindUI(),this._bindUI()}async setUIElement(t){let a;if(a=typeof t=="string"?await Ps(t):t,a instanceof HTMLDivElement&&a.childElementCount==0){const f=await Ps(qe.defaultUIElementURL);f instanceof HTMLTemplateElement?(window._dce_default_template=f,a.append(new Ti)):a.append(f),this._setUIElement(a)}else this._setUIElement(a)}getUIElement(){return this.UIElement}_bindUI(){var t;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let a,f=this.UIElement;if(f instanceof Ti?a=f.getElement(`.${this.containerClassName}`):f instanceof HTMLDivElement&&f.childElementCount===1&&f.firstElementChild instanceof Ti?(a=f.firstElementChild.getElement(`.${this.containerClassName}`),f=f.firstElementChild):a=f.classList.contains(this.containerClassName)?f:f.querySelector(`.${this.containerClassName}`),!a)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new bo,a.appendChild(this._innerComponent),!S(this,Ve,"m",ct).call(this)){const g=document.createElement("video");g.style.position="absolute",g.style.left="0",g.style.top="0",g.style.width="100%",g.style.height="100%",g.style.objectFit=this.getVideoFit(),g.setAttribute("autoplay","true"),g.setAttribute("playsinline","true"),g.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(tt.OS)&&g.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),ye(this,$e,g);const v=document.createElement("div");v.append(g),v.style.overflow="hidden",this._videoContainer=v,this._innerComponent.setElement("content",v)}if(f instanceof Ti?(this._selRsl=f.getElement(".dce-sel-resolution"),this._selMinLtr=f.getElement(".dlr-sel-minletter"),this._divScanArea=f.getElement(".dce-scanarea"),this._divScanLight=f.getElement(".dce-scanlight"),this._bgLoading=f.getElement(".dce-bg-loading"),this._bgCamera=f.getElement(".dce-bg-camera"),this._selCam=f.getElement(".dce-sel-camera"),this._optGotRsl=f.getElement(".dce-opt-gotResolution"),this._btnClose=f.getElement(".dce-btn-close"),this._optGotMinLtr=f.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=f.querySelector(".dce-sel-resolution"),this._selMinLtr=f.querySelector(".dlr-sel-minletter"),this._divScanArea=f.querySelector(".dce-scanarea"),this._divScanLight=f.querySelector(".dce-scanlight"),this._bgLoading=f.querySelector(".dce-bg-loading"),this._bgCamera=f.querySelector(".dce-bg-camera"),this._selCam=f.querySelector(".dce-sel-camera"),this._optGotRsl=f.querySelector(".dce-opt-gotResolution"),this._btnClose=f.querySelector(".dce-btn-close"),this._optGotMinLtr=f.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||S(this,Ve,"m",ct).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||S(this,Ve,"m",ct).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||S(this,Ve,"m",ur).call(this),S(this,Ve,"m",ct).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),S(this,Ve,"m",ct).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(v=>{var y;qe._onLog&&qe._onLog("resize observer triggered.");for(let w of v)w.target===((y=this._innerComponent)===null||y===void 0?void 0:y.getWrapper())&&this._videoResizeListener()}));const g=(t=this._innerComponent)===null||t===void 0?void 0:t.getWrapper();g&&this._resizeObserver.observe(g)}S(this,$t,"f").width=document.documentElement.clientWidth,S(this,$t,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var t,a,f,g;S(this,Ve,"m",ct).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),S(this,Ve,"m",ur).call(this),(t=this._drawingLayerManager)===null||t===void 0||t.clearDrawingLayers(),(a=this._innerComponent)===null||a===void 0||a.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,(f=this._innerComponent)===null||f===void 0||f.remove(),this._innerComponent=null,ye(this,$e,null),(g=this._videoContainer)===null||g===void 0||g.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(t,a){if(!this._selCam)return;let f;this._selCam.textContent="";for(let g of a){const v=document.createElement("option");v.value=g.deviceId,v.innerText=g.label,this._selCam.append(v),g.deviceId&&t&&t.deviceId==g.deviceId&&(f=v)}this._selCam.value=f?f.value:""}_renderResolutionInfo(t){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",t.width),this._optGotRsl.setAttribute("data-height",t.height),this._optGotRsl.innerText="got "+t.width+"x"+t.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return S(this,$e,"f")}isVideoLoaded(){return!!S(this,$e,"f")&&S(this,$e,"f").readyState==4}setVideoFit(t){if(t=t.toLowerCase(),!["contain","cover"].includes(t))throw new Error(`Unsupported value '${t}'.`);if(this.videoFit=t,!S(this,$e,"f")||(S(this,$e,"f").style.objectFit=t,S(this,Ve,"m",ct).call(this)))return;let a;this._updateVideoContainer();try{a=this.getContentDimensions()}catch(f){if((f.message||f)==="Invalid content dimensions.")return;throw f}S(this,Ve,"m",Nr).call(this,a,this.getConvertedRegion()),this.updateDrawingLayers(a)}getVideoFit(){return this.videoFit}getContentDimensions(){var t,a,f,g;let v,y,w;if(S(this,Ve,"m",ct).call(this)?(v=(f=this._cvsSingleFrameMode)===null||f===void 0?void 0:f.width,y=(g=this._cvsSingleFrameMode)===null||g===void 0?void 0:g.height,w="contain"):(v=(t=S(this,$e,"f"))===null||t===void 0?void 0:t.videoWidth,y=(a=S(this,$e,"f"))===null||a===void 0?void 0:a.videoHeight,w=this.getVideoFit()),!v||!y)throw new Error("Invalid content dimensions.");return{width:v,height:y,objectFit:w}}updateConvertedRegion(t){const a=Rr.convert(this.scanRegion,t.width,t.height);ye(this,Mr,a),S(this,hr,"f")&&clearTimeout(S(this,hr,"f")),ye(this,hr,setTimeout(()=>{let f;try{f=this.getContentDimensions()}catch(g){if((g.message||g)==="Invalid content dimensions.")return;throw g}S(this,Ve,"m",kr).call(this,f,a),S(this,Ve,"m",Nr).call(this,f,a)},0))}getConvertedRegion(){return S(this,Mr,"f")}setScanRegion(t){if(t!=null&&!as(t)&&!vi(t))throw TypeError("Invalid 'region'.");let a;this.scanRegion=t?JSON.parse(JSON.stringify(t)):null;try{a=this.getContentDimensions()}catch(f){if((f.message||f)==="Invalid content dimensions.")return;throw f}this.updateConvertedRegion(a)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(t){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const a=S(this,$e,"f").videoWidth,f=S(this,$e,"f").videoHeight,g=this.getVideoFit(),{width:v,height:y}=this._innerComponent.getBoundingClientRect();if(v<=0||y<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let w;const I={x:0,y:0,width:a,height:f,isMeasuredInPercentage:!1};if(g==="cover"&&(v/y<a/f?(w=y/f,I.x=Math.floor((a-v/w)/2),I.y=0,I.width=Math.ceil(v/w),I.height=f):(w=v/a,I.x=0,I.y=Math.floor((f-y/w)/2),I.width=a,I.height=Math.ceil(y/w))),t?.inPixels)return I;const x=I;return x.x=Math.ceil(x.x/f*100),x.y=Math.ceil(x.y/a*100),x.width=Math.floor(x.width/a*100),x.height=Math.floor(x.height/f*100),x.isMeasuredInPercentage=!0,I}setScanRegionMask(t,a,f,g){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||S(this,Ve,"m",Wn).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=re.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=re.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const v=this._drawingLayerOfMask.width,y=this._drawingLayerOfMask.height,w=new Si({x:0,y:0,width:v,height:y},this._maskBackRectStyleId),I=new Si({x:-v/2,y:-y/2+a,width:t,height:g}),x=new Si({x:-v/2+t+f,y:-y/2+a,width:v-t-f<0?0:v-t-f,height:g}),A=new Si({x:-v/2,y:-y/2,width:v,height:a}),L=new Si({x:-v/2,y:-y/2+a+g,width:v,height:y-a-g<0?0:y-a-g});I.set("strokeWidth",0),x.set("strokeWidth",0),A.set("strokeWidth",0),L.set("strokeWidth",0);const k=new pa([I,x,A,L])._getFabricObject();w.set("clipPath",k);const N=new Si({x:t,y:a,width:f,height:g},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([w,N])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(t){ye(this,Fr,t),t?S(this,Ve,"m",Io).call(this):S(this,Ve,"m",Wn).call(this)}setScanRegionMaskVisible(t){this._setScanRegionMaskVisible(t),this._userSetMaskVisible=t}isScanRegionMaskVisible(){return S(this,Fr,"f")}setScanRegionMaskStyle(t){if(!t)return;let a;t.fillStyle&&(this.regionMaskFillStyle=t.fillStyle),t.strokeStyle&&(this.regionMaskStrokeStyle=t.strokeStyle),t.lineWidth&&(this.regionMaskLineWidth=t.lineWidth),this._maskBackRectStyleId&&re.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&re.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{a=this.getContentDimensions()}catch(f){if((f.message||f)==="Invalid content dimensions.")return;throw f}S(this,Ve,"m",kr).call(this,a,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(t){ye(this,Pr,t),t?S(this,Ve,"m",Yn).call(this):S(this,Ve,"m",ur).call(this)}setScanLaserVisible(t){this._setScanLaserVisible(t),this._userSetLaserVisible=t}isScanLaserVisible(){return S(this,Pr,"f")}_updateVideoContainer(){if(!S(this,$e,"f")||S(this,Ve,"m",ct).call(this))return;let t=1;const a=S(this,$e,"f").style.transform.match(/scale\((.+)\)/);a&&(t=parseFloat(a[1]));const f=this._videoContainer;if(this.videoFit==="contain"&&t>1){const g=S(this,$e,"f").videoWidth,v=S(this,$e,"f").videoHeight,{width:y,height:w}=this._innerComponent.getBoundingClientRect(),I=g/v;if(y/w<I){let x=y/I;f.style.left="0",f.style.top=(w-x)/2/w*100+"%",f.style.width="100%",f.style.height=x/w*100+"%"}else{let x=w*I;f.style.left=(y-x)/2/y*100+"%",f.style.top="0",f.style.width=x/y*100+"%",f.style.height="100%"}}else f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%"}updateLayers(){let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(f){if((f.message||f)==="Invalid content dimensions.")return;throw f}const a=this.getConvertedRegion();S(this,Ve,"m",Nr).call(this,t,a),this.updateDrawingLayers(t),S(this,Ve,"m",kr).call(this,t,a)}clearAllInnerDrawingItems(){S(this,cr,"f").forEach(t=>t.remove()),S(this,cr,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let t in this)delete this[t];Object.defineProperty(this,"disposed",{value:!0})}}function R(h,t,a,f){if(a==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?h!==t||!f:!t.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?f:a==="a"?f.call(h):f?f.value:t.get(h)}function ke(h,t,a,f,g){if(typeof t=="function"?h!==t||!g:!t.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(h,a),a}or=new WeakMap,ar=new WeakMap,hr=new WeakMap,$e=new WeakMap,Mr=new WeakMap,Fr=new WeakMap,Pr=new WeakMap,$t=new WeakMap,lr=new WeakMap,cr=new WeakMap,Vn=new WeakMap,Ve=new WeakSet,ct=function(){return this._singleFrameMode!=="disabled"},kr=function(h,t){t&&(t.x!==0||t.y!==0||t.width!==h.width||t.height!==h.height)?this.setScanRegionMask(t.x,t.y,t.width,t.height):this.clearScanRegionMask()},Io=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Wn=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Yn=function(){this._divScanLight&&this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block")},ur=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Nr=function(h,t){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:a,height:f,objectFit:g}=h;t||(t={x:0,y:0,width:a,height:f});const{width:v,height:y}=this._innerComponent.getBoundingClientRect();if(v<=0||y<=0)return;const w=v/y,I=a/f;let x,A,L,k,N=1;if(g==="contain")w<I?(N=v/a,x=0,A=(y-f*N)/2):(N=y/f,x=(v-a*N)/2,A=0),x+=t.x*N,A+=t.y*N,L=t.width*N,k=t.height*N;else if(g==="cover")if(w<I){N=y/f,x=t.x*N-(a*N-v)/2,x=Math.max(x,0),x=Math.min(x,v),A=t.y*N;let P=(t.x+t.width)*N-(a*N-v)/2;P=Math.max(P,0),P=Math.min(P,v),L=P-x,k=t.height*N}else{N=v/a,x=t.x*N,A=t.y*N-(f*N-y)/2,A=Math.max(A,0),A=Math.min(A,y);let P=(t.y+t.height)*N-(f*N-y)/2;P=Math.max(P,0),P=Math.min(P,y),L=t.width*N,k=P-A}else x=0,A=0,L=0,k=0;this._divScanArea.style.left=x+"px",this._divScanArea.style.top=A+"px",this._divScanArea.style.width=L+"px",this._divScanArea.style.height=k+"px"},qe.uiComponentName="default-camera-view",qe._defaultUIElementURL="@engineResourcePath/dce.ui.html",typeof SuppressedError=="function"&&SuppressedError;const Us=typeof self>"u";let qi,$i,br,Cn,nt;function st(h,t,a,f){if(a==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?h!==t||!f:!t.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?f:a==="a"?f.call(h):f?f.value:t.get(h)}function Ct(h,t,a,f,g){if(typeof t=="function"?h!==t||!g:!t.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return g?g.value=a:t.set(h,a),a}typeof navigator<"u"&&(qi=navigator,$i=qi.userAgent,br=qi.platform,Cn=qi.mediaDevices),function(){if(!Us){const h={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:qi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:br,search:"Win"},Mac:{str:br},Linux:{str:br}};let a="unknownBrowser",f=0,g="unknownOS";for(let v in h){const y=h[v]||{};let w=y.str||$i,I=y.search||v,x=y.verStr||$i,A=y.verSearch||v;if(A instanceof Array||(A=[A]),w.indexOf(I)!=-1){a=v;for(let L of A){let k=x.indexOf(L);if(k!=-1){f=parseFloat(x.substring(k+L.length+1));break}}break}}for(let v in t){const y=t[v]||{};let w=y.str||$i,I=y.search||v;if(w.indexOf(I)!=-1){g=v;break}}g=="Linux"&&$i.indexOf("Windows NT")!=-1&&(g="HarmonyOS"),nt={browser:a,version:f,OS:g}}Us&&(nt={browser:"ssr",version:0,OS:"ssr"})}(),Cn&&Cn.getUserMedia,nt.browser==="Chrome"&&nt.version>66||nt.browser==="Safari"&&nt.version>13||nt.browser==="OPR"&&nt.version>43||nt.browser==="Edge"&&nt.version,typeof SuppressedError=="function"&&SuppressedError;let Dt=class Br{static multiply(t,a){const f=[];for(let g=0;g<3;g++){const v=a.slice(3*g,3*g+3);for(let y=0;y<3;y++){const w=[t[y],t[y+3],t[y+6]].reduce((I,x,A)=>I+x*v[A],0);f.push(w)}}return f}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(t,a,f){return Br.multiply(t,[1,0,0,0,1,0,a,f,1])}static rotate(t,a){var f=Math.cos(a),g=Math.sin(a);return Br.multiply(t,[f,-g,0,g,f,0,0,0,1])}static scale(t,a,f){return Br.multiply(t,[a,0,0,0,f,0,0,0,1])}};var Pe,Ft,Pt,jr,Di,dr,fr,Li,Ur;(function(h){h.GREY="grey",h.GREY32="grey32",h.RGBA="rgba",h.RBGA="rbga",h.GRBA="grba",h.GBRA="gbra",h.BRGA="brga",h.BGRA="bgra"})(Pe||(Pe={}));class be{static get version(){return"1.1.0"}static checkWebGLSupport(){return document.createElement("canvas").getContext("webgl")===null?(Ct(be,Ft,!1,"f",Pt),!1):(Ct(be,Ft,!0,"f",Pt),!0)}get disposed(){return st(this,Ur,"f")}constructor(){jr.set(this,Pe.RGBA),Di.set(this,null),dr.set(this,null),fr.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Li.set(this,null),Ur.set(this,!1)}drawImage(t,a,f,g,v,y){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!f||!g)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(st(be,Ft,"f",Pt)==null&&be.checkWebGLSupport(),y?.bUseWebGL&&!st(be,Ft,"f",Pt))throw new Error("Your browser or machine may not support WebGL.");if(a instanceof HTMLVideoElement&&a.readyState!==4||a instanceof HTMLImageElement&&!a.complete)throw new Error("The source is not loaded.");let w;be._onLog&&(w=Date.now(),be._onLog("drawImage(), START: "+w));let I=0,x=0,A=f,L=g,k=0,N=0,P=f,V=g;v&&(v.sx&&(I=Math.round(v.sx)),v.sy&&(x=Math.round(v.sy)),v.sWidth&&(A=Math.round(v.sWidth)),v.sHeight&&(L=Math.round(v.sHeight)),v.dx&&(k=Math.round(v.dx)),v.dy&&(N=Math.round(v.dy)),v.dWidth&&(P=Math.round(v.dWidth)),v.dHeight&&(V=Math.round(v.dHeight)));let W,X=Pe.RGBA;if(y?.pixelFormat&&(X=y.pixelFormat),y?.bufferContainer&&(W=y.bufferContainer,W.length<4*P*V))throw new Error("Unexpected size of the 'bufferContainer'.");const K=t;if(!st(be,Ft,"f",Pt)||!(this.useWebGLByDefault&&y?.bUseWebGL==null||y?.bUseWebGL)){be._onLog&&be._onLog("drawImage() in context2d."),K.ctx2d||(K.ctx2d=K.getContext("2d",{willReadFrequently:!0}));const ee=K.ctx2d;if(!ee)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(K.width<k+P||K.height<N+V)&&(K.width=k+P,K.height=N+V),ee.drawImage(a,I,x,A,L,k,N,P,V),be._onLog&&be._onLog("drawImage() in context2d end. Costs: "+(Date.now()-w)),{context:ee,pixelFormat:Pe.RGBA,bUseWebGL:!1}}be._onLog&&be._onLog("drawImage() in WebGL.");try{(K.width<k+P||K.height<N+V)&&(K.width=k+P,K.height=N+V,K.ctxWebGL&&K.ctxWebGL.viewport(0,0,k+P,N+V));const ee=K.ctxWebGL||K.getContext("webgl",{antialias:!1})||K.getContext("experimental-webgl",{antialias:!1});if(!ee){be._onLog&&be._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const p=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw p.name="WebGLError",p}if(!K.ctxWebGL||X!==st(this,jr,"f")){K.ctxWebGL=ee;const p=e=>{const i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW);const o=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),{positions:i,texCoords:o}},me=e=>{const i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i},Te=(e,i)=>{const o=e.createProgram();if(i.forEach(d=>e.attachShader(o,d)),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){const d=new Error(`An error occured linking the program: ${e.getProgramInfoLog(o)}.`);throw d.name="WebGLError",d}return e.useProgram(o),o},ue=(e,i,o)=>{const d=e.createShader(i);if(e.shaderSource(d,o),e.compileShader(d),!e.getShaderParameter(d,e.COMPILE_STATUS)){const c=new Error(`An error occured compiling the shader: ${e.getShaderInfoLog(d)}.`);throw c.name="WebGLError",c}return d},s=`
                  attribute vec2 a_position;
                  attribute vec2 a_texCoord;
  
                  uniform mat3 u_matrix;
                  uniform mat3 u_textureMatrix;
  
                  varying vec2 v_texCoord;
                  void main(void) {
                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                  }
              `;let r="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(X)&&(r=X.slice(0,3));const n=`
                  precision mediump float;
                  varying vec2 v_texCoord;
                  uniform sampler2D u_image;
                  uniform float uColorFactor;
  
                  void main() {
                      vec4 sample = texture2D(u_image, v_texCoord);
                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                      gl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                  }
              `,l=Te(ee,[ue(ee,ee.VERTEX_SHADER,s),ue(ee,ee.FRAGMENT_SHADER,n)]);Ct(this,dr,{program:l,attribLocations:{vertexPosition:ee.getAttribLocation(l,"a_position"),texPosition:ee.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:ee.getUniformLocation(l,"u_image"),uColorFactor:ee.getUniformLocation(l,"uColorFactor"),uMatrix:ee.getUniformLocation(l,"u_matrix"),uTextureMatrix:ee.getUniformLocation(l,"u_textureMatrix")}},"f"),Ct(this,fr,p(ee),"f"),Ct(this,Di,me(ee),"f"),Ct(this,jr,X,"f")}const ge=(p,me,Te)=>{p.bindBuffer(p.ARRAY_BUFFER,me),p.enableVertexAttribArray(Te),p.vertexAttribPointer(Te,2,p.FLOAT,!1,0,0)},ce=(p,me,Te)=>{const ue=p.RGBA,s=p.RGBA,r=p.UNSIGNED_BYTE;p.bindTexture(p.TEXTURE_2D,me),p.texImage2D(p.TEXTURE_2D,0,ue,s,r,Te)},Se=(p,me,Te,ue)=>{p.clearColor(0,0,0,1),p.clearDepth(1),p.enable(p.DEPTH_TEST),p.depthFunc(p.LEQUAL),p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT),ge(p,Te.positions,me.attribLocations.vertexPosition),ge(p,Te.texCoords,me.attribLocations.texPosition),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,ue),p.uniform1i(me.uniformLocations.uSampler,0),p.uniform1f(me.uniformLocations.uColorFactor,[Pe.GREY,Pe.GREY32].includes(X)?1:0);let s,r,n=Dt.translate(Dt.identity(),-1,-1);n=Dt.scale(n,2,2),n=Dt.scale(n,1/p.canvas.width,1/p.canvas.height),s=Dt.translate(n,k,N),s=Dt.scale(s,P,V),p.uniformMatrix3fv(me.uniformLocations.uMatrix,!1,s),r=Dt.translate(Dt.identity(),I/f,x/g),r=Dt.scale(r,A/f,L/g),p.uniformMatrix3fv(me.uniformLocations.uTextureMatrix,!1,r),p.drawArrays(p.TRIANGLES,0,6)};ce(ee,st(this,Di,"f"),a),Se(ee,st(this,dr,"f"),st(this,fr,"f"),st(this,Di,"f"));const De=W||new Uint8Array(4*P*V);if(ee.readPixels(k,N,P,V,ee.RGBA,ee.UNSIGNED_BYTE,De),De[3]!==255){be._onLog&&be._onLog("Incorrect WebGL drawing .");const p=new Error("WebGL error: incorrect drawing.");throw p.name="WebGLError",p}return be._onLog&&be._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-w)),{context:ee,pixelFormat:X===Pe.GREY?Pe.GREY32:X,bUseWebGL:!0}}catch(ee){if(this.forceLoseContext(),y?.bUseWebGL==null)return be._onLog&&be._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(t,a,f,g,v,Object.assign({},y,{bUseWebGL:!1}));throw ee.name="WebGLError",ee}}readCvsData(t,a,f){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let g,v=0,y=0,w=t.canvas.width,I=t.canvas.height;if(a&&(a.x&&(v=a.x),a.y&&(y=a.y),a.width&&(w=a.width),a.height&&(I=a.height)),f?.length<4*w*I)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const x=t;f?(x.readPixels(v,y,w,I,x.RGBA,x.UNSIGNED_BYTE,f),g=new Uint8Array(f.buffer,0,4*w*I)):(g=new Uint8Array(4*w*I),x.readPixels(v,y,w,I,x.RGBA,x.UNSIGNED_BYTE,g))}else if(t instanceof CanvasRenderingContext2D){let x;x=t.getImageData(v,y,w,I),g=new Uint8Array(x.data.buffer),f?.set(g)}return g}transformPixelFormat(t,a,f,g){let v,y;if(be._onLog&&(v=Date.now(),be._onLog("transformPixelFormat(), START: "+v)),a===f)return be._onLog&&be._onLog("transformPixelFormat() end. Costs: "+(Date.now()-v)),g?new Uint8Array(t):t;const w=[Pe.RGBA,Pe.RBGA,Pe.GRBA,Pe.GBRA,Pe.BRGA,Pe.BGRA];if(w.includes(a))if(f===Pe.GREY){y=new Uint8Array(t.length/4);for(let I=0;I<t.length;I+=4){const x=.21*t[I]+.71*t[I+1]+.07*t[I+2];y[I/4]=x}}else if(f===Pe.GREY32){y=g?new Uint8Array(t):t;for(let I=0;I<t.length;I+=4){const x=.21*t[I]+.71*t[I+1]+.07*t[I+2];y[I]=x,y[I+1]=x,y[I+2]=x}}else{if(!w.includes(f))throw new Error("Unable to transform.");if(g){y=new Uint8Array(t);const I=a.indexOf("r"),x=a.indexOf("g"),A=a.indexOf("b"),L=f.indexOf("r"),k=f.indexOf("g"),N=f.indexOf("b");for(let P=0;P<t.length;P+=4)y[P+L]=t[P+I],y[P+k]=t[P+x],y[P+N]=t[P+A]}else{y=t;const I=a.indexOf("r"),x=a.indexOf("g"),A=a.indexOf("b"),L=f.indexOf("r"),k=f.indexOf("g"),N=f.indexOf("b");for(let P=0;P<t.length;P+=4){let V=[t[P],t[P+1],t[P+2]];y[P+L]=V[I],y[P+k]=V[x],y[P+N]=V[A]}}}else if(a===Pe.GREY){if(f!==Pe.GREY32)throw new Error("Unable to transform.");y=new Uint8Array(4*t.length);for(let I=0;I<t.length;I++)y[4*I]=t[I],y[4*I+1]=t[I],y[4*I+2]=t[I],y[4*I+3]=255}else{if(a!==Pe.GREY32)throw new Error("Unable to transform.");if(f!==Pe.GREY)throw new Error("Unable to transform.");y=new Uint8Array(t.length/4);for(let I=0;I<t.length;I+=4)y[I/4]=t[I]}return be._onLog&&be._onLog("transformPixelFormat() end. Costs: "+(Date.now()-v)),y}getImageData(t,a,f,g,v){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!a||!f)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(st(be,Ft,"f",Pt)==null&&be.checkWebGLSupport(),v?.bUseWebGL&&!st(be,Ft,"f",Pt))throw new Error("Your browser or machine may not support WebGL.");if(g.sx>a||g.sy>f||g.sx+g.sWidth>a||g.sy+g.sHeight>f)throw new Error("Invalid position.");if(t instanceof HTMLVideoElement&&t.readyState!==4||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let y;be._onLog&&(y=Date.now(),be._onLog("getImageData(), START: "+y));const w=Math.round(g.sx),I=Math.round(g.sy),x=Math.round(g.sWidth),A=Math.round(g.sHeight),L=Math.round(g.dWidth),k=Math.round(g.dHeight);let N=Pe.RGBA;v?.pixelFormat&&(N=v.pixelFormat);let P,V,W,X=null;if(v?.bufferContainer&&(X=v.bufferContainer),st(be,Ft,"f",Pt)&&(this.useWebGLByDefault&&v?.bUseWebGL==null||v?.bUseWebGL)){be._onLog&&be._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),P=this._reusedWebGLCvs;try{if(X)if(N===Pe.GREY){if(W=new Uint8Array(4*L*k),V=this.drawImage(P,t,a,f,{sx:w,sy:I,sWidth:x,sHeight:A,dWidth:L,dHeight:k},{pixelFormat:N,bUseWebGL:!0,bufferContainer:W}),W=this.transformPixelFormat(W,V.pixelFormat,N),X){if(X.length<W.length)throw new Error("Unexpected size of the 'bufferContainer'.");X.set(W)}}else V=this.drawImage(P,t,a,f,{sx:w,sy:I,sWidth:x,sHeight:A,dWidth:L,dHeight:k},{pixelFormat:N,bUseWebGL:!0,bufferContainer:X}),W=new Uint8Array(X.buffer,0,4*L*k),W=this.transformPixelFormat(W,V.pixelFormat,N);else N===Pe.GREY?((!st(this,Li,"f")||st(this,Li,"f").length<4*L*k)&&Ct(this,Li,new Uint8Array(4*L*k),"f"),W=new Uint8Array(st(this,Li,"f").buffer,0,4*L*k)):W=new Uint8Array(4*L*k),V=this.drawImage(P,t,a,f,{sx:w,sy:I,sWidth:x,sHeight:A,dWidth:L,dHeight:k},{pixelFormat:N,bUseWebGL:!0,bufferContainer:W}),W=this.transformPixelFormat(W,V.pixelFormat,N)}catch(K){if(K.name==="WebGLError"&&(this.forceLoseContext(),v?.bUseWebGL==null))return be._onLog&&be._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(t,a,f,{sx:w,sy:I,sWidth:x,sHeight:A,dWidth:L,dHeight:k},Object.assign({},v,{bUseWebGL:!1}));throw K}}else if(be._onLog&&be._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),P=this._reusedCvs,V=this.drawImage(P,t,a,f,{sx:w,sy:I,sWidth:x,sHeight:A,dWidth:L,dHeight:k},{pixelFormat:Pe.RGBA,bUseWebGL:!1}),W=this.readCvsData(V.context,{width:L,height:k},null),W=this.transformPixelFormat(W,V.pixelFormat,N),X){if(X.length<W.length)throw new Error("Unexpected size of the 'bufferContainer'.");X.set(W)}return be._onLog&&be._onLog("getImageData() end. Costs: "+(Date.now()-y)),{data:W,pixelFormat:N,width:L,height:k,bUseWebGL:V.bUseWebGL}}convertDataToCvs(t,a,f,g){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof a!="number"||a<=0)throw new Error("Invalid 'width'.");if(typeof f!="number"||f<=0)throw new Error("Invalid 'height'.");const v=document.createElement("canvas");let y;if(v.width=a,v.height=f,g===Pe.GREY){y=new Uint8ClampedArray(4*a*f);for(let I=0;I<y.length;I+=4)y[I]=t[I/4],y[I+1]=t[I/4],y[I+2]=t[I/4],y[I+3]=255}else y=new Uint8ClampedArray(t.buffer);const w=new ImageData(y,a,f);return v.getContext("2d").putImageData(w,0,0),v}forceLoseContext(){if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),Ct(this,Di,null),Ct(this,dr,null),Ct(this,fr,null),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Ct(this,Ur,!0)}}Ft=be,jr=new WeakMap,Di=new WeakMap,dr=new WeakMap,fr=new WeakMap,Li=new WeakMap,Ur=new WeakMap,Pt={value:void 0};var ci,Gr,wn,fe,Ae,Be,Vr,Wr,We,Et,Bt,Mi,Yr,xt,Wt,dt,Fi,Pi,gr,Hr,ki,ui,jt,Ut,Hn,Qe,Xn,di,xo,Xr,zr,Gs,St,Sn,Tn,ji,mr,on,lt,Ii,zn,Zn,Ao;class Ea{constructor(){ci.set(this,new Map),Gr.set(this,!1)}get disposed(){return R(this,Gr,"f")}on(t,a){t=t.toLowerCase();const f=R(this,ci,"f").get(t);if(f){if(f.includes(a))return;f.push(a)}else R(this,ci,"f").set(t,[a])}off(t,a){t=t.toLowerCase();const f=R(this,ci,"f").get(t);if(!f)return;const g=f.indexOf(a);g!==-1&&f.splice(g,1)}offAll(t){t=t.toLowerCase();const a=R(this,ci,"f").get(t);a&&(a.length=0)}async fire(t,a=[],f={async:!1,copy:!0}){a||(a=[]),t=t.toLowerCase();const g=R(this,ci,"f").get(t);if(g&&g.length){f=Object.assign({async:!1,copy:!0},f);for(let v of g){if(!v)continue;let y=[];if(f.copy)for(let I of a){try{I=JSON.parse(JSON.stringify(I))}catch{}y.push(I)}else y=a;let w=!1;if(f.async)setTimeout(()=>{this.disposed||v.apply(f.target,y)},0);else try{w=v.apply(f.target,y)}catch{}if(w===!0)break}}}dispose(){ke(this,Gr,!0)}}ci=new WeakMap,Gr=new WeakMap;const ot=(h,t,a,f)=>{if(!a)return h;let g=t+Math.round((h-t)/a)*a;return f&&(g=Math.min(g,f)),g};class we{static get version(){return"2.0.7"}static isStorageAvailable(t){let a;try{a=window[t];const f="__storage_test__";return a.setItem(f,f),a.removeItem(f),!0}catch(f){return f instanceof DOMException&&(f.code===22||f.code===1014||f.name==="QuotaExceededError"||f.name==="NS_ERROR_DOM_QUOTA_REACHED")&&a&&a.length!==0}}static findBestRearCameraInIOS(t,a){if(!t||!t.length)return null;let f=!1;if(a?.getMainCamera&&(f=!0),f){const g=["후면 카메라","背面カメラ","後置鏡頭","后置相机","กล้องด้านหลัง","बैक कैमरा","الكاميرا الخلفية","מצלמה אחורית","камера на задней панели","задня камера","задна камера","артқы камера","πίσω κάμερα","zadní fotoaparát","zadná kamera","tylny aparat","takakamera","stražnja kamera","rückkamera","kamera på baksidan","kamera belakang","kamera bak","hátsó kamera","fotocamera (posteriore)","câmera traseira","câmara traseira","cámara trasera","càmera posterior","caméra arrière","cameră spate","camera mặt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],v=t.find(y=>g.includes(y.label.toLowerCase()));return v?.deviceId}{const g=["후면","背面","後置","后置","านหลัง","बैक","خلفية","אחורית","задняя","задней","задна","πίσω","zadní","zadná","tylny","trasera","traseira","taka","stražnja","spate","sau","rück","posteriore","posterior","hátsó","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"],v=["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],y=["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],w=t.filter(A=>{const L=A.label.toLowerCase();return g.some(k=>L.includes(k))});if(!w.length)return null;const I=w.find(A=>{const L=A.label.toLowerCase();return v.some(k=>L.includes(k))});if(I)return I.deviceId;const x=w.find(A=>{const L=A.label.toLowerCase();return y.some(k=>L.includes(k))});return x?x.deviceId:w[0].deviceId}}static findBestRearCamera(t,a){if(!t||!t.length)return null;if(["iPhone","iPad","Mac"].includes(nt.OS))return we.findBestRearCameraInIOS(t,{getMainCamera:a?.getMainCameraInIOS});const f=["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"];for(let g of t){const v=g.label.toLowerCase();if(v&&f.some(y=>v.includes(y))&&/\b0(\b)?/.test(v))return g.deviceId}return["Android","HarmonyOS"].includes(nt.OS)?t[t.length-1].deviceId:null}static findBestCamera(t,a,f){return t&&t.length?a==="environment"?this.findBestRearCamera(t,f):a==="user"?null:a?void 0:null:null}static async playVideo(t,a,f){if(!t)throw new Error("Invalid 'videoEl'.");if(!a)throw new Error("Invalid 'source'.");return new Promise(async(g,v)=>{let y;const w=()=>{t.removeEventListener("loadstart",L),t.removeEventListener("abort",k),t.removeEventListener("play",N),t.removeEventListener("error",P),t.removeEventListener("loadedmetadata",X)};let I=!1;const x=()=>{I=!0,y&&clearTimeout(y),w(),g(t)},A=K=>{y&&clearTimeout(y),w(),v(K)},L=()=>{t.addEventListener("abort",k,{once:!0})},k=()=>{const K=new Error("Video playing was interrupted.");K.name="AbortError",A(K)},N=()=>{x()},P=()=>{A(new Error(`Video error ${t.error.code}: ${t.error.message}.`))};let V;const W=new Promise(K=>{V=K}),X=()=>{V()};if(t.addEventListener("loadstart",L,{once:!0}),t.addEventListener("play",N,{once:!0}),t.addEventListener("error",P,{once:!0}),t.addEventListener("loadedmetadata",X,{once:!0}),typeof a=="string"||a instanceof String?t.src=a:t.srcObject=a,t.autoplay&&await new Promise(K=>{setTimeout(K,1e3)}),!I){f&&(y=setTimeout(()=>{w(),v(new Error("Failed to play video. Timeout."))},f));try{t.src&&await t.load(),await t.play(),x()}catch(K){console.warn("1st play error: "+(K?.message||K))}if(!I){await W;try{await t.play(),x()}catch(K){console.warn("2rd play error: "+(K?.message||K)),A(K)}}}})}static async testCameraAccess(t){var a,f;if(!(!((f=(a=window?.navigator)===null||a===void 0?void 0:a.mediaDevices)===null||f===void 0)&&f.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let g;try{g=t?await navigator.mediaDevices.getUserMedia(t):await navigator.mediaDevices.getUserMedia({video:!0})}catch(v){return{ok:!1,errorName:v.name,errorMessage:v.message}}finally{g?.getTracks().forEach(v=>{v.stop()})}return{ok:!0}}get state(){if(!R(this,dt,"f"))return"closed";if(R(this,dt,"f")==="pending")return"opening";if(R(this,dt,"f")==="fulfilled")return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(t){t?we.isStorageAvailable("localStorage")?ke(this,Mi,!0):(ke(this,Mi,!1),console.warn("Local storage is unavailable")):ke(this,Mi,!1)}get ifSaveLastUsedCamera(){return R(this,Mi,"f")}get isVideoPlaying(){return!(!R(this,Ae,"f")||R(this,Ae,"f").paused)&&this.state==="opened"}set tapFocusEventBoundEl(t){var a,f,g;if(!(t instanceof HTMLElement)&&t!=null)throw new TypeError("Invalid 'element'.");(a=R(this,ui,"f"))===null||a===void 0||a.removeEventListener("click",R(this,ki,"f")),(f=R(this,ui,"f"))===null||f===void 0||f.removeEventListener("touchend",R(this,ki,"f")),(g=R(this,ui,"f"))===null||g===void 0||g.removeEventListener("touchmove",R(this,Hr,"f")),ke(this,ui,t),t&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(nt.OS)?(t.addEventListener("touchend",R(this,ki,"f")),t.addEventListener("touchmove",R(this,Hr,"f"))):t.addEventListener("click",R(this,ki,"f")))}get tapFocusEventBoundEl(){return R(this,ui,"f")}get disposed(){return R(this,zr,"f")}constructor(t){var a,f;fe.add(this),Ae.set(this,null),Be.set(this,void 0),Vr.set(this,()=>{this.state==="opened"&&R(this,Qe,"f").fire("resumed",null,{target:this,async:!1})}),Wr.set(this,()=>{R(this,Qe,"f").fire("paused",null,{target:this,async:!1})}),We.set(this,void 0),Et.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],Bt.set(this,void 0),Mi.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Yr.set(this,void 0),xt.set(this,!0),Wt.set(this,void 0),dt.set(this,void 0),Fi.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Pi.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(g,v)=>{let y,w;const I=window.getComputedStyle(R(this,Ae,"f")).objectFit,x=this.getResolution(),A=R(this,Ae,"f").getBoundingClientRect(),L=A.left,k=A.top,{width:N,height:P}=R(this,Ae,"f").getBoundingClientRect();if(N<=0||P<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const V=N/P,W=x.width/x.height;let X=1;if(I==="contain")W>V?(X=N/x.width,y=(g-L)/X,w=(v-k-(P-N/W)/2)/X):(X=P/x.height,w=(v-k)/X,y=(g-L-(N-P*W)/2)/X);else{if(I!=="cover")throw new Error("Unsupported object-fit.");W>V?(X=P/x.height,w=(v-k)/X,y=(g-L+(P*W-N)/2)/X):(X=N/x.width,y=(g-L)/X,w=(v-k+(N/W-P)/2)/X)}return{x:y,y:w}},gr.set(this,!1),Hr.set(this,()=>{ke(this,gr,!0)}),ki.set(this,async g=>{var v;if(R(this,gr,"f"))return void ke(this,gr,!1);if(!R(this,Pi,"f")||!this.isVideoPlaying||!R(this,Be,"f")||!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(v=this.getCameraCapabilities())===null||v===void 0?void 0:v.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let y,w;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),g instanceof MouseEvent)y=g.clientX,w=g.clientY;else{if(!(g instanceof TouchEvent))throw new Error("Unknown event type.");if(!g.changedTouches.length)return;y=g.changedTouches[0].clientX,w=g.changedTouches[0].clientY}const I=this.getResolution(),x=2*Math.round(Math.min(I.width,I.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let A;try{A=this.calculateCoordInVideo(y,w)}catch{}if(A.x<0||A.x>I.width||A.y<0||A.y>I.height)return;const L={x:A.x+"px",y:A.y+"px"},k=x+"px",N=k;let P;we._onLog&&(P=Date.now());try{await R(this,fe,"m",zn).call(this,L,k,N,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(V){if(we._onLog)throw we._onLog(V),V}we._onLog&&we._onLog(`Tap focus costs: ${Date.now()-P} ms`),this._focusParameters.taskBackToContinous=setTimeout(()=>{var V;we._onLog&&we._onLog("Back to continuous focus."),(V=R(this,Be,"f"))===null||V===void 0||V.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime),R(this,Qe,"f").fire("tapfocus",null,{target:this,async:!1})}),ui.set(this,null),jt.set(this,1),Ut.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!R(this,Ae,"f"))return;const g=R(this,jt,"f");if(g<1)throw new RangeError("Invalid scale value.");if(g===1)R(this,Ae,"f").style.transform="";else{const v=window.getComputedStyle(R(this,Ae,"f")).objectFit,y=R(this,Ae,"f").videoWidth,w=R(this,Ae,"f").videoHeight,{width:I,height:x}=R(this,Ae,"f").getBoundingClientRect();if(I<=0||x<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const A=I/x,L=y/w;let k=1;v==="contain"?k=A<L?I/(y/g):x/(w/g):v==="cover"&&(k=L>A?x/(y/g):I/(w/g));const N=k*(1-1/g)*(y/2-R(this,Ut,"f").x),P=k*(1-1/g)*(w/2-R(this,Ut,"f").y);R(this,Ae,"f").style.transform=`translate(${N}px, ${P}px) scale(${g})`}},Hn.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const g=document.createElement("canvas");let v;if(g.width=this.width,g.height=this.height,this.pixelFormat===Pe.GREY){v=new Uint8ClampedArray(this.width*this.height*4);for(let w=0;w<v.length;w+=4)v[w]=this.data[w/4],v[w+1]=this.data[w/4],v[w+2]=this.data[w/4],v[w+3]=255}else v=new Uint8ClampedArray(this.data.buffer);const y=new ImageData(v,this.width,this.height);return g.getContext("2d").putImageData(y,0,0),g}),Qe.set(this,void 0),Xn.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],di.set(this,new Map),xo.set(this,!1),Xr.set(this,async()=>{var g,v;if(document.visibilityState==="visible"){if(we._onLog&&we._onLog("document visible. video paused: "+((g=R(this,Ae,"f"))===null||g===void 0?void 0:g.paused)),this.state=="opening"||this.state=="opened"){let y=!1;if(!this.isVideoPlaying){we._onLog&&we._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),y=!0}catch{we._onLog&&we._onLog("document visible. 1st resume video failed, try open instead.")}y||await R(this,fe,"m",ji).call(this)}if(await new Promise(w=>setTimeout(w,300)),!this.isVideoPlaying){we._onLog&&we._onLog("document visible. 1st open failed. 2rd resume start."),y=!1;try{await this.resume(),y=!0}catch{we._onLog&&we._onLog("document visible. 2rd resume video failed, try open instead.")}y||await R(this,fe,"m",ji).call(this)}}}else document.visibilityState==="hidden"&&(we._onLog&&we._onLog("document hidden. video paused: "+((v=R(this,Ae,"f"))===null||v===void 0?void 0:v.paused)),this.state=="opening"||this.state=="opened"&&this.isVideoPlaying&&this.pause())}),zr.set(this,!1),!((f=(a=window?.navigator)===null||a===void 0?void 0:a.mediaDevices)===null||f===void 0)&&f.getUserMedia||setTimeout(()=>{we.onWarning&&we.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),t instanceof HTMLVideoElement&&this.setVideoEl(t),ke(this,Qe,new Ea),this.imageDataGetter=new be,document.addEventListener("visibilitychange",R(this,Xr,"f"))}setVideoEl(t){if(!(t&&t instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");t.addEventListener("play",R(this,Vr,"f")),t.addEventListener("pause",R(this,Wr,"f")),ke(this,Ae,t)}getVideoEl(){return R(this,Ae,"f")}releaseVideoEl(){var t,a;(t=R(this,Ae,"f"))===null||t===void 0||t.removeEventListener("play",R(this,Vr,"f")),(a=R(this,Ae,"f"))===null||a===void 0||a.removeEventListener("pause",R(this,Wr,"f")),ke(this,Ae,null)}isVideoLoaded(){return!!R(this,Ae,"f")&&R(this,Ae,"f").readyState==4}async open(){if(R(this,Wt,"f")&&!R(this,xt,"f")){if(R(this,dt,"f")==="pending")return R(this,Wt,"f");if(R(this,dt,"f")==="fulfilled")return}R(this,Qe,"f").fire("before:open",null,{target:this}),await R(this,fe,"m",ji).call(this),R(this,Qe,"f").fire("played",null,{target:this,async:!1}),R(this,Qe,"f").fire("opened",null,{target:this,async:!1})}async close(){if(this.state==="closed")return;R(this,Qe,"f").fire("before:close",null,{target:this});const t=R(this,Wt,"f");if(R(this,fe,"m",on).call(this),t&&R(this,dt,"f")==="pending"){try{await t}catch{}if(R(this,xt,"f")===!1){const a=new Error("'close()' was interrupted.");throw a.name="AbortError",a}}ke(this,Wt,null),ke(this,dt,null),R(this,Qe,"f").fire("closed",null,{target:this,async:!1})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");R(this,Ae,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");await R(this,Ae,"f").play()}async setCamera(t){if(typeof t!="string")throw new TypeError("Invalid 'deviceId'.");if(typeof R(this,We,"f").video!="object"&&(R(this,We,"f").video={}),delete R(this,We,"f").video.facingMode,R(this,We,"f").video.deviceId={exact:t},!(this.state==="closed"||this.videoSrc||this.state==="opening"&&R(this,xt,"f"))){R(this,Qe,"f").fire("before:camera:change",[],{target:this,async:!1}),await R(this,fe,"m",mr).call(this);try{this.resetSoftwareScale()}catch{}return R(this,Et,"f")}}async switchToFrontCamera(t){if(typeof R(this,We,"f").video!="object"&&(R(this,We,"f").video={}),t?.resolution&&(R(this,We,"f").video.width={ideal:t.resolution.width},R(this,We,"f").video.height={ideal:t.resolution.height}),delete R(this,We,"f").video.deviceId,R(this,We,"f").video.facingMode={exact:"user"},ke(this,Bt,null),!(this.state==="closed"||this.videoSrc||this.state==="opening"&&R(this,xt,"f"))){R(this,Qe,"f").fire("before:camera:change",[],{target:this,async:!1}),R(this,fe,"m",mr).call(this);try{this.resetSoftwareScale()}catch{}return R(this,Et,"f")}}getCamera(){var t;if(R(this,Et,"f"))return R(this,Et,"f");{let a=((t=R(this,We,"f").video)===null||t===void 0?void 0:t.deviceId)||"";if(a){a=a.exact||a.ideal||a;for(let f of this._arrCameras)if(f.deviceId===a)return JSON.parse(JSON.stringify(f))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(t){var a,f;if(!(!((f=(a=window?.navigator)===null||a===void 0?void 0:a.mediaDevices)===null||f===void 0)&&f.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let g;if(t){let w=await navigator.mediaDevices.getUserMedia({video:!0});g=(await navigator.mediaDevices.enumerateDevices()).filter(I=>I.kind==="videoinput"),w.getTracks().forEach(I=>{I.stop()})}else g=(await navigator.mediaDevices.enumerateDevices()).filter(w=>w.kind==="videoinput");const v=[],y=[];if(this._arrCameras)for(let w of this._arrCameras)w._checked&&y.push(w);for(let w=0;w<g.length;w++){let I,x=g[w];for(let A of y)if(x.deviceId==A.deviceId){I=A;break}I||(I={deviceId:x.deviceId,label:x.label?x.label:"camera "+w,_checked:!1}),I.deviceId&&v.push(I)}return this._arrCameras=v,we._onLog&&we._onLog(JSON.stringify(this._arrCameras)),v}async getCameras(){var t,a;if(!(!((a=(t=window?.navigator)===null||t===void 0?void 0:t.mediaDevices)===null||a===void 0)&&a.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const f=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="videoinput");return f&&f.length&&!f[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(t,a,f){if(typeof t!="number"||t<=0)throw new TypeError("Invalid 'width'.");if(typeof a!="number"||a<=0)throw new TypeError("Invalid 'height'.");if(typeof R(this,We,"f").video!="object"&&(R(this,We,"f").video={}),f?(R(this,We,"f").video.width={exact:t},R(this,We,"f").video.height={exact:a}):(R(this,We,"f").video.width={ideal:t},R(this,We,"f").video.height={ideal:a}),this.state==="closed"||this.videoSrc||this.state==="opening"&&R(this,xt,"f"))return null;R(this,Qe,"f").fire("before:resolution:change",[],{target:this,async:!1}),await R(this,fe,"m",mr).call(this);try{this.resetSoftwareScale()}catch{}const g=this.getResolution();return{width:g.width,height:g.height}}getResolution(){if(this.state==="opened"&&this.videoSrc&&R(this,Ae,"f"))return{width:R(this,Ae,"f").videoWidth,height:R(this,Ae,"f").videoHeight};if(R(this,Be,"f")){const t=R(this,Be,"f").getSettings();return{width:t.width,height:t.height}}if(this.isVideoLoaded())return{width:R(this,Ae,"f").videoWidth,height:R(this,Ae,"f").videoHeight};{const t={width:0,height:0};let a=R(this,We,"f").video.width||0,f=R(this,We,"f").video.height||0;return a&&(t.width=a.exact||a.ideal||a),f&&(t.height=f.exact||f.ideal||f),t}}async getResolutions(t){var a,f,g,v,y,w,I,x,A,L,k;if(!(!((f=(a=window?.navigator)===null||a===void 0?void 0:a.mediaDevices)===null||f===void 0)&&f.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let N="";const P=(V,W)=>{const X=R(this,di,"f").get(V);if(!X||!X.length)return!1;for(let K of X)if(K.width===W.width&&K.height===W.height)return!0;return!1};if(this._mediaStream){N=(k=R(this,Et,"f"))===null||k===void 0?void 0:k.deviceId;let V=R(this,di,"f").get(N);if(V&&!t)return JSON.parse(JSON.stringify(V));V=[],R(this,di,"f").set(N,V),ke(this,Fi,!0);try{for(let W of this.detectedResolutions){await R(this,Be,"f").applyConstraints({width:{ideal:W.width},height:{ideal:W.height}}),R(this,fe,"m",St).call(this);const X=R(this,Be,"f").getSettings(),K={width:X.width,height:X.height};P(N,K)||V.push({width:K.width,height:K.height})}}catch(W){throw R(this,fe,"m",on).call(this),ke(this,Fi,!1),W}try{await R(this,fe,"m",ji).call(this)}catch(W){if(W.name==="AbortError")return V;throw W}finally{ke(this,Fi,!1)}return V}{const V=async(K,ee,ge)=>{const ce={video:{deviceId:{exact:K},width:{ideal:ee},height:{ideal:ge}}};let Se=null;try{Se=await navigator.mediaDevices.getUserMedia(ce)}catch{return null}if(!Se)return null;const De=Se.getVideoTracks();let p=null;try{const me=De[0].getSettings();p={width:me.width,height:me.height}}catch{const Te=document.createElement("video");Te.srcObject=Se,p={width:Te.videoWidth,height:Te.videoHeight},Te.srcObject=null}return De.forEach(me=>{me.stop()}),p};let W=((y=(v=(g=R(this,We,"f"))===null||g===void 0?void 0:g.video)===null||v===void 0?void 0:v.deviceId)===null||y===void 0?void 0:y.exact)||((x=(I=(w=R(this,We,"f"))===null||w===void 0?void 0:w.video)===null||I===void 0?void 0:I.deviceId)===null||x===void 0?void 0:x.ideal)||((L=(A=R(this,We,"f"))===null||A===void 0?void 0:A.video)===null||L===void 0?void 0:L.deviceId);if(!W)return[];let X=R(this,di,"f").get(W);if(X&&!t)return JSON.parse(JSON.stringify(X));X=[],R(this,di,"f").set(W,X);for(let K of this.detectedResolutions){const ee=await V(W,K.width,K.height);ee&&!P(W,ee)&&X.push({width:ee.width,height:ee.height})}return X}}async setMediaStreamConstraints(t,a){if(!(f=>{return f!==null&&(g=f,Object.prototype.toString.call(g)==="[object Object]");var g})(t))throw new TypeError("Invalid 'mediaStreamConstraints'.");ke(this,We,JSON.parse(JSON.stringify(t))),ke(this,Bt,null),a&&R(this,fe,"m",mr).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(R(this,We,"f")))}resetMediaStreamConstraints(){ke(this,We,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null)}getCameraCapabilities(){if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");return R(this,Be,"f").getCapabilities?R(this,Be,"f").getCapabilities():{}}getCameraSettings(){if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");return R(this,Be,"f").getSettings()}async turnOnTorch(){if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!t?.torch)throw Error("Not supported.");await R(this,Be,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!t?.torch)throw Error("Not supported.");await R(this,Be,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(t,a){var f;if(typeof t!="number")throw new TypeError("Invalid 'value'.");if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const g=(f=this.getCameraCapabilities())===null||f===void 0?void 0:f.colorTemperature;if(!g)throw Error("Not supported.");return a&&(t<g.min?t=g.min:t>g.max&&(t=g.max),t=ot(t,g.min,g.step,g.max)),await R(this,Be,"f").applyConstraints({advanced:[{colorTemperature:t,whiteBalanceMode:"manual"}]}),t}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(t,a){var f;if(typeof t!="number")throw new TypeError("Invalid 'value'.");if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const g=(f=this.getCameraCapabilities())===null||f===void 0?void 0:f.exposureCompensation;if(!g)throw Error("Not supported.");return a&&(t<g.min?t=g.min:t>g.max&&(t=g.max),t=ot(t,g.min,g.step,g.max)),await R(this,Be,"f").applyConstraints({advanced:[{exposureCompensation:t}]}),t}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(t,a){var f;if(typeof t!="number")throw new TypeError("Invalid 'value'.");if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");let g=(f=this.getCameraCapabilities())===null||f===void 0?void 0:f.frameRate;if(!g)throw Error("Not supported.");a&&(t<g.min?t=g.min:t>g.max&&(t=g.max));const v=this.getResolution();return await R(this,Be,"f").applyConstraints({width:{ideal:Math.max(v.width,v.height)},frameRate:t}),t}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(t,a){if(typeof t!="object"||Array.isArray(t)||t==null)throw new TypeError("Invalid 'settings'.");if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const f=this.getCameraCapabilities(),g=f?.focusMode,v=f?.focusDistance;if(!g)throw Error("Not supported.");if(typeof t.mode!="string")throw TypeError("Invalid 'mode'.");const y=t.mode.toLowerCase();if(!g.includes(y))throw Error("Unsupported focus mode.");if(y==="manual"){if(!v)throw Error("Manual focus unsupported.");if(t.hasOwnProperty("distance")){let w=t.distance;a&&(w<v.min?w=v.min:w>v.max&&(w=v.max),w=ot(w,v.min,v.step,v.max)),this._focusParameters.focusArea=null,await R(this,Be,"f").applyConstraints({advanced:[{focusMode:y,focusDistance:w}]})}else{if(!t.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const w=t.area.centerPoint;let I=t.area.width,x=t.area.height;if(!I||!x){const A=this.getResolution();I||(I=2*Math.round(Math.min(A.width,A.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),x||(x=2*Math.round(Math.min(A.width,A.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:w.x,y:w.y},width:I,height:x},await R(this,fe,"m",zn).call(this,w,I,x)}}}else this._focusParameters.focusArea=null,await R(this,Be,"f").applyConstraints({advanced:[{focusMode:y}]})}getFocus(){const t=this.getCameraSettings(),a=t.focusMode;return a?a==="manual"?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:t.focusDistance}:{mode:a}:null}async enableTapToFocus(){ke(this,Pi,!0)}disableTapToFocus(){ke(this,Pi,!1)}isTapToFocusEnabled(){return R(this,Pi,"f")}async setZoom(t){if(typeof t!="object"||Array.isArray(t)||t==null)throw new TypeError("Invalid 'settings'.");if(typeof t.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(t.factor<1)throw new RangeError("Invalid 'factor'.");if(this.state!=="opened")throw new Error("Video is not playing.");t.centerPoint?R(this,fe,"m",Zn).call(this,t.centerPoint):this.resetScaleCenter();try{if(R(this,fe,"m",Ao).call(this,R(this,Ut,"f"))){const a=await this.setHardwareScale(t.factor,!0);let f=this.getHardwareScale();f==1&&a!=1&&(f=a),t.factor>f?this.setSoftwareScale(t.factor/f):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(t.factor)}catch(a){const f=a.message||a;if(f!=="Not supported."&&f!=="Camera is not open.")throw a;this.setSoftwareScale(t.factor)}}getZoom(){if(this.state!=="opened")throw new Error("Video is not playing.");let t=1;try{t=this.getHardwareScale()}catch(a){if((a.message||a)!=="Camera is not open.")throw a}return{factor:t*R(this,jt,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(t,a){var f;if(typeof t!="number")throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(!R(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const g=(f=this.getCameraCapabilities())===null||f===void 0?void 0:f.zoom;if(!g)throw Error("Not supported.");return a&&(t<g.min?t=g.min:t>g.max&&(t=g.max),t=ot(t,g.min,g.step,g.max)),await R(this,Be,"f").applyConstraints({advanced:[{zoom:t}]}),t}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(t,a){if(typeof t!="number")throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(this.state!=="opened")throw new Error("Video is not playing.");a&&R(this,fe,"m",Zn).call(this,a),ke(this,jt,t),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return R(this,jt,"f")}resetScaleCenter(){if(this.state!=="opened")throw new Error("Video is not playing.");const t=this.getResolution();ke(this,Ut,{x:t.width/2,y:t.height/2})}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(t){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||R(this,Fi,"f"))return null;const a=Date.now();we._onLog&&we._onLog("getFrameData() START: "+a);const f=R(this,Ae,"f").videoWidth,g=R(this,Ae,"f").videoHeight;let v={sx:0,sy:0,sWidth:f,sHeight:g,dWidth:f,dHeight:g};t?.position&&(v=JSON.parse(JSON.stringify(t.position)));let y=Pe.RGBA;t?.pixelFormat&&(y=t.pixelFormat);let w=R(this,jt,"f");t?.scale&&(w=t.scale);let I=R(this,Ut,"f");if(t?.scaleCenter){if(typeof t.scaleCenter.x!="string"||typeof t.scaleCenter.y!="string")throw new Error("Invalid scale center.");let k=0,N=0;if(t.scaleCenter.x.endsWith("px"))k=parseFloat(t.scaleCenter.x);else{if(!t.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");k=parseFloat(t.scaleCenter.x)/100*f}if(t.scaleCenter.y.endsWith("px"))N=parseFloat(t.scaleCenter.y);else{if(!t.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");N=parseFloat(t.scaleCenter.y)/100*g}if(isNaN(k)||isNaN(N))throw new Error("Invalid scale center.");I.x=Math.round(k),I.y=Math.round(N)}let x=null;if(t?.bufferContainer&&(x=t.bufferContainer),f==0||g==0)return null;w!==1&&(v.sWidth=Math.round(v.sWidth/w),v.sHeight=Math.round(v.sHeight/w),v.sx=Math.round((1-1/w)*I.x+v.sx/w),v.sy=Math.round((1-1/w)*I.y+v.sy/w));const A=this.imageDataGetter.getImageData(R(this,Ae,"f"),f,g,v,{pixelFormat:y,bufferContainer:x});if(!A)return null;const L=Date.now();return we._onLog&&we._onLog("getFrameData() END: "+L),{data:A.data,width:A.width,height:A.height,pixelFormat:A.pixelFormat,timeSpent:L-a,timeStamp:L,toCanvas:R(this,Hn,"f")}}on(t,a){if(!R(this,Xn,"f").includes(t.toLowerCase()))throw new Error(`Event '${t}' does not exist.`);R(this,Qe,"f").on(t,a)}off(t,a){R(this,Qe,"f").off(t,a)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),R(this,Qe,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",R(this,Xr,"f")),ke(this,zr,!0)}}var yr,an,Ui,pi,hn,Ni,Vs,Oo,Fe,Kn,qn,de,ve,pr,kt,fi,Zr,Kr,qr,Er,gi,$r,Nt,ft,ze,pe,It,$n,Ye,Ro,Do,Jn,Qn;Ae=new WeakMap,Be=new WeakMap,Vr=new WeakMap,Wr=new WeakMap,We=new WeakMap,Et=new WeakMap,Bt=new WeakMap,Mi=new WeakMap,Yr=new WeakMap,xt=new WeakMap,Wt=new WeakMap,dt=new WeakMap,Fi=new WeakMap,Pi=new WeakMap,gr=new WeakMap,Hr=new WeakMap,ki=new WeakMap,ui=new WeakMap,jt=new WeakMap,Ut=new WeakMap,Hn=new WeakMap,Qe=new WeakMap,Xn=new WeakMap,di=new WeakMap,xo=new WeakMap,Xr=new WeakMap,zr=new WeakMap,fe=new WeakSet,Gs=async function(){const h=this.getMediaStreamConstraints();if(typeof h.video=="boolean"&&(h.video={}),!h.video.deviceId){if(R(this,Bt,"f"))delete h.video.facingMode,h.video.deviceId={exact:R(this,Bt,"f")};else if(this.ifSaveLastUsedCamera&&we.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete h.video.facingMode,h.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const t=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),a=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));t&&a&&(h.video.width=t,h.video.height=a)}else if(!this.ifSkipCameraInspection){const t=async g=>{let v=null;return g==="environment"&&["Android","HarmonyOS","iPhone","iPad"].includes(nt.OS)?(await this._getCameras(!1),R(this,fe,"m",St).call(this),v=we.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):g||["Android","HarmonyOS","iPhone","iPad"].includes(nt.OS)||(await this._getCameras(!1),R(this,fe,"m",St).call(this),v=we.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),v};let a=h.video.facingMode;a instanceof Array&&a.length&&(a=a[0]),typeof a=="object"&&(a=a.exact||a.ideal);const f=await t(a);f&&(delete h.video.facingMode,h.video.deviceId={exact:f})}}return h},St=function(){if(R(this,xt,"f")){const h=new Error("The operation was interrupted.");throw h.name="AbortError",h}},Sn=async function(h){var t,a;if(!(!((a=(t=window?.navigator)===null||t===void 0?void 0:t.mediaDevices)===null||a===void 0)&&a.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let f;try{we._onLog&&we._onLog("======try getUserMedia========");let g=[0,500,1e3,2e3],v=null;const y=async w=>{for(let I of g){I&&(await new Promise(x=>setTimeout(x,I)),R(this,fe,"m",St).call(this));try{we._onLog&&we._onLog("ask "+JSON.stringify(w)),f=await navigator.mediaDevices.getUserMedia(w),R(this,fe,"m",St).call(this);break}catch(x){if(x.name==="NotFoundError"||x.name==="NotAllowedError"||x.name==="AbortError"||x.name==="OverconstrainedError")throw x;v=x,we._onLog&&we._onLog(x.message||x)}}};if(await y(h),f||typeof h.video!="object"||(h.video.deviceId&&(delete h.video.deviceId,await y(h)),!f&&h.video.facingMode&&(delete h.video.facingMode,await y(h)),f||!h.video.width&&!h.video.height||(delete h.video.width,delete h.video.height,await y(h))),!f)throw v;return f}catch(g){throw f?.getTracks().forEach(v=>{v.stop()}),g.name==="NotFoundError"&&(DOMException?g=new DOMException("No camera available, please use a device with an accessible camera.",g.name):(g=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),g}},Tn=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(h=>{h.stop()}),this._mediaStream=null),ke(this,Be,null)},ji=async function(){ke(this,xt,!1);const h=ke(this,Yr,Symbol());if(R(this,Wt,"f")&&R(this,dt,"f")==="pending"){try{await R(this,Wt,"f")}catch{}R(this,fe,"m",St).call(this)}return h!==R(this,Yr,"f")?void 0:ke(this,Wt,(async()=>{ke(this,dt,"pending","f");try{if(this.videoSrc){if(!R(this,Ae,"f"))throw new Error("'videoEl' should be set.");await we.playVideo(R(this,Ae,"f"),this.videoSrc,this.cameraOpenTimeout),R(this,fe,"m",St).call(this)}else{let a=await R(this,fe,"m",Gs).call(this);R(this,fe,"m",Tn).call(this);let f=await R(this,fe,"m",Sn).call(this,a);await this._getCameras(!1),R(this,fe,"m",St).call(this);const g=()=>{const I=f.getVideoTracks();let x,A;if(I.length&&(x=I[0]),x){const L=x.getSettings();if(L){for(let k of this._arrCameras)if(L.deviceId===k.deviceId){k._checked=!0,k.label=x.label,A=k;break}}}return A},v=R(this,We,"f");if(typeof v.video=="object"){let I=v.video.facingMode;if(I instanceof Array&&I.length&&(I=I[0]),typeof I=="object"&&(I=I.exact||I.ideal),!(R(this,Bt,"f")||this.ifSaveLastUsedCamera&&we.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||v.video.deviceId)){const x=g(),A=we.findBestCamera(this._arrCameras,I,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});A&&A!=x?.deviceId&&(f.getTracks().forEach(L=>{L.stop()}),a.video.deviceId={exact:A},f=await R(this,fe,"m",Sn).call(this,a),R(this,fe,"m",St).call(this))}}const y=g();y?.deviceId&&(ke(this,Bt,y&&y.deviceId,"f"),this.ifSaveLastUsedCamera&&we.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",R(this,Bt,"f")),typeof a.video=="object"&&a.video.width&&a.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(a.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(a.video.height))))),R(this,Ae,"f")&&(await we.playVideo(R(this,Ae,"f"),f,this.cameraOpenTimeout),R(this,fe,"m",St).call(this)),this._mediaStream=f;const w=f.getVideoTracks();w?.length&&ke(this,Be,w[0],"f"),ke(this,Et,y,"f")}}catch(a){throw R(this,fe,"m",on).call(this),ke(this,dt,null,"f"),a}ke(this,dt,"fulfilled","f")})())},mr=async function(){var h;if(this.state==="closed"||this.videoSrc)return;const t=(h=R(this,Et,"f"))===null||h===void 0?void 0:h.deviceId,a=this.getResolution();await R(this,fe,"m",ji).call(this);const f=this.getResolution();t&&t!==R(this,Et,"f").deviceId&&R(this,Qe,"f").fire("camera:changed",[R(this,Et,"f").deviceId,t],{target:this,async:!1}),a.width==f.width&&a.height==f.height||R(this,Qe,"f").fire("resolution:changed",[{width:f.width,height:f.height},{width:a.width,height:a.height}],{target:this,async:!1}),R(this,Qe,"f").fire("played",null,{target:this,async:!1})},on=function(){R(this,fe,"m",Tn).call(this),ke(this,Et,null),R(this,Ae,"f")&&(R(this,Ae,"f").srcObject=null,this.videoSrc&&(R(this,Ae,"f").pause(),R(this,Ae,"f").currentTime=0)),ke(this,xt,!0);try{this.resetSoftwareScale()}catch{}},lt=async function h(t,a){const f=V=>{if(!R(this,Be,"f")||!this.isVideoPlaying||V.focusTaskId!=this._focusParameters.curFocusTaskId){R(this,Be,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const W=new Error(`Focus task ${V.focusTaskId} canceled.`);throw W.name="DeprecatedTaskError",W}this._focusParameters.isDoingFocus===1&&Date.now()-V.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let g;a=ot(a,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await R(this,Be,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}),f(t),g=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/a),Math.abs(1/this._focusParameters.fds.max-1/a))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/a)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=a,await new Promise(V=>{setTimeout(V,g)}),f(t);let v=t.focusL-t.focusW/2,y=t.focusT-t.focusH/2,w=t.focusW,I=t.focusH;const x=this.getResolution();if(v>=x.width||y>=x.height)throw new Error("Invalid area.");v+w>x.width&&(w=x.width-v),y+I>x.height&&(I=x.height-y),v=Math.round(v),y=Math.round(y),w=Math.round(w),I=Math.round(I);const A=4*x.width*x.height*this._focusParameters.defaultTempBufferContainerLenRatio,L=4*w*I;let k=this._focusParameters.tempBufferContainer;if(k){const V=k.length;A>V&&A>=L?k=new Uint8Array(A):L>V&&L>=A&&(k=new Uint8Array(L))}else k=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(A,L));if(!this.imageDataGetter.getImageData(R(this,Ae,"f"),x.width,x.height,{sx:v,sy:y,sWidth:w,sHeight:I,dWidth:w,dHeight:I},{pixelFormat:Pe.RGBA,bufferContainer:k}))return R(this,fe,"m",h).call(this,t,a);const N=k;let P=0;for(let V=0,W=L-8;V<W;++V){let X=N[V]-N[V+8];++V;let K=N[V]-N[V+8];++V;let ee=N[V]-N[V+8];++V,P+=X*X+K*K+ee*ee}return-P},Ii=async function h(t,a,f,g,v,y,w){let I;if(a=ot(a,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),g=ot(g,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y?y=ot(y,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(y=ot(Math.sqrt((a||this._focusParameters.fds.step)*(g||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),w=await R(this,fe,"m",lt).call(this,t,y)),w<=f&&w<=v?I=3:f<v&&f<w?I=1:v<f&&v<w&&(I=2),(g-a)/2<=this._focusParameters.fds.step)return I===3||(I===1?await R(this,Be,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:a}]}):I===2&&await R(this,Be,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:g}]})),!0;if(I===1)return await R(this,fe,"m",h).call(this,t,a,f,y,w);if(I===2)return await R(this,fe,"m",h).call(this,t,y,w,g,v);if(I!==3)return f=await R(this,fe,"m",lt).call(this,t,a),v=await R(this,fe,"m",lt).call(this,t,g),await R(this,fe,"m",h).call(this,t,a,f,g,v);let x=ot(Math.sqrt((a||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),A=ot(Math.sqrt((g||this._focusParameters.fds.step)*(y||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/x)<=Math.abs(1/this._focusParameters.oldDistance-1/A)){let L=await R(this,fe,"m",lt).call(this,t,x);if(L<w)return await R(this,fe,"m",h).call(this,t,a,f,y,w,x,L);if(L==w)return await R(this,fe,"m",h).call(this,t,x,L,y,w);let k=await R(this,fe,"m",lt).call(this,t,A);if(L>w&&w<k)return await R(this,fe,"m",h).call(this,t,x,L,A,k,y,w);if(w==k)return await R(this,fe,"m",h).call(this,t,y,w,A,k);if(w>k)return await R(this,fe,"m",h).call(this,t,y,w,g,v,A,k)}else{let L=await R(this,fe,"m",lt).call(this,t,A);if(w>L)return await R(this,fe,"m",h).call(this,t,y,w,g,v,A,L);if(w==L)return await R(this,fe,"m",h).call(this,t,y,w,A,L);let k=await R(this,fe,"m",lt).call(this,t,x);if(k>w&&w<L)return await R(this,fe,"m",h).call(this,t,x,k,A,L,y,w);if(k==w)return await R(this,fe,"m",h).call(this,t,x,k,y,w);if(k<w)return await R(this,fe,"m",h).call(this,t,a,f,y,w,x,k)}return!1},zn=async function(h,t,a,f,g){var v;if(this._focusParameters.isDoingFocus==1)return!1;if(!h||typeof h.x!="string"||typeof h.y!="string")throw new Error("Invalid 'centerPoint'.");if(!t||typeof t!="string")throw new Error("Invalid 'width'.");if(!a||typeof a!="string")throw new Error("Invalid 'height'.");const y=this.getResolution();let w=0,I=0;if(h.x.endsWith("px"))w=parseFloat(h.x);else{if(!h.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");w=parseFloat(h.x)/100*y.width}if(h.y.endsWith("px"))I=parseFloat(h.y);else{if(!h.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");I=parseFloat(h.y)/100*y.height}if(isNaN(w)||isNaN(I)||w<0||w>y.width||I<0||I>y.height)throw new Error("Invalid 'centerPoint'.");let x=0;if(t.endsWith("px"))x=parseFloat(t);else{if(!t.endsWith("%"))throw new Error("Invalid 'width'.");x=parseFloat(t)/100*y.width}if(isNaN(x)||x<0)throw new Error("Invalid 'width'.");let A=0;if(a.endsWith("px"))A=parseFloat(a);else{if(!a.endsWith("%"))throw new Error("Invalid 'height'.");A=parseFloat(a)/100*y.height}if(isNaN(A)||A<0)throw new Error("Invalid 'height'.");if(R(this,jt,"f")!==1){const N=R(this,jt,"f"),P=R(this,Ut,"f");x/=N,A/=N,w=(1-1/N)*P.x+w/N,I=(1-1/N)*P.y+I/N}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(v=this.getCameraCapabilities())===null||v===void 0?void 0:v.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const L={focusL:w,focusT:I,focusW:x,focusH:A,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},k=async(N,P,V)=>{try{(P==null||P<this._focusParameters.fds.min)&&(P=this._focusParameters.fds.min),(V==null||V>this._focusParameters.fds.max)&&(V=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let W=ot(Math.sqrt(V*(P||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),X=ot(Math.sqrt((P||this._focusParameters.fds.step)*W),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),K=ot(Math.sqrt(W*V),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),ee=await R(this,fe,"m",lt).call(this,N,K),ge=await R(this,fe,"m",lt).call(this,N,X),ce=await R(this,fe,"m",lt).call(this,N,W);if(ge>ce&&ce<ee){const Se=await R(this,fe,"m",Ii).call(this,N,X,ge,K,ee,W,ce);return this._focusParameters.isDoingFocus=0,Se}if(ge<ce&&ge<ee){let Se=await R(this,fe,"m",lt).call(this,N,P);const De=await R(this,fe,"m",Ii).call(this,N,P,Se,W,ce,X,ge);return this._focusParameters.isDoingFocus=0,De}if(ce>ee&&ge>ee){let Se=await R(this,fe,"m",lt).call(this,N,V);const De=await R(this,fe,"m",Ii).call(this,N,W,ce,V,Se,K,ee);return this._focusParameters.isDoingFocus=0,De}if(ge==ce&&ce<ee){const Se=await R(this,fe,"m",Ii).call(this,N,X,ge,W,ce);return this._focusParameters.isDoingFocus=0,Se}if(ce==ee&&ge>ce){const Se=await R(this,fe,"m",Ii).call(this,N,W,ce,K,ee);return this._focusParameters.isDoingFocus=0,Se}return k(N,P,V)}catch(W){if(W.name!=="DeprecatedTaskError")throw W}};return k(L,f,g)},Zn=function(h){if(this.state!=="opened")throw new Error("Video is not playing.");if(!h||typeof h.x!="string"||typeof h.y!="string")throw new Error("Invalid 'center'.");const t=this.getResolution();let a=0,f=0;if(h.x.endsWith("px"))a=parseFloat(h.x);else{if(!h.x.endsWith("%"))throw new Error("Invalid scale center.");a=parseFloat(h.x)/100*t.width}if(h.y.endsWith("px"))f=parseFloat(h.y);else{if(!h.y.endsWith("%"))throw new Error("Invalid scale center.");f=parseFloat(h.y)/100*t.height}if(isNaN(a)||isNaN(f))throw new Error("Invalid scale center.");ke(this,Ut,{x:a,y:f})},Ao=function(h){if(this.state!=="opened")throw new Error("Video is not playing.");const t=this.getResolution();return h&&h.x==t.width/2&&h.y==t.height/2},we.browserInfo=nt,we.onWarning=(wn=window?.console)===null||wn===void 0?void 0:wn.warn;class Yt{constructor(t){yr.add(this),an.set(this,void 0),Ui.set(this,0),pi.set(this,void 0),hn.set(this,0),Ni.set(this,!1),ye(this,an,t)}startCharging(){S(this,Ni,"f")||(Yt._onLog&&Yt._onLog("start charging."),S(this,yr,"m",Oo).call(this),ye(this,Ni,!0))}stopCharging(){S(this,pi,"f")&&clearTimeout(S(this,pi,"f")),S(this,Ni,"f")&&(Yt._onLog&&Yt._onLog("stop charging."),ye(this,Ui,Date.now()-S(this,hn,"f")),ye(this,Ni,!1))}}an=new WeakMap,Ui=new WeakMap,pi=new WeakMap,hn=new WeakMap,Ni=new WeakMap,yr=new WeakSet,Vs=function(){Ze.cfd(1),Yt._onLog&&Yt._onLog("charge 1.")},Oo=function h(){S(this,Ui,"f")==0&&S(this,yr,"m",Vs).call(this),ye(this,hn,Date.now()),S(this,pi,"f")&&clearTimeout(S(this,pi,"f")),ye(this,pi,setTimeout(()=>{ye(this,Ui,0,"f"),S(this,yr,"m",h).call(this)},S(this,an,"f")-S(this,Ui,"f")))};const Ws=new Map([[Ee.IPF_GRAYSCALED,Pe.GREY],[Ee.IPF_ABGR_8888,Pe.RGBA],[Ee.IPF_ARGB_8888,Pe.BGRA]]),Ys=new Map([[Pe.GREY,Ee.IPF_GRAYSCALED],[Pe.RGBA,Ee.IPF_ABGR_8888],[Pe.BGRA,Ee.IPF_ARGB_8888]]),In=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Re extends Pn{static set _onLog(t){ye(Re,Kn,t,"f",qn),we._onLog=t,Yt._onLog=t}static get _onLog(){return S(Re,Kn,"f",qn)}static async detectEnvironment(){return await(async()=>({wasm:ha,worker:la,getUserMedia:po,camera:await ca(),browser:tt.browser,version:tt.version,OS:tt.OS}))()}static async testCameraAccess(){const t=await we.testCameraAccess();return t.ok?{ok:!0,message:"Successfully accessed the camera."}:t.errorName==="InsecureContext"?{ok:!1,message:"Insecure context."}:t.errorName==="OverconstrainedError"||t.errorName==="NotFoundError"?{ok:!1,message:"No camera detected."}:t.errorName==="NotAllowedError"?{ok:!1,message:"No permission to access camera."}:t.errorName==="AbortError"?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:t.errorName==="NotReadableError"?{ok:!1,message:"A hardware error occurred."}:t.errorName==="SecurityError"?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:t.errorMessage}}static async createInstance(t){var a,f;if(t&&!(t instanceof qe))throw new TypeError("Invalid view.");if(!((a=Ke.license)===null||a===void 0)&&a.LicenseManager){if(!(!((f=Ke.license)===null||f===void 0)&&f.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await Ze.loadWasm(["license"]),await Ke.license.dynamsoft()}const g=new Re(t);return Re.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{Re.onWarning&&Re.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Re.onWarning&&Re.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),g}get video(){return S(this,de,"f").getVideoEl()}set videoSrc(t){if(!S(this,de,"f"))throw new Error("Camera manager is null.");S(this,ve,"f")&&(S(this,ve,"f")._hideDefaultSelection=!0),S(this,de,"f").videoSrc=t}get videoSrc(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.videoSrc}set ifSaveLastUsedCamera(t){if(!S(this,de,"f"))throw new Error("Camera manager is null.");S(this,de,"f").ifSaveLastUsedCamera=t}get ifSaveLastUsedCamera(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.ifSaveLastUsedCamera}set ifSkipCameraInspection(t){if(!S(this,de,"f"))throw new Error("Camera manager is null.");S(this,de,"f").ifSkipCameraInspection=t}get ifSkipCameraInspection(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.ifSkipCameraInspection}set cameraOpenTimeout(t){if(!S(this,de,"f"))throw new Error("Camera manager is null.");S(this,de,"f").cameraOpenTimeout=t}get cameraOpenTimeout(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.cameraOpenTimeout}set singleFrameMode(t){if(!["disabled","image","camera"].includes(t))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");ye(this,Zr,t)}get singleFrameMode(){return S(this,Zr,"f")}get _isFetchingStarted(){return S(this,Nt,"f")}get disposed(){return S(this,$n,"f")}constructor(t){if(super(),Fe.add(this),de.set(this,void 0),ve.set(this,void 0),pr.set(this,"closed"),kt.set(this,void 0),fi.set(this,!1),Zr.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&S(this,ve,"f")&&!S(this,ve,"f").disposed&&await this.selectCamera(S(this,ve,"f")._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen()||!S(this,ve,"f")||S(this,ve,"f").disposed)return;let a,f;if(S(this,ve,"f")._selRsl&&S(this,ve,"f")._selRsl.selectedIndex!=-1){let g=S(this,ve,"f")._selRsl.options[S(this,ve,"f")._selRsl.selectedIndex];a=parseInt(g.getAttribute("data-width")),f=parseInt(g.getAttribute("data-height"))}await this.setResolution({width:a,height:f})},this._onCloseBtnClick=async()=>{this.isOpen()&&S(this,ve,"f")&&!S(this,ve,"f").disposed&&this.close()},Kr.set(this,(a,f,g,v)=>{const y=Date.now(),w={sx:v.x,sy:v.y,sWidth:v.width,sHeight:v.height,dWidth:v.width,dHeight:v.height},I=Math.max(w.dWidth,w.dHeight);if(this.canvasSizeLimit&&I>this.canvasSizeLimit){const L=this.canvasSizeLimit/I;w.dWidth>w.dHeight?(w.dWidth=this.canvasSizeLimit,w.dHeight=Math.round(w.dHeight*L)):(w.dWidth=Math.round(w.dWidth*L),w.dHeight=this.canvasSizeLimit)}const x=S(this,de,"f").imageDataGetter.getImageData(a,f,g,w,{pixelFormat:Ws.get(this.getPixelFormat())});let A=null;if(x){const L=Date.now();let k;x.pixelFormat===Pe.GREY?k=x.width:k=4*x.width;let N=!0;w.sx===0&&w.sy===0&&w.sWidth===f&&w.sHeight===g&&(N=!1),A={bytes:x.data,width:x.width,height:x.height,stride:k,format:Ys.get(x.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:tn.ITT_FILE_IMAGE,isCropped:N,cropRegion:{left:v.x,top:v.y,right:v.x+v.width,bottom:v.y+v.height,isMeasuredInPercentage:!1},originalWidth:f,originalHeight:g,currentWidth:x.width,currentHeight:x.height,timeSpent:L-y,timeStamp:L},toCanvas:S(this,qr,"f"),isDCEFrame:!0}}return A}),this._onSingleFrameAcquired=a=>{let f;f=S(this,ve,"f")?S(this,ve,"f").getConvertedRegion():Rr.convert(S(this,gi,"f"),a.width,a.height),f||(f={x:0,y:0,width:a.width,height:a.height});const g=S(this,Kr,"f").call(this,a,a.width,a.height,f);S(this,kt,"f").fire("singleFrameAcquired",[g],{async:!1,copy:!1})},qr.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const a=document.createElement("canvas");let f;if(a.width=this.width,a.height=this.height,this.format===Ee.IPF_GRAYSCALED){f=new Uint8ClampedArray(this.width*this.height*4);for(let g=0;g<f.length;g+=4)f[g]=this.bytes[g/4],f[g+1]=this.bytes[g/4],f[g+2]=this.bytes[g/4],f[g+3]=255}else f=new Uint8ClampedArray(this.bytes.buffer);return a.getContext("2d").putImageData(new ImageData(f,this.width,this.height),0,0),a}),Er.set(this,void 0),gi.set(this,void 0),$r.set(this,Ee.IPF_ABGR_8888),Nt.set(this,!1),this._imageId=-1,ft.set(this,void 0),this.fetchInterval=0,ze.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),pe.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),It.set(this,void 0),$n.set(this,!1),this.isCameraEnhancer=!0,t&&!(t instanceof qe))throw new TypeError("Invalid view.");ye(this,kt,new yo),ye(this,de,new we),this._imageDataGetter=S(this,de,"f").imageDataGetter,S(this,de,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const a=S(this,de,"f").getSoftwareScale();if(a<1)throw new RangeError("Invalid scale value.");S(this,ve,"f")&&!S(this,ve,"f").disposed?(this.video.style.transform=a===1?"":`scale(${a})`,S(this,ve,"f")._updateVideoContainer()):this.video.style.transform=a===1?"":`scale(${a})`},["iPhone","iPad","Android","HarmonyOS"].includes(tt.OS)?S(this,de,"f").setResolution(1280,720):S(this,de,"f").setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",t&&this.setCameraView(t),this._on("before:camera:change",()=>{S(this,It,"f").stopCharging();const a=S(this,ve,"f");a&&!a.disposed&&(a._startLoading(),a.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const a=S(this,ve,"f");a&&!a.disposed&&(a._startLoading(),a.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),t.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{S(this,It,"f").stopCharging();const a=S(this,ve,"f");a&&a.disposed}),this._on("resumed",()=>{const a=S(this,ve,"f");a&&a.disposed}),this._on("tapfocus",()=>{S(this,ze,"f").tapToFocus&&S(this,It,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(a,f)=>{var g,v,y,w;if(S(this,Fe,"m",Ye).call(this)||!this.isOpen()||this.isPaused())return;const I=a.intermediateResultUnits;Re._onLog&&(Re._onLog("intermediateResultUnits:"),Re._onLog(I));let x=!1,A=!1;for(let L of I){if(L.unitType===Bi.IRUT_DECODED_BARCODES&&L.decodedBarcodes.length){x=!0;break}L.unitType===Bi.IRUT_LOCALIZED_BARCODES&&L.localizedBarcodes.length&&(A=!0)}if(Re._onLog&&(Re._onLog("hasLocalizedBarcodes:"),Re._onLog(A)),S(this,ze,"f").autoZoom||S(this,ze,"f").enhancedFocus)if(x)S(this,pe,"f").autoZoomInFrameArray.length=0,S(this,pe,"f").autoZoomOutFrameCount=0,S(this,pe,"f").frameArrayInIdealZoom.length=0,S(this,pe,"f").autoFocusFrameArray.length=0;else{const L=async N=>{await this.setZoom(N),S(this,ze,"f").autoZoom&&S(this,It,"f").startCharging()},k=async N=>{await this.setFocus(N),S(this,ze,"f").enhancedFocus&&S(this,It,"f").startCharging()};if(A){const N=I[0].originalImageTag,P=((g=N.cropRegion)===null||g===void 0?void 0:g.left)||0,V=((v=N.cropRegion)===null||v===void 0?void 0:v.top)||0,W=!((y=N.cropRegion)===null||y===void 0)&&y.right?N.cropRegion.right-P:N.originalWidth,X=!((w=N.cropRegion)===null||w===void 0)&&w.bottom?N.cropRegion.bottom-V:N.originalHeight,K=N.currentWidth,ee=N.currentHeight;let ge;{let ce,Se,De,p,me;{const s=this.video.videoWidth*(1-S(this,pe,"f").autoZoomDetectionArea)/2,r=this.video.videoWidth*(1+S(this,pe,"f").autoZoomDetectionArea)/2,n=r,l=s,e=this.video.videoHeight*(1-S(this,pe,"f").autoZoomDetectionArea)/2,i=e,o=this.video.videoHeight*(1+S(this,pe,"f").autoZoomDetectionArea)/2;me=[{x:s,y:e},{x:r,y:i},{x:n,y:o},{x:l,y:o}]}Re._onLog&&(Re._onLog("detectionArea:"),Re._onLog(me));const Te=[];{const s=(r,n)=>{const l=(i,o)=>{if(!i&&!o)throw new Error("Invalid arguments.");return function(d,c,u){let m=!1;const _=d.length;if(_<=2)return!1;for(let E=0;E<_;E++){const T=d[E],C=d[(E+1)%_];if(fa(T,C,{x:c,y:u}))return!0;En(T.y-u)>0!=En(C.y-u)>0&&En(c-(u-T.y)*(T.x-C.x)/(T.y-C.y)-T.x)<0&&(m=!m)}return m}(o,i.x,i.y)},e=(i,o)=>!!(Ir([i[0],i[1]],[i[2],i[3]],[o[0].x,o[0].y],[o[1].x,o[1].y])||Ir([i[0],i[1]],[i[2],i[3]],[o[1].x,o[1].y],[o[2].x,o[2].y])||Ir([i[0],i[1]],[i[2],i[3]],[o[2].x,o[2].y],[o[3].x,o[3].y])||Ir([i[0],i[1]],[i[2],i[3]],[o[3].x,o[3].y],[o[0].x,o[0].y]));return!!(l({x:r[0].x,y:r[0].y},n)||l({x:r[1].x,y:r[1].y},n)||l({x:r[2].x,y:r[2].y},n)||l({x:r[3].x,y:r[3].y},n))||!!(l({x:n[0].x,y:n[0].y},r)||l({x:n[1].x,y:n[1].y},r)||l({x:n[2].x,y:n[2].y},r)||l({x:n[3].x,y:n[3].y},r))||!!(e([n[0].x,n[0].y,n[1].x,n[1].y],r)||e([n[1].x,n[1].y,n[2].x,n[2].y],r)||e([n[2].x,n[2].y,n[3].x,n[3].y],r)||e([n[3].x,n[3].y,n[0].x,n[0].y],r))};for(let r of I)if(r.unitType===Bi.IRUT_LOCALIZED_BARCODES)for(let n of r.localizedBarcodes){if(!n)continue;const l=n.location.points;l.forEach(e=>{qe._transformCoordinates(e,P,V,W,X,K,ee)}),s(me,l)&&Te.push(n)}if(Re._debug&&S(this,ve,"f")){const r=this.__layer||(this.__layer=S(this,ve,"f")._createDrawingLayer(99));r.clearDrawingItems();const n=this.__styleId2||(this.__styleId2=re.createDrawingStyle({strokeStyle:"red"}));for(let l of I)if(l.unitType===Bi.IRUT_LOCALIZED_BARCODES)for(let e of l.localizedBarcodes){if(!e)continue;const i=e.location.points,o=new Un({points:i},n);r.addDrawingItems([o])}}}if(Re._onLog&&(Re._onLog("intersectedResults:"),Re._onLog(Te)),!Te.length)return;let ue;if(Te.length){let s=Te.filter(r=>r.possibleFormats==In.BF_QR_CODE||r.possibleFormats==In.BF_DATAMATRIX);if(s.length||(s=Te.filter(r=>r.possibleFormats==In.BF_ONED),s.length||(s=Te)),s.length){const r=l=>{const e=l.location.points,i=(e[0].x+e[1].x+e[2].x+e[3].x)/4,o=(e[0].y+e[1].y+e[2].y+e[3].y)/4;return(i-K/2)*(i-K/2)+(o-ee/2)*(o-ee/2)};ue=s[0];let n=r(ue);if(s.length!=1)for(let l=1;l<s.length;l++){const e=r(s[l]);(s[l].confidence>1.1*ue.confidence||s[l].confidence>.9*ue.confidence&&e<n)&&(ue=s[l],n=e)}}}if(Re._onLog&&(Re._onLog("highPriorityResult:"),Re._onLog(ue)),ue){const s=ue.location.points;ce=Math.min(s[0].x,s[1].x,s[2].x,s[3].x),Se=Math.max(s[0].x,s[1].x,s[2].x,s[3].x),De=Math.min(s[0].y,s[1].y,s[2].y,s[3].y),p=Math.max(s[0].y,s[1].y,s[2].y,s[3].y),ge={points:[{x:ce,y:De},{x:Se,y:De},{x:Se,y:p},{x:ce,y:p}],result:ue}}}if(Re._onLog&&(Re._onLog("boundingRect:"),Re._onLog(ge)),!ge)return;if(Re._debug&&S(this,ve,"f")&&ge?.points){const ce=this.__layer||(this.__layer=S(this,ve,"f")._createDrawingLayer(99)),Se=this.__styleId1||(this.__styleId1=re.createDrawingStyle({strokeStyle:"blue"})),De=new Un({points:ge.points},Se);ce.addDrawingItems([De])}if(S(this,pe,"f").autoZoomOutFrameCount=0,S(this,ze,"f").autoZoom){const ce=S(this,pe,"f").autoZoomIdealArea[1];let Se=(1-S(this,pe,"f").autoZoomTargetBorder)/2;const De=ge.points[0].x/W,p=(W-ge.points[2].x)/W,me=ge.points[0].y/X,Te=(X-ge.points[2].y)/X;if(De>ce&&p>ce&&me>ce&&Te>ce&&ge.result.moduleSize<S(this,pe,"f").autoZoomInIdealModuleSize){if(S(this,pe,"f").autoZoomInFrameArray.push(!0),S(this,pe,"f").autoZoomInFrameArray.splice(0,S(this,pe,"f").autoZoomInFrameArray.length-S(this,pe,"f").autoZoomInFrameLimit[0]),S(this,pe,"f").frameArrayInIdealZoom.length=0,S(this,ze,"f").enhancedFocus&&k({mode:"continuous"}).catch(()=>{}),S(this,pe,"f").autoZoomInFrameArray.filter(ue=>ue===!0).length>=S(this,pe,"f").autoZoomInFrameLimit[1]){S(this,pe,"f").autoZoomInFrameArray.length=0;const ue=[(.5-Se)/(.5-De),(.5-Se)/(.5-p),(.5-Se)/(.5-me),(.5-Se)/(.5-Te)].filter(e=>e>0),s=Math.min(...ue,S(this,pe,"f").autoZoomInIdealModuleSize/ge.result.moduleSize),r=this.getZoomSettings().factor;let n=Math.max(Math.pow(r*s,1/S(this,pe,"f").autoZoomInMaxTimes),S(this,pe,"f").autoZoomInMinStep);n=Math.min(n,s);let l=r*n;l=Math.max(S(this,pe,"f").minValue,l),l=Math.min(S(this,pe,"f").maxValue,l);try{await L({factor:l})}catch(e){const i=e.message||e;console.warn(i)}this.clearBuffer()}}else if(S(this,pe,"f").autoZoomInFrameArray.length=0,S(this,pe,"f").frameArrayInIdealZoom.push(!0),S(this,pe,"f").frameArrayInIdealZoom.splice(0,S(this,pe,"f").frameArrayInIdealZoom.length-S(this,pe,"f").frameLimitInIdealZoom[0]),S(this,pe,"f").frameArrayInIdealZoom.filter(ue=>ue===!0).length>=S(this,pe,"f").frameLimitInIdealZoom[1]&&(S(this,pe,"f").frameArrayInIdealZoom.length=0,S(this,ze,"f").enhancedFocus)){const ue=ge.points;try{await k({mode:"manual",area:{centerPoint:{x:(ue[0].x+ue[2].x)/2+"px",y:(ue[0].y+ue[2].y)/2+"px"},width:ue[2].x-ue[0].x+"px",height:ue[2].y-ue[0].y+"px"}})}catch(s){const r=s.message||s;console.warn(r)}this.clearBuffer()}}if(!S(this,ze,"f").autoZoom&&S(this,ze,"f").enhancedFocus&&(S(this,pe,"f").autoFocusFrameArray.push(!0),S(this,pe,"f").autoFocusFrameArray.splice(0,S(this,pe,"f").autoFocusFrameArray.length-S(this,pe,"f").autoFocusFrameLimit[0]),S(this,pe,"f").autoFocusFrameArray.filter(ce=>ce===!0).length>=S(this,pe,"f").autoFocusFrameLimit[1])){S(this,pe,"f").autoFocusFrameArray.length=0;try{const ce=ge.points;await k({mode:"manual",area:{centerPoint:{x:(ce[0].x+ce[2].x)/2+"px",y:(ce[0].y+ce[2].y)/2+"px"},width:ce[2].x-ce[0].x+"px",height:ce[2].y-ce[0].y+"px"}})}catch(ce){const Se=ce.message||ce;console.warn(Se)}this.clearBuffer()}}else{if(S(this,ze,"f").autoZoom){if(S(this,pe,"f").autoZoomInFrameArray.push(!1),S(this,pe,"f").autoZoomInFrameArray.splice(0,S(this,pe,"f").autoZoomInFrameArray.length-S(this,pe,"f").autoZoomInFrameLimit[0]),S(this,pe,"f").autoZoomOutFrameCount++,S(this,pe,"f").frameArrayInIdealZoom.push(!1),S(this,pe,"f").frameArrayInIdealZoom.splice(0,S(this,pe,"f").frameArrayInIdealZoom.length-S(this,pe,"f").frameLimitInIdealZoom[0]),S(this,pe,"f").autoZoomOutFrameCount>=S(this,pe,"f").autoZoomOutFrameLimit){S(this,pe,"f").autoZoomOutFrameCount=0;const N=this.getZoomSettings().factor;let P=N-Math.max((N-1)*S(this,pe,"f").autoZoomOutStepRate,S(this,pe,"f").autoZoomOutMinStep);P=Math.max(S(this,pe,"f").minValue,P),P=Math.min(S(this,pe,"f").maxValue,P);try{await L({factor:P})}catch(V){const W=V.message||V;console.warn(W)}this.clearBuffer()}S(this,ze,"f").enhancedFocus&&k({mode:"continuous"}).catch(()=>{})}!S(this,ze,"f").autoZoom&&S(this,ze,"f").enhancedFocus&&(S(this,pe,"f").autoFocusFrameArray.length=0,k({mode:"continuous"}).catch(()=>{}))}}},ye(this,It,new Yt(1e4))}setCameraView(t){if(!(t instanceof qe))throw new TypeError("Invalid view.");if(t.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),t._singleFrameMode=this.singleFrameMode,t._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(S(this,ve,"f")._hideDefaultSelection=!0),S(this,Fe,"m",Ye).call(this)||S(this,de,"f").setVideoEl(t.getVideoElement()),ye(this,ve,t),this.addListenerToView()}getCameraView(){return S(this,ve,"f")}releaseCameraView(){S(this,ve,"f")&&(this.removeListenerFromView(),S(this,ve,"f").disposed||(S(this,ve,"f")._singleFrameMode="disabled",S(this,ve,"f")._onSingleFrameAcquired=null,S(this,ve,"f")._hideDefaultSelection=!1),S(this,de,"f").releaseVideoEl(),ye(this,ve,null))}addListenerToView(){if(!S(this,ve,"f"))return;if(S(this,ve,"f").disposed)throw new Error("'cameraView' has been disposed.");const t=S(this,ve,"f");S(this,Fe,"m",Ye).call(this)||this.videoSrc||(t._innerComponent&&(S(this,de,"f").tapFocusEventBoundEl=t._innerComponent),t._selCam&&t._selCam.addEventListener("change",this._onCameraSelChange),t._selRsl&&t._selRsl.addEventListener("change",this._onResolutionSelChange)),t._btnClose&&t._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!S(this,ve,"f")||S(this,ve,"f").disposed)return;const t=S(this,ve,"f");S(this,de,"f").tapFocusEventBoundEl=null,t._selCam&&t._selCam.removeEventListener("change",this._onCameraSelChange),t._selRsl&&t._selRsl.removeEventListener("change",this._onResolutionSelChange),t._btnClose&&t._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return S(this,Fe,"m",Ye).call(this)?S(this,pr,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(S(this,de,"f").state)}isOpen(){return this.getCameraState()==="open"}getVideoEl(){return this.video}async open(){const t=S(this,ve,"f");if(t?.disposed)throw new Error("'cameraView' has been disposed.");t&&(t._singleFrameMode=this.singleFrameMode,S(this,Fe,"m",Ye).call(this)?t._clickIptSingleFrameMode():(S(this,de,"f").setVideoEl(t.getVideoElement()),t._startLoading()));let a={width:0,height:0,deviceId:""};if(!S(this,Fe,"m",Ye).call(this)){try{await S(this,de,"f").open()}catch(g){throw t&&t._stopLoading(),g}S(this,fi,"f")&&this.turnOnTorch().catch(()=>{});const f=this.getResolution();a.width=f.width,a.height=f.height,a.deviceId=this.getSelectedCamera().deviceId}return ye(this,pr,"open"),t&&(t._innerComponent.style.display="",S(this,Fe,"m",Ye).call(this)||(t._stopLoading(),t._renderCamerasInfo(this.getSelectedCamera(),S(this,de,"f")._arrCameras),t._renderResolutionInfo({width:a.width,height:a.height}),t.eventHandler.fire("content:updated",null,{async:!1}),t.eventHandler.fire("videoEl:resized",null,{async:!1}))),S(this,kt,"f").fire("opened",null,{target:this,async:!1}),a}close(){const t=S(this,ve,"f");if(t?.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),S(this,Fe,"m",Ye).call(this)||S(this,de,"f").close(),ye(this,pr,"closed"),S(this,It,"f").stopCharging(),t&&(t._innerComponent.style.display="none",S(this,Fe,"m",Ye).call(this)&&t._innerComponent.removeElement("content"),t._stopLoading()),S(this,kt,"f").fire("closed",null,{target:this,async:!1})}pause(){if(S(this,Fe,"m",Ye).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");S(this,de,"f").pause()}isPaused(){var t;return!S(this,Fe,"m",Ye).call(this)&&((t=this.video)===null||t===void 0?void 0:t.paused)===!0}async resume(){if(S(this,Fe,"m",Ye).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await S(this,de,"f").resume()}async selectCamera(t){if(!t)throw new Error("Invalid value.");let a;a=typeof t=="string"?t:t.deviceId,await S(this,de,"f").setCamera(a),ye(this,fi,!1);const f=this.getResolution(),g=S(this,ve,"f");return g&&!g.disposed&&(g._stopLoading(),g._renderCamerasInfo(this.getSelectedCamera(),S(this,de,"f")._arrCameras),g._renderResolutionInfo({width:f.width,height:f.height})),{width:f.width,height:f.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return S(this,de,"f").getCamera()}async getAllCameras(){return S(this,de,"f").getCameras()}async setResolution(t){await S(this,de,"f").setResolution(t.width,t.height),S(this,fi,"f")&&this.turnOnTorch().catch(()=>{});const a=this.getResolution(),f=S(this,ve,"f");return f&&!f.disposed&&(f._stopLoading(),f._renderResolutionInfo({width:a.width,height:a.height})),{width:a.width,height:a.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return S(this,de,"f").getResolution()}getAvailableResolutions(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getResolutions()}_on(t,a){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(t.toLowerCase())?S(this,kt,"f").on(t,a):S(this,de,"f").on(t,a)}_off(t,a){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(t.toLowerCase())?S(this,kt,"f").off(t,a):S(this,de,"f").off(t,a)}on(t,a){const f=t.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._on(g,a)}off(t,a){const f=t.toLowerCase(),g=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(f);if(!g)throw new Error("Invalid event.");this._off(g,a)}getVideoSettings(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getMediaStreamConstraints()}async updateVideoSettings(t){var a;await((a=S(this,de,"f"))===null||a===void 0?void 0:a.setMediaStreamConstraints(t,!0))}getCapabilities(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getCameraCapabilities()}getCameraSettings(){return S(this,de,"f").getCameraSettings()}async turnOnTorch(){var t;if(S(this,Fe,"m",Ye).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");await((t=S(this,de,"f"))===null||t===void 0?void 0:t.turnOnTorch()),ye(this,fi,!0)}async turnOffTorch(){var t;if(S(this,Fe,"m",Ye).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await((t=S(this,de,"f"))===null||t===void 0?void 0:t.turnOffTorch()),ye(this,fi,!1)}async setColorTemperature(t){if(S(this,Fe,"m",Ye).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await S(this,de,"f").setColorTemperature(t,!0)}getColorTemperature(){return S(this,de,"f").getColorTemperature()}async setExposureCompensation(t){var a;if(S(this,Fe,"m",Ye).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await((a=S(this,de,"f"))===null||a===void 0?void 0:a.setExposureCompensation(t,!0))}getExposureCompensation(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getExposureCompensation()}async _setZoom(t){var a;if(S(this,Fe,"m",Ye).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await((a=S(this,de,"f"))===null||a===void 0?void 0:a.setZoom(t))}async setZoom(t){await this._setZoom(t)}getZoomSettings(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getZoom()}async resetZoom(){var t;if(S(this,Fe,"m",Ye).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await((t=S(this,de,"f"))===null||t===void 0?void 0:t.resetZoom())}async setFrameRate(t){var a;if(S(this,Fe,"m",Ye).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await((a=S(this,de,"f"))===null||a===void 0?void 0:a.setFrameRate(t,!0))}getFrameRate(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getFrameRate()}async setFocus(t){var a;if(S(this,Fe,"m",Ye).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await((a=S(this,de,"f"))===null||a===void 0?void 0:a.setFocus(t,!0))}getFocusSettings(){var t;return(t=S(this,de,"f"))===null||t===void 0?void 0:t.getFocus()}setAutoZoomRange(t){S(this,pe,"f").minValue=t.min,S(this,pe,"f").maxValue=t.max}getAutoZoomRange(){return{min:S(this,pe,"f").minValue,max:S(this,pe,"f").maxValue}}async enableEnhancedFeatures(t){var a,f;if(!(!((f=(a=Ke.license)===null||a===void 0?void 0:a.LicenseManager)===null||f===void 0)&&f.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(Ze.bSupportDce4Module!==0)throw new Error("Please set a license containing the DCE module.");t&Qt.EF_ENHANCED_FOCUS&&(S(this,ze,"f").enhancedFocus=!0),t&Qt.EF_AUTO_ZOOM&&(S(this,ze,"f").autoZoom=!0),t&Qt.EF_TAP_TO_FOCUS&&(S(this,ze,"f").tapToFocus=!0,S(this,de,"f").enableTapToFocus())}disableEnhancedFeatures(t){t&Qt.EF_ENHANCED_FOCUS&&(S(this,ze,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),t&Qt.EF_AUTO_ZOOM&&(S(this,ze,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),t&Qt.EF_TAP_TO_FOCUS&&(S(this,ze,"f").tapToFocus=!1,S(this,de,"f").disableTapToFocus()),S(this,Fe,"m",Do).call(this)&&S(this,Fe,"m",Ro).call(this)||S(this,It,"f").stopCharging()}_setScanRegion(t){if(t!=null&&!as(t)&&!vi(t))throw TypeError("Invalid 'region'.");ye(this,gi,t?JSON.parse(JSON.stringify(t)):null),S(this,ve,"f")&&!S(this,ve,"f").disposed&&S(this,ve,"f").setScanRegion(t)}setScanRegion(t){this._setScanRegion(t),S(this,ve,"f")&&!S(this,ve,"f").disposed&&(t===null?S(this,ve,"f").setScanRegionMaskVisible(!1):S(this,ve,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(S(this,gi,"f")))}setErrorListener(t){if(!t)throw new TypeError("Invalid 'listener'");ye(this,Er,t)}hasNextImageToFetch(){return!(this.getCameraState()!=="open"||!S(this,de,"f").isVideoLoaded()||S(this,Fe,"m",Ye).call(this))}startFetching(){if(S(this,Fe,"m",Ye).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");S(this,Nt,"f")||(ye(this,Nt,!0),S(this,Fe,"m",Jn).call(this))}stopFetching(){S(this,Nt,"f")&&(Re._onLog&&Re._onLog("DCE: stop fetching loop: "+Date.now()),S(this,ft,"f")&&clearTimeout(S(this,ft,"f")),ye(this,Nt,!1))}fetchImage(){if(S(this,Fe,"m",Ye).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(this.video.readyState!==4)throw new Error("The video is not loaded.");const t=this.getResolution();if(!t?.width||!t?.height)throw new Error("The video is not loaded.");let a;if(a=Rr.convert(S(this,gi,"f"),t.width,t.height),a||(a={x:0,y:0,width:t.width,height:t.height}),a.x>t.width||a.y>t.height)throw new Error("Invalid scan region.");a.x+a.width>t.width&&(a.width=t.width-a.x),a.y+a.height>t.height&&(a.height=t.height-a.y);const f={sx:a.x,sy:a.y,sWidth:a.width,sHeight:a.height,dWidth:a.width,dHeight:a.height},g=Math.max(f.dWidth,f.dHeight);if(this.canvasSizeLimit&&g>this.canvasSizeLimit){const I=this.canvasSizeLimit/g;f.dWidth>f.dHeight?(f.dWidth=this.canvasSizeLimit,f.dHeight=Math.round(f.dHeight*I)):(f.dWidth=Math.round(f.dWidth*I),f.dHeight=this.canvasSizeLimit)}const v=S(this,de,"f").getFrameData({position:f,pixelFormat:Ws.get(this.getPixelFormat())});if(!v)return null;let y;v.pixelFormat===Pe.GREY?y=v.width:y=4*v.width;let w=!0;return f.sx===0&&f.sy===0&&f.sWidth===t.width&&f.sHeight===t.height&&(w=!1),{bytes:v.data,width:v.width,height:v.height,stride:y,format:Ys.get(v.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:tn.ITT_VIDEO_FRAME,isCropped:w,cropRegion:{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height,isMeasuredInPercentage:!1},originalWidth:t.width,originalHeight:t.height,currentWidth:v.width,currentHeight:v.height,timeSpent:v.timeSpent,timeStamp:v.timeStamp},toCanvas:S(this,qr,"f"),isDCEFrame:!0}}setImageFetchInterval(t){this.fetchInterval=t,S(this,Nt,"f")&&(S(this,ft,"f")&&clearTimeout(S(this,ft,"f")),ye(this,ft,setTimeout(()=>{this.disposed||S(this,Fe,"m",Jn).call(this)},t)))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(t){ye(this,$r,t)}getPixelFormat(){return S(this,$r,"f")}takePhoto(t){if(!this.isOpen())throw new Error("Not open.");if(S(this,Fe,"m",Ye).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),a.setAttribute("capture",""),a.style.position="absolute",a.style.top="-9999px",a.style.backgroundColor="transparent",a.style.color="transparent",a.addEventListener("click",()=>{const f=this.isOpen();this.close(),window.addEventListener("focus",()=>{f&&this.open(),a.remove()},{once:!0})}),a.addEventListener("change",async()=>{const f=a.files[0],g=await(async x=>{let A=null,L=null;if(typeof createImageBitmap<"u")try{if(A=await createImageBitmap(x),A)return A}catch{}var k;return A||(L=await(k=x,new Promise((N,P)=>{let V=URL.createObjectURL(k),W=new Image;W.src=V,W.onload=()=>{URL.revokeObjectURL(W.src),N(W)},W.onerror=X=>{P(new Error("Can't convert blob to image : "+(X instanceof Event?X.type:X)))}}))),L})(f),v=g instanceof HTMLImageElement?g.naturalWidth:g.width,y=g instanceof HTMLImageElement?g.naturalHeight:g.height;let w=Rr.convert(S(this,gi,"f"),v,y);w||(w={x:0,y:0,width:v,height:y});const I=S(this,Kr,"f").call(this,g,v,y,w);t&&t(I)}),document.body.appendChild(a),a.click()}convertToPageCoordinates(t){const a=S(this,Fe,"m",Qn).call(this,t);return{x:a.pageX,y:a.pageY}}convertToClientCoordinates(t){const a=S(this,Fe,"m",Qn).call(this,t);return{x:a.clientX,y:a.clientY}}dispose(){this.close(),S(this,de,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let t in this)delete this[t];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}Kn=Re,de=new WeakMap,ve=new WeakMap,pr=new WeakMap,kt=new WeakMap,fi=new WeakMap,Zr=new WeakMap,Kr=new WeakMap,qr=new WeakMap,Er=new WeakMap,gi=new WeakMap,$r=new WeakMap,Nt=new WeakMap,ft=new WeakMap,ze=new WeakMap,pe=new WeakMap,It=new WeakMap,$n=new WeakMap,Fe=new WeakSet,Ye=function(){return this.singleFrameMode!=="disabled"},Ro=function(){return!this.videoSrc&&S(this,de,"f").state==="opened"},Do=function(){for(let h in S(this,ze,"f"))if(S(this,ze,"f")[h]==1)return!0;return!1},Jn=function h(){if(this.disposed)return;if(this.getCameraState()!=="open"||!S(this,Nt,"f"))return S(this,ft,"f")&&clearTimeout(S(this,ft,"f")),void ye(this,ft,setTimeout(()=>{this.disposed||S(this,Fe,"m",h).call(this)},this.fetchInterval));const t=()=>{var a;let f;Re._onLog&&Re._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{f=this.fetchImage()}catch(g){const v=g.message||g;if(v==="The video is not loaded.")return;if(!((a=S(this,Er,"f"))===null||a===void 0)&&a.onErrorReceived)return void setTimeout(()=>{var y;(y=S(this,Er,"f"))===null||y===void 0||y.onErrorReceived(kn.EC_IMAGE_READ_FAILED,v)},0);console.warn(g)}f?(this.addImageToBuffer(f),Re._onLog&&Re._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),S(this,kt,"f").fire("frameAddedToBuffer",null,{async:!1})):Re._onLog&&Re._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case _i.BOPM_BLOCK:break;case _i.BOPM_UPDATE:t()}else t();S(this,ft,"f")&&clearTimeout(S(this,ft,"f")),ye(this,ft,setTimeout(()=>{this.disposed||S(this,Fe,"m",h).call(this)},this.fetchInterval))},Qn=function(h){if(!S(this,ve,"f"))throw new Error("Camera view is not set.");if(S(this,ve,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!S(this,Fe,"m",Ye).call(this)&&!S(this,de,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(S(this,Fe,"m",Ye).call(this)&&!S(this,ve,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const t=S(this,ve,"f")._innerComponent.getBoundingClientRect(),a=t.left,f=t.top,g=a+window.scrollX,v=f+window.scrollY,{width:y,height:w}=S(this,ve,"f")._innerComponent.getBoundingClientRect();if(y<=0||w<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let I,x,A;if(S(this,Fe,"m",Ye).call(this)){const K=S(this,ve,"f")._innerComponent.getElement("content");I=K.width,x=K.height,A="contain"}else{const K=this.getVideoEl();I=K.videoWidth,x=K.videoHeight,A=S(this,ve,"f").getVideoFit()}const L=y/w,k=I/x;let N,P,V,W,X=1;if(A==="contain")L<k?(X=y/I,N=a+h.x*X,P=f+h.y*X+(w-x*X)/2,V=g+h.x*X,W=v+h.y*X+(w-x*X)/2):(X=w/x,N=a+h.x*X+(y-I*X)/2,P=f+h.y*X,V=g+h.x*X+(y-I*X)/2,W=v+h.y*X);else if(A==="cover")if(L<k){X=w/x;let K=h.x*X-(I*X-y)/2;K=Math.max(K,0),K=Math.min(K,y),N=a+K,P=f+h.y*X,V=g+K,W=v+h.y*X}else{X=y/I;let K=h.y*X-(x*X-w)/2;K=Math.max(K,0),K=Math.min(K,w),N=a+h.x*X,P=f+K,V=g+h.x*X,W=v+K}return{clientX:N,clientY:P,pageX:V,pageY:W}},Re._debug=!1,qn={value:void 0},Re.browserInfo=tt,typeof SuppressedError=="function"&&SuppressedError;var Hs,vt,Xs,es,_r,vr;(function(h){h.GREY="grey",h.GREY32="grey32",h.RGBA="rgba",h.RBGA="rbga",h.GRBA="grba",h.GBRA="gbra",h.BRGA="brga",h.BGRA="bgra"})(Hs||(Hs={}));class Gi{static beep(){if(!this.beepSoundSource)return;let t;if(S(this,vt,"f",_r).size&&(t=S(this,vt,"f",_r).values().next().value,this.beepSoundSource==t.src?(S(this,vt,"f",_r).delete(t),t.play()):t=null),!t)if(S(this,vt,"f",vr).size<64){t=new Audio(this.beepSoundSource);let a=null,f=()=>{t.removeEventListener("loadedmetadata",f),t.play(),a=setTimeout(()=>{S(this,vt,"f",vr).delete(t)},2e3*t.duration)};t.addEventListener("loadedmetadata",f),t.addEventListener("ended",()=>{a!=null&&(clearTimeout(a),a=null),t.pause(),t.currentTime=0,S(this,vt,"f",vr).delete(t),S(this,vt,"f",_r).add(t)})}else S(this,vt,"f",es)||(ye(this,vt,!0,"f",es),console.warn("The requested audio tracks exceed 64 and will not be played."));t&&S(this,vt,"f",vr).add(t)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Gi.vibrateDuration)}}vt=Gi,Xs={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},es={value:!1},_r={value:new Set},vr={value:new Set},Gi.beepSoundSource=S(Gi,vt,"f",Xs),Gi.vibrateDuration=300;/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.2.10
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const Lo=typeof self>"u",hs=(()=>{if(!Lo&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})(),Mo=h=>{if(h==null&&(h="./"),!Lo){let t=document.createElement("a");t.href=h,h=t.href}return h.endsWith("/")||(h+="/"),h};Ie.dbr==null&&(Ie.dbr=hs),Ht.dbr={js:!1,wasm:!0,deps:["license","dip"]},Ke.dbr={};const bn="1.2.0";typeof Ie.std!="string"&&ri(Ie.std.version,bn)<0&&(Ie.std={version:bn,path:Mo(hs+`../../dynamsoft-capture-vision-std@${bn}/dist/`)});const xn="2.2.10";(!Ie.dip||typeof Ie.dip!="string"&&ri(Ie.dip.version,xn)<0)&&(Ie.dip={version:xn,path:Mo(hs+`../../dynamsoft-image-processing@${xn}/dist/`)});const Ca=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};var zs,Zs,Ks,qs;(function(h){h[h.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",h[h.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",h[h.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(zs||(zs={})),function(h){h[h.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",h[h.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",h[h.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",h[h.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Zs||(Zs={})),function(h){h[h.LM_AUTO=1]="LM_AUTO",h[h.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",h[h.LM_STATISTICS=4]="LM_STATISTICS",h[h.LM_LINES=8]="LM_LINES",h[h.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",h[h.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",h[h.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",h[h.LM_CENTRE=128]="LM_CENTRE",h[h.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",h[h.LM_REV=-2147483648]="LM_REV",h[h.LM_SKIP=0]="LM_SKIP"}(Ks||(Ks={})),function(h){h[h.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",h[h.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",h[h.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",h[h.DM_SMOOTHING=8]="DM_SMOOTHING",h[h.DM_MORPHING=16]="DM_MORPHING",h[h.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",h[h.DM_SHARPENING=64]="DM_SHARPENING",h[h.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",h[h.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",h[h.DM_REV=-2147483648]="DM_REV",h[h.DM_SKIP=0]="DM_SKIP"}(qs||(qs={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Utility JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 1.2.20
 * @fileoverview Dynamsoft JavaScript Library for Utility
 * More info DU JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/utility/utility-module.html
 */const Fo=typeof self>"u",ls=(()=>{if(!Fo&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})(),Po=h=>{if(h==null&&(h="./"),!Fo){let t=document.createElement("a");t.href=h,h=t.href}return h.endsWith("/")||(h+="/"),h};Ie.utility==null&&(Ie.utility=ls),Ht.utility={js:!0,wasm:!0};const An="1.2.10";typeof Ie.std!="string"&&ri(Ie.std.version,An)<0&&(Ie.std={version:An,path:Po(ls+`../../dynamsoft-capture-vision-std@${An}/dist/`)});const On="2.2.30";(!Ie.dip||typeof Ie.dip!="string"&&ri(Ie.dip.version,On)<0)&&(Ie.dip={version:On,path:Po(ls+`../../dynamsoft-image-processing@${On}/dist/`)});const ln={barcode:2,text_line:4,detected_quad:8,normalized_image:16},bi=h=>Object.values(ln).includes(h)||ln.hasOwnProperty(h),Rn=(h,t)=>typeof h=="string"?t[ln[h]]:t[h],Dn=(h,t,a)=>{typeof h=="string"?t[ln[h]]=a:t[h]=a};class wa{constructor(){this.verificationEnabled={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!0,[Ce.CRIT_DETECTED_QUAD]:!0,[Ce.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!1,[Ce.CRIT_DETECTED_QUAD]:!1,[Ce.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[Ce.CRIT_BARCODE]:3e3,[Ce.CRIT_TEXT_LINE]:3e3,[Ce.CRIT_DETECTED_QUAD]:3e3,[Ce.CRIT_NORMALIZED_IMAGE]:3e3}}enableResultCrossVerification(t,a){bi(t)&&Dn(t,this.verificationEnabled,a)}isResultCrossVerificationEnabled(t){return!!bi(t)&&Rn(t,this.verificationEnabled)}enableResultDeduplication(t,a){bi(t)&&Dn(t,this.duplicateFilterEnabled,a)}isResultDeduplicationEnabled(t){return!!bi(t)&&Rn(t,this.duplicateFilterEnabled)}setDuplicateForgetTime(t,a){bi(t)&&(a>18e4&&(a=18e4),a<0&&(a=0),Dn(t,this.duplicateForgetTime,a))}getDuplicateForgetTime(t){return bi(t)?Rn(t,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let t=0;const a=[Ce.CRIT_BARCODE,Ce.CRIT_TEXT_LINE,Ce.CRIT_DETECTED_QUAD];for(let f=0;f<a.length;f++)(this.verificationEnabled[a[f]]||this.duplicateFilterEnabled[a[f]])&&(t|=a[f]);return t}onOriginalImageResultReceived(t){}onDecodedBarcodesReceived(t){if(this.isResultCrossVerificationEnabled(Ce.CRIT_BARCODE))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_BARCODE&&!t[a].verified&&(t[a].isFilter=!0);if(this.isResultDeduplicationEnabled(Ce.CRIT_BARCODE))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_BARCODE&&t[a].duplicate&&(t[a].isFilter=!0)}onRecognizedTextLinesReceived(t){if(this.isResultCrossVerificationEnabled(Ce.CRIT_TEXT_LINE))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_TEXT_LINE&&!t[a].verified&&(t[a].isFilter=!0);if(this.isResultDeduplicationEnabled(Ce.CRIT_TEXT_LINE))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_TEXT_LINE&&t[a].duplicate&&(t[a].isFilter=!0)}onDetectedQuadsReceived(t){if(this.isResultCrossVerificationEnabled(Ce.CRIT_DETECTED_QUAD))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_DETECTED_QUAD&&!t[a].verified&&(t[a].isFilter=!0);if(this.isResultDeduplicationEnabled(Ce.CRIT_DETECTED_QUAD))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_DETECTED_QUAD&&t[a].duplicate&&(t[a].isFilter=!0)}onNormalizedImagesReceived(t){if(this.isResultCrossVerificationEnabled(Ce.CRIT_NORMALIZED_IMAGE))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_NORMALIZED_IMAGE&&!t[a].verified&&(t[a].isFilter=!0);if(this.isResultDeduplicationEnabled(Ce.CRIT_NORMALIZED_IMAGE))for(let a=0;a<t.length;a++)t[a]&&t[a].type===Ce.CRIT_NORMALIZED_IMAGE&&t[a].duplicate&&(t[a].isFilter=!0)}}/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition Bundle
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.2.1000
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/let Jt="./";if(document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}Jt=h.substring(0,h.lastIndexOf("/")+1)}const oi=h=>{h==null&&(h="./");let t=document.createElement("a");return t.href=h,(h=t.href).endsWith("/")||(h+="/"),h};Ze.engineResourcePaths={std:oi(Jt+"../../dynamsoft-capture-vision-std@1.2.10/dist/"),dip:oi(Jt+"../../dynamsoft-image-processing@2.2.30/dist/"),core:oi(Jt+"../../dynamsoft-core@3.2.30/dist/"),license:oi(Jt+"../../dynamsoft-license@3.2.21/dist/"),cvr:oi(Jt+"../../dynamsoft-capture-vision-router@2.2.30/dist/"),dce:oi(Jt+"../../dynamsoft-camera-enhancer@4.0.3/dist/"),dbr:oi(Jt+"../../dynamsoft-barcode-reader@10.2.10/dist/")};/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Code Parser JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 2.2.10
* @fileoverview Dynamsoft JavaScript Library for Code Parser
* More info on dcp JS: https://www.dynamsoft.com/code-parser/docs/web/programming/javascript/
*/var cn,un;function ko(h){delete h.moduleId;const t=JSON.parse(h.jsonString).ResultInfo,a=h.fullCodeString;h.getFieldValue=f=>f.toLowerCase()==="fullcodestring"?a:No(t,f),h.getFieldMappingStatus=f=>Bo(t,f),h.getFieldValidationStatus=f=>jo(t,f),delete h.fullCodeString}function No(h,t){for(let a of h){if(a.FieldName===t)return a.Value;if(a.ChildFields&&a.ChildFields.length>0){let f;for(let g of a.ChildFields)f=No(g,t);if(f!==null)return f}}return null}function Bo(h,t){for(let a of h){if(a.FieldName===t)return a.MappingStatus?Number(cn[a.MappingStatus]):cn.MS_NONE;if(a.ChildFields&&a.ChildFields.length>0){let f;for(let g of a.ChildFields)f=Bo(g,t);if(f!==null)return f}}return null}function jo(h,t){for(let a of h){if(a.FieldName===t&&a.ValidationStatus)return a.ValidationStatus?Number(un[a.ValidationStatus]):un.VS_NONE;if(a.ChildFields&&a.ChildFields.length>0){let f;for(let g of a.ChildFields)f=jo(g,t);if(f!==null)return f}}return null}function xr(h){if(h.disposed)throw new Error('"CodeParser" instance has been disposed')}(function(h){h[h.MS_NONE=0]="MS_NONE",h[h.MS_SUCCEEDED=1]="MS_SUCCEEDED",h[h.MS_FAILED=2]="MS_FAILED"})(cn||(cn={})),function(h){h[h.VS_NONE=0]="VS_NONE",h[h.VS_SUCCEEDED=1]="VS_SUCCEEDED",h[h.VS_FAILED=2]="VS_FAILED"}(un||(un={}));const $s=h=>h&&typeof h=="object"&&typeof h.then=="function";class Sa extends Promise{constructor(t){let a,f;super((g,v)=>{a=g,f=v}),this._s="pending",this.resolve=g=>{this.isPending&&($s(g)?this.task=g:(this._s="fulfilled",a(g)))},this.reject=g=>{this.isPending&&(this._s="rejected",f(g))},this.task=t}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let a;this._task=t,$s(t)?a=t:typeof t=="function"&&(a=new Promise(t)),a&&(async()=>{try{const f=await a;t===this._task&&this.resolve(f)}catch(f){t===this._task&&this.reject(f)}})()}get isEmpty(){return this._task==null}}class cs{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static async createInstance(){if(!Ke.license)throw Error("Module `license` is not existed.");await Ke.license.dynamsoft(),await yt("dcp");const t=new cs,a=new Sa;let f=je();return Le[f]=async g=>{if(g.success)t._instanceID=g.instanceID,a.resolve(t);else{const v=Error(g.message);g.stack&&(v.stack=g.stack),a.reject(v)}},xe.postMessage({type:"dcp_createInstance",id:f}),a}async dispose(){xr(this);let t=je();this.bDestroyed=!0,Le[t]=a=>{if(!a.success){let f=new Error(a.message);throw f.stack=a.stack+`
`+f.stack,f}},xe.postMessage({type:"dcp_dispose",id:t,instanceID:this._instanceID})}get disposed(){return this.bDestroyed}async initSettings(t){return xr(this),t&&["string","object"].includes(typeof t)?(typeof t=="string"&&Ko(t)&&(t=await Mn(t,"text")),typeof t=="object"&&(t=JSON.stringify(t)),await new Promise((a,f)=>{let g=je();Le[g]=async v=>{if(v.success){const y=JSON.parse(v.response);if(y.exception!==0){let w=new Error(y.description?y.description:"Init Settings Failed.");return w.errorCode=y.exception,f(w)}return a(y)}{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,f(y)}},xe.postMessage({type:"dcp_initSettings",id:g,instanceID:this._instanceID,body:{settings:t}})})):console.error("Invalid settings.")}async resetSettings(){return xr(this),await new Promise((t,a)=>{let f=je();Le[f]=async g=>{if(g.success)return t();{let v=new Error(g.message);return v.stack=g.stack+`
`+v.stack,a(v)}},xe.postMessage({type:"dcp_resetSettings",id:f,instanceID:this._instanceID})})}async parse(t,a=""){if(xr(this),!(t&&(t instanceof Array||t instanceof Uint8Array||typeof t=="string")))throw new Error("`parse` must pass in an Array or Uint8Array or string");return await new Promise((f,g)=>{let v=je();t instanceof Array&&(t=Uint8Array.from(t)),typeof t=="string"&&(t=Uint8Array.from(function(y){let w=[];for(let I=0;I<y.length;++I)w.push(y.charCodeAt(I));return w}(t))),Le[v]=async y=>{if(y.success){let w=JSON.parse(y.parseResponse);return w.exception?g(new Error(w.description)):(ko(w),f(w))}{let w=new Error(y.message);return w.stack=y.stack+`
`+w.stack,g(w)}},xe.postMessage({type:"dcp_parse",id:v,instanceID:this._instanceID,body:{source:t,taskSettingName:a}})})}}const Uo=typeof self>"u",Go=(()=>{if(!Uo&&document.currentScript){let h=document.currentScript.src,t=h.indexOf("?");if(t!=-1)h=h.substring(0,t);else{let a=h.indexOf("#");a!=-1&&(h=h.substring(0,a))}return h.substring(0,h.lastIndexOf("/")+1)}return"./"})(),Ta=h=>{if(h==null&&(h="./"),!Uo){let t=document.createElement("a");t.href=h,h=t.href}return h.endsWith("/")||(h+="/"),h};Ie.dcp==null&&(Ie.dcp=Go),Ht.dcp={js:!0,wasm:!0,deps:["license"]},Ke.dcp={handleParsedResultItem:ko};const Ln="1.2.0";typeof Ie.std!="string"&&ri(Ie.std.version,Ln)<0&&(Ie.std={version:Ln,path:Ta(Go+`../../dynamsoft-capture-vision-std@${Ln}/dist/`)});class Js{static getVersion(){const t=Tt.dcp&&Tt.dcp.wasm;return`2.2.10(Worker: ${Tt.dcp&&Tt.dcp.worker||"Not Loaded"}, Wasm: ${t||"Not Loaded"})`}static async loadSpec(t,a){return await yt("dcp"),await new Promise((f,g)=>{let v=je();Le[v]=async w=>{if(w.success)return f();{let I=new Error(w.message);return I.stack=w.stack+`
`+I.stack,g(I)}},a&&!a.endsWith("/")&&(a+="/");const y=t instanceof Array?t:[t];xe.postMessage({type:"dcp_appendResourceBuffer",id:v,body:{specificationPath:a||Ze.engineResourcePaths.dcp+"specification/",specificationNames:y}})})}}async function Ia(){try{et.initLicense(""),Ze.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.2.10/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.2.30/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.2.30/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.2.21/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.2.30/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.2.10/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.3/dist/",dcp:"https://cdn.jsdelivr.net/npm/dynamsoft-code-parser@2.2.10/dist/"},Ze.loadWasm(["DBR","DCP"]),Js.loadSpec("AAMVA_DL_ID"),Js.loadSpec("AAMVA_DL_ID_WITH_MAG_STRIPE"),console.log("Success")}catch(h){throw console.error("Failed to load Dynamsoft SDK:",h),h}}function Qs(h){document.getElementById(h).style.display="block"}function eo(h){document.getElementById(h).style.display="none"}async function Vo(){const h="camera-view-container",t=document.getElementById("camera-view-container"),a=t,f=document.createElement("div");f.id="enhancerUIContainer",f.style.width="100%",f.style.height="60vh",f.style.maxHeight="50vh",f.style.background="#ddd";const g=document.createElement("div");g.className="dce-video-container",g.style.width="100%",g.style.height="50%",g.style.maxHeight="50vh",g.style.objectFit="cover",f.appendChild(g),t.appendChild(f),Qs(h);const v=await qe.createInstance(f),y=await Re.createInstance(v);a.append(v.getUIElement());const w=await oa.createInstance();w.setInput(y);const I=new wa;I.enableResultDeduplication("barcode",!0),await w.addResultFilter(I),w.addResultReceiver({onDecodedBarcodesReceived:async L=>{if(!L.barcodeResultItems.length)return;const k=await cs.createInstance();try{let N=await k.parse(L.barcodeResultItems[0].bytes);if(N.exception)return!1;N=JSON.parse(N.jsonString);let P={};if(N.CodeType==="AAMVA_DL_ID")for(let ee of N.ResultInfo)ee.FieldName==="commonSubfile"&&ee.ChildFields&&A(ee.ChildFields,P);else if(N.CodeType==="AAMVA_DL_ID_WITH_MAG_STRIPE")for(let ee of N.ResultInfo)ee.FieldName.includes("track")&&ee.ChildFields&&A(ee.ChildFields,P);console.log(P);const V=P.birthDate,W=`${V.slice(0,2)}/${V.slice(2,4)}/${V.slice(4)}`,X=()=>{switch(P.sex){case"male":return"Male";case"female":return"Female";default:return"Unknown"}},K=()=>{switch(P.jurisdictionCode){case"Alabama":return"AL";case"Alaska":return"AK";case"Arizona":return"AZ";case"Arkansas":return"AR";case"California":return"CA";case"Colorado":return"CO";case"Connecticut":return"CT";case"Delaware":return"DE";case"Florida":return"FL";case"Georgia":return"GA";case"Hawaii":return"HI";case"Idaho":return"ID";case"Illinois":return"IL";case"Indiana":return"IN";case"Iowa":return"IA";case"Kansas":return"KS";case"Kentucky":return"KY";case"Louisiana":return"LA";case"Maine":return"ME";case"Maryland":return"MD";case"Massachusetts":return"MA";case"Michigan":return"MI";case"Minnesota":return"MN";case"Mississippi":return"MS";case"Missouri":return"MO";case"Montana":return"MT";case"Nebraska":return"NE";case"Nevada":return"NV";case"New Hampshire":return"NH";case"New Jersey":return"NJ";case"New Mexico":return"NM";case"New York":return"NY";case"North Carolina":return"NC";case"North Dakota":return"ND";case"Ohio":return"OH";case"Oklahoma":return"OK";case"Oregon":return"OR";case"Pennsylvania":return"PA";case"Rhode Island":return"RI";case"South Carolina":return"SC";case"South Dakota":return"SD";case"Tennessee":return"TN";case"Texas":return"TX";case"Utah":return"UT";case"Vermont":return"VT";case"Virginia":return"VA";case"Washington":return"WA";case"West Virginia":return"WV";case"Wisconsin":return"WI";case"Wyoming":return"WY";default:return"Unknown"}};return document.getElementById("guestfname").value=P.firstName,document.getElementById("guestlname").value=P.lastName,document.getElementById("dobWaiver").value=W,document.getElementById("genderWaiver").value=X(),document.getElementById("firstName").value=P.firstName,document.getElementById("lastName").value=P.lastName,document.getElementById("state").value=K(),document.getElementById("addressLine1").value=P.street_1,document.getElementById("city").value=P.city,document.getElementById("zipCode").value=P.postalCode,document.getElementById("birthday").value=W,document.getElementById("gender").value=X(),w.stopCapturing(),y.close(),eo(h),!0}catch(N){return alert(N.message),!1}}});let x=await w.getSimplifiedSettings("ReadDenseBarcodes");x.barcodeSettings.barcodeFormatIds=Ca.BF_PDF417,await w.updateSettings("ReadDenseBarcodes",x),y.singleFrameMode="image",await y.open(),await w.startCapturing("ReadDenseBarcodes"),document.getElementById("okaymodalBtn15").onclick=async()=>{w.stopCapturing(),y.close(),eo(h)},document.getElementById("startBtn15").onclick=async()=>{Qs(h),await Vo()};function A(L,k){for(let N of L)for(let P of N)["dataElementSeparator","segmentTerminator","subfile","subfileType"].includes(P.FieldName)||(k[P.FieldName]=P.Value),P.ChildFields&&A(P.ChildFields,k)}}await Ia();await Vo();
